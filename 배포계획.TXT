웹메일요약 배포/업데이트 계획 (초안)
작성일: 2026-02-27

1) 목표
- 사용자가 설치형 앱을 쓰는 동안 "새 버전 있음"을 명확히 인지하게 한다.
- 사용자 선택지를 제공한다: 지금 업데이트 / 나중에 / 1주일 동안 다시 보지 않기.
- 보안 업데이트는 일반 기능 업데이트와 다른 정책(더 강한 안내/제한)을 적용한다.
- 단계적 배포, 중단(halt), 롤백 가능한 운영 체계를 갖춘다.

2) 우리 프로젝트 기준 현재 상태
- 버전 소스: pyproject.toml 의 version = "0.1.0".
- 자동 업데이트 구현: 현재 없음(체크/다운로드/적용 플로우 미구현).
- 재사용 가능한 패턴:
  - 설정 저장: src/webmail_summary/index/settings.py, settings 테이블(src/webmail_summary/index/db.py)
  - 백그라운드 진행률 UI: jobs + SSE 패턴(src/webmail_summary/api/routes_jobs.py, src/webmail_summary/jobs/tasks_local_install.py)
- 의미: 업데이트 기능은 "설정 저장 + jobs 진행률" 조합으로 비교적 자연스럽게 붙일 수 있다.

3) 상용 프로그램 사례 조사 요약 (참고)

3.1 Chrome (관리형)
- 재시작 권고/필수(relaunch recommended/required) 정책을 분리 운영.
- RelaunchNotificationPeriod 기본 7일(604,800,000ms)로 설정 가능.
- 시사점: "1주일 미루기"는 업계에서 충분히 검증된 UX 길이.
- 출처: https://support.google.com/chrome/a/answer/7679871?hl=en

3.2 VS Code
- 업데이트 모드를 정책으로 분리: default/start/manual/none.
- 시사점: 개인 사용자/조직 사용자 요구가 다르므로 "업데이트 채널/자동여부" 설정 분리가 유효.
- 출처: https://code.visualstudio.com/docs/enterprise/updates

3.3 Slack
- 사용자가 Check for Updates 수행 가능, 적용 시 재시작 안내.
- 보안 관련 업데이트 중요도를 릴리즈 커뮤니케이션에서 구분.
- 시사점: 앱 내 수동 확인 메뉴 + 보안 중요도 라벨 권장.
- 출처: https://slack.com/help/articles/360048367814-Update-the-Slack-desktop-app

3.4 Notion
- 기본 자동 업데이트 + 필요 시 수동 확인 제공.
- 시사점: 기본은 자동 체크, 사용자에게 수동 제어권도 제공.
- 출처: https://www.notion.com/en-gb/help/notion-for-desktop?nxtPslug=notion-for-desktop

3.5 JetBrains Rider
- 업데이트 시 "지금 업데이트/연기(postpone)/무시(ignore)" 선택지 제공.
- 패치 업데이트 우선, 불가 시 신규 설치.
- 시사점: "나중에"와 "이번 버전 무시"는 각각 다른 의도이므로 구분하는 것이 좋다.
- 출처: https://www.jetbrains.com/help/rider/Update.html

3.6 Microsoft Teams
- 자동 업데이트가 환경에 따라 제한될 수 있음을 문서화하고, 수동 확인 경로 제공.
- 시사점: 업데이트 실패/지연 사유를 사용자에게 설명하는 UX가 신뢰를 높인다.
- 출처: https://learn.microsoft.com/en-us/troubleshoot/microsoftteams/teams-sign-in/teams-doesnt-automatically-update

4) 권장 업데이트 UX/정책 (웹메일요약 적용안)

4.1 알림 노출 시점
- 앱 시작 시 1회 체크(기본).
- 앱 실행 중에는 24시간마다 백그라운드 재체크(과도한 방해 방지).
- 업데이트 있음 + snooze 만료 상태일 때만 모달/배너 노출.

4.2 사용자 선택지 (요청사항 반영)
- [지금 업데이트]
  - 업데이트 잡 실행(다운로드 -> 검증 -> 적용).
  - 완료 후 재시작 안내.
- [나중에]
  - 이번 세션에서만 닫음(다음 앱 시작 시 다시 노출).
- [1주일 동안 안 보기]
  - 현재 시각 + 7일을 settings 에 저장.
  - 만료 전에는 동일 버전 알림 숨김.

4.3 보안 업데이트 예외 정책
- critical/security 업데이트는 "1주일 숨김" 선택을 제한하거나, 짧은 기간(예: 24시간)으로 강등.
- 화면에 "보안 업데이트" 라벨/사유를 명시.
- 최소한 "나중에"는 허용하되 반복 알림 주기를 짧게 설정.

4.4 권장 데이터 모델 (settings key)
- update_channel: stable | beta
- update_auto_check_enabled: true | false
- update_last_checked_at: ISO8601
- update_snooze_until: ISO8601 (1주일 숨김)
- update_skip_version: 예) 0.2.1 (선택 기능)
- update_last_prompted_version: 예) 0.2.1

5) 배포 전략 (운영)

5.1 버전/릴리즈 규칙
- 사용자 노출 버전은 SemVer(MAJOR.MINOR.PATCH) 사용.
- 패치(PATCH)는 버그/보안 중심으로 작게 유지.

5.2 채널 전략
- stable 기본, beta 선택.
- 채널 자동 전환 금지(사용자 신뢰 보호).

5.3 점진 배포 (staged rollout)
- 권장 초기 비율: 5% -> 25% -> 50% -> 100%.
- 각 단계에서 크래시율/실패율/롤백율 확인 후 승격.
- 이상 징후 시 즉시 halt.

5.4 롤백/중단
- 최소 1개 이전 설치본(Last Known Good) 유지.
- 업데이트 서버 측 kill switch로 특정 버전 배포 중단 가능하게 설계.
- 주의: 배포 중단은 "미수신 사용자"를 멈추는 것이며, 이미 업데이트한 사용자는 별도 후속조치 필요.

6) 구현 포인트 (이 저장소 기준)

6.1 설정 저장
- src/webmail_summary/index/settings.py 에 update_* key 저장/조회 추가.
- src/webmail_summary/index/db.py 의 settings 테이블은 현재 구조 그대로 재사용 가능.

6.2 체크/실행 흐름
- 앱 시작 체크 지점: src/webmail_summary/app/main.py 또는 src/webmail_summary/ui/routes.py 초기 진입 경로.
- 업데이트 다운로드/적용 작업은 jobs 패턴 재사용:
  - API/SSE: src/webmail_summary/api/routes_jobs.py
  - 작업 구현: src/webmail_summary/jobs/ 아래에 update 전용 task 추가

6.3 UI
- setup/설정 화면에 항목 추가:
  - 자동 업데이트 확인 On/Off
  - 업데이트 채널(stable/beta)
  - 지금 확인(Check for updates)
- 업데이트 알림 모달 버튼:
  - 지금 업데이트 / 나중에 / 1주일 안 보기

7) 릴리즈 노트/사용자 커뮤니케이션 원칙
- 각 버전에 대해 "무엇이 바뀌었는지"와 "사용자 영향"을 짧게 명시.
- 보안 업데이트는 별도 헤더로 분리(중요도 명확화).
- 실패 시 복구 방법(재시도, 수동 설치 링크)을 함께 제공.

8) 단계별 실행 계획
- Phase 1: 수동 확인 + 알림 UX(지금/나중에/1주일 숨김) + settings 저장.
- Phase 2: 백그라운드 다운로드/적용 jobs + 진행률 표시 + 재시작 유도.
- Phase 3: 채널(stable/beta), 점진 배포, kill switch, 롤백 자동화.

9) 참고 자료
- Chrome Enterprise relaunch policy: https://support.google.com/chrome/a/answer/7679871?hl=en
- VS Code enterprise updates: https://code.visualstudio.com/docs/enterprise/updates
- Slack desktop update help: https://slack.com/help/articles/360048367814-Update-the-Slack-desktop-app
- Notion desktop help: https://www.notion.com/en-gb/help/notion-for-desktop?nxtPslug=notion-for-desktop
- JetBrains Rider update docs: https://www.jetbrains.com/help/rider/Update.html
- Microsoft Teams update troubleshooting: https://learn.microsoft.com/en-us/troubleshoot/microsoftteams/teams-sign-in/teams-doesnt-automatically-update
- Windows gradual rollout: https://learn.microsoft.com/en-us/windows/apps/publish/gradual-package-rollout
- Windows MSIX update settings/rollback constraints: https://learn.microsoft.com/en-us/windows/msix/app-installer/update-settings
- Amazon staged rollout concept: https://developer.amazon.com/docs/app-submission/release-updates-in-staged-rollouts.html
- Sparkle publishing (channels/critical/signing 참고): https://sparkle-project.org/documentation/publishing/

끝.
