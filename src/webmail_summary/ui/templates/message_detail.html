{% extends "base.html" %}
{% block content %}
<section class="hero">
  <div class="hero__row">
    <div>
      <p class="muted" style="margin-bottom: 4px;">{{ msg.internal_date }}</p>
      <h1>{{ msg.subject }}</h1>
      {% if msg.summarize_ms or msg.summarized_at %}
        <div class="muted" style="margin-top:8px; font-size: 0.9rem;">
          {% if ui_lang(request) == 'ko' %}요약됨{% else %}Summarized{% endif %}
          {% if msg.summarize_ms %} · {{ msg.summarize_ms }}{% endif %}
          {% if msg.summarized_at %} · {{ msg.summarized_at }}{% endif %}
        </div>
      {% endif %}
    </div>
    <div class="hero__actions">
      <a class="btn btn--secondary" href="{{ msg.back_href or '/' }}">{{ t(request, 'detail.back') }}</a>
    </div>
  </div>

  <div style="margin-top: 16px; display: flex; flex-wrap: wrap; gap: 8px;">
    {% if msg.tags %}
      {% for t in msg.tags %}<span class="chip">#{{ t }}</span>{% endfor %}
    {% endif %}
    {% if msg.topics %}
      {% for t in msg.topics %}<span class="chip" style="border-color: var(--accent); color: var(--accent);">[[{{ t }}]]</span>{% endfor %}
    {% endif %}
  </div>
</section>

<div class="bento-grid" style="margin-top: 24px;">
  <div class="card span-2">
    <div class="card__title">{{ t(request, 'detail.summary') }}</div>
    <div class="card__body">
      <div class="summary-content" style="font-size: 1rem; line-height: 1.7;" data-raw="{{ msg.summary }}"></div>
    </div>
  </div>

  <div class="card span-2">
    <div class="card__title" style="display: flex; justify-content: space-between; align-items: center;">
      <span>{{ t(request, 'detail.original') }}</span>
      {% if msg.has_rendered %}
        <a class="btn btn--secondary" href="/m/{{ msg.id }}/rendered.html" target="_blank" style="padding: 6px 12px; font-size: 0.8rem;">새 창에서 열기</a>
      {% endif %}
    </div>
    <div class="card__body" style="padding: 0; overflow: hidden; border-radius: 0 0 var(--card-radius) var(--card-radius);">
      {% if msg.has_rendered %}
        <iframe src="/m/{{ msg.id }}/rendered.html" style="width: 100%; height: 600px; border: none; background: white;" title="rendered" referrerpolicy="no-referrer"></iframe>
      {% else %}
        <div style="padding: 24px;" class="muted">{{ t(request, 'detail.no_rendered') }}</div>
      {% endif %}
    </div>
  </div>
</div>

<script>
  // Summary formatting is now provided by /static/app.js
  applyFormatting('.summary-content');


  const el = document.querySelector('.summary-content');
  if (el) {
    const raw = el.getAttribute('data-raw');
    if (raw) el.innerHTML = formatSummary(raw);
  }
})();
</script>
{% endblock %}
