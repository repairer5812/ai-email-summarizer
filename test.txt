webmail-summary v2 테스트 방법 (Windows)

목표
- GUI(FastAPI localhost)로 설정/동기화/원문 보기/Obsidian export가 동작하는지 확인
- 로컬 AI(llama.cpp + GGUF)를 설치해서 AI 요약/태그/주제 기능이 동작하는지 확인
- (옵션) OpenRouter를 fallback으로 설정할 수 있는지 확인

0) 사전 준비
- 다우오피스 IMAP이 켜져 있어야 함
- IMAP host 기본값: imap.daouoffice.com
- IMAP port: 993 (SSL)

1) 설치 (권장: venv)
프로젝트 루트에서 실행:

  python -m venv .venv
  .\.venv\Scripts\python.exe -m pip install -U pip
  .\.venv\Scripts\pip.exe install -r requirements.txt
  .\.venv\Scripts\pip.exe install -e .

2) GUI 실행

  .\.venv\Scripts\webmail-summary.exe serve

또는(명령어 치기 싫으면):
- run_dev.cmd 더블클릭

브라우저가 자동으로 열리고, 처음이면 /setup 화면으로 이동함.

3) Setup Wizard 테스트

3-1) IMAP 테스트
- IMAP host/port/user/password 입력
- "Test & Load Folders" 클릭
- 폴더 목록이 로드되는지 확인

3-2) 메일함/필터/저장 위치
- IMAP folder에서 "z이형세"에 해당하는 폴더 선택
- Sender filter 기본값 hslee@tekville.com 확인
- Obsidian export root:
  - 기본값: Desktop\Tekville_Obsidian
  - "Pick" 버튼으로 폴더 선택 가능
- External download limit:
  - 기본값: 1073741824 (1GB)
- Save 클릭

3-3) Local AI 설치(필수 권장)
- Local model tier에서 low/medium/high 중 선택
- "Install engine + model" 클릭
- 진행률 바와 %가 올라가는지 확인
  - 엔진(llama.cpp)과 모델(GGUF)은 %LOCALAPPDATA%\WebmailSummary 아래에 설치됨
  - 다운로드는 중단/재실행해도 이어받기(resume) 됩니다.
  - 설치 완료 표시는 모델 파일 옆에 `.complete` 마커 파일로 관리됩니다.

4) OpenRouter 설정(옵션 fallback)

- Setup 화면에서 OpenRouter model 입력(예: openai/gpt-4o-mini)
- OpenRouter API key 입력(비밀번호 형태, keyring에 저장됨)
- Save 후 Dashboard에서 Sync 실행

5) 동기화(Sync) 테스트
- Dashboard(/)에서 "Sync now" 클릭
- 진행률 바/퍼센트가 올라가는지 확인
- 완료 후 페이지가 자동 새로고침되며 메일 목록이 표시되는지 확인

  (테스트 옵션) 읽음 원복(B)
  - Setup 화면에서 "Testing: revert read flag"를 체크하면,
    Sync 중에는 \Seen(읽음)으로 바뀌지만 Sync가 끝난 후 \Seen을 다시 제거(안읽음)합니다.
  - 주의: Sync 도중 다른 클라이언트(웹/모바일/Outlook)가 같은 메일을 읽으면,
    마지막에 \Seen을 제거하면서 실제 읽음 상태를 숨길 수 있습니다. 테스트 전용 폴더에서 권장.

6) 원문(HTML) & 첨부/외부 리소스 확인
- 메일 목록에서 아무 메일 클릭
- Summary가 보이는지 확인
- rendered.html iframe이 보이는지 확인
- 이미지/영상이 외부 URL이었다면, 오프라인 렌더가 깨지지 않는지 확인

7) Obsidian export 확인
- Desktop\Tekville_Obsidian 아래에 다음이 생겼는지 확인:
  - Mail\YYYY-MM\YYYY-MM-DD - <subject>.md
  - Daily\YYYY-MM-DD.md
  - Topic\<topic>.md
  - Assets\<message_key>\...
  - Raw\<message_key>.eml
- Obsidian에서 열었을 때:
  - tags / topics가 frontmatter에 있는지
  - Daily/Topic backlink 위키링크가 동작하는지
  - 이미지가 ![[...]]로 embed 되는지

8) 아카이브 파일 저장 위치(디버그)
- %LOCALAPPDATA%\WebmailSummary\data\messages\... 아래에
  - raw.eml
  - rendered.html
  - attachments\*
  - external\*
  등이 생성되는지 확인

문제 발생 시
- 서버 로그(터미널) 확인
- Setup에서 IMAP 재테스트
- OpenRouter API key/model 설정 확인
