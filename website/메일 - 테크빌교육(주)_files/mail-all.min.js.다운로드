Handlebars.registerHelper("flagClass",function(d,b){var e="ic_read_no";var c=mailMsg.mail_flag_unseen_message;if(d.indexOf("A")>-1){if(d.indexOf("S")>-1){e="ic_read_reply";c=mailMsg.mail_flag_reply_message}else{e="ic_noread_reply";c=mailMsg.mail_flag_reply_unseen_message}}else{if(d.indexOf("C")>-1){if(d.indexOf("S")>-1){e="ic_read_fw";c=mailMsg.mail_flag_forward_message}else{e="ic_noread_fw";c=mailMsg.mail_flag_forward_unseen_message}}else{if(d.indexOf("S")>-1){e="ic_read_yes";c=mailMsg.mail_flag_seen_message}}}var a='<span class="ic flagClass '+e+'" title="'+c+'"></span>';return new Handlebars.SafeString(a)});Handlebars.registerHelper("flagClassMobile",function(d,b){var e="ic_mail";var c=mailMsg.mail_flag_unseen_message;if(d.indexOf("A")>-1){if(d.indexOf("S")>-1){e="ic_read_reply";c=mailMsg.mail_flag_reply_message}else{e="ic_noread_reply";c=mailMsg.mail_flag_reply_unseen_message}}else{if(d.indexOf("C")>-1){if(d.indexOf("S")>-1){e="ic_read_fw";c=mailMsg.mail_flag_forward_message}else{e="ic_noread_fw";c=mailMsg.mail_flag_forward_unseen_message}}else{if(d.indexOf("S")>-1){e="ic_mail_read";c=mailMsg.mail_flag_seen_message}}}var a='<span class="ic '+e+'" title="'+c+'"></span>';return new Handlebars.SafeString(a)});Handlebars.registerHelper("folderDepthName",function(b,a){if(b=="Inbox"){b=mailMsg.folder_inbox}else{if(b=="Sent"){b=mailMsg.folder_sent}else{if(b=="Drafts"){b=mailMsg.folder_drafts}else{if(b=="Reserved"){b=mailMsg.folder_reserved}else{if(b=="Spam"){b=mailMsg.folder_spam}else{if(b=="Trash"){b=mailMsg.folder_trash}else{if(b=="bill_box"){b=mailMsg.folder_bill}else{if(b=="adv_box"){b=mailMsg.folder_adv}else{if(b=="sns_box"){b=mailMsg.folder_sns}}}}}}}}}return b});Handlebars.registerHelper("viewMoveFolderName",function(b,a){var c=replaceAll(b,"move ","");if(c=="Inbox"){c=mailMsg.folder_inbox}else{if(c=="Sent"){c=mailMsg.folder_sent}else{if(c=="Drafts"){c=mailMsg.folder_drafts}else{if(c=="Reserved"){c=mailMsg.folder_reserved}else{if(c=="Spam"){c=mailMsg.folder_spam}else{if(c=="Trash"){c=mailMsg.folder_trash}else{if(c=="bill_box"){c=mailMsg.folder_bill}else{if(c=="adv_box"){c=mailMsg.folder_adv}else{if(c=="sns_box"){c=mailMsg.folder_sns}else{c=replaceInboxChild(c)}}}}}}}}}return c});Handlebars.registerHelper("viewTagName",function(c,a){var b=replaceAll(c,"tag ","");var d=getTagInfo(b);return(d)?d.name:""});Handlebars.registerHelper("emailName",function(b,a){if(jQuery.trim(b)==""){return""}return(get_name(b)=="")?get_email(b):get_name(b)});Handlebars.registerHelper("makeEmailAddress",function(c,b,a){return getEmailFormat(c,b)});Handlebars.registerHelper("makeEmailFormatName",function(b,a){return getFormatName(b)});Handlebars.registerHelper("makeMdn",function(d,c,b){var a="";if(d=="1"){a=mailMsg.mail_mdn_recall}else{if(d=="1000"){a=Handlebars.helpers.printMdnTimeDate.apply(this,[c])}else{if(d=="100"){a=mailMsg.mail_mdn_wait}else{if(d=="200"||d=="201"||d=="300"){a=mailMsg.mail_mdn_unseen}else{a=mailMsg.mail_mdn_fail}}}}return a});Handlebars.registerHelper("isMdnCheck",function(c,b,a){if(arguments.length<3){throw new Error("Handlebars Helper equal needs 2 parameters")}if(c&&(b=="200"||b=="201"||b=="300")){return a.fn(this)}else{return a.inverse(this)}});Handlebars.registerHelper("printSize",function(b,a){return printSize(b)});Handlebars.registerHelper("printDate",function(b,d,c){var a=d;if(d&&d.length>=8){a=d.substring(0,4)+b+d.substring(4,6)+b+d.substring(6,8)}return a});Handlebars.registerHelper("fileExt",function(b,a){if(!b||b==""){return"unknown"}return b.substring((b.lastIndexOf(".")+1),b.length)});Handlebars.registerHelper("printDateDesc",function(a,c,d,b){var g=Handlebars.compile(jQuery("#mail_list_date_tmpl").html());var f={};var e="";f.folderType=a;f.term=c;if(listDateStore==c){return}listDateStore=c;if(c<7){if(c==0){e=mailMsg.mail_date_today}else{if(c==1){e=mailMsg.mail_date_yesterday}}if(d[c]){f.format=moment(d[c]).format("YYYY-MM-DD (ddd)")}}else{if(c==7){e=mailMsg.mail_date_lastweek}else{if(c==8){e=mailMsg.mail_date_twoweeksago}else{if(c==9){e=mailMsg.mail_date_threeweeksago}else{if(c>9){e=mailMsg.mail_date_longago}}}}}f.msg=e;return new Handlebars.SafeString(g(f))});Handlebars.registerHelper("user_folder_inbox_check",function(c,a,b){var d=c.fullName;if(a){if(d.toLowerCase()=="Inbox".toLowerCase()||d.toLowerCase().indexOf("Inbox.".toLowerCase())==0){return b.fn(this)}}else{if(d.toLowerCase()!="Inbox".toLowerCase()&&d.toLowerCase().indexOf("Inbox.".toLowerCase())<0){return b.fn(this)}}return b.inverse(this)});Handlebars.registerHelper("replaceInboxChild",function(b,a){return replaceInboxChild(b)});Handlebars.registerHelper("isUserFolder",function(b,a){if(isDefaultBoxCheck(b)){return a.inverse(this)}else{return a.fn(this)}});Handlebars.registerHelper("isNotgroupAgingZero",function(b,a){if(b!=0){return a.fn(this)}else{a.inverse(this)}});Handlebars.registerHelper("isOvergroupAging",function(c,a,b){if(c==0){b.inverse(this)}else{if(c<a){return b.fn(this)}else{b.inverse(this)}}});Handlebars.registerHelper("isCustomAging",function(d,b){var a=[0,30,90,120];for(var c=0;c<a.length;c++){if(a[c]==d){return b.inverse(this)}}return b.fn(this)});Handlebars.registerHelper("selectAging",function(e,c,f,d){var b=c;var a=0;if(c==a||(e!=a&&e<c)){b=e}if(b==f){return"selected"}else{return""}});Handlebars.registerHelper("displayFolderName",function(b,a){if(!b||b==""){return""}if(b.indexOf(".")>0){return b.substring((b.lastIndexOf(".")+1),b.length)}else{return b}});Handlebars.registerHelper("displayBookmark",function(c,a,b){return mailBookmarkName(c,a)});Handlebars.registerHelper("bookmarkCss",function(c,a,b){var d="";if(c=="flaged"){d="mail_important"}else{if(c=="unseen"){d="mail_noread"}else{if(c=="seen"){d="mail_read"}else{if(c=="today"){d="mail_today"}else{if(c=="yesterday"){d="mail_yesterday"}else{if(c=="attach"){d="mail_file"}else{if(c=="reply"){d="mail_reply"}else{if(c=="myself"){d="mail_me"}else{if(c=="mail"){d="folder";if(a=="Inbox"){d="mail_inbox"}else{if(a=="Sent"){d="mail_sent"}else{if(a=="Drafts"){d="mail_draft"}else{if(a=="Reserved"){d="mail_reserved"}else{if(a=="Spam"){d="mail_spam"}else{if(a=="Trash"){d="trash"}}}}}}}else{d="star"}}}}}}}}}return d});Handlebars.registerHelper("mobileFileName",function(b,a){if(!b||b==""){return""}if(b.lastIndexOf(".")<=0){return b}b=b.substring(0,b.lastIndexOf("."));return b});Handlebars.registerHelper("mobileFileExt",function(c,b){if(!c||c==""){return""}if(c.lastIndexOf(".")<=0){return""}var a=c.substring(c.lastIndexOf("."),c.length);return a});Handlebars.registerHelper("mobileFileIcon",function(b,c){b=b.toLowerCase();if(b.lastIndexOf(".")>0){b=b.substring(b.lastIndexOf(".")+1,b.length)}var a="";if(b=="pdf"||b=="ppt"||b=="pptx"||b=="xls"||b=="xlsx"||b=="doc"||b=="docx"||b=="hwp"||b=="zip"||b=="txt"||b=="html"||b=="xml"||b=="mpeg"||b=="avi"||b=="htm"||b=="mp3"||b=="mp4"||b=="exe"||b=="csv"||b=="log"||b=="lzh"){a=b}else{if(isImgFile("xxx."+b)){if(b=="jpg"||b=="png"||b=="gif"||b=="bmp"||b=="jpeg"){a=b}}else{a="def"}}return a});Handlebars.registerHelper("acceptConverter",function(b,d){if(!b||b==""){return d.inverse(this)}b=b.toLowerCase();var a="doc|docx|hwp|ppt|pptx|xls|xlsx|pdf|gif|jpg|jpeg|bmp|png|txt|hwpx|j2k|jpc|j2c|jp2|webp|tif|tiff";var c=new RegExp("("+a+")$","i");if(c.test(b)){return d.fn(this)}else{return d.inverse(this)}});Handlebars.registerHelper("acceptConverterMobile",function(b,d){if(!b||b==""){return d.inverse(this)}b=b.toLowerCase();var a="doc|docx|hwp|ppt|pptx|xls|xlsx|pdf|txt|hwpx|j2k|jpc|j2c|jp2|tif|tiff|webp";var c=new RegExp("("+a+")$","i");if(c.test(b)){return d.fn(this)}else{return d.inverse(this)}});Handlebars.registerHelper("makeTreeLink",function(e,b){var d=jQuery('<span evt-rol="toggle-mail-folder"></span>');var a=getCookie("DFN_"+e);if(a=="C"){d.addClass("open").attr({status:"close",fid:e,title:mailMsg.comn_open})}else{d.addClass("close").attr({status:"open",fid:e,title:mailMsg.comn_close})}var c=jQuery("<span></span>").append(d);return new Handlebars.SafeString(c.html())});Handlebars.registerHelper("closeTreeLink",function(c,b){var a=getCookie("DFN_"+c);if(a=="C"){return b.fn(this)}return b.inverse(this)});Handlebars.registerHelper("printFromPage",function(c,b,a){c=Number(c);c-=1;b=Number(b);var d=parseInt(c*b,10);return d+1});Handlebars.registerHelper("printToPage",function(d,c,b,a){d=Number(d);c=Number(c);b=Number(b);var e=parseInt(d*b,10);e=(e>c)?c:e;return e});Handlebars.registerHelper("mobileBookmarkCss",function(c,a,b){var d="";if(c=="flaged"){d="ic_side ic_mail_important"}else{if(c=="unseen"){d="ic_side ic_mail_noread"}else{if(c=="seen"){d="ic_side ic_mail_read"}else{if(c=="today"){d="ic_side ic_mail_today"}else{if(c=="yesterday"){d="ic_side ic_mail_yesterday"}else{if(c=="attach"){d="ic_side ic_mail_file"}else{if(c=="reply"){d="ic_side ic_mail_reply"}else{if(c=="myself"){d="ic_side ic_mail_me"}else{if(c=="tag"){d="ic_side ic_favori"}else{if(c=="mail"){d="folder";if(a=="Inbox"){d="ic_side ic_mail_receive"}else{if(a=="Sent"){d="ic_side ic_mail_send"}else{if(a=="Drafts"){d="ic_side ic_mail_temp"}else{if(a=="Reserved"){d="ic_side ic_mail_reserve"}else{if(a=="Spam"){d="ic_side ic_mail_spam"}else{if(a=="Trash"){d="ic_side ic_mail_basket"}else{d="ic_side ic_mail"}}}}}}}else{d="ic_side ic_mail"}}}}}}}}}}return d});Handlebars.registerHelper("printListDate",function(c,b){var e;var d=moment(c);var a=new Date();if(d.isSame(a,"day")){e="HH:mm"}else{e="YY-MM-DD HH:mm"}return d.format(e)});Handlebars.registerHelper("printReadDate",function(b,a){var d="YYYY/MM/DD dddd a h:mm:ss";var c=moment(b);return c.format(d)});Handlebars.registerHelper("printMdnListDate",function(c,b){var a=new Date();var e=moment(c);var d;if(e.isSame(a,"day")){d="HH:mm"}else{if(e.isSame(a,"year")){d="MM-DD"}else{d="YY-MM-DD"}}return e.format(d)});Handlebars.registerHelper("printMdnTimeDate",function(c,b){var a=new Date();var e=moment(c);var d;if(e.isSame(a,"day")){d="HH:mm:ss"}else{d="YYYY/MM/DD"}return e.format(d)});Handlebars.registerHelper("printMdnReadMessage",function(c,a){var e=moment(c);var d="YYYY/MM/DD (HH:mm)";var b="";if(e.isValid()){b=e.format(d)}else{b=c}return b});Handlebars.registerHelper("printFormatDate",function(b,d,a){if(b==""){return}var c=moment(b);return c.format(d)});Handlebars.registerHelper("printSmartFolder",function(b,a){if(b==""){return}if(b=="bill_box"){b="bill"}else{if(b=="sns_box"){b="sns"}else{if(b=="adv_box"){return"ad"}}}return b});Handlebars.registerHelper("printSmartFolderMobile",function(b,a){if(b==""){return}if(b=="bill_box"){b="ic_mail_bill"}else{if(b=="sns_box"){b="ic_mail_sns"}else{if(b=="adv_box"){return"ic_mail_ad"}}}return b});Handlebars.registerHelper("isSmartFolder",function(b,a){if(b=="bill_box"||b=="sns_box"||b=="adv_box"){return a.fn(this)}else{return a.inverse(this)}});Handlebars.registerHelper("printOnlyTime",function(d,a){var c="HH:mm";var b=moment(d);return b.format(c)});Handlebars.registerHelper("printFullDate",function(d,a){var c="YYYY-MM-DD (dd)";var b=moment(d);return b.format(c)});Handlebars.registerHelper("printFullDateTime",function(d,a){var c="YYYY-MM-DD (dd) HH:mm";var b=moment(d);return b.format(c)});Handlebars.registerHelper("printFullMonth",function(d,a){var c="MMM";var b=moment(d);return b.format(c)});Handlebars.registerHelper("printSingleDayOfMonth",function(d,a){var c="D";var b=moment(d);return b.format(c)});Handlebars.registerHelper("printDayOfWeek",function(d,a){var c="dd";var b=moment(d);return b.format(c)});Handlebars.registerHelper("printNationText",function(b,c,a){if(b=="local"||b=="private"||b=="unknown"){c=mailMsg["common_ip_"+b]}return c});var layoutControl,basicAttachUploadControl,massAttachUploadControl=null;var mailControl,folderControl,mailSettingControl,historyControl,editorControl,editorImgControl;var currentFolderType,currentFolderName,currentFolderViewName,layoutMode,isAllfolder,currentMenu,currentMenuType;var autoSaveTimeTerm,checkSaveTimeTerm,autoSaveMessageTerm,writeAutoSave;var autoReflashTimeTerm,runAutoReflashTime;var isAutoReflash=false;var POPUPDATA={};var isDocTemplate=false;var isAutoSave=false;var isAutoSaveStart=false;var isSendWork=false;var isRcptModeNormal=true;var isRcptModeNoneAC=false;var sendAllowUsed=false;var isSendInfoCheckUse=false;var isSendEmailCheckUse=false;var isSendAttachCheckUse=false;var sendAttachData="";var isSendKeywordCheckUse=false;var sendKeywordData="";var today;var isOcxUpload=false;var isOcxUploadDownModule=false;var MAX_ATTACH_SIZE=0;var MAX_BIG_ATTACH_SIZE=0;var BIG_ATTACH_QUOTA=0;var MAX_BIG_ATTACH_QUOTA=0;var BIGATTACH_TIMEZONE;var BIGATTACH_EXPIRE_DATE;var BIGATTACH_EXPIRE;var BIGATTACH_DOWNCNT;var USE_BIGATTACH_MODE=false;var isBookmark=false;var bookmarkType="mail";var bookmarkName="";var bookmarkValue="";var bookmarkSeq=0;var listDateStore=-1;var popWriteWin;var isLetter=false;var mailBadgeCount=0;var isModFieldInside=false;var isMaxSendMailCountUse=false;var maxSendMailCount=0;var childrenFnameForModify=null;var initSendData={};var isUseReflashTime=true;var previousSenderEmail="";var sendConfirm="";var LOCAL_DOMAIN="";var agreeForAiMail=false;var aiMailConfig="";var mailToolbarRuleMap=new HashMap();mailToolbarRuleMap.put("normal",{quick:true,tag:true,"delete":true,reply:true,forward:true,seen:true,copy:true,move:true,erase:true,save:true,filter:true,spam:true,notspam:false,reject:true,allow:false,resend:false,layout:true,print:true,upload:true,thismail:true,attachdelete:true});mailToolbarRuleMap.put("inbox",{quick:true,tag:true,"delete":true,reply:true,forward:true,seen:true,copy:true,move:true,erase:true,save:true,filter:true,spam:true,notspam:false,reject:true,allow:false,resend:false,layout:true,print:true,upload:false,thismail:true,attachdelete:true});mailToolbarRuleMap.put("sent",{quick:true,tag:true,"delete":true,reply:true,forward:true,seen:true,copy:true,move:true,erase:true,save:true,filter:true,spam:false,notspam:false,reject:false,allow:false,resend:true,layout:true,print:true,upload:false,thismail:true,attachdelete:true});mailToolbarRuleMap.put("drafts",{quick:true,tag:false,"delete":true,reply:false,forward:false,seen:false,copy:true,move:true,erase:true,save:false,filter:false,spam:false,notspam:false,reject:false,allow:false,resend:false,layout:false,print:true,upload:false,thismail:true,attachdelete:false});mailToolbarRuleMap.put("reserved",{quick:true,tag:false,"delete":true,reply:false,forward:false,seen:false,copy:false,move:false,erase:true,save:true,filter:false,spam:false,notspam:false,reject:false,allow:false,resend:false,layout:true,print:true,upload:false,thismail:true,attachdelete:false});mailToolbarRuleMap.put("spam",{quick:true,tag:true,"delete":true,reply:true,forward:true,seen:true,copy:true,move:true,erase:true,save:true,filter:true,spam:false,notspam:true,reject:false,allow:true,resend:false,layout:true,print:true,upload:false,thismail:true,attachdelete:true});mailToolbarRuleMap.put("trash",{quick:true,tag:true,"delete":true,reply:true,forward:true,seen:true,copy:true,move:true,erase:true,save:true,filter:true,spam:false,notspam:true,reject:false,allow:true,resend:false,layout:true,print:true,upload:false,thismail:true,attachdelete:true});mailToolbarRuleMap.put("all",{quick:true,tag:true,"delete":true,reply:true,forward:true,seen:true,copy:true,move:true,erase:true,save:false,filter:false,spam:false,notspam:false,reject:false,allow:false,resend:false,layout:true,print:true,upload:false,thismail:true,attachdelete:true});mailToolbarRuleMap.put("shared",{quick:true,tag:false,"delete":false,reply:true,forward:true,seen:false,copy:true,move:false,erase:false,save:true,filter:false,spam:false,notspam:false,reject:false,allow:false,resend:false,layout:true,print:true,upload:false,thismail:true,attachdelete:false});mailToolbarRuleMap.put("quotaviolate",{quick:true,tag:false,"delete":true,reply:false,forward:false,seen:false,copy:false,move:true,erase:true,save:false,filter:false,spam:false,notspam:false,reject:false,allow:false,resend:false,layout:true,print:false,upload:false,thismail:false,attachdelete:true});window.layoutMode=layoutMode;var MailControl=function(){var a=this;this.listAction="/api/mail/message/list";this.readAction="/api/mail/message/read";this.writeAction="/api/mail/message/write";this.sendAction="/api/mail/message/send";this.autoSaveAction="/api/mail/message/autosave";this.mdnListAction="/api/mail/message/mdn/list";this.mdnReadAction="/api/mail/message/mdn/read";this.deleteMdnAction="/api/mail/message/mdn/delete";this.recallMessageAction="/api/mail/message/mdn/recall";this.sendMdnResponseAction="/api/mail/message/mdn/send";this.previewAction="/api/mail/message/write/preview";this.sourceAction="/api/mail/message/source";this.downloadAttachFileAction="/api/mail/message/attach/download";this.downloadAllAttachFileAction="/api/mail/message/attach/download/all";this.downloadTnefAttachFileAction="/api/mail/message/tnef/attach/download";this.removeAttachFileAction="/api/mail/message/attach/delete";this.removeAllAttachesFromMessageAction="/api/mail/message/attach/delete/all";this.relationAction="/api/mail/message/relation";this.switchFlagAction="/api/mail/message/flag";this.listSearchQueryAction="/api/mail/searchquery/list";this.saveSearchQueryAction="/api/mail/searchquery/create";this.deleteSearchQueryAction="/api/mail/searchquery/delete";this.readModeOptionAction="/api/mail/setting/basic/readmode";this.pageBaseOptionAction="/api/mail/setting/basic/pagebase";this.autoSaveOptionAction="/api/mail/setting/basic/autosave";this.searchAddressAction="/api/mail/address/search/name";this.searchAddressesAction="/api/mail/address/search/names";this.listBigAttachAction="/api/mail/bigattach/list";this.deleteBigAttachAction="/api/mail/bigattach/delete";this.listLetterAction="/mail/mail/getLetterList.action";this.listDocTemplateAction="/mail/common/listDocTemplate.action";this.readDocTemplateAction="/mail/common/loadDocTemplate.action";this.signListAction="/api/mail/setting/sign/list";this.signContentAction="/api/mail/setting/sign/content";this.bigAttachUpdateAction="/api/mail/bigattach/save";this.resetExtMailAction="/api/mail/pop3/reset";this.downloadOrderExtMailAction="/api/mail/pop3/download/order";this.downloadExtMailAction="/api/mail/pop3/download";this.taggingMessageAction="/api/mail/message/tag";this.deleteMessageAction="/api/mail/message/delete";this.cleanMessageAction="/api/mail/message/clean";this.copyMessageAction="/api/mail/message/copy";this.moveMessageAction="/api/mail/message/move";this.downloadMessageAction="/api/mail/message/download";this.addResistRuleAction="/api/mail/message/rule";this.allSelectMessageProcessAction="/api/mail/message/all";this.saveMailFilterAction="/api/mail/setting/filter";this.sortFilterMessageAction="/api/mail/message/filter";this.registBayesianRuleAction="/api/mail/message/bayesian";this.messageIntegrityAction="/api/mail/message/integrity";this.readNestedAction="/api/mail/message/nested/read";this.webfolderAttachSaveAction="/api/webfolder/mail/attach/save";this.webfolderAttachWriteAction="/api/webfolder/mail/attach/write";this.readMailUserSenderAction="/api/mail/setting/sender/list";this.listSendAllowAction="/api/mail/address/sendallow/list";this.checkSendAllowAction="/api/mail/address/sendallow/check";this.isMailAttachSearchAction="/api/system/mailattachsearch";this.lastRcptListAction="/api/mail/setting/lastrcpt/list";this.listMode="mail";this.listParam={};this.readParam={};this.writeParam={};this.writeData={};this.sendData={};this.sharedFlag=false;this.currentFolder="Inbox";this.loadMessageList=function(e,b,f,d){if(e){this.listParam=e;if(e.folder&&e.folder!=""){this.currentFolder=e.folder;e.folder=htmlEntityDecode(e.folder)}if(e.sharedFlag&&e.sharedFlag=="shared"){this.sharedFlag=true;e.sharedFolderName=htmlEntityDecode(e.sharedFolderName)}else{this.sharedFlag=false}}else{e={}}this.listParam=e;e.init=f;makeProcessLoader();var c=jQuery("#searchType").val();if(c=="appSearch"||isPopup){ActionLoader.postSyncGoJsonLoadAction(this.listAction,e,function(g){d=(!d)?false:d;g.directRead=d;g.toolbarSort=e.toolbarSort;a.printMessageList(g)},"json");google.sendPageView(this.listAction)}else{if(isMsie8){window.top.window.location="/app/#unified/search?stype=simple&searchTerm=all&offset=5&page=0&keyword="+encodeURIComponent(e.keyWord)}else{window.top.window.location="/app/unified/search?stype=simple&searchTerm=all&offset=5&page=0&keyword="+encodeURIComponent(e.keyWord)}jQuery("#searchType").val("appSearch");jQuery("#mailSearchKeyWord").val("");b=true}if(!b){historyControl.setHistory({type:"list",param:e})}};this.initSubMessage=function(){if(layoutMode!="n"){ReadSubMessageChecker.resetUid();jQuery("#mailReadArea").handlebars("mail_read_default_tmpl")}};this.readRelationMessage=function(c,b){var d=a.readParam;d.page=c;d.sortDir=b;ActionLoader.postGoJsonLoadAction(this.relationAction,d,a.printRelationMessage,"json");google.sendPageView(this.relationAction)};this.printRelationMessage=function(b){if(b.total>1){b.isPopup=(CURRENT_PAGE_NAME=="popup");jQuery("#relationMessageWrapper").show();jQuery("#relationMessageCount").text((b.total-1));jQuery("#relationContentWrap").handlebars("mail_read_relation_tmpl",b);jQuery("#relation_"+getFolderNameId(b.folderName)+"_"+b.uid).addClass("active")}};this.getSharedFolderParam=function(b){if(this.sharedFlag){b.sharedFlag="shared";b.sharedUserSeq=this.listParam.sharedUserSeq;b.sharedFolderName=this.listParam.sharedFolderName}else{b.sharedFlag="user";b.sharedUserSeq="0";b.sharedFolderName=""}return b},this.setSharedFolderParam=function(b){if(b.shared){this.sharedFlag=true;if(this.listParam){this.listParam.sharedUserSeq=b.sharedUserSeq;this.listParam.sharedFolderName=b.folderName}}},this.switchMessagesFlags=function(d,b,g,c,e){var f={};f=this.getSharedFolderParam(f);f.folderNames=b;f.uids=d;f.flagType=g;f.used=c;ActionLoader.postGoJsonLoadAction(this.switchFlagAction,f,function(h){if(e){changeFlagReadView(c,g);if(layoutMode!="n"){changeFlagView(c,g,h)}}else{changeFlagView(c,g,h);if(layoutMode!="n"){changeFlagReadView(c,g)}}if(isReloadReady()){opener.reloadMessageList()}},"json")};this.movePage=function(b){var c=this.listParam;if(this.listMode=="mdnread"){c=this.readParam}if(c==null){c={}}c.page=b;this.listParam=c;if(this.listMode=="mail"){this.loadMessageList(c)}else{if(this.listMode=="mdnlist"){this.loadMdnList(c)}else{if(this.listMode=="mdnread"){this.loadMdnRead(c)}}}};this.reloadMessageList=function(b){b=(!b)?true:false;if(this.listMode=="mail"){this.loadMessageList(this.listParam,b)}else{if(this.listMode=="mdnlist"){this.loadMdnList(this.listParam,b)}else{if(this.listMode=="mdnread"){this.loadMdnRead(this.readParam,b)}}}};this.sortMessage=function(d,b){var c=this.listParam;if(c==null){c={}}c.page=1;c.sortBy=d;c.sortDir=b;c.toolbarSort=true;this.listParam=c;this.loadMessageList(c)};this.searchMessage=function(b){b=this.getSharedFolderParam(b);this.loadMessageList(b)};this.printMessageList=function(c){a.initSubMessage();useSearch(true);if(c.init){changeMailContainer("read")}else{changeMailContainer("list")}listDateStore=-1;currentMenu="list";a.listMode="mail";currentFolderType=c.folderType;currentFolderName=c.folderFullName;currentFolderViewName=c.folderName;isAllFolder=(currentFolderType=="all")?true:false;isBookmark=c.bookmark;bookmarkType=c.listType;bookmarkName=currentFolderViewName;bookmarkValue=currentFolderName;bookmarkSeq=c.bookmarkSeq;if(c.extFolder=="on"){bookmarkType=c.extType;bookmarkValue=bookmarkType}var e="";if(Number(bookmarkSeq)>0){e="bookmark_title_"+c.bookmarkSeq}else{if(bookmarkType=="tag"){e="tag_link_"+c.tagId}else{if(!isAllFolder){if(c.folderType=="shared"){e="shared_link_"+c.folderEncName}else{e="folder_link_"+c.folderEncName}}else{if(c.extFolder=="on"){e="ext_folder_link_"+bookmarkType}}}}selectCurrentFolderName(e);var b={};b.name=c.folderName;b.totalCnt=c.messageCount;b.unseenCnt=c.unreadMessageCount;b.bookmarkType=bookmarkType;b.bookmarkSeq=bookmarkSeq;b.isBookmark=isBookmark;b.isAllFolder=isAllFolder;b.folderType=c.folderType;b.extFolder=c.extFolder;b.flag=c.flag;if(bookmarkType=="tag"){bookmarkValue=c.tagId;var d=getTagInfo(bookmarkValue);b.type="tag";b.tagInfo=d}makeMailHeaderMessege(b);if(!c.toolbarSort){a.makeListToolbar(c)}a.makeMailListContent(c);c.pageInfo.out=true;a.makeNavigation(c);if(!isFirstLoad){executeFolderInfo()}isFirstLoad=false;removeProcessLoader()};this.makeListToolbar=function(d){deleteWriteToolbarClass();var c=mailToolbarRuleMap.get(d.folderType);if(isPopupView()){c.isPopup=true}jQuery("#toolbar_wrap").handlebars("mail_toolbar_tmpl",c);if(d.directRead){a.makeReadToolbar(d)}else{if(!isPopupView()&&d.pageInfo){if(c.layout){var b={layoutMode:layoutMode,pageBase:d.pageInfo.pageSize,refreshTime:getCookie("reflash_time"),isUseRefreshTime:isUseReflashTime,isAllFolder:isAllFolder};jQuery("#mailOptionBoxWrap").handlebars("mail_list_option_tmpl",b)}else{var b={pageBase:d.pageInfo.pageSize};jQuery("#mailOptionBoxWrap").handlebars("mail_list_option_page_tmpl",b)}}}};this.makeMailListContent=function(c){var b="mail_list_header_tmpl";c.locale=LOCALE;c.mailExposure=MAIL_EXPOSURE;c.companyDomainList=companyDomainList;var d="mail_list_tmpl";if(layoutMode=="v"&&c.folderType!="drafts"){b="mail_list_horizon_header_tmpl";d="mail_list_horizon_tmpl"}jQuery("#mail_list_content").handlebars(d,c);this.makeMailListPreview()};this.makeMailListPreview=function(){jQuery("#mail_list_content span.preview").tooltipster({theme:["tooltipster-noir","tooltipster-noir-customized"],delay:500,position:"bottom",minWidth:400,maxWidth:400,contentAsHTML:true,functionBefore:function(b,e){var c=jQuery(e.origin).html();var d=jQuery(e.origin).data("preview");var f={subject:c,content:d};b.content(getHandlebarsTemplate("mail_list_content_preview",f))}})};this.closeMailListPreview=function(){jQuery("div.tooltipster-noir-customized").hide();var b=jQuery.tooltipster.instances();jQuery.each(b,function(d,c){c.close()})};this.makeNavigation=function(b){jQuery("#messageNaviWrap").handlebars("mail_navi_tmpl",b)};this.readMessage=function(c,b){this.readParam=clone(this.listParam);this.readParam.folder=c.folder;this.readParam.uid=c.uid;if(c.viewImg){this.readParam.viewImg=c.viewImg}this.readParam=this.getSharedFolderParam(this.readParam);ActionLoader.postSyncGoJsonLoadAction(this.readAction,this.readParam,function(d){a.printReadMessage(d)},"json");google.sendPageView(this.readAction);if(!b&&!isPopupView()){historyControl.setHistory({type:"read",param:c})}};this.reloadReadMessage=function(){var b=a.readParam;a.readMessage(b,true)};this.printReadMessage=function(d){if(d.readResult&&d.readResult=="fail"){jQuery.goAlert(mailMsg.mail_not_found_message,"",function(){if(POPUPREAD){if(isReloadReady()){opener.reloadMessageList()}window.close()}else{if(layoutMode!="n"){a.reloadMessageList()}}});return}changeMailContainer("read");currentMenu="read";a.listMode="mail";var c=("on"==getCookie("rcpt_hidden"));d.isRcptHidden=c;a.makeMailReadContent(d);a.makeReadToolbar(d);a.makeNDRGuide(d);mailReadInit(d);executeFolderInfo();agreeForAiMail=d.aiMailUse;aiMailConfig=d.aiMailConfig;if(aiMailConfig==="off"){jQuery("#ai_summary_wrap").hide();jQuery("#ai_tr_area").hide()}else{if(aiMailConfig==="on"){jQuery("#ai_summary_wrap").show();jQuery("#ai_tr_area").show()}}if(POPUPREAD){document.title=d.msgContent.subject+" - "+document.title;POPUPREAD=false}var e=a.readParam;if(e){e.page=d.page;a.readParam=e}var b=a.listParam;if(b){b.page=d.page;a.listParam=b}};this.makeNDRGuide=function(c){var b=c.msgContent.subject;if(b.indexOf("[NDR]")==0){jQuery("#ndrGuide").show().handlebars("mail_ndr_guide_tmpl")}};this.makeMailReadContent=function(b){b.useWebfolder=USE_WEBFOLDER;b.useContact=USE_CONTACT&&MAIL_EXPOSURE;b.useCalendar=USE_CALENDAR;b.mailExposure=MAIL_EXPOSURE;b.msgContent.htmlContent=GO.util.escapeXssFromHtml(b.msgContent.htmlContent);b.msgContent.htmlContent=a.convertMSWordTag(b.msgContent.htmlContent);b.msgContent.htmlContent=a.convertIcalTemplate(b.msgContent.icalList)+b.msgContent.htmlContent;if(layoutMode=="n"){jQuery("#mailListAllCheck").hide()}jQuery("#mailReadArea").handlebars("mail_read_tmpl",b);this.hideLabel("mailReadArea")};this.convertIcalTemplate=function(d){if(!d||d.length==0){return""}for(var c=0;c<d.length;c++){var e=d[c].icalRecurrence;d[c].icalRecurrenceMsg="";if(e!=""&&e!=null){d[c].icalRecurrenceMsg=recurrenceParser(d[c].icalRecurrence);d[c].icalStartDate=""}var b=jQuery.trim(d[c].icalSubject);if(b==""||b==null){d[c].icalSubject=mailMsg.header_nosubject}}return getHandlebarsTemplate("mail_icalendar_tmpl",d)};this.hideLabel=function(b){var c={to:[],cc:[]};jQuery.each(["to","cc"],function(e,g){var d=jQuery("#"+b).find("li[data-type="+g+"]");if(d.length>20){c[g]=jQuery("#"+b).find("li[data-type="+g+"]:gt(19)");c[g].attr("data-more","").hide();var f=['<li evt-rol="moreLabel" data-type="'+g+'" class="add">','<span class="name">',"<span data-label>",mailMsg.mail_more,"</span>",'<span class="ic ic_arrow_down" title="'+mailMsg.mail_more+'"></span>',"</span>","</li>"];d.parent("ul").append(f.join(""))}});jQuery("#"+b+" li[evt-rol='moreLabel']").on("click",function(j){var h=jQuery(j.currentTarget);var f=h.attr("data-type");var d=c[f].is(":visible");var g=d?mailMsg.mail_more:mailMsg.mail_fold;h.find("span[data-label]").text(g);h.find("span.ic").toggleClass("ic_arrow_down").toggleClass("ic_arrow_up");c[f].toggle(!d)})};this.convertMSWordTag=function(c){if(isMsie9||isMsie8||isMsie7){if(c==null){return c}var b=""+c;b=b.replace(/&lt;!--\[[^-->]*\]--&gt;/gi,"");b=b.replace(/<!--\[[^-->]*\]-->/gi,"");b=b.replace(/(xmlns=")[\\s\\S]*[^"]*/gi,"");return b}return c};this.removeSignAnnotation=function(c){if(c==null){return""}var b=""+c;b=b.replace(/&lt;!--sign Area start--&gt;/gi,"");b=b.replace(/<!--sign Area start-->/gi,"");b=b.replace(/&lt;!--sign Area end--&gt;/gi,"");b=b.replace(/<!--sign Area end-->/gi,"");return b};this.makeReadToolbar=function(b){deleteWriteToolbarClass();if(isPopupView()){b.isPopup=true}if(currentMenu=="read"&&layoutMode=="n"){jQuery("#mailOptionBoxWrap").handlebars("mail_read_optionbox_tmpl",b)}};this.downloadMessages=function(b){jQuery("#reqFrame").attr("src",this.downloadMessageAction+"?"+jQuery.param(b))};this.downloadAttachFile=function(c){if(TABLET||MOBILE){var b=window.location.protocol+"//"+window.location.host;url=this.downloadAttachFileAction+"?"+jQuery.param(c);window.location=b+url}else{jQuery("#reqFrame").attr("src",this.downloadAttachFileAction+"?"+jQuery.param(c))}};this.downloadTnefAttachFile=function(b){jQuery("#reqFrame").attr("src",this.downloadTnefAttachFileAction+"?"+jQuery.param(b))};this.downloadAllAttachFile=function(b){makeProcessLoader();ActionLoader.postGoJsonLoadAction(this.downloadAllAttachFileAction,b,function(c){var d={downloadFileName:c.downloadFileName,zipFileName:c.zipFileName};jQuery("#reqFrame").attr("src",a.downloadAllAttachFileAction+"?"+jQuery.param(d));removeProcessLoader()})};this.removeAttachFile=function(b){ActionLoader.postGoLoadAction(this.removeAttachFileAction,b,function(c){a.readParam.uid=c;if(layoutMode!="n"){a.reloadMessageList()}a.readMessage(a.readParam,true);if(isReloadReady()){opener.reloadMessageList()}removeProcessLoader()},"json")};this.removeAllAttachesFromMessage=function(b){ActionLoader.postGoJsonLoadAction(this.removeAllAttachesFromMessageAction,b,function(c){jQuery.goSlideMessage(mailMsg.mail_complete_delete_mail,"caution");if((layoutMode!="n"&&currentMenu=="read")||currentMenu!="read"){a.reloadMessageList()}if(layoutMode!="n"||currentMenu=="read"){if(c>0){a.readParam.uid=c;a.readMessage(a.readParam,true)}else{a.initSubMessage()}}if(isReloadReady()){opener.reloadMessageList()}removeProcessLoader()},"json")};this.readNestedMessage=function(b){ActionLoader.postGoJsonLoadAction(this.readNestedAction,b,function(c){c.useWebfolder=USE_WEBFOLDER;c.msgContent.htmlContent=a.convertMSWordTag(c.msgContent.htmlContent);c.msgContent.htmlContent=a.convertIcalTemplate(c.msgContent.icalList)+c.msgContent.htmlContent;c.folderName=b.folderName;c.uid=b.uid;c.orgPart=b.part;c.nestedPart=(b.nestedPart)?b.nestedPart:((b.part)?b.part:"");jQuery("#popupBodyWrap").handlebars("mail_nested_read_tmpl",c)},"json");google.sendPageView(this.readNestedAction)};this.writeMessage=function(c,b){this.writeParam=c;makeProcessLoader();ActionLoader.postGoJsonLoadAction(this.writeAction,c,function(d){jQuery.getJSON("/resources/js/conf/editor/editor.config.json",function(e){LOCAL_DOMAIN=d.localDomain?d.localDomain:"";if(TABLET){d.editorMode="text"}changeMailContainer("write");currentMenu="write";d.isPopupWrite=isPopupWrite;notiMode=d.notiMode;agreeForAiMail=d.aiMailUse;aiMailConfig=d.aiMailConfig;a.writeData=d;a.setSharedFolderParam(d);a.convertSendData(d);a.convertInitSendData(d);a.makeMailWriteToolbar(d);a.makeMailWriteContent(d,e);mailWriteInit(d);if(TABLET){jQuery("#writeChangeEditorWrap").hide()}isMaxSendMailCountUse=d.sendMailCount.maxSendMailCountUse;maxSendMailCount=d.sendMailCount.maxSendMailCount;removeProcessLoader();if(!d.isPopupWrite){a.initWritePageScroll()}if(aiMailConfig==="off"){jQuery("#aiDraftBtn").hide()}else{if(aiMailConfig==="on"){jQuery("#aiDraftBtn").show()}}}).fail(function(e,g,f){console.warn("editor.config.json파일이 없습니다.")})},"json");google.sendPageView(this.writeAction);if(!b){historyControl.setHistory({type:"empty"})}};this.initWritePageScroll=function(){var c=jQuery(window).height(),b=jQuery("#mailHeaderWrap").outerHeight(),d=jQuery("#write_toolbar_wrap").outerHeight();var e=c-b-d-10;jQuery("#mailWriteArea").css({"overflow-y":"auto",height:e+"px"})};this.reloadWriteMessage=function(){this.writeMessage(this.writeParam,true)};this.convertSendData=function(b){this.sendData={};this.sendData.senderEmail=b.senderEmail;this.sendData.senderName=b.senderName;this.sendData.sendType=b.writeType;this.sendData.sendFlag=b.sendFlag;this.sendData.charset=b.encoding;this.sendData.folderName=b.folderName;this.sendData.uids=b.uids;this.sendData.orgMessageId=b.orgMsgId;this.sendData.draftMessageId=b.draftMsgId;if(b.defaultSignSeq&&b.defaultSignSeq>0){this.sendData.attachsign=b.signAttach;this.sendData.signSeq=b.defaultSignSeq}this.sendData.signLocation=b.signLocation;this.sendData.bannerDisplay=b.bannerDisplay;this.sendData.bannerContent=b.bannerContent};this.convertInitSendData=function(b){this.initSendData={};this.initSendData.senderEmail=b.senderEmail;this.initSendData.senderName=b.senderName;this.initSendData.sendType=b.writeType;this.initSendData.sendFlag=b.sendFlag;this.initSendData.charset=b.encoding;this.initSendData.folderName=b.folderName;this.initSendData.uids=b.uids;this.sendData.orgMessageId=b.orgMsgId;this.initSendData.draftMessageId=b.draftMsgId;if(b.defaultSignSeq&&b.defaultSignSeq>0){this.initSendData.attachsign=b.signAttach;this.initSendData.signSeq=b.defaultSignSeq}this.initSendData.signLocation=b.signLocation;this.initSendData.bannerDisplay=b.bannerDisplay;this.initSendData.bannerContent=b.bannerContent};this.getWriteData=function(){return this.writeData};this.getSendData=function(){return this.sendData};this.setSendData=function(b){this.sendData=b};this.getInitSendData=function(){return this.initSendData};this.makeMailWriteContent=function(h,e){var p=e.config.mailWritePrefixHtml;var r=BASECONFIG.data.editorConfig;var q="SmartEditor";var s=r&&r.editorName?r.editorName:q;var j=!GO.Editor.isIE()&&GO.Editor.isActiveXType(s)?q:s;if(!p){console.warn("(daou office) editor.config.json 파일을 최신으로 적용해주세요.");p={activeDesigner:"<P>&nbsp;</P><P>&nbsp;</P>",dext5:"<P>&nbsp;</P><P>&nbsp;</P>",smartEditor:"<br><p><br></p><p><br></p><br>"}}var g=p.activeDesigner;var o=p.dext5;var n=p.smartEditor;var c="";var b={ActiveDesigner:function(){c=g},Dext5Editor:function(){c=o},SmartEditor:function(){c=n}};b[s]();var m="";var d="";var f=a.removeSignAnnotation(h.htmlContent);var k=a.removeSignAnnotation(h.textContent);if(h.sendFlag=="forwardAttached"){h.signLocation="outside";f="<div style='font-weight:bold;text-align:center'>"+mailMsg.mail_forwardmessage+"</div><br><br>";k="* "+mailMsg.mail_forwardmessage}if(h.signAttach&&(h.writeType!="drafts"&&h.writeType!="rewrite")){if(h.signLocation=="inside"){m="<span>&nbsp;</span><!--sign Area start-->"+h.signContent+"<!--sign Area end-->"+f;d="\n\n"+h.textSignContent+k}else{m=f+"<span>&nbsp;</span><!--sign Area start-->"+h.signContent+"<!--sign Area end-->";d=k+"\n\n"+h.textSignContent}}else{m=f;d=k}if(!h.signAttach&&h.sendFlag=="normal"||h.folderName=="Drafts"||h.sendFlag=="draftForwardAttached"||(h.sendFlag=="forward"&&h.writeType=="drafts")||h.writeType=="rewrite"){c=""}h.htmlContent=c+a.convertMSWordTag(m);h.textContent=a.convertMSWordTag(d);EDITOR_TYPE=j;h.useContact=USE_CONTACT;h.useWebfolder=USE_WEBFOLDER;jQuery("#mailWriteArea").handlebars("mail_write_tmpl",h);jQuery("#ai_draft_prompt").on("focus input blur",this.addTextareaEvent);var l=this;jQuery("#ai_draft_prompt").on("keyup",function(t){if(t.key==="Enter"&&!t.shiftKey){l.submitAiDraft()}});this.setAiInputStyle()};this.submitAiDraft=function(){var b=(jQuery("#ai_draft_prompt").val()||"").trim()!=="";if(!b){jQuery.goSlideMessage("내용을 입력해주세요.");return}var c=function(){submitAiDraft()};if(!agreeForAiMail){openAiConsentCheckLayer(c);return}submitAiDraft()};this.setAiInputStyle=function(){document.querySelectorAll(".ai_input_msg textarea").forEach(function(b){b.addEventListener("input",function(){this.style.height="20px";this.style.height=Math.min(this.scrollHeight,100)+"px";if(this.scrollHeight>120){this.style.overflowY="auto"}else{this.style.overflowY="hidden"}})})};this.addTextareaEvent=function(){checkAiTextarea()};this.makeMailWriteToolbar=function(b){jQuery("div[data-tag=write_toolbar_wrap]").handlebars("mail_write_toolbar_tmpl",b);addWriteToolbarClass()};this.sendMessage=function(b){if(b.sendType!="draft"){makeProcessLoader();google.sendPageView(this.sendAction)}b=this.getSharedFolderParam(b);ActionLoader.postGoJsonLoadAction(this.sendAction,b,function(d){if(b.sendType=="draft"){if(!d.sendError){var c=mailControl.getSendData();c.draftMessageId=d.messageId;jQuery.goSlideMessage(mailMsg.mail_drafts_success)}isAutoSave=false}else{a.sendMessageResult(d);removeProcessLoader();executeFolderInfo();destroyBasicUploadControl();destroyMassUploadControl();destoryEditorControl()}SearchByNameInfo.searchAddrValueList=[];isSendWork=false},"json")};this.autoSaveMessage=function(b){b=this.getSharedFolderParam(b);ActionLoader.postGoJsonLoadAction(this.autoSaveAction,b,function(c){resultAutoSave(c)},"json")};this.sendMessageResult=function(b){currentMenu="send";b.pageMode=CURRENT_PAGE_NAME;b.useContact=USE_CONTACT&&MAIL_EXPOSURE;b.mailExposure=MAIL_EXPOSURE;jQuery("#mailSendArea").handlebars("mail_send_tmpl",b);jQuery("#toolbar_wrap").empty();jQuery("div[data-tag=write_toolbar_wrap]").empty();changeMailContainer("send");removeProcessLoader()};this.loadMdnList=function(c,b){c=(!c)?{}:c;this.listParam=c;ActionLoader.postGoLoadAction(this.mdnListAction,c,a.printMdnList,"json");google.sendPageView(this.mdnListAction);if(!b){historyControl.setHistory({type:"mdnlist",param:c})}};this.printMdnList=function(c){a.listMode="mdnlist";currentMenu="list";changeMailContainer("list");useSearch(false);var b={type:"mdn",name:mailMsg.menu_receivenoti};makeMailHeaderMessege(b);c.pageInfo.out=true;a.makeMdnListToolbar(c);a.makeMdnListContent(c);a.makeNavigation(c);removeProcessLoader()};this.makeMdnListToolbar=function(b){deleteWriteToolbarClass();jQuery("#toolbar_wrap").handlebars("mail_mdn_list_toolbar_tmpl",b)};this.makeMdnListContent=function(b){b.mailExposure=MAIL_EXPOSURE;jQuery("#mail_list_content").handlebars("mail_mdn_list_tmpl",b)};this.loadMdnRead=function(c,b){this.readParam=c;ActionLoader.postGoLoadAction(this.mdnReadAction,c,a.printMdnRead,"json");google.sendPageView(this.mdnReadAction);if(!b){historyControl.setHistory({type:"mdnread",param:this.readParam})}};this.printMdnRead=function(c){a.listMode="mdnread";currentMenu="list";changeMailContainer("list");var b={type:"mdn",name:mailMsg.menu_receivenoti};makeMailHeaderMessege(b);c.subject=a.readParam.subject;c.dateUtc=a.readParam.dateUtc;c.pageInfo.out=true;a.makeMdnReadToolbar(c);a.makeMdnReadContent(c);a.makeNavigation(c);removeProcessLoader()};this.makeMdnReadToolbar=function(b){deleteWriteToolbarClass();jQuery("#toolbar_wrap").handlebars("mail_mdn_read_toolbar_tmpl",b)};this.makeMdnReadContent=function(b){b.mailExposure=MAIL_EXPOSURE;b.companyDomainList=companyDomainList;jQuery("#mail_list_content").handlebars("mail_mdn_read_tmpl",b)};this.deleteMdn=function(b){makeProcessLoader();ActionLoader.postGoLoadAction(this.deleteMdnAction,b,function(c){removeProcessLoader();jQuery.goSlideMessage(mailMsg.mail_complete_delete_mail,"caution");a.reloadMessageList()},"json")};this.recallMessage=function(b){ActionLoader.postGoLoadAction(this.recallMessageAction,b,function(c){a.processRecallResult(c)},"json")};this.processRecallResult=function(b){if((b.ignoreEmailList&&b.ignoreEmailList.length>0)||(b.failEmailList&&b.failEmailList.length>0)||(b.externalEmailList&&b.externalEmailList.length>0)){jQuery.goPopup({id:"recallFailAddressPopup",pclass:"layer_normal layer_confim",width:500,header:mailMsg.mail_mdn_message_recall_004,contents:getHandlebarsTemplate("mail_mdn_recall_fail_tmpl",b),closeCallback:function(){a.reloadMessageList()},buttons:[{btype:"close",autoclose:true,btext:mailMsg.comn_close}]})}else{jQuery.goMessage(mailMsg.mail_mdn_message_recall_008);a.reloadMessageList()}};this.sendMdnResponse=function(b){ActionLoader.postGoJsonLoadAction(this.sendMdnResponseAction,b,function(c){jQuery.goMessage(mailMsg.mail_send_success)},"json")};this.getSearchQueryList=function(){ocxUploadVisible(false);ActionLoader.getGoLoadAction(this.listSearchQueryAction,null,function(d){var c={};c.searchAllFolder=searchAllFolder;c.folderList=folderControl.getUserFolderList();c.queryList=d;jQuery("#detailSearchLayerWrap").handlebars("mail_detail_search_tmpl",c);jQuery("#adStartDate").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearSuffix:""});jQuery("#adEndDate").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearSuffix:""});var b=a.isMailAttachSearch();if(b){jQuery("#adAttachContentSearch").show()}jQuery("#detailSearchLayerWrap").show();jQuery(document).trigger("showLayer.goLayer")},"json")};this.getUnifiedSearchFolderList=function(){jQuery("#detailSearchLayerWrap").handlebars("mail_unified_detail_search_tmpl",{});jQuery("#fromDate").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearSuffix:""});jQuery("#toDate").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearSuffix:""});ocxUploadVisible(false);jQuery("#detailSearchLayerWrap").show()};this.saveSearchQuery=function(b){jQuery.ajax({url:this.saveSearchQueryAction,dataType:"json",type:"POST",data:b,success:function(){a.getSearchQueryList()},error:function(d){var c=JSON.parse(d.responseText);d.ignoreProcessLoader=true;if(c.code!="401"){jQuery.goSlideMessage(c.message,"caution")}}})};this.deleteSearchQuery=function(b){ActionLoader.postGoLoadAction(this.deleteSearchQueryAction,b,function(c){a.getSearchQueryList()},"json")};this.updateReadModeOption=function(b){ActionLoader.postGoLoadAction(this.readModeOptionAction,b,function(c){contentSplitterChange(b.readMode)},"json")};this.updatePageBaseOption=function(b){ActionLoader.postGoLoadAction(this.pageBaseOptionAction,b,function(c){a.reloadMessageList()},"json")};this.listBigAttachFile=function(b){ActionLoader.postGoLoadAction(this.listBigAttachAction,null,function(c){if(b){b(c)}},"json")};this.deleteBigAttach=function(d,b,c){ActionLoader.postGoLoadAction(this.deleteBigAttachAction,d,function(e){if(b){b(e)}},"json",function(e){if(c){c(e)}})};this.getLetterList=function(c,b){ActionLoader.postLoadAction(this.listLetterAction,c,function(d){if(b){b(d)}},"json")};this.getDocTemplateList=function(c,b){ActionLoader.postLoadAction(this.listDocTemplateAction,c,function(d){if(b){b(d)}},"json")};this.getTemplateContent=function(c,b){ActionLoader.postLoadAction(this.readDocTemplateAction,c,function(d){if(b){b(d)}},"json")};this.updateAutoSaveInfo=function(b,c){var d={term:b};ActionLoader.postGoLoadAction(this.autoSaveOptionAction,d,function(e){if(c){c(e)}},"json")};this.getSignList=function(b){ActionLoader.getGoLoadAction(this.signListAction,null,function(c){if(b){b(c)}},"json")};this.signContent=function(c,b){ActionLoader.postGoLoadAction(this.signContentAction,c,function(d){if(b){b(d)}},"json")};this.getLastRcptList=function(){ActionLoader.getGoLoadAction(this.lastRcptListAction,null,function(c){var b=(isRcptModeNormal)?"#toRcptList,#ccRcptList,#bccRcptList":"#rcptList";jQuery(b).append(getHandlebarsTemplate("mail_write_last_rcpt_tmpl",c))},"json")};this.mailPreview=function(b){ActionLoader.postGoJsonLoadAction(this.previewAction,b,function(c){jQuery("#popupBodyWrap").handlebars("mail_preview_tmpl",c)},"json")};this.mailPrint=function(b){ActionLoader.postSyncGoJsonLoadAction(this.readAction,b,function(c){c.msgContent.htmlContent=a.convertMSWordTag(c.msgContent.htmlContent);c.msgContent.htmlContent=a.convertIcalTemplate(c.msgContent.icalList)+c.msgContent.htmlContent;jQuery("#popupBodyWrap").handlebars("mail_print_tmpl",c);jQuery("#mailViewArea").find("img").load(function(){if(jQuery(this).width()>800){jQuery(this).attr({width:"100%"})}});a.hideLabel("popupBodyWrap")},"json")};this.mailPreviewPrint=function(b){ActionLoader.postGoJsonLoadAction(this.previewAction,b,function(c){jQuery("#popupBodyWrap").handlebars("mail_preview_print_tmpl",c);a.hideLabel("popupBodyWrap");jQuery("#mailViewArea").find("img").load(function(){if(jQuery(this).width()>800){jQuery(this).attr({width:"100%"})}})},"json")};this.mailReadPopup=function(b){ActionLoader.postSyncGoJsonLoadAction(this.readAction,b,function(c){jQuery("#mailReadArea").handlebars("mail_read_tmpl",c);a.hideLabel("mailReadArea")},"json")};this.mailSource=function(b){jQuery("#sourceFrame").attr("src",this.sourceAction+"?"+jQuery.param(b))};this.bigAttachUpdate=function(c,b){makeProcessLoader();ActionLoader.postGoLoadAction(this.bigAttachUpdateAction,c,function(d){sendForBigAttach(d,b);removeProcessLoader()},"json")};this.loadExtMail=function(b){ActionLoader.getGoLoadAction(this.downloadExtMailAction,null,function(c){if(b){b(c)}},"json")};this.downloadOrderExtMail=function(b){ActionLoader.postGoLoadAction(this.downloadOrderExtMailAction,b,function(c){runCheckPop3Status();a.downloadExtMail()},"json")};this.downloadExtMail=function(){ActionLoader.postGoLoadAction(this.downloadExtMailAction,{},function(b){},"json")};this.resetExtMail=function(b){ActionLoader.postGoLoadAction(this.resetExtMailAction,b,function(c){runCheckPop3Status()},"json")};this.makeToolbarTagList=function(b){jQuery("#toolbar_tag_list").handlebars("mail_tag_toolbar_tmpl",b)};this.deleteMessages=function(b){makeProcessLoader();ActionLoader.postGoJsonLoadAction(this.deleteMessageAction,b,function(c){removeProcessLoader();jQuery.goSlideMessage(mailMsg.mail_complete_delete_mail,"caution");if(isPopupView()){if(isReloadReady()){opener.reloadMessageList()}window.close()}else{a.reloadMessageList(true)}},"json")};this.cleanMessages=function(b){makeProcessLoader();ActionLoader.postGoJsonLoadAction(this.cleanMessageAction,b,function(c){removeProcessLoader();jQuery.goSlideMessage(mailMsg.mail_complete_delete_mail,"caution");if(isPopupView()){if(isReloadReady()){opener.reloadMessageList()}window.close()}else{a.reloadMessageList()}},"json")};this.copyMessage=function(b){b=this.getSharedFolderParam(b);ActionLoader.postGoJsonLoadAction(this.copyMessageAction,b,function(c){if(isReloadReady()){opener.reloadMessageList()}else{a.reloadMessageList()}},"json",function(c){jQuery.goSlideMessage(c.message,"caution")})};this.moveMessage=function(b){ActionLoader.postGoJsonLoadAction(this.moveMessageAction,b,function(c){if(isPopupView()){if(isReloadReady()){opener.reloadMessageList()}window.close()}else{a.reloadMessageList(true)}},"json",function(c){jQuery.goSlideMessage(c.message,"caution")})};this.addResistRule=function(c,b){ActionLoader.postGoJsonLoadAction(this.addResistRuleAction,c,function(d){if(b){b(c.ruleType)}},"json")};this.searchAddressByKeyowrd=function(c,b){ActionLoader.postGoLoadAction(this.searchAddressesAction,c,function(d){if(b){b(d)}},"json")};this.allSelectMessageProcess=function(b){makeProcessLoader();ActionLoader.postGoJsonLoadAction(this.allSelectMessageProcessAction,b,function(c){removeProcessLoader();if(b.actionType=="delete"||b.actionType=="clean"){jQuery.goSlideMessage(mailMsg.mail_complete_delete_mail,"caution")}a.reloadMessageList()},"json",function(){jQuery.goAlert(mailMsg.allselect_action_error)})};this.saveMailFilter=function(b){ActionLoader.postGoJsonLoadAction(this.saveMailFilterAction,b,function(c){saveMessageFilterResult(b,c)},"json",function(c){if(c.name=="DuplicatedException"){jQuery.goMessage(mailMsg.conf_filter_exist)}else{jQuery.goMessage(mailMsg.save_fail)}})};this.sortFilterMessage=function(b){ActionLoader.postGoJsonLoadAction(this.sortFilterMessageAction,b,function(c){removeProcessLoader();if(isPopupView()){if(isReloadReady()){opener.reloadMessageList()}window.close()}else{a.reloadMessageList()}},"json")};this.saveMemberAddress=function(c){var b=JSON.stringify(c);jQuery.ajax({url:"/api/contact/personal/contact",type:"post",contentType:"application/json",dataType:"json",data:b}).done(function(d){if(d.code=="200"&&d.message=="OK"){jQuery.goAlert(mailMsg.alert_addr_add)}})};this.registBayesianRule=function(b){ActionLoader.postGoLoadAction(this.registBayesianRuleAction,b,function(c){jQuery.goMessage(mailMsg.bayesian_submitmsg);a.reloadReadMessage()},"json",function(){jQuery.goMessage(mailMsg.bayesian_submitmsg_error)})};this.messageIntegrity=function(c,b){ActionLoader.postGoLoadAction(this.messageIntegrityAction,c,function(d){if(b){b(d)}},"json")};this.getListParam=function(){return this.listParam};this.setListParam=function(b){this.listParam=b;if(b.sharedFlag&&b.sharedFlag=="shared"){this.sharedFlag=true}};this.webfolderAttachSave=function(c,b){ActionLoader.postGoJsonLoadAction(this.webfolderAttachSaveAction,c,function(d){jQuery.goAlert(mailMsg.mail_attach_webfolder_save,mailMsg.mail_attach_webfolder_save_ok)},"json",function(e){var d=mailMsg.mail_attach_webfolder_save_fail;if(e.message){d=e.message}jQuery.goAlert(mailMsg.mail_attach_webfolder_save,d)})};this.webfolderWriteAttach=function(c,b){ActionLoader.postGoJsonLoadAction(this.webfolderAttachWriteAction,c,function(d){if(b){b(d)}},"json",function(){jQuery.goAlert(mailMsg.alert_attachFile)})};this.readMailUserSender=function(b){ActionLoader.getGoLoadAction(this.readMailUserSenderAction,null,function(c){if(b){b(c)}},"json")};this.listSendAllow=function(b){ActionLoader.getGoLoadAction(this.listSendAllowAction,null,function(c){if(b){b(c)}},"json")};this.checkSendAllow=function(c,b){ActionLoader.postSyncGoLoadAction(this.checkSendAllowAction,c,function(d){if(b){b(d)}},"json")};this.isMailAttachSearch=function(){var b=false;ActionLoader.getSyncGoLoadAction(this.isMailAttachSearchAction,null,function(c){b=c},"json");return b};this.makeMailEvent=function(){var f={everyPreFunc:function(){closeMailFolderOptionLayer()}};var d=new EventControl("#mainContentWrap","click","a,span,ins,li,p,tr,td",f);d.add("switch-flag",function(l){var j=jQuery(l).attr("flag");var h=("on"==jQuery(l).attr("flaged"));var k=jQuery(l).closest("tr").attr("id");switchFlagFlaged([k],j,!h)});d.add("switch-flag-read",function(l){var j=jQuery(l).attr("flag");var h=("on"==jQuery(l).attr("flaged"));var m=jQuery("#folderName").val();var k=jQuery("#msgUid").val();a.switchMessagesFlags([k],[m],j,!h,true)});d.add("toolbar",function(h){a.executeToolbarAction(h)});d.add("check-reserved",function(j){var k=a.getSendData();var h=(k.secureMail);if(h){jQuery.goAlert(mailMsg.mail_setting_error,mailMsg.write_alert004);return}openReservedLayerPopup();jQuery(document).trigger("showLayer.goLayer")});d.add("check-securemail",function(j){var k=a.getSendData();var h=(k.reserveMail);if(h){jQuery.goAlert(mailMsg.mail_setting_error,mailMsg.write_alert004);return}openSecureMailLayerPopup();jQuery(document).trigger("showLayer.goLayer")});d.add("list-sort",function(k){var h=jQuery(k);var l=h.attr("by");var j=(h.hasClass("sorting_desc"))?"asce":"desc";jQuery("#toolbar_sort_flag li").removeClass("sorting_desc sorting_asce");jQuery("#toolbar_sort_flag span.sort").removeClass("ic_toolbar sort_up sort_down");if(j=="asce"){h.addClass("sorting_asce");h.find("span.sort").addClass("ic_toolbar sort_up")}else{h.addClass("sorting_desc");h.find("span.sort").addClass("ic_toolbar sort_down")}a.sortMessage(l,j)});d.add("toolbar-quick-search",function(j){var h=jQuery(j).attr("data-type");console.log(h);viewQuickList(h)});d.add("list-page-move",function(j){var h=jQuery(j).attr("page");a.movePage(h);jQuery("#mail_list_content").scrollTop(0)});d.add("reload-list",function(h){a.reloadMessageList(true)});d.add("reload-mdn-list",function(h){a.loadMdnList(a.listParam)});d.add("read-message-simple",function(j){var k=jQuery(j).attr("folder");var h=jQuery(j).attr("uid");readMessage(k,h)});d.add("read-message-simple-relation",function(j){var l=jQuery(j).attr("folder");var h=jQuery(j).attr("uid");var k={folder:unescape_tag_title(l)};k=a.getSharedFolderParam(k);if(layoutMode!="n"){mailControl.loadMessageList(k,true,true,true)}readMessage(l,h)});d.add("read-message",function(j){a.closeMailListPreview();var k=jQuery(j).closest("tr").attr("folder");var h=jQuery(j).closest("tr").attr("uid");readMessage(k,h)});d.add("read-message-popup",function(j){var k=jQuery(j).closest("tr").attr("folder");var h=jQuery(j).closest("tr").attr("uid");readMessagePopup(k,h)});d.add("read-message-relation-popup",function(j){var k=jQuery(j).attr("folder");var h=jQuery(j).attr("uid");readMessagePopup(k,h)});d.add("draft-message",function(j){var k=jQuery(j).closest("tr").attr("folder");var h=jQuery(j).closest("tr").attr("uid");writeDraftMessage(k,h)});d.add("mail-read-close-sender-list",function(h){jQuery("#mailReadSenderListWrap").hide();jQuery(h).hide();jQuery(h).parent().find(".ic_arrow_down_type4").show();setCookie("rcpt_hidden","on",365)});d.add("mail-read-open-sender-list",function(h){jQuery("#mailReadSenderListWrap").show();jQuery(h).hide();jQuery(h).parent().find(".ic_arrow_up_type4").show();setCookie("rcpt_hidden","off",365)});d.add("mail-read-open-relation-list",function(h){jQuery(h).hide();jQuery(h).parent().find(".btn_slide_hide").show();jQuery("#relationContentWrap").show()});d.add("mail-read-close-relation-list",function(h){jQuery(h).hide();jQuery(h).parent().find(".btn_slide_show").show();jQuery("#relationContentWrap").hide()});d.add("download-attach",function(l){var h=jQuery(l).attr("evt-data");if(h&&h!=""){attachChecklayer()}else{var m=jQuery("#folderName").val();var k=jQuery("#msgUid").val();var j=jQuery(l).closest("li").attr("part");downloadAttach(m,k,j)}});d.add("preview-attach",function(k){var l=jQuery("#folderName").val();var j=jQuery("#msgUid").val();var h=jQuery(k).closest("li").attr("part");previewAttach(j,l,h)});d.add("save-webfolder",function(l){var h=jQuery(l).attr("evt-data");if(h&&h!=""){attachChecklayer()}else{var n=jQuery("#folderName").val();var k=jQuery("#msgUid").val();var j=jQuery(l).closest("li").attr("part");var m={folderName:n,uid:k,part:j};if(jQuery("#shared_folder_wrap").find("p.title.on").length>0){m.sharedUserSeq=jQuery("#shared_folder_wrap").find("p.title.on").children().attr("seq");m.sharedFolderName=n;m.sharedFlag="shared"}openWebfolderPopup(m)}});d.add("read-view-img",function(j){var k=jQuery("#folderName").val();var h=jQuery("#msgUid").val();readViewImg(k,h)});d.add("regist-bayesian-rule",function(j){var l=jQuery(j).data("type");var k=jQuery("#folderName").val();var h=jQuery("#msgUid").val();registBayesianRuleMessage(l,k,h)});d.add("download-attach-all",function(k){var l=jQuery("#folderName").val();var h=jQuery("#msgUid").val();var j="";jQuery("#attachListWrap li:not(.deleted)").each(function(){j+=(j=="")?j:"_";j+=jQuery(this).attr("part")});if(j==""){jQuery.goAlert(mailMsg.mail_attach,mailMsg.alert_download_nofile);return}jQuery.goAlert(mailMsg.mail_attach_all_save_title,mailMsg.mail_attach_all_save_message);downloadAllAttach(l,h,j)});d.add("delete-attach",function(k){var l=jQuery("#folderName").val();var j=jQuery("#msgUid").val();var h=jQuery(k).closest("li").attr("part");deleteAttachFile(l,j,h)});d.add("delete-attach-all",function(k){var l=jQuery("#folderName").val();var h=jQuery("#msgUid").val();var j="";jQuery("#attachListWrap li").each(function(){if(!jQuery(this).hasClass("deleted")){j+=(j=="")?j:"_";j+=jQuery(this).attr("part")}});deleteAllAttach(l,h,j)});d.add("read-nested-pop",function(k){var l=jQuery("#folderName").val();var j=jQuery("#msgUid").val();var h=jQuery(k).closest("li").attr("part");readNestedMessage(l,j,h)});d.add("help-accordion-collapse",function(l){var k=jQuery(l);var j=k.data("id");var h=jQuery("#"+j);if(k.hasClass("on")){k.removeClass("on")}else{k.addClass("on")}h.slideToggle("fast")});d.add("download-tnef-attach",function(l){var m=jQuery("#folderName").val();var k=jQuery("#msgUid").val();var j=jQuery(l).closest("li").attr("part");var h=jQuery(l).attr("attkey");downLoadTnefAttach(m,k,j,h)});d.add("view-message-source",function(j){var k=jQuery("#folderName").val();var h=jQuery("#msgUid").val();viewSource(k,h)});d.add("view-ndr-guide",function(h){viewNdrGuide()});d.add("registration-schedule",function(j){var h=jQuery("#messageListId").attr("subject");viewRegistrationSchedule(h)});d.add("ai-summary",function(){var n=jQuery("iframe").filter("#messageContentFrame");var l=n[0].contentDocument||n[0].contentWindow.document;var j=l.getElementById("message-container");var h=jQuery(j).text();var k=getAiSummaryParams();var m=function(){startAiSummaryProcess(k.emailId,k.subject,k.sender,h)};if(!agreeForAiMail){openAiConsentCheckLayer(m);return}startAiSummaryProcess(k.emailId,k.subject,k.sender,h)});d.add("ai-draft",function(){var h=function(){submitAiDraft()};if(!agreeForAiMail){openAiConsentCheckLayer(h);return}submitAiDraft()});d.add("reset-editor",function(){var h=jQuery(jQuery(jQuery("#ai_draft_input").parents("body").find("iframe#dext_frame_smartEditor")[0]).contents().context.contentDocument);var j=h.find("iframe").contents().find("#dext_body");j.html("")});d.add("print-message",function(h){printMessage()});d.add("confirm-integrity",function(j){var k=jQuery("#folderName").val();var h=jQuery("#msgUid").val();confirmIntegrity(k,h)});d.add("write-toggle-bccwrap",function(h){if(jQuery(h).hasClass("ic_arrow_down_type4")){jQuery(h).removeClass("ic_arrow_down_type4").addClass("ic_arrow_up_type4").attr("title",mailMsg.comn_close);jQuery("#writeBccWrap").show()}else{jQuery(h).removeClass("ic_arrow_up_type4").addClass("ic_arrow_down_type4").attr("title",mailMsg.comn_open);jQuery("#writeBccWrap").hide()}});d.add("attach-area-toggle",function(k){var h=jQuery(k);var j=h.hasClass("ic_arrow_up_type4");if(getCookie("OcxUpload")=="on"){jQuery("#att_ocx_area").toggle(!j)}else{jQuery("#att_simple_area").toggle(!j)}h.toggleClass("ic_arrow_down_type4").toggleClass("ic_arrow_up_type4");setCookie("isAttachAreaFolded",j,365)});d.add("write-toggle-massRcptwrap",function(h){var j="on";if(jQuery(h).hasClass("ic_arrow_down_type4")){jQuery(h).removeClass("ic_arrow_down_type4").addClass("ic_arrow_up_type4").attr("title",mailMsg.comn_close);jQuery("#massRcptwrap").show();j="off"}else{jQuery(h).removeClass("ic_arrow_up_type4").addClass("ic_arrow_down_type4").attr("title",mailMsg.comn_open);jQuery("#massRcptwrap").hide()}setCookie("DO_MASSRCPT_CLOSE",j,365)});d.add("bigattach-manage",function(h){viewBigAttachManager()});d.add("open-write-webfolder",function(h){openWriteWebfolder()});d.add("letter-layer",function(h){getLetterListLayer()});d.add("write-change-editor",function(h){getWriteModeLayer()});d.add("write-mode-change",function(h){var j=jQuery(h).data("mode");chgEditorMod(j)});d.add("template-layer",function(h){getDocTemplateList()});d.add("layer-list-page-move",function(k){var h=jQuery("#pageNaviLayerWrap").data("type");var j=jQuery(k).attr("page");if(h=="letter"){getLetterListLayer(j)}else{if(h=="docTmpl"){getDocTemplateList(j)}}});d.add("send-message",function(h){if(!contentValidation()){return}sendMessage()});d.add("send-draft",function(h){if(!contentValidation()){return}doDraftSave()});d.add("receive-noti-read",function(k){var h=jQuery(k).attr("messageId");var j=jQuery(k).attr("subject");var m=jQuery(k).attr("date");var l={messageId:h,subject:j,dateUtc:m};mailControl.loadMdnRead(l)});d.add("add-message-tagging",function(j){var h=jQuery(j).closest("li").data("tid");messageTaggingManager(h,"true")});d.add("remove-message-tagging",function(j){var h=jQuery(j).closest("li").data("tid");messageTaggingManager(h,"false")});d.add("self-remove-message-tagging",function(m){var k=jQuery(m).data("tagid");var l,j;if(currentMenu=="read"){l=jQuery("#folderName").val();j=jQuery("#msgUid").val()}else{var h=jQuery(m).closest("tr");l=h.attr("folder");j=h.attr("uid")}selfRemoveMessageTagging(l,j,k)});d.add("change-flag-seen",function(h){changeSeenFlag(true)});d.add("change-flag-unseen",function(h){changeSeenFlag(false)});d.add("toolbar-folder",function(h){var j=jQuery(h).attr("fname");copyMoveMessage(j)});d.add("toolbar-write-reply",function(h){replyWrite("reply")});d.add("toolbar-write-replyall",function(h){replyWrite("replyall")});d.add("toolbar-forward-parsed",function(h){forwardMessage("parsed")});d.add("toolbar-forward-attached",function(h){forwardMessage("attached")});d.add("toolbar-message-delete",function(h){deleteMessage()});d.add("toolbar-message-erase",function(h){cleanMessage()});d.add("toolbar-attach-delete",function(h){deleteMessageAttaches()});d.add("toolbar-message-save",function(h){if(!checkListToolbarSelect()){return}downloadMessage()});d.add("toolbar-message-filter",function(h){if(!checkListToolbarSelect()){return}addMessageFilter()});d.add("toolbar-print",function(h){if(!checkListToolbarSelect()){return}printMessage()});d.add("toolbar-add-reject",function(h){if(!checkListToolbarSelect()){return}registRejectAllow("black")});d.add("toolbar-add-allow",function(h){if(!checkListToolbarSelect()){return}registRejectAllow("white")});d.add("toolbar-write-cancel",function(h){checkEscapeWriteMode(function(){mailControl.reloadWriteMessage()})});d.add("toolbar-rewrite",function(h){if(!checkListToolbarSelect()){return}reWrite()});d.add("toolbar-change-mailmode",function(k){var j=jQuery(k).find("span").attr("id");var h=jQuery("#readMode_layer1");var m=jQuery("#readMode_layer2");var l=jQuery("#readMode_layer3");h.removeClass("ic_layer1 ic_layer1_active on");m.removeClass("ic_layer2 ic_layer2_active on");l.removeClass("ic_layer3 ic_layer3_active on");if(j=="readMode_layer1"){h.addClass("ic_layer1_active on");m.addClass("ic_layer2");l.addClass("ic_layer3")}else{if(j=="readMode_layer2"){h.addClass("ic_layer1");m.addClass("ic_layer2_active on");l.addClass("ic_layer3")}else{h.addClass("ic_layer1");m.addClass("ic_layer2");l.addClass("ic_layer3_active on")}}saveLayoutOption()});d.add("search-rcpt-address",function(h){searchRcptAddress()});d.add("select-all-message-on",function(h){selectAllMessageOn()});d.add("select-all-message-off",function(h){selectAllMessageOff()});d.add("from-to-submenu",function(h){openAddrLayerPopup(h)});d.add("layer-write-email",function(j){var h=jQuery(j).parent().data("email");var k={wtype:"normal",to:h};goWrieLoad(k);closeAddrLayerPopup(j)});d.add("layer-save-addr",function(j){var h=jQuery(j).parent().data("email");addAddrBookEmail(h);closeAddrLayerPopup(j)});d.add("layer-search-mail",function(k){var j=jQuery(k).parent().data("email");var h=get_email(j);searchMessage(h);closeAddrLayerPopup(k)});d.add("goto-basic-setting",function(h){if(isPopupView()){if(isReloadReady()){opener.loadBasicSetting()}window.close()}else{loadBasicSetting()}});d.add("go-home",function(h){parent.GoInitMenu()});d.add("write-mail",function(h){jQuery(window).scrollTop(0);goWrite()});d.add("folder",function(j){var h=jQuery(j).attr("fname");goFolder(h)});d.add("write-add-address",function(h){var j=jQuery(h).data("rcpt");openWriteAddrRcptPopup(j)});d.add("write-mail-popup",function(j){var h="writePopup"+makeRandom();location.replace("/app/mail/popup",h,"scrollbars=yes,resizable=yes,width=1280,height=790")});d.add("view-popup-allow-list",function(h){a.listSendAllow(function(j){viewSendAllow(j)})});d.add("select-field",function(h){selectAddressFieldkeyEvt(jQuery(h).closest("li"))});d.add("multi-select-field",function(j){var h=jQuery(j).closest("li");h.addClass("on")});d.add("multi-select-fields",function(o){if(window.event){window.event.returnValue=false}else{event.returnValue=false}var r=jQuery(o).closest("li");var s=r.closest("ul.name_tag");var k=s.find("li:not(.creat)");var q=k.size();r.addClass("on");var h=k.first();var l=null;var p=new Array();for(var n=0;n<q;n++){if(n==0){if(h.hasClass("on")){p.push(n)}l=h.next()}else{if(l.hasClass("on")){p.push(n)}l=l.next()}}for(var n=p[0];n<p[1];n++){for(var m=0;m<q;m++){if(m==0&&n==m){h.addClass("on");l=h.next()}else{if(m!=0&&n==m){l.addClass("on");l=l.next()}else{if(m==0){l=h.next()}else{l=l.next()}}}}}});d.add("toggle-mail-folder",function(k){var h=jQuery(k).attr("status");var j=jQuery(k).closest("li").attr("depth");j=parseInt(j,10);var l=jQuery(k).closest("li").find("ul[depth='"+(j+1)+"']");if(h=="open"){l.hide();jQuery(k).removeClass("close").addClass("open").attr({status:"close",title:mailMsg.comn_open})}else{l.show();jQuery(k).removeClass("open").addClass("close").attr({status:"open",title:mailMsg.comn_close})}});d.add("refresh-mail-list",function(h){makeProcessLoader();mailControl.reloadMessageList()});d.add("refresh-toolbar",function(h){a.makeSubToolbar(jQuery(h))});d.add("select-refresh-time",function(j){setCookie("reflash_time",jQuery(j).attr("data-value"),365);jQuery("#toolbar_refresh_flag li .ic_check").each(function(){jQuery(this).hide()});var h=getCookie("reflash_time");jQuery("#toolbar_refresh_flag li").each(function(){if(jQuery(this).attr("data-value")==h){jQuery(this).find(".ic_board.ic_check").show()}});if(h!="-1"){jQuery("#refresh_min_text").text(h)}else{jQuery("#refresh_min_text").text("")}});d.add("layout-toolbar",function(h){a.makeLayoutSubToolbar(jQuery(h))});d.add("sort-toolbar",function(h){a.makeSortAndSearchToolbar(jQuery(h))});d.add("disk-next-request",function(j){var h={data:false};setLocalStorage(USERSESSION.id+"_mail-quota-top-bar",h);jQuery("#mail_quota_bar").hide()});d.add("disk-add-request",function(j){if(folderControl.quotaRequest.requestComment!==undefined){if(folderControl.quotaRequest.quotaRequestAgainTime>0){addDiskRequestAgainPopup(true)}else{addDiskRequestAgainPopup(false)}}else{addDiskRequestPopup()}var h={data:false};setLocalStorage(USERSESSION.id+"_mail-quota-top-bar",h);jQuery("#mail_quota_bar").hide()});var c=new EventControl("#mainContentWrap","click","input");c.add("list-select-all",function(k){var h=jQuery(k).attr("checked");var j=jQuery("#mail_list_content input:checkbox");j.each(function(){listCheckboxControl(jQuery(this),h)});toggleAllCheckMessage(h)});c.add("write-myself",function(j){var h=jQuery(j).attr("checked");makeWriteMyself(h)});c.add("check-list",function(h){ReadSubMessageChecker.resetUid();listCheckboxControl(jQuery(h),jQuery(h).attr("checked"))});c.add("mod-field-inside",function(h){isModFieldInside=true});var b=new EventControl("#mainContentWrap","click","ul");b.add("write-address-to",function(h){if(!isModFieldInside){jQuery("#to").focus()}});b.add("write-address-cc",function(h){if(!isModFieldInside){jQuery("#cc").focus()}});b.add("write-address-bcc",function(h){if(!isModFieldInside){jQuery("#bcc").focus()}});var e=new EventControl("#mainContentWrap","change","select");e.add("auto-save",function(j){var h=jQuery(j).val();chgAutoSaveTerm(h)});e.add("select-rcpt-email",function(j){var k=jQuery(j).data("rcpt");var h=jQuery(j).val();selectRcptEmail(k,h);jQuery(j).val("")});e.add("change-pagebase",function(h){savePageBase()});e.add("change-sender-mail",function(h){if(jQuery(h).find("option:selected").attr("alias")=="true"){jQuery.goPopup({id:"changeSenderMail",contents:"<p class='add'>"+mailMsg.mail_sender_email_alias_alert+"</p>",closeCallback:function(){jQuery("#senderUserEmail").val(previousSenderEmail)},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:function(){jQuery.goPopup.close()}},{btype:"cancel",btext:mailMsg.comn_cancel}]})}});var g=new EventControl("#mailHeaderWrap","click","a,:button,ins");g.add("mail-detail-search",function(h){toggleDetailSearchLayer()});g.add("mail-search",function(h){searchMessage()});g.add("add-bookmark",function(h){addBookmark()});g.add("delete-bookmark",function(h){deleteBookmark()});g.add("mail-search-cancel",function(h){cancelSearch()});jQuery("#mainContentWrap").on("mouseover","#mail_list_content table:not(#mail_mdn_list_content,#mail_mdn_read_content) tr:not(.tb_option,.dateDesc)",function(h){makeDragEvent(jQuery(this))});jQuery("#mailSearchKeyWord").on("keypress",function(h){if(h.which==13){searchMessage()}}).on("focus",function(){jQuery(this).parent().addClass("search_focus")}).on("blur",function(){jQuery(this).parent().removeClass("search_focus")})};this.makeSortAndSearchToolbar=function(c){var d=function(g,f){var e;g.bind({mouseover:function(){if(e){clearTimeout(e)}},mouseout:function(){e=setTimeout(function(){f.hide();g.unbind();f.unbind()},1000)}});f.bind({mouseover:function(){if(e){clearTimeout(e)}},mouseout:function(){e=setTimeout(function(){f.hide();g.unbind();f.unbind()},1000)}})};var b=c.parent().find("div.array_option");if(b.css("display")=="none"){jQuery("#toolbar_wrap div.array_option").hide();jQuery("div[data-tag=write_toolbar_wrap] div.array_option").hide();b.show();d(c,b)}else{b.hide();c.unbind();b.unbind()}};this.makeSubToolbar=function(e,f){var b=function(j,h){jQuery("#"+j+" *").unbind();h.unbind()};var g=e.parent().find("ul").attr("id");var c=jQuery("#"+g).closest("div.array_option");if(c.css("display")=="none"){jQuery("#toolbar_wrap div.array_option").hide();jQuery("div[data-tag=write_toolbar_wrap] div.array_option").hide();c.show();var d;e.bind("mouseover",function(){if(d){clearTimeout(d)}});e.bind("mouseout",function(){d=setTimeout(function(){c.hide();b(g,e)},1000)});jQuery("#"+g).parent().bind("mouseout",function(){d=setTimeout(function(){c.hide();b(g,e)},1000)});jQuery("#"+g).parent().bind("mouseover",function(){if(d){clearTimeout(d)}});if(f=="move"){jQuery("#"+g).closest("div.array_option").bind("mouseover",function(){if(d){clearTimeout(d)}})}jQuery("#"+g+" > li").bind("click",function(){if(jQuery(this).parent().attr("auto-close")!="off"){c.hide();b(g,e)}var h=jQuery(this).attr("evt-rol");if(!h){return}if(h=="toolbar-quick-search"){var h=jQuery(this).data("type");viewQuickList(h)}})}else{c.hide();b(g,e)}};this.makeLayoutSubToolbar=function(d,e){var f="toolbar_layout_flag";var b=jQuery("#"+f).closest("div.array_option");if(b.css("display")=="none"){jQuery("#toolbar_wrap div.array_option").hide();jQuery("div[data-tag=write_toolbar_wrap] div.array_option").hide();b.show();var c;d.bind("mouseover",function(){if(c){clearTimeout(c)}});d.bind("mouseout",function(){c=setTimeout(function(){b.hide();jQuery("#"+f+" *").unbind();d.unbind()},1000)});jQuery("#"+f+" > *").bind("mouseout",function(){c=setTimeout(function(){b.hide();jQuery("#"+f+" *").unbind();d.unbind()},1000)});jQuery("#"+f+" > *").bind("mouseover",function(){if(c){clearTimeout(c)}});jQuery("#"+f+" > a").bind("click",function(){if(jQuery(this).parent().attr("auto-close")!="off"){b.hide();jQuery("#"+f+" *").unbind();d.unbind()}})}else{jQuery("#"+f+" *").unbind();d.unbind();b.hide()}};this.makeMailHeaderMsg=function(c){if(getCookie("reflash_time")==""){setCookie("reflash_time",-1,365)}var d=getCookie("reflash_time");c.reflashTime=d;var b=c.folderType;if(b=="sent"||b=="drafts"||b=="reserved"||b=="spam"||b=="trash"||b=="all"){isUseReflashTime=false;runAutoReflashTime=null}else{if(b=="inbox"||b=="normal"){isUseReflashTime=true}}jQuery("#mail_header_msg").handlebars("mail_header_msg_tmpl",c);if(isUseReflashTime&&d>0&&runAutoReflashTime==null){runAutoReflashTime=setTimeout(function(){runAutoReflashProcess()},5000)}};this.getListMode=function(){return this.listMode};this.getCurrentFolder=function(){return this.currentFolder};this.taggingMessage=function(b){ActionLoader.postGoJsonLoadAction(this.taggingMessageAction,b,function(c){if(isReloadReady()){opener.reloadMessagePopup();opener.reloadMessageList()}else{if(currentMenu=="read"){a.reloadReadMessage()}else{a.reloadMessageList()}}},"json")};this.executeToolbarAction=function(e){if(currentMenu=="list"||(currentMenu=="read"&&layoutMode!="n")){var g=("on"==jQuery(e).attr("ignore"));if(!g&&getMailListCheckedCount()==0){if(a.listMode=="mdnread"){jQuery.goAlert(mailMsg.error_noselect);return}else{if(a.listMode=="mdnlist"){var d=jQuery(e).attr("evt-act");if(d=="toolbar-mdn-recall-all"){jQuery.goSlideMessage(mailMsg.mail_mdn_message_recall_001,"caution")}else{jQuery.goSlideMessage(mailMsg.mail_mdn_message_delete_001,"caution")}return}else{jQuery.goAlert(mailMsg.mail_message_notselect);return}}}}var c=("on"==jQuery(e).attr("sub"));var f=jQuery(e).attr("menu");if(c){if(f=="tag"){makeTagToolbar()}else{if(f=="copy"||f=="move"){makeCopyMoveToolbar()}else{if(f=="forward"){jQuery("#toolbarForwardParsedMenu").show();if(getMailListCheckedCount()>1){jQuery("#toolbarForwardParsedMenu").hide()}}}}a.makeSubToolbar(jQuery(e),f)}else{var d=jQuery(e).attr("evt-act");switch(d){case"toolbar-write-preview":writePreview();break;case"toolbar-message-delete":if(a.listMode=="mdnlist"){deleteMdn()}else{deleteMessage()}break;case"toolbar-write-reply":replyWrite("reply");break;case"toolbar-forward-quick":if(getMailListCheckedCount()>1){forwardMessage("attached")}else{forwardMessage("parsed")}break;case"change-flag-seen":changeSeenFlag(true);break;case"toolbar-add-spam":addSpamWhiteRule("black");break;case"toolbar-add-white":addSpamWhiteRule("white");break;case"toolbar-mdn-recall":recallMsg();break;case"toolbar-mdn-recall-all":recallSelectMsg();break;case"toolbar-mdn-sent-view":var b=jQuery("#mdnReadUid").val();if(b<0){jQuery.goSlideMessage(mailMsg.mail_not_found_message,"caution");return}readMessagePopup("Sent",b);break;default:return}}}};var FolderControl=function(){this.folderInfoAction="/api/mail/folder/info";this.folderAllInfoAction="/api/mail/folder/all";this.folderBasicInfoAction="/api/mail/folder/list";this.addFolderAction="/api/mail/folder/create";this.modifyFolderAction="/api/mail/folder/modify";this.deleteFolderAction="/api/mail/folder/delete";this.emptyFolderAction="/api/mail/folder/empty";this.sharedFolderReaderListAction="/api/mail/folder/share/reader";this.bookmarkListAction="/api/mail/bookmark/list";this.saveBookmarkAction="/api/mail/bookmark/save";this.updateBookmarkAction="/api/mail/bookmark/update";this.deleteBookmarkAction="/api/mail/bookmark/delete";this.changeBookmarkAction="/api/mail/bookmark/change";this.tagListAction="/api/mail/tag/list";this.addTagAction="/api/mail/tag/create";this.modifyTagAction="/api/mail/tag/modify";this.deleteTagAction="/api/mail/tag/delete";this.userFolderList=[];this.quotaInfo={};this.quotaRequest={};this.tagData=[];var a=this;this.updateFolderCountInfo=function(){var b={};ActionLoader.getGoLoadAction(this.folderInfoAction,b,function(c){a.printFolderCountUpdate(c);a.printFolderCountUpdateBookMark(c);makeMailBadgeCount()},"json")};this.printFolderCountUpdate=function(f){var h=f;if(h&&h.length>0){for(var g=0;g<h.length;g++){var b=h[g];if(isMailBadgeUse){if(b.fullName=="Inbox"){mailBadgeCount=b.unseenCnt}if(!isDefaultBox(b.fullName)){mailBadgeCount+=b.unseenCnt}}var j=jQuery("#"+b.id+"_num");j.empty();if(b.unseenCnt>0){var e=jQuery("<a></a>");var k=jQuery("<span class='num'></span>");k.text(b.unseenCnt);e.attr({"evt-rol":"unseen-folder",fname:b.fullName});e.html(k);j.html(e);j.data("unseen",b.unseenCnt)}if(b.child&&b.child.length>0){a.printFolderCountUpdate(b.child)}if((currentMenu=="list"||currentMenu=="read")&&currentFolderName==b.fullName){isBookmark=false;jQuery("#mail_bookmark_list li").each(function(){var m=jQuery(this).attr("query");var l=jQuery(this).attr("seq");if(m==b.fullName){isBookmark=true}});var c={name:currentFolderViewName,totalCnt:b.totalCnt,unseenCnt:b.unseenCnt,isBookmark:isBookmark};if(bookmarkType=="tag"){var d=getTagInfo(bookmarkValue);c.type="tag";c.tagInfo=d}makeMailHeaderMessege(c)}}}};this.printFolderCountUpdateBookMark=function(b){if(b&&b.length>0){for(var c=0;c<b.length;c++){var d=b[c];jQuery("#mail_bookmark_list li").each(function(){var j=jQuery(this).attr("query");var g=jQuery(this).attr("seq");if(j==d.fullName){var f=jQuery("#bookmark_num_"+g);f.empty();if(d.unseenCnt>0){var e=jQuery("<a></a>");var h=jQuery("<span class='num'></span>");h.text(d.unseenCnt);e.attr({"evt-rol":"unseen-folder",fname:d.fullName});e.html(h);f.html(e);f.data("unseen",d.unseenCnt)}}});if(d.child&&d.child.length>0){a.printFolderCountUpdateBookMark(d.child)}}}};this.getFolderAllInfo=function(){var b={};ActionLoader.getGoLoadAction(this.folderAllInfoAction,b,function(c){a.checkCollapseStatus();a.printFolderAllInfo(c)},"json")};this.checkCollapseStatus=function(){a.toggleCollapseStatus("mail_tag_wrap","tag_menu_collapse");a.toggleCollapseStatus("left_mail_box_wrap","mail_menu_collapse");a.toggleCollapseStatus("uf_smart_area","smart_menu_collapse");a.toggleCollapseStatus("left_quicksearch_box_wrap","quicksearch_menu_collapse")};this.toggleCollapseStatus=function(d,c){var b=getCookie(d);if(b=="close"){jQuery("#"+c).closest("h1").addClass("folded").attr("title",mailMsg.common_menu_show);jQuery("#"+d).hide()}else{jQuery("#"+c).closest("h1").removeClass("folded").attr("title",mailMsg.common_menu_hide);jQuery("#"+d).show()}};this.getFolderInfo=function(){a.getFolderInfoData(function(b){a.printFolderInfo(b)})};this.getFolderInfoData=function(b){var c={};ActionLoader.getGoLoadAction(this.folderBasicInfoAction,c,function(d){if(b){b(d)}},"json")};this.getQuotaInfo=function(){return this.quotaInfo};this.setQuotaInfo=function(b){this.quotaInfo=b};this.addFolderAfterFunc=function(d,b){var c={folderName:d};ActionLoader.postGoLoadAction(this.addFolderAction,c,function(e){if(b){b(e)}},"json")};this.addFolder=function(b){ActionLoader.postGoLoadAction(this.addFolderAction,b,function(c){a.getFolderInfo();if(isFolderManageMenu()){mailSettingControl.loadViewFolderManage()}removeProcessLoader()},"json")};this.modifyFolder=function(b){ActionLoader.postGoLoadAction(this.modifyFolderAction,b,function(e){a.getFolderInfo();var f=b.newName;var d="";if(f.indexOf(".")>0){d=f.substring((f.lastIndexOf(".")+1),f.length)}else{d=f}var c={};c.bookmarkType="mail";c.preBookmarkValue=b.previousName;c.bookmarkName=d;c.bookmarkValue=f;a.changeBookMarkInfo(c);if(isFolderManageMenu()){mailSettingControl.loadViewFolderManage()}},"json",function(c){jQuery.goSlideMessage(c.message,"caution")})};this.deleteFolder=function(d,b){var c={folderName:d};ActionLoader.postGoLoadAction(this.deleteFolderAction,c,function(f){a.getFolderInfo();var e={};e.bookmarkType="mail";e.bookmarkValue=d;a.deleteBookmark(e);if(b){b()}},"json")};this.emptyMailFolder=function(c,b){ActionLoader.postGoLoadAction(this.emptyFolderAction,c,function(d){if(b){b()}},"json")};this.printFolderInfo=function(b){a.makeDefaultFolder(b.defaultFolders);a.makeUserFolder(b.userFolders);a.makeQuotaInfo(b.quotaInfo,b.quotaRequest);a.printFolderCountUpdateBookMark(b.defaultFolders);a.printFolderCountUpdateBookMark(b.userFolders)};this.printFolderAllInfo=function(b){a.printFolderInfo(b);a.makeTagList(b.userTags);a.makeSharedFolderList(b.userSharedFolderList)};this.makeQuotaInfo=function(k,l){if(_.isUndefined(l.apply)){l.apply=false}if(l.apply==false){jQuery("#mail-volume-request").remove();resizeLeftMenu()}else{jQuery("#mail-volume-request").show()}jQuery("#usageQuota").html(k.usageUnit);jQuery("#limitQuota").html(k.limitUnit);var g=k.percent>=100;var b=k.percent>=l.mailGroupQuotaWarningRatio;var c=l.mailGroupQuotaWarningRatio>0;var d=l.mailGroupApply=="on";var h=d&&b&&c;var j=getLocalStorage(USERSESSION.id+"_mail-quota-top-bar");if((l.apply==false)||(j&&j.data==false)){jQuery("#mail_quota_bar").hide()}else{if(g){jQuery("#mail_quota_bar").show();jQuery("#mail_quota_bar .ment").hide();jQuery("#mail_quota_bar .full").show()}else{if(h){jQuery("#mail_quota_bar").show();jQuery("#mail_quota_bar .ment").hide();jQuery("#mail_quota_bar .almostfull").show()}}}if(l.requestComment!==undefined){jQuery("#diskAddRequestStatus").html(mailMsg.volume_quota_waiting);this.quotaRequest=l}else{jQuery("#diskAddRequestStatus").html(mailMsg.volume_quota_diskadd);this.quotaRequest=l}if(g||h){jQuery("#diskUsageColor").attr("class","lnb personal_data nega")}else{jQuery("#diskUsageColor").attr("class","lnb personal_data");var e={data:true};setLocalStorage(USERSESSION.id+"_mail-quota-top-bar",e);jQuery("#mail_quota_bar").hide()}var f=g?100:k.percent;jQuery("#usagePercent").css("width",f+"%");this.quotaInfo=k};this.makeDefaultFolder=function(e){var d=false;if(e&&e.length>0){for(var g=0;g<e.length;g++){var h=e[g];if(h.fullName=="Quotaviolate"){d=true}var c=jQuery("#"+h.id+"_num");c.empty();if(h.unseenCnt>0){var b=jQuery("<a></a>");var f=jQuery("<span class='num'></span>");f.text(h.unseenCnt);b.attr({"evt-rol":"unseen-folder",fname:h.fullName});b.html(f);c.html(b);c.data("unseen",h.unseenCnt)}if(isMailBadgeUse&&h.fullName=="Inbox"){mailBadgeCount=h.unseenCnt}}}if(d){jQuery("#df_quotaviolate").show()}else{jQuery("#df_quotaviolate").hide()}};this.makeUserFolder=function(c){this.userFolderList=c;c.isInbox=true;var f=jQuery("#inbox_folder_area");f.handlebars("mail_user_folder_tmpl",c);var e=jQuery("#inbox_toggle_btn");if(f.find("li.folder").length>0){var b=getCookie("DFN_defaultFolder0");if(b=="C"){e.addClass("open").removeClass("close").attr({status:"close",title:mailMsg.comn_open});f.hide()}else{e.addClass("close").removeClass("open").attr({status:"open",title:mailMsg.comn_close});f.show()}e.show()}else{e.hide()}c.isInbox=false;jQuery("#uf_folder_area").handlebars("mail_user_folder_tmpl",c);jQuery("#uf_folder_area p.title span.txt").each(function(){makeDropEvent(jQuery(this))});jQuery("#inbox_folder_area p.title span.txt").each(function(){makeDropEvent(jQuery(this))});if(isMailBadgeUse){for(var d=0;d<c.length;d++){mailBadgeCount+=c[d].unseenCnt}}jQuery("#uf_smart_area").handlebars("mail_smart_folder_tmpl",c);if(jQuery("#uf_smart_area li").length>0){jQuery("#smart_menu").show()}else{jQuery("#smart_menu").hide()}};this.makeSharedFolderList=function(b){if(b&&b.length>0){jQuery("#shared_folder_title").show()}else{jQuery("#shared_folder_title").hide()}jQuery("#shared_folder_wrap").handlebars("shared_folder_tmpl",b)};this.getSharringReaderList=function(b){ActionLoader.getGoLoadAction(this.sharedFolderReaderListAction,b,function(c){makeShareFolderInfo(c)},"json")};this.setSharringReaderList=function(c,b){ActionLoader.putGoJsonLoadAction(this.sharedFolderReaderListAction,c,function(d){jQuery.goOrgSlide.close();a.getFolderInfo();if(b){b()}},"json")};this.getBookmarkInfo=function(){ActionLoader.getGoLoadAction(this.bookmarkListAction,null,function(c){var b=getCookie("mail_bookmark_list");if(b=="close"){jQuery("#bookmark_menu_collapse").closest("h1.star").addClass("folded").attr("title",mailMsg.common_menu_show);jQuery("#mail_bookmark_list").hide()}else{jQuery("#bookmark_menu_collapse").closest("h1.star").removeClass("folded").attr("title",mailMsg.common_menu_hide);jQuery("#mail_bookmark_list").show()}jQuery("#mail_bookmark_list").handlebars("mail_bookmark_tmpl",c);a.updateFolderCountInfo()},"json")};this.saveBookmark=function(b){ActionLoader.postGoLoadAction(this.saveBookmarkAction,b,function(c){a.changeBookmarkFlag(true);a.getBookmarkInfo(true)},"json")};this.updateBookmark=function(b){ActionLoader.postGoLoadAction(this.updateBookmarkAction,b,function(c){a.getBookmarkInfo(true)},"json")};this.deleteBookmark=function(b){ActionLoader.postGoLoadAction(this.deleteBookmarkAction,b,function(c){a.changeBookmarkFlag(false);a.getBookmarkInfo()},"json")};this.changeBookMarkInfo=function(b){ActionLoader.postGoLoadAction(this.changeBookmarkAction,b,function(c){a.getBookmarkInfo()},"json")};this.changeBookmarkFlag=function(b){var c=jQuery("#mail_header_msg ins");if(b){c.attr("evt-rol","delete-bookmark");c.removeClass("ic_star_off").addClass("ic_star").attr("title",mailMsg.mail_bookmark_del)}else{c.attr("evt-rol","add-bookmark");c.removeClass("ic_star").addClass("ic_star_off").attr("title",mailMsg.mail_bookmark_add)}};this.getTagList=function(){this.getTagListAfterFunc(function(b){a.makeTagList(b)})};this.getTagListAfterFunc=function(b){ActionLoader.getGoLoadAction(this.tagListAction,null,function(c){if(b){b(c)}},"json")};this.makeTagList=function(b){a.tagData=b;jQuery("#mail_tag_list_area").handlebars("mail_tag_tmpl",b);jQuery("#mail_tag_list_area p.title span.txt").each(function(){makeDropEvent(jQuery(this))})};this.getTagData=function(){return this.tagData};this.setTagData=function(b){this.tagData=b};this.addTag=function(b){this.addTagAfterFunc(b,function(){a.getTagList();if(isFolderManageMenu()){mailSettingControl.loadViewFolderManage()}})};this.addTagAfterFunc=function(c,b){ActionLoader.postGoLoadAction(this.addTagAction,c,function(d){if(b){b()}},"json")};this.modifyTag=function(c,b){ActionLoader.postGoLoadAction(this.modifyTagAction,c,function(e){a.getTagList();var d={};d.bookmarkType="tag";d.preBookmarkValue=c.oldId;d.bookmarkName=c.tagName;d.bookmarkValue=c.oldId;a.changeBookMarkInfo(d);if(isFolderManageMenu()){mailSettingControl.loadViewFolderManage()}if(b){b()}},"json")};this.delTag=function(b,c){var d={tagIds:[b]};ActionLoader.postGoLoadAction(this.deleteTagAction,d,function(f){a.getTagList();var e={};e.bookmarkType="tag";e.bookmarkValue=b;a.deleteBookmark(e);if(isFolderManageMenu()){mailSettingControl.loadViewFolderManage()}if(c){c()}},"json")};this.getUserFolderList=function(){return this.userFolderList};this.setUserFolderList=function(b){this.userFolderList=b};this.makeEvent=function(){var b={everyPreFunc:function(){closeMailFolderOptionLayer()}};var c=new EventControl("#mailLeftMenuWrap","click","a,span,li",b);c.add("mail-home",function(){top.location="/app/mail"});c.add("write-mail",function(d){goWrite()});c.add("folder",function(e){var d=jQuery(e).attr("fname");goFolder(d)});c.add("add-folder",function(d){var e=jQuery(d).offset();addFolder(e)});c.add("more-folder",function(d){var e=jQuery(d).offset();moreFolder(e)});c.add("mail-folder-option",function(g){var k=jQuery(g).data("depth");var j=jQuery(g).attr("fname");var d=jQuery(g).parent().parent().find("p a");childrenFnameForModify=new Array(d.length);jQuery(g).parent().parent().find("p a").each(function(m){childrenFnameForModify[m]=jQuery(g).attr("fname")});var e=jQuery(g).data("share");var l=jQuery(g).data("shareseq");var f={folderName:j,depth:k,share:e,shareseq:l};var h=jQuery(g).offset();f.useSharedfolder=useSharedfolder;jQuery.goPopup({id:"mailFolderOptionLayer",pclass:"layer_normal layer_context",width:115,modal:false,openCallback:function(){jQuery("#mailFolderOptionLayer header, #mailFolderOptionLayer footer").hide();jQuery("#mailFolderOptionLayer div.content").css("padding","0");jQuery("#mailFolderOptionLayer div.content").on("click","li",function(p){var m=jQuery(this).attr("evt-rol");var r=jQuery(this).parent().attr("folder");if(m=="empty-user-folder"){emptyFolder(r)}else{if(m=="modify-folder"){modifyFolder(r)}else{if(m=="delete-folder"){deleteFolder(r)}else{if(m=="add-sub-folder"){addSubFolder(r)}else{if(m=="share-folder"){openShareFolderSettingLayer(r);var o=("on"==jQuery(this).parent().data("share"));if(o){var n=jQuery(this).parent().data("shareseq");jQuery("#orgShareFlag").attr("checked",true);jQuery("#orgShareFlag").data("shareSeq",n);var q={folderUid:n};folderControl.getSharringReaderList(q)}}else{if(m=="upload-message"){upfolderName=r;openUploadMessageLayer()}else{if(m=="move-folder"){moveFolder(r)}}}}}}}})},offset:{top:h.top,left:h.left+15},contents:getHandlebarsTemplate("mail_folder_option_tmpl",f),buttons:[]})});c.add("mail-folder-option-close",function(d){closeMailFolderOptionLayer()});c.add("empty-spam-folder",function(d){emptyFolder("Spam")});c.add("empty-trash-folder",function(d){emptyFolder("Trash")});c.add("add-disk-request",function(d){if(folderControl.quotaRequest.requestComment!==undefined){if(folderControl.quotaRequest.quotaRequestAgainTime>0){addDiskRequestAgainPopup(true)}else{addDiskRequestAgainPopup(false)}}else{addDiskRequestPopup()}});c.add("shared-folder",function(f){var e=jQuery(f).attr("fname");var d=jQuery(f).attr("seq");goSharedFolder(e,d)});c.add("unseen-folder",function(e){var d=jQuery(e).attr("fname");goFolder(d,"U")});c.add("bookmark-modify",function(d){bookmarkManage()});c.add("bookmark-cancel",function(d){bookmarkCancel()});c.add("bookmark-submit",function(d){bookmarkModify()});c.add("bookmark-execute",function(g){if(jQuery("#mail_bookmark_wrap").hasClass("lnb_edit")){return}var d=jQuery(g).closest("li");var e=d.attr("type");var h=d.attr("query");var f=d.attr("seq");bookmarkExecute(f,e,h)});c.add("bookmark-delete",function(d){jQuery(d).closest("li").remove()});c.add("tag-add",function(e){var d=jQuery(e);var f=d.offset();f.sideTop=d.attr("id");addMailTag(null,f)});c.add("mail-tag-option",function(g){var j=jQuery(g).attr("tagid");var e=jQuery(g).attr("tagname");var d=jQuery(g).attr("tagcolor");var f={id:j,name:e,color:d};var h=jQuery(g).offset();jQuery.goPopup({id:"mailTagOptionLayer",pclass:"layer_normal layer_context",width:115,modal:false,openCallback:function(){jQuery("#mailTagOptionLayer header,footer").hide();jQuery("#mailTagOptionLayer div.content").css("padding","0");jQuery("#mailTagOptionLayer div.content").on("click","li",function(p){var n=jQuery(this).attr("evt-rol");var m=jQuery(this).parent().attr("tagid");if(n=="tag-modify"){var k=jQuery(this).parent().attr("tagname");var l=jQuery(this).parent().attr("tagcolor");var o={id:m,name:k,color:l,type:"modify"};addMailTag(o)}else{if(n=="tag-delete"){deleteMailTag(m)}}})},offset:{top:h.top,left:h.left+15},contents:getHandlebarsTemplate("mail_tag_option_tmpl",f),buttons:[]})});c.add("mail-tag-option-close",function(d){closeMailTagOptionLayer()});c.add("tag-message",function(d){var f={folder:"all",listType:"tag",tagId:jQuery(d).attr("val")};var e=layoutControl.getContentSplitterMode();e=(e)?e:"n";layoutControl.contentSplitterChange(e);checkEscapeWriteMode(function(){mailControl.loadMessageList(f)})});c.add("setting-menu",function(d){selectSettingMenu("basic")});c.add("receive-noti-list",function(d){loadMdnList()});c.add("extmail-download",function(d){viewExtMailPopup()});c.add("go-folder-manager",function(d){selectSettingMenu("folder")});c.add("change-menu-collapse",function(j){var h=jQuery(j).data("id");var g=jQuery(j).data("icon");var f=jQuery("#"+h);var e=(f.css("display")=="none");var d="open";if(e){f.slideDown();jQuery(j).closest("h1").removeClass("folded").attr("title",mailMsg.common_menu_hide)}else{d="close";f.slideUp();jQuery(j).closest("h1").addClass("folded").attr("title",mailMsg.common_menu_show)}setCookie(h,d,365)});c.add("folder-execute",function(e){var d=jQuery(e).attr("type");folderExecute(d)});c.add("toggle-mail-folder",function(g){var d=jQuery(g).attr("status");var h=jQuery(g).attr("fid");var f=jQuery(g).closest("li").attr("depth");f=parseInt(f,10);var j=jQuery(g).closest("li").find("ul[depth='"+(f+1)+"']");var e="O";if(d=="open"){j.hide();jQuery(g).removeClass("close").addClass("open").attr({status:"close",title:mailMsg.comn_open});e="C"}else{j.show();jQuery(g).removeClass("open").addClass("close").attr({status:"open",title:mailMsg.comn_close})}setCookie("DFN_"+h,e,365)});c.add("tmw-folder",function(d){window.open("tmwPopup.jsp")});c.add("move-security-center",function(f){var d=jQuery(f).parent().attr("evt-data-url");var e=jQuery(f).attr("evt-data");if(e){d+="&folder="+e}window.open(d)});c.add("go-filter-manager",function(d){selectSettingMenu("filter")});jQuery("#leftMenuSectionWrap li.default_folder p.title span.txt").each(function(){makeDropEvent(jQuery(this))})}};function getListResizeHeight(){var c=jQuery("#mailBottom").offset().top;var b=jQuery("#mainContent").offset().top;var a=44;var d=0;if(USERSESSION.theme=="THEME_ADVANCED"){a=0;d=50}jQuery("#mail_list_content").height(c-b-a-d)}function getReadResizeHeight(){var b=jQuery("#mailBottom").offset().top;var a=jQuery("#mainContent").offset().top;jQuery("#mailViewContentWrap").height(b-a-60)}var LayoutControl=function(){var a=this;this.opt={};this.contentSplitterMode="n";this.normalMode=false;this.makeLayout=function(b){if(!b){b="n"}this.contentSplitterMode=b;this.contentSplitterChange(b,true)};this.contentSplitterChange=function(c,b){if(!c){c="n"}if(!b&&(!this.normalMode&&c==this.contentSplitterMode)){return}this.contentSplitterMode=c;if(c=="n"){this.contentNormalSplitter()}else{if(c=="h"){this.makeHorizonSplitter()}else{if(c=="v"){this.makeVerticalSplitter(b)}}}this.normalMode=false};this.contentNormalSplitter=function(){jQuery(window).off(".mail");resizeLeftMenu();jQuery("#xbar").draggable("destroy").hide();jQuery("#ybar").draggable("destroy").hide();jQuery("#mailListArea").removeAttr("style").hide();jQuery("#mailReadArea").removeAttr("style").hide();jQuery("#mail_list_content").removeAttr("style");jQuery(window).on("resize.mail",getListResizeHeight);jQuery(window).on("resize.mail",getReadResizeHeight);jQuery(window).trigger("resize");jQuery("#mainContent").removeClass("column_inline column_block").addClass("column_block");this.normalMode=true};this.makeHorizonSplitter=function(){jQuery(window).off(".mail");resizeLeftMenu();jQuery("#xbar").draggable("destroy").hide();jQuery("#ybar").draggable("destroy").hide();jQuery("#mail_list_content").removeAttr("style");jQuery("#mailListArea").removeAttr("style");jQuery("#mailReadArea").removeAttr("style");jQuery("#mainContent").removeClass("column_inline column_block").addClass("column_block");var c=getCookie("TL_V_H");c=(c)?c:200;var b=parseInt(c,10)+64;jQuery("#mail_list_content").height(b);jQuery("#xbar").draggable({containment:"parent",axis:"y",zIndex:100,cursor:"n-resize",start:function(d,e){jQuery('<div class="splitterMask"></div>').insertAfter(jQuery(this))},stop:function(d,e){jQuery("div.splitterMask").remove();a.makeHorizonBar(jQuery(this),true)}});jQuery("#xbar").show();a.makeHorizonBar(jQuery("#xbar"))};this.makeHorizonBar=function(g,d){var c=parseInt(jQuery(g).offset().top,10);c=(c<300)?300:c;jQuery(g).css("top","0px");var b=jQuery("#mainContent").offset().top;var f=jQuery("#mailBottom").offset().top-10;var e=c-b-65;jQuery("#mail_list_content").height(e);jQuery("#mailReadArea").height(f-c-10).show();if(TABLET){jQuery("#mailReadArea").css({overflow:"scroll","-webkit-overflow-scrolling":"touch"})}jQuery("#mailViewContentWrap").css("height",(jQuery("#mailReadArea").height()-77)+"px");jQuery(window).on("resize.mail",function(){f=jQuery("#mailBottom").offset().top-10;jQuery("#mailReadArea").height(f-c-10)});setCookie("TL_V_H",e,365);if(!d){jQuery(window).trigger("resize")}};this.resizeMailEvent=function(){mailBottomTop=jQuery("#mailBottom").offset().top;var h=mailBottomTop-100;jQuery("#ybar").height((h>510)?h:510);var c=mailBottomTop-120-80;jQuery("#mail_list_content").height((c>430)?c:430);var d=mailBottomTop-149;jQuery("#mailReadArea").height((d>500)?d:500);var f=jQuery("#mainContent").width();var g=jQuery("#mailListArea").outerWidth()+1;var b=jQuery("#ybar").outerWidth()+1;var e=f-g-b;jQuery("#mailReadArea").width(e)};this.makeVerticalSplitter=function(e){jQuery(window).off(".mail");resizeLeftMenu();jQuery("#xbar").draggable("destroy").hide();jQuery("#ybar").draggable("destroy").hide();jQuery("#mail_list_content").removeAttr("style");jQuery("#mailListArea").removeAttr("style");jQuery("#mailReadArea").removeAttr("style");jQuery("#mainContent").removeClass("column_inline column_block").addClass("column_inline");var f=a.getLeftMenuWidth();var d=getCookie("TL_H_V");d=(d)?d:830;var c=d-f;jQuery("#mailListArea").width(c);var b=jQuery("#ybar");b.draggable({containment:"parent",axis:"x",zIndex:100,cursor:"e-resize",start:function(g,h){},stop:function(g,h){}});b.on("dragstart",function(g,h){jQuery('<div class="splitterMask"></div>').insertAfter(jQuery(this))});b.on("dragstop",function(g,h){jQuery("div.splitterMask").remove();a.makeVerticalBar(a.getLeftMenuWidth(),a.getVerticalBaroffsetWidth(),true)});b.show();if(!e){d=a.getVerticalBaroffsetWidth()}a.makeVerticalBar(f,d,false)};this.makeVerticalBar=function(g,e,h){var l=jQuery("#mailBottom").offset().top;var b=jQuery("#mainContent").width();var k=e-g;if(e>b-100){e=e-100}jQuery("#ybar").css("left","0px");jQuery("#mailListArea").width(k);var d=b-k-jQuery("#ybar").outerWidth();if(b<=1000){d=1000-e-7}jQuery("#mailReadArea").width(d);if(!h){var j=l-100;jQuery("#ybar").height((j>510)?j:510);var f=l-120-50;jQuery("#mail_list_content").height((f>430)?f:430);var c=l-149;jQuery("#mailReadArea").height((c>500)?c:500).show();if(TABLET){jQuery("#mailReadArea").css({overflow:"scroll","-webkit-overflow-scrolling":"touch"})}}jQuery(window).off("resize.mail");jQuery(window).on("resize.mail",this.resizeMailEvent);jQuery(window).trigger("resize");setCookie("TL_H_V",e,365)};this.getVerticalBaroffsetWidth=function(){var b=parseInt(jQuery("#ybar").offset().left-jQuery("div.go_body").offset().left,10);b=(b<700)?700:b;return b};this.getLeftMenuWidth=function(){var b=jQuery("#mailLeftMenuWrap");var c=b.outerWidth();if(b.css("display")=="none"){c=0}return c};this.getContentSplitterMode=function(){return this.contentSplitterMode};if(!isPopupView()){jQuery(window).on("resize.mail",this.resizeMailEvent)}};function mailHistoryCallBack(d){var c=historyControl.getHistoryIndex();var b=d.data;if(b&&b.param&&c-1>b.state){checkEscapeWriteMode(function(){switch(b.type){case"list":var f=b.param.folder;if(f!="Drafts"){var e=layoutControl.getContentSplitterMode();e=(e)?e:"n";layoutControl.contentSplitterChange(e)}else{layoutControl.contentNormalSplitter()}mailControl.loadMessageList(b.param,true);break;case"read":var f=b.param.folder;if(f!="Drafts"){var e=layoutControl.getContentSplitterMode();e=(e)?e:"n";layoutControl.contentSplitterChange(e)}else{layoutControl.contentNormalSplitter()}if(e!="n"){mailControl.loadMessageList(b.param,true)}mailControl.readMessage(b.param,true);break;case"mdnlist":layoutControl.contentNormalSplitter();mailControl.loadMdnList(b.param,true);break;case"mdnread":layoutControl.contentNormalSplitter();mailControl.loadMdnRead(b.param,true);break}},function(){history.forward()})}else{if(!b||!b.type){var a=d.url;if(a.indexOf("app/mail?work=")>0){checkEscapeWriteMode(function(){history.back()},function(){history.forward()})}}}}var ReadSubMessageChecker={currentUid:"",setCurrent:function(a){a=getFolderNameId(a);ReadSubMessageChecker.currentUid=a;jQuery("#mail_list_content tr.choice input:checkbox[name=msgId]").each(function(){listCheckboxControl(jQuery(this),false)});listCheckboxControl(jQuery("#"+a+" input:checkbox[name=msgId]"),true)},resetUid:function(){ReadSubMessageChecker.currentUid=""},hasCurrentItem:function(){if(ReadSubMessageChecker.currentUid==""){return false}var a=(jQuery("#"+ReadSubMessageChecker.currentUid+" td input:checkbox[name=msgId]").length>0);if(!a){if(layoutMode!="n"){a=true}}return a}};function checkSuccess(a){if(a&&a.isSuccess){return true}else{if(a&&a.failMsg){jQuery.goAlert(a.failMsg)}return false}}function changeMailContainer(a){mailMenuStatus=a;jQuery("#toolbar_wrap").show();a=(!a)?"list":a;if(a=="setting"){jQuery("#mainContentWrap").hide();jQuery("#mailSettingWrap").show()}else{if(a=="list"){if(layoutMode=="n"){jQuery("#mailReadArea").hide()}jQuery("#mailWriteArea").hide();jQuery("#mailSendArea").hide();jQuery("#mailListArea").show()}else{if(a=="read"){if(layoutMode=="n"){jQuery("#mailListArea").hide()}jQuery("#mailWriteArea").hide();jQuery("#mailSendArea").hide();jQuery("#mailReadArea").show();if(TABLET){jQuery("#mailReadArea").css({overflow:"scroll","-webkit-overflow-scrolling":"touch"})}}else{if(a=="write"){jQuery("#mailListArea").hide();jQuery("#mailReadArea").hide();jQuery("#mailSendArea").hide();jQuery("#mailWriteArea").show()}else{if(a=="send"){jQuery("#toolbar_wrap").hide();jQuery("div[data-tag=write_toolbar_wrap]").hide();jQuery("#mailListArea").hide();jQuery("#mailReadArea").hide();jQuery("#mailWriteArea").hide();jQuery("#mailSendArea").show()}}}}jQuery("#mailSettingWrap").hide();jQuery("#mainContentWrap").show()}jQuery(window).trigger("resize")}function getTextMessage(){contentValue="";if(isMsie){contentValue=window.textContentFrame.getContent()}else{contentValue=document.getElementById("textContentFrame").contentWindow.getContent()}return contentValue}function getHtmlMessage(g){var n=mailControl.getSendData();var j=("on"==n.letterMode);if(g=="draft"||g=="ascheck"||g=="secure"){return editorControl.getEditorText()}if(!j){var f=editorControl.getEditorText();var l="";var h=false;try{if((jQuery(f).length==1)&&(jQuery(f).attr("class")=="TerraceMsg")){h=true}}catch(c){h=false;console.warn("[DO] FAIL! Convert HTML string into Jquery Object")}if(editorControl.oEditor.options.name=="ActiveDesigner"){var k=document.createElement("textarea");k.appendChild(document.createTextNode(f));l=h?k.outerHTML:"<div class='TerraceMsg' data-content-type='MIME' data-editor='ActiveDesigner'>"+k.outerHTML+"</div>"}else{l=h?f:"<div class='TerraceMsg'>"+f+"</div>"}return l}else{var e="{tims_letter_paper_header}";var b="{tims_letter_paper_body}";var m="{tims_letter_paper_tail}";if(g=="preview"){var a=n.letterData;e=a.header;b=a.body;m=a.tail}var d="<table width='600px' cellspacing='0' cellpadding='0'><tr><td style='line-height:0;'><img src='"+e+"'/></td></tr><tr><td class='TerraceMsg' style='padding:10px 30px 0px 30px;' background='"+b+"'>"+editorControl.getEditorText()+"</td></tr><tr><td style='line-height:0;'><img src='"+m+"'></td></tr></table>"}return d}function getPopupData(){return POPUPDATA}function checkEmailInvalidAddress(d){var b=getEmailArray(d);for(var c=0;c<b.length;c++){var a=b[c];a=jQuery.trim(a);if(a==""||checkEmailFormat(a)){continue}else{jQuery.goMessage(mailMsg.alert_invalidaddress+'"'+escape_tag(a)+'"');return false}}return true}function useSearch(a){if(a){jQuery("section.combine_search").show()}else{jQuery("section.combine_search").hide()}}function isContainedTrashMail(){return jQuery("tr[folder=Trash] input:checked").length>0}function getMailListCheckedObj(){var a;if(currentMenu=="read"&&layoutMode=="n"){a=jQuery("#messageListId")}else{a=jQuery("#mail_list_content input[name=msgId]:checked")}return a}function getMailListCheckedCount(){return getMailListCheckedObj().length}function getMailListCheckedIdArray(){var a=new Array();if(currentMenu=="read"&&layoutMode=="n"){a.push(getMailListCheckedObj().val())}else{getMailListCheckedObj().each(function(){a.push(jQuery(this).closest("tr").attr("id"))})}return a}function getMailListCheckedData(a){var b=new Array();getMailListCheckedObj().each(function(){b.push(jQuery(this).data(a))});return b}function getMailListCheckedValue(){var a=new Array();getMailListCheckedObj().each(function(){a.push(jQuery(this).val())});return a}function getListProcessParams(f){var c=[];var d=[];for(var b=0;b<f.length;b++){var g=f[b].lastIndexOf("_");var e=f[b].substring(0,g);var a=f[b].substring(g+1);c[c.length]=a;if(isAllFolder){d[d.length]=e}else{d[0]=e}}return{uids:c,fnames:d}}function makeMailHeaderMessege(a){mailControl.makeMailHeaderMsg(a)}function executeFolderInfo(){folderControl.updateFolderCountInfo()}function closeMailFolderOptionLayer(){jQuery("#mailFolderOptionLayer").remove()}function closeMailMoreFolderPopupLayer(){jQuery("#mail_more_folder_popup").remove()}function closeMailTagOptionLayer(){jQuery("#mailTagOptionLayer").remove()}function getTagInfo(b){var c=folderControl.getTagData();if(c&&c.length>0){for(var a=0;a<c.length;a++){if(c[a].id==b){return c[a]}}}return null}function isExistTagName(c,a){var d=false;var e=folderControl.getTagData();if(e&&e.length>0){for(var b=0;b<e.length;b++){if(e[b].name==c&&e[b].id!=a){d=true;break}}}return d}function makeDragEvent(a){jQuery(a).draggable({helper:function(){var c=("on"==jQuery("#mailListAllCheck").val());var b=getMailListCheckedCount();var e="";if(c){e=mailMsg.allselect_003}else{if(b>0){e=b+mailMsg.mail_moremsg}else{e=jQuery(this).find("span.subject").text()}}var d={message:e};return getHandlebarsTemplate("mail_dnd_tmpl",d)},appendTo:"#mailLeftMenuWrap",cursorAt:{top:10,left:-5},scroll:false})}function makeDropEvent(a){jQuery(a).droppable({accept:"#mail_list_content tr:not(.tb_option,.dateDesc)",tolerance:"pointer",hoverClass:"dropClass",over:function(g,h){var b=jQuery(this).data("droptype");b=(b)?b:"folder";var e=h.draggable.attr("id");var j=getListProcessParams([e]);var f=j.fnames[0];var d=("on"==jQuery("#mailListAllCheck").val());if(b=="folder"){var c=jQuery(this).closest("a").attr("fname");if((!isAllFolder&&c==f)||(c=="Sent"||c=="Drafts"||c=="Reserved")){return}}else{if(d){return}}jQuery("#dragHelperIcon").removeClass("ic_disallow").addClass("ic_allow")},out:function(b,c){jQuery("#dragHelperIcon").removeClass("ic_allow").addClass("ic_disallow")},drop:function(b,o){var f=jQuery(this).data("droptype");f=(f)?f:"folder";var d=o.draggable.attr("id");var j=getListProcessParams([d]);var c=j.fnames[0];var m=j.uids[0];var e=("on"==jQuery("#mailListAllCheck").val());if(f=="folder"){var n=jQuery(this).closest("a").attr("fname");if((!isAllFolder&&n==c)||(n=="Sent"||n=="Drafts"||n=="Reserved")){return}if(e){allSelectAction("move",n)}else{var h={};if(getMailListCheckedCount()>0){var p=getMailListCheckedIdArray();var k=getListProcessParams(p);h={fromFolders:k.fnames,uids:k.uids,toFolder:n}}else{h={fromFolders:[c],uids:[m],toFolder:n}}mailControl.moveMessage(h)}}else{if(e){return}var g=jQuery(this).closest("a").attr("val");var l={};if(getMailListCheckedCount()>0){var p=getMailListCheckedIdArray();var k=getListProcessParams(p);l={addFlag:"true",tagId:g,folderNames:k.fnames,uids:k.uids}}else{l={addFlag:"true",tagId:g,folderNames:[c],uids:[m]}}mailControl.taggingMessage(l)}}})}function mailReadInit(e){var c=e.msgContent;var g=c.folderEncName+"_"+c.uid;ReadSubMessageChecker.setCurrent(g);if(c.mdnCheck){jQuery.goConfirm("",mailMsg.mail_mdn_response_confirm,function(){var j={folderName:c.folderEncName,uid:c.uid};j=mailControl.getSharedFolderParam(j);mailControl.sendMdnResponse(j)})}var a=e.tagIdList;var h=jQuery("#readTagWrap");if(a&&a.length>0){var k=folderControl.getTagData();for(var f=0;f<a.length;f++){for(var d=0;d<k.length;d++){if(a[f]==k[d].id){var b={messageId:g,tagInfo:k[d]};h.append(getHandlebarsTemplate("mail_read_tag_tmpl",b));break}}}}readRelationMessage()}function mailWriteInit(c){var b={type:"write",name:mailMsg.mail_write};mailControl.makeMailHeaderMsg(b);if(c.rcptMode=="searchaddr"){isRcptModeNormal=false;isRcptModeNoneAC=false}else{if(c.rcptMode=="noneac"){isRcptModeNoneAC=true;isRcptModeNormal=true}else{if(c.rcptMode=="normal"){isRcptModeNoneAC=false;isRcptModeNormal=true}}}isSendInfoCheckUse=c.sendCheckConfig.sendCheckApply;isSendEmailCheckUse=c.sendCheckConfig.sendEmailCheck;isSendAttachCheckUse=c.sendCheckConfig.sendAttachCheck;sendAttachData=c.sendCheckConfig.sendAttachData;isSendKeywordCheckUse=c.sendCheckConfig.sendKeywordCheck;sendKeywordData=c.sendCheckConfig.sendKeywordData;sendAllowUsed=c.sendAllowUsed;sendConfirm=c.sendConfirm;if(isRcptModeNormal){makeInputAddresskeyEvt("to");makeInputAddresskeyEvt("cc");makeInputAddresskeyEvt("bcc");if(!isRcptModeNoneAC){var l={autoResizeWidth:true,makeFormat:true,makeFormatFunc:makeFormatUnit,multiple:false,width:"450px",matchCase:true,max:20,notContact:(USE_CONTACT==true?"F":"T")};jQuery("#to").autocomplete(mailControl.searchAddressAction,l);jQuery("#cc").autocomplete(mailControl.searchAddressAction,l);jQuery("#bcc").autocomplete(mailControl.searchAddressAction,l)}makeInputDropEvents("#toAddrWrap ul.name_tag, #ccAddrWrap ul.name_tag, #bccAddrWrap ul.name_tag");bindAddrAreaEvents("#toAddrWrap ul.name_tag, #ccAddrWrap ul.name_tag, #bccAddrWrap ul.name_tag")}else{jQuery("#writeRcptValue").keypress(function(m){if(m.which==13){m.preventDefault();searchRcptAddress()}})}mailControl.getLastRcptList();makeInputAddressFormat("to",c.to);makeInputAddressFormat("cc",c.cc);makeInputAddressFormat("bcc",c.bcc);if(c.editorMode=="html"){makeEditorProcess(c)}if(c.editorMode=="text"&&notiMode=="link"){jQuery("#receivenoti").attr("disabled",true)}MAX_ATTACH_SIZE=c.attachConfig.maxAttachSize;USE_BIGATTACH_MODE=c.attachConfig.useBigAttachMode;BIGATTACH_EXPIRE=c.attachConfig.bigAttachExpireDay;BIGATTACH_DOWNCNT=c.attachConfig.bigAttachDownCnt;today=new Date(Number(c.systemTime));BIGATTACH_TIMEZONE=c.attachConfig.bigAttachTimezone;BIGATTACH_EXPIRE_DATE=new Date(today.getTime()+((parseInt(BIGATTACH_EXPIRE)-1)*24*60*60*1000));var e=c.attachConfig.useBigAttachQuota;MAX_BIG_ATTACH_SIZE=c.attachConfig.maxBigAttachSize*1024*1024;MAX_BIG_ATTACH_QUOTA=c.attachConfig.maxBigAttachQuota*1024*1024;BIG_ATTACH_QUOTA=MAX_BIG_ATTACH_QUOTA-e;BIG_ATTACH_QUOTA=(BIG_ATTACH_QUOTA<0)?0:BIG_ATTACH_QUOTA;var d=USE_BIGATTACH_MODE?"power":"normal";var j={controlType:d,btnId:"basicUploadControl",btnCid:"basicUploadBtn",formName:"theFile",param:{uploadType:"flash",email:USER_EMAIL},url:"/api/mail/file/upload",maxFileSize:(1024*1024*2000),fileType:"*.*",locale:LOCALE,width:(LOCALE=="jp")?90:73,btnText:mailMsg.comn_file_select,debug:false,autoStart:false,handler:basicUploadListeners,listId:"basicUploadAttachList",startUploadFunc:startUploadAttach};var a={controlType:d,btnId:"massUploadControl",btnCid:"massUploadBtn",formName:"theFile",param:{uploadType:"flash",email:USER_EMAIL},url:"/api/mail/file/upload",maxFileSize:(1024*1024*100),singleSelect:true,fileType:"*.txt",locale:LOCALE,width:(LOCALE=="jp")?90:73,btnText:mailMsg.comn_file_select,debug:false,autoStart:false,handler:{swfuploadLoaded:function(m){},fileQueued:function(n,m){if(!isConfirmFile(m.type,"txt")){jQuery.goAlert(msgArgsReplace(mailMsg.error_nofileext,["txt"]));return}jQuery(this).swfupload("startUpload")},fileQueueError:function(o,m,p,n){},fileDialogStart:function(m){},fileDialogComplete:function(n,m,o){},uploadStart:function(n,m){},uploadProgress:function(o,m,n){},uploadSuccess:function(r,q,o){var s=jQuery.parseJSON(o);var n=q.name,p=(parseInt(q.size)/1024).toFixed(2),m=["<span class='item_file' file-path='"+s.filePath+"'>","<span class='ic_file ic_txt'></span>","<span class=''>"+n+"</span>","<span class='size'>"+p+"KB</span>","<span class='btn_bdr'>","<span class='ic_classic ic_del' title='"+mailMsg.comn_del+"'></span>","</span>","</span>"].join("");$fileItemTmp=jQuery(m);jQuery("#massFileItem").html($fileItemTmp);jQuery("#uploadActor").hide();$fileItemTmp.find("span.ic_del").on("click",function(t){jQuery(this).parents("span.item_file:first").remove();jQuery("#uploadActor").show()})},uploadComplete:function(n,m){},uploadError:function(o,m,p,n){}},listId:"basicUploadAttachList",startUploadFunc:startUploadAttach};basicAttachUploadControl=new UploadSimpleBasicControl(j);if(hasFlashPlayer()){massAttachUploadControl=new UploadBasicControl(a)}else{massAttachUploadControl=new UploadSimpleBasicControl(a)}if(USE_BIGATTACH_MODE){jQuery("#bigattachBtn").show();jQuery("#bigattachMngBtn").show();var k;if(c.attachConfig.useBigAttachDownCnt){k=msgArgsReplace(mailMsg.bigattach_15,[BIGATTACH_EXPIRE,BIGATTACH_DOWNCNT])}else{k=msgArgsReplace(mailMsg.bigattach_07,[BIGATTACH_EXPIRE])}jQuery("#bigattachMessageSpan").html(k)}var g=mailMsg.mail_attach_normal_simple+" <span id='ocx_normal_size' class='num'>0B</span>/<strong>"+MAX_ATTACH_SIZE+"MB</strong><span id='ocx_bigattach_size' style='display:none;'>, "+mailMsg.mail_attach_bigattach_simple+" <span id='ocx_huge_size' class='num'>0B</span>/<strong id='ocx_huge_quota'>0B</strong></span>";jQuery("#att_ocx_quota_info").html(g);var h=mailMsg.mail_attach_normal_simple+" <span id='basic_normal_size' class='current'>0B</span>/<strong>"+MAX_ATTACH_SIZE+"MB</strong><span id='basic_bigattach_size' style='display:none;'>, "+mailMsg.mail_attach_bigattach_simple+" <span id='basic_huge_size' class='current'>0B</span>/<strong id='basic_huge_quota'>0B</strong></span>";jQuery("#att_simple_quota_info").html(h);if(c.attachConfig.useBigAttachMode){jQuery("#ocx_bigattach_size").show();jQuery("#basic_bigattach_size").show()}var f=getCookie("OcxUpload")=="on"?true:false;if(activeXMake&&activeXUse&&isMsie){chgAttachMod("ocx",true)}else{if(isMsie9){chgAttachMod("ocx",true);jQuery("#crtBtnSimple").hide()}else{if(isMsie&&f){chgAttachMod("ocx",true)}else{chgAttachMod("simple",true);if(!hasFlashPlayer()){jQuery("#massUploadControl").hide();jQuery("#massSimpleFileInit").show()}}}}massAttachUploadControl.init();massAttachUploadControl.makeBtnControl();if(USE_WEBFOLDER){jQuery("#writeWebfolderBtn").show()}checkMassRcptToggleBtn(c.massRcptConfirm);mailControl.getSignList(makeSignListItem);if(c.useMailSender){getMailUserSender()}if(c.bcc&&c.bcc!=""){openWriteBccWrap()}setTimeout(function(){checkUploadfile(c.attaches);if(c.editorMode=="text"){jQuery("#signSelect").attr("disabled",true)}},1000);writeAutoSave=setTimeout(function(){runAutoSaveProcess()},5000)}function openShareFolderSettingLayer(e,c){var d=e.split(".");var a=d.length-1;var b=d[a];jQuery.goOrgSlide({header:b,desc:mailMsg.mail_folder_share_msg,headerOption:'<input type="checkbox" id="orgShareFlag" checked="checked"/><label for="orgShareFlag">'+mailMsg.mail_folder_share_msg1+'</label><div class="data_result"><ul id="orgDataWrap" class="name_tag" style="max-height:55px;overflow-y:auto;"></ul></div>',isOrgServiceOn:useOrgAccess,type:"node",callback:function(f){if(jQuery("#orgMember_"+f.id).length>0){return}makeShareFolderUser(f)},buttons:[{bclass:"btn_major_s",btext:mailMsg.comn_confirm,callback:function(){var h=false;var m=jQuery("#orgDataWrap li span.name");if(jQuery("#orgShareFlag").attr("checked")&&m.length!=0){h=true}var k=jQuery("#orgShareFlag").data("shareSeq");var l={};var j=[];var g=[];if(m.length==0&&jQuery("#orgShareFlag").data("shareSeq")==null){jQuery.goOrgSlide.close();return}var f=false;m.each(function(){if(jQuery(this).data("id")==SESSION_ID){f=true;return false}if(jQuery(this).data("type")=="org"){g.push(jQuery(this).data("id"))}else{j.push(jQuery(this).data("id"))}});if(f){jQuery.goAlert(mailMsg.self_share_impossible);return}l.save=h;l.folderUid=k;l.folderName=e;l.goSeq=true;l.sharedUserSeq=j;l.sharedDeptSeq=g;folderControl.setSharringReaderList(l,c)}}],contextRoot:"/"})}function openDirectedApproverPopup(){jQuery.goOrgSlide({header:mailMsg.mail_directed_approver,desc:mailMsg.mail_folder_share_msg,headerOption:mailMsg.mail_approver_msg001,isOrgServiceOn:useOrgAccess,type:"node",callback:function(g){var e=g.name;var d=g.email;var f=g.type;if(!("MEMBER"==f||"MODERATOR"==f||"MASTER"==f)){jQuery("#customButtons0").attr("selected",null);jQuery.goAlert(mailMsg.mail_approver_msg004);return}if(USEREMAIL==d){jQuery("#customButtons0").attr("selected",null);jQuery.goAlert(mailMsg.mail_approver_msg002);return}if(g.postion){e+="/"+g.postion}if(g.deptName){e+="/"+g.deptName}jQuery("#customButtons0").attr("selected","selected");jQuery("#customButtons0").attr("data-address",e+" &lt;"+d+"&gt;")},buttons:[{bclass:"btn_major_s",btext:mailMsg.comn_confirm,callback:function(){if("selected"!=jQuery("#customButtons0").attr("selected")){jQuery.goAlert(mailMsg.comn_error_001);return}var d={};d.address=jQuery("#customButtons0").attr("data-address");makeDirectedApprover(d);jQuery.goOrgSlide.close()}}],contextRoot:"/"});var c=jQuery("#gpopupLayer");var b=(jQuery(window).width()-c.width())/2;var a=(jQuery(window).height()-c.height())/2;c.css("left","156px");c.css("top","178px")}function makeShareFolderUser(b){var a=jQuery('<span id="" class="name" data-id="'+b.id+'" data-email="'+b.email+'"" data-type="'+b.type+'"></span>').attr("id","orgMember_"+b.id).data("id",b.id).data("email",b.email).text(b.name+" "+((!b.position)?"":b.position));var c=jQuery('<span class="btn_wrap" title="'+mailMsg.comn_del+'"><span class="ic_classic ic_del"></span></span>').click(function(){jQuery(this).closest("li").remove()});jQuery("#orgDataWrap").append(jQuery("<li></li>").append(a).append(c))}function makeDirectedApprover(b){var a=jQuery("<span class='name'>"+b.address+"</span>");var c=jQuery("<span class='btn_wrap'><span class='ic_classic ic_del' title='"+mailMsg.mail_attach_delete+"'></span></span>").click(function(){jQuery(this).closest("li").remove()});jQuery("#approverAddrWrap ul").append(jQuery("<li approver='"+b.address+"'></li>").append(a).append(c))}function makeShareFolderInfo(c){var b=c;if(b&&b.length>0){var d={};for(var a=0;a<b.length;a++){d={};d.id=b[a].readerUserSeq;d.email=b[a].readerId;d.name=b[a].readerName;d.position="";makeShareFolderUser(d)}}}function isPopupView(){return(CURRENT_PAGE_NAME=="popup")}function isReloadReady(){return isPopupView()&&window.opener&&(window.opener.reloadMessageList)}function getFolderType(b){var a="normal";if(b=="Inbox"){a="inbox"}else{if(b=="Sent"){a="sent"}else{if(b=="Drafts"){a="drafts"}else{if(b=="Reserved"){a="reserved"}else{if(b=="Spam"){a="spam"}else{if(b=="Trash"){a="trash"}else{if(b=="Quotaviolate"){a="quotaviolate"}}}}}}}return a}function checkListToolbarSelect(){if(currentMenu=="list"&&getMailListCheckedCount()==0){jQuery.goAlert(mailMsg.mail_message_notselect);return false}return true}function selectCurrentFolderName(a){jQuery("#leftMenuSectionWrap p.title").removeClass("on");if(a!=""){if(jQuery("#"+getFolderNameId(a)).length==0){setTimeout(function(){jQuery("#"+getFolderNameId(a)).addClass("on")},1000)}else{jQuery("#"+getFolderNameId(a)).addClass("on")}}}function isDefaultBoxCheck(b){var a=b.toUpperCase();if(a=="INBOX"||a=="SENT"||a=="DRAFTS"||a=="TRASH"||a=="SPAM"||a=="RESERVED"||a=="QUOTAVIOLATE"||b==mailMsg.folder_inbox||b==mailMsg.folder_sent||b==mailMsg.folder_drafts||b==mailMsg.folder_reserved||b==mailMsg.folder_spam||b==mailMsg.folder_trash||b==mailMsg.folder_quotaviolate){return true}return false}function isDefaultBox(b){var a=b.toUpperCase();if(a=="INBOX"||a=="SENT"||a=="DRAFTS"||a=="TRASH"||a=="SPAM"||a=="RESERVED"||a=="QUOTAVIOLATE"){return true}else{return false}}function checkReserveTime(j,b,a,g,k,e){var d=new Date(j,b-1,a,g,k);d.setFullYear(j,b-1,a);d.setHours(g);d.setMinutes(k);var f=today.getTime()+(10*60*1000);var h=today.getTime()+(e*24*60*60*1000);var c=d.getTime();if(c<f){jQuery.goMessage(mailMsg.alert_minreserved);return false}if(c>h){jQuery.goMessage(msgArgsReplace(mailMsg.alert_maxreserved,[e]));return false}return true}function preventDrop(){var a=jQuery("body");a.bind("dragover",function(b){b.preventDefault();b.stopPropagation();b.originalEvent.dataTransfer.dropEffect="none"});a.bind("drop",function(b){console.log("drop");b.preventDefault();b.stopPropagation()})}function resizeLeftMenu(){var a=function(){var h=jQuery("#mailBottom").offset().top;var d=jQuery("#leftMenuSectionWrap").offset().top;var b=jQuery("#mailLeftMenuWrap").height();var g=jQuery("#mailLeftMenuWrap section.gnb_title").outerHeight();var e=jQuery("#mailLeftMenuWrap section.function").outerHeight();var c=jQuery("#mailLeftMenuWrap section.personal_data").outerHeight();var f=50;if(USERSESSION.theme=="THEME_ADVANCED"){f=0}jQuery("#leftMenuSectionWrap").height(h-g-e-c-f)};jQuery(window).on("resize.mail",a);jQuery(window).trigger("resize")}function hideAutoComplate(){jQuery("#to").unautocomplete();jQuery("#cc").unautocomplete();jQuery("#bcc").unautocomplete()}function recurrenceParser(a){var j=a.split(";");var g={};for(var f=0;f<j.length;f++){var b=j[f].split("=");g[b[0]]=b[1]}var d=humanizeFrequency(g);var e=humanizeIntervalOption(g);var c=humanizeUntil(g);var h=humanizeCount(g);return d+" "+e+" "+c+" "+h}function humanizeFrequency(a){var b="";switch(a.FREQ){case"DAILY":if(a.hasOwnProperty("INTERVAL")){b=msgArgsReplace(mailMsg.mail_calendar_recur_day,[a.INTERVAL])}else{b=mailMsg.mail_calendar_allday}break;case"WEEKLY":if(a.hasOwnProperty("INTERVAL")){b=msgArgsReplace(mailMsg.mail_calendar_recur_week,[a.INTERVAL])}else{b=mailMsg.mail_calendar_allweek}break;case"MONTHLY":if(a.hasOwnProperty("INTERVAL")){b=msgArgsReplace(mailMsg.mail_calendar_recur_month,[a.INTERVAL])}else{b=mailMsg.mail_calendar_allmonth}break;case"YEARLY":if(a.hasOwnProperty("INTERVAL")){b=msgArgsReplace(mailMsg.mail_calendar_recur_year,[a.INTERVAL])}else{b=mailMsg.mail_calendar_allyear}break}return b}function humanizeIntervalOption(f){var g="";if(f.hasOwnProperty("BYDAY")){var b=f.BYDAY.split(",");var h={SU:mailMsg.mail_calendar_sunday,MO:mailMsg.mail_calendar_monday,TU:mailMsg.mail_calendar_tuesday,WE:mailMsg.mail_calendar_wednesday,TH:mailMsg.mail_calendar_thursday,FR:mailMsg.mail_calendar_friday,SA:mailMsg.mail_calendar_saturday};for(var d=0;d<b.length;d++){var a=/([0-9]*)(SU|MO|TU|WE|TH|FR|SA)?$/.exec(b[d]);var e=a[1]?a[1]:undefined;var c=h[a[2]];if(f.hasOwnProperty("BYSETPOS")){e=f.BYSETPOS}if(e==null){g+=c}else{g+=msgArgsReplace(mailMsg.mail_calendar_recur_number,[e,c])}if(b.length!=(d+1)){g+=", "}}}if(f.hasOwnProperty("BYMONTHDAY")){var b=f.BYMONTHDAY.split(",");for(var d=0;d<b.length;d++){g+=msgArgsReplace(mailMsg.mail_calendar_recur_day,[b[d]]);if(b.length!=(d+1)){g+=", "}}}if(f.hasOwnProperty("BYMONTH")){var b=f.BYMONTHDAY.split(",");for(var d=0;d<b.length;d++){g+=msgArgsReplace(mailMsg.mail_calendar_recur_day,[b[d]]);if(b.length!=(d+1)){g+=", "}}}return g}function humanizeUntil(a){var c="";if(a.hasOwnProperty("UNTIL")){var b=moment(a.UNTIL,"YYYYMMDD");c=msgArgsReplace(mailMsg.mail_calendar_recur_to,[b.format("YYYY-MM-DD")])}return c}function humanizeCount(a){var b="";if(a.hasOwnProperty("COUNT")){b=msgArgsReplace(mailMsg.mail_calendar_recur_count,[a.COUNT])}return b}function securityCetnerFolderInfo(){if(securityCenter){ActionLoader.getGoLoadAction("/api/security/mailfolder/list",null,function(b){if(b&&b.length>0){for(var a=0;a<b.length;a++){if(b[a].name=="Todo"){jQuery("#leftMenuSectionWrap .security .approver").show();jQuery("#leftMenuSectionWrap .security .num").text(b[a].count);break}}}},"json",function(){})}}var layoutMode=window.layoutMode||"h";var isFirstLoad=false;function initService(){initMailLayout();folderControl.getFolderAllInfo();folderControl.getBookmarkInfo();folderControl.makeEvent();mailControl.makeMailEvent();isFirstLoad=true;var a=false;if(workAction=="write"){a=true;var b={};if(writeToList){b.to=unescape_tag_title(writeToList)}if(wtype){b.wtype=wtype;b.wuid=wuid;b.folderName=folder;b.wfolderType=wfolderType;b.wfolderShareSeq=wfolderShareSeq}goWrieLoad(b);if(isPopupWrite){mailControl.loadMessageList()}}else{if(workAction=="read"){if(isNotFoundError=="true"){jQuery.goAlert("",mailMsg.mail_sid_not_found_alert);mailControl.loadMessageList()}if(workFolder&&workFolder!=""&&workUid&&Number(workUid)>0){workFolder=decodeURIComponent(workFolder);var b={};if(quickType&&quickType!=""){b=getFolderExecuteParam(quickType)}else{b.folder=unescape_tag_title(workFolder)}if(parseInt(initPage,10)>1){b.page=initPage}mailControl.loadMessageList(b,true,true);a=true;readMessage(unescape_tag_title(workFolder),workUid)}}else{if(workAction=="list"){if(isShareFolder){goSharedFolder(workFolder,workUid)}else{goFolder(workFolder)}a=true}else{if(workAction=="quick"){folderExecute(workFolder);a=true}}}}if(!a){mailControl.loadMessageList()}jQuery("#mailSearchKeyWord").placeholder()}function setMailAppName(){jQuery("#mailAppNameLink").text(currentAppName)}function initMailFunction(){layoutControl=new LayoutControl();folderControl=new FolderControl();mailControl=new MailControl();historyControl=new HistoryControl(mailHistoryCallBack)}function initMailLayout(){layoutControl.makeLayout(storeLayoutMode);layoutMode=layoutControl.getContentSplitterMode()}function goFolder(b,a){checkEscapeWriteMode(function(){var d={folder:b};d.sharedFlag="user";if(a){d.flag=a}if(b!="Drafts"){var c=layoutControl.getContentSplitterMode();c=(c)?c:"n";layoutControl.contentSplitterChange(c)}else{layoutControl.contentNormalSplitter()}mailControl.loadMessageList(d);hideSearchCancelBtn()})}function writeDraftMessage(b,a){goWrieLoad({wtype:"drafts",folderName:b,uids:[a]})}function readMessage(c,a){var b={folder:c,uid:a};mailControl.readMessage(b);if(layoutMode!="n"){if(ReadSubMessageChecker.hasCurrentItem()){if(ReadSubMessageChecker.currentUid!=a){changeFlagView(true,"S",[c+"_"+a])}}}}function readMessagePopup(d,b){if(currentMenu=="list"){changeFlagView(true,"S",[d+"_"+b])}var c={};c.folder=d;c.uid=b;c.folderType=currentFolderType;c=mailControl.getSharedFolderParam(c);c.action="read";c.popupWrite=isPopupWrite;POPUPDATA=c;var a="popupRead"+makeRandom();POPUPDATA.wname=a;window.open("/app/mail/popup",a,"scrollbars=yes,resizable=yes,width=1280,height=640")}function reloadMessagePopup(){var a="";if(POPUPDATA.action=="read"){a=POPUPDATA.wname}window.open("/app/mail/popup",a)}function reloadMessageList(){mailControl.reloadMessageList()}function downloadAttach(d,b,a){var c={folderName:d,uid:b,part:a,type:"normal"};c=mailControl.getSharedFolderParam(c);mailControl.downloadAttachFile(c)}function downloadAllAttach(d,a,b){var c={folderName:d,uid:a,part:b};c=mailControl.getSharedFolderParam(c);mailControl.downloadAllAttachFile(c)}function downLoadTnefAttach(d,c,b,a){var e={folderName:d,uid:c,part:b,type:"tnef",tnefKey:a};e=mailControl.getSharedFolderParam(e);mailControl.downloadTnefAttachFile(e)}function deleteAttachFile(c,b,a){jQuery.goConfirm(mailMsg.mail_del_attach,mailMsg.confirm_delete,function(){jQuery("#gpopupLayer").hide();jQuery(this)[0].autoclose=false;makeProcessLoader();var d={folderName:c,uid:b,part:a};mailControl.removeAttachFile(d)})}function deleteAllAttach(c,a,b){jQuery.goConfirm(mailMsg.mail_attach_delete_all,mailMsg.confirm_delete,function(){jQuery("#gpopupLayer").hide();jQuery(this)[0].autoclose=false;makeProcessLoader();var d={folderName:c,uid:a,part:b};mailControl.removeAttachFile(d)})}function deleteMessageAttaches(){var b=getMailListCheckedIdArray();var c=getListProcessParams(b);var a={folderNames:c.fnames,uids:c.uids};jQuery.goConfirm(mailMsg.mail_del_attach,mailMsg.confirm_delete,function(){jQuery("#gpopupLayer").hide();jQuery(this)[0].autoclose=false;makeProcessLoader();mailControl.removeAllAttachesFromMessage(a)})}function readNestedMessage(d,c,b){var e={};e.folderName=d;e.uid=c;e.part=b;e.action="nestedRead";e=mailControl.getSharedFolderParam(e);POPUPDATA=e;var a="popupRead"+makeRandom();window.open("/app/mail/popup",a,"scrollbars=yes,resizable=yes,width=800,height=640")}function readRelationMessage(c,b,a){mailControl.readRelationMessage(a)}function goSharedFolder(b,a){checkEscapeWriteMode(function(){var c={folder:b,sharedFlag:"shared",sharedUserSeq:a,sharedFolderName:b};mailControl.loadMessageList(c)})}function addFolder(c){var b=null;if(c){b={top:c.top,left:c.left+90}}var a=folderControl.getUserFolderList();jQuery.goPopup({id:"mail_add_folder_popup",pclass:"layer_normal layer_add_mailbox",header:mailMsg.mail_folder_add,width:300,contents:getHandlebarsTemplate("mail_add_folder_tmpl",a),offset:b,openCallback:function(){jQuery("#mail_add_folder_popup div.content").on("click","input",function(f){var d=jQuery(this).attr("evt-rol");if(d=="add-folder-select-parent"){if(jQuery(this).attr("checked")){jQuery("#addFolderParentSelect").attr("disabled",false);jQuery("#addFolderParentSelect").removeClass("inactive")}else{jQuery("#addFolderParentSelect").attr("disabled",true);jQuery("#addFolderParentSelect").addClass("inactive")}}})},closeCallback:function(){jQuery("#mail_add_folder_popup div.content").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:saveMailFolder},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function addSubFolder(b){var a={folderName:b};jQuery.goPopup({id:"mail_add_subfolder_popup",pclass:"layer_normal layer_add_mailbox",header:mailMsg.mail_subfolder_add,width:300,contents:getHandlebarsTemplate("mail_add_subfolder_tmpl",a),buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:saveSubMailFolder},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function saveMailFolder(){if(!validateInputValue(jQuery("#newMailFolderName"),2,32,"folderName")){return}var c=jQuery.trim(jQuery("#newMailFolderName").val());if(isDefaultBoxCheck(c)){jQuery.goMessage(mailMsg.alert_systemfolder);return}var b="";if(jQuery("#newParentSelectCheck").attr("checked")){b=jQuery("#addFolderParentSelect").val()}c=(b=="")?c:b+"."+c;var a={folderName:c};folderControl.addFolder(a);jQuery.goPopup.close()}function saveSubMailFolder(){if(!validateInputValue(jQuery("#subMailFolderName"),2,32,"folderName")){return}var c=jQuery("#subMailFolderName").val();var d=jQuery("#subMailFolderName").attr("folder");var a=d+"."+c;if(strByteLength(a)>255){jQuery.goSlideMessage(mailMsg.mail_newfolder_error,"caution");return}var b={folderName:a};folderControl.addFolder(b);jQuery.goPopup.close();makeProcessLoader()}function modifyFolder(b){var a={folderName:b};jQuery.goPopup({id:"mail_modify_folder_popup",pclass:"layer_normal layer_add_mailbox",header:mailMsg.mail_folder_modify,width:300,contents:getHandlebarsTemplate("mail_modify_folder_tmpl",a),buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:modifySaveFolder},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function moveFolder(e){var c={folderName:e};var d={};var a=e;var b="";ActionLoader.getGoLoadAction(folderControl.folderAllInfoAction,d,function(j){var f=j.userFolders;f.isInbox=true;jQuery.goPopup({id:"mail_move_folder_popup",pclass:"layer_normal layer_select layer_mailbox_detail ",header:mailMsg.mail_folder_move_header,contents:getHandlebarsTemplate("mail_move_folder_popup_tmpl"),openCallback:function(){jQuery("#preMailFolderName").val(a);jQuery("#selectMailFolderPopup").on("click","a,span,ins,li,p",function(n){var m=jQuery(this).attr("evt-rol");if(!m){return}if(n.stopPropagation){n.stopPropagation()}else{n.cancelBubble=true}n.preventDefault();if(m=="toggle-mail-folder"){var k=jQuery(this).attr("status");var p=jQuery(this).attr("fid");var o=jQuery(this).closest("li").attr("depth");o=parseInt(o,10);var q=jQuery(this).closest("li").find("ul[depth='"+(o+1)+"']");var l="O";if(k=="open"){q.hide();jQuery(this).removeClass("close").addClass("open").attr({status:"close",title:mailMsg.comn_open});l="C"}else{q.show();jQuery(this).removeClass("open").addClass("close").attr({status:"open",title:mailMsg.comn_close})}}else{if(m=="folder"){b=jQuery(this).find("a").attr("fname");jQuery("#selectMailFolderPopup p").each(function(r){if(jQuery(this).hasClass("title on")){jQuery(this).removeClass("on")}});if(jQuery("#selectMailFolderPopup h1.mail").hasClass("on")){jQuery("#selectMailFolderPopup h1.mail").removeClass("on")}jQuery(this).addClass("on");jQuery("#newMailFolderName").val(b)}else{if(m=="select-root"){b="";jQuery("#newMailFolderName").val(b);jQuery("#selectMailFolderPopup p").each(function(r){if(jQuery(this).hasClass("title on")){jQuery(this).removeClass("on")}});jQuery(this).parent().addClass("on")}}}})},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:moveSaveFolder},{btype:"cancel",btext:mailMsg.comn_cancel}]});f.isInbox=true;var h=jQuery("#inbox_folder_popup_area");h.handlebars("mail_user_folder_popup_tmpl",f);var g=jQuery("#inbox_toggle_popup_btn");if(h.find("li.folder").length>0){if(status=="C"){g.addClass("open").removeClass("close").attr({status:"close",title:mailMsg.comn_open});h.hide()}else{g.addClass("close").removeClass("open").attr({status:"open",title:mailMsg.comn_close});h.show()}g.show()}else{g.hide()}f.isInbox=false;jQuery("#uf_folder_popup_area").handlebars("mail_user_folder_popup_tmpl",f);jQuery("#selectMailFolderPopup span").each(function(k){if(jQuery(this).attr("status")!=null){var l=jQuery(this).closest("li").attr("depth");l=parseInt(l,10);var m=jQuery(this).closest("li").find("ul[depth='"+(l+1)+"']");m.show();jQuery(this).removeClass("open").addClass("close").attr({status:"open",title:mailMsg.comn_close})}});jQuery("#selectMailFolderPopup a").each(function(k){if(jQuery(this).attr("fname")==a){jQuery(this).parent().addClass("title_selected")}})},"json")}function moveSaveFolder(){var b=jQuery("#newMailFolderName");var a=jQuery("#preMailFolderName");var d=jQuery(".title_selected").parent().find("p a");var c=new Array(d.length);jQuery(".title_selected").parent().find("p a").each(function(e){c[e]=jQuery(this).attr("fname")});checkMoveFolderName(b,a,d)}function checkMoveFolderName(f,r,d){var k=new Array(d.length);d.each(function(t){k[t]=jQuery(this).attr("fname")});var p=r.val().substring(r.val().lastIndexOf(".")+1);var g=r.val().substring(0,r.val().lastIndexOf(".")+1);var l=f.val()+".";if(f.val()==""){l=""}var h=l+p;var m=r.val();var s=f.val().split(".");var e=r.val().split(".");var b=strByteLength(h);if(b>255){jQuery.goSlideMessage(mailMsg.mail_folder_move_message_001,"caution");return}var q=new Array(k.length);for(var o=0;o<k.length;o++){q[o]=strByteLength(k[o])}var a=q[0];for(var o=0;o<q.length;o++){var j=q[o]-a;if(parseInt(b)+j>255){jQuery.goSlideMessage(mailMsg.mail_folder_move_message_001,"caution");return}}var n=false;if(s.length>e.length){for(var o=0;o<e.length;o++){if(s[o]==e[o]){n=true;continue}else{n=false;break}}if(n){jQuery.goSlideMessage(mailMsg.mail_folder_move_message_002,"caution");return}}if(f.val()==m){jQuery.goSlideMessage(mailMsg.mail_folder_move_message_003,"caution");return}var c={previousName:r.val(),newName:h};folderControl.modifyFolder(c);jQuery.goPopup.close()}function modifySaveFolder(){var l=jQuery("#modifyMailFolderName");if(!validateInputValue(l,2,32,"folderName")){return}var n=l.attr("folder");var j="";if(n.indexOf(".")>0){j=n.substring(0,n.lastIndexOf(".")+1)}var f=jQuery.trim(l.val());var d=l.data("folder-name");if(f==d){jQuery.goPopup.close();return}f=j+""+f;var a=f;var c=j+""+d;var b=strByteLength(f);if(b>255){jQuery.goSlideMessage(mailMsg.mail_folder_move_message_001,"caution");return}var m=new Array(childrenFnameForModify.length);for(var h=0;h<childrenFnameForModify.length;h++){m[h]=strByteLength(childrenFnameForModify[h])}var g=m[0];for(var h=0;h<m.length;h++){var k=m[h]-g;if(parseInt(b)+k>255){jQuery.goSlideMessage(mailMsg.mail_folder_move_message_001,"caution");return}}if(isDefaultBoxCheck(f)){jQuery.goMessage(mailMsg.alert_systemfolder);return}var e={previousName:n,newName:f};folderControl.modifyFolder(e);jQuery.goPopup.close();childrenFnameForModify=null}function bookmarkManage(){var a=jQuery("#mail_bookmark_wrap");a.data("content",a.html());if(!a.hasClass("lnb_edit")){a.addClass("lnb_edit")}a.find("span.btn_wrap").show();jQuery("#mail_bookmark_list").find("p.on").attr("data-on","true").removeClass("on");jQuery("#mail_bookmark_list").sortable({start:function(b,c){jQuery(c.helper).addClass("move")},beforeStop:function(b,c){jQuery(c.helper).removeClass("move")}}).sortable("enable");jQuery("#mail_bookmark_list").disableSelection();jQuery("#mail_bookmark_btn_normal").hide();jQuery("#mail_bookmark_btn_modify").show()}function bookmarkCancel(){var a=jQuery("#mail_bookmark_wrap");a.find("span.btn_wrap").hide();a.html(a.data("content"));if(a.hasClass("lnb_edit")){a.removeClass("lnb_edit")}jQuery("#mail_bookmark_list").sortable("disable");jQuery("#mail_bookmark_list").find("p[data-on=true]").addClass("on")}function bookmarkModify(){var c=[];jQuery("#mail_bookmark_list li").each(function(){c.push(jQuery(this).attr("seq"))});var d={bookmarkSeqArray:c};folderControl.updateBookmark(d);jQuery("#mail_bookmark_list span.btn_wrap").hide();var b=jQuery("#mail_bookmark_wrap");if(b.hasClass("lnb_edit")){b.removeClass("lnb_edit")}jQuery("#mail_bookmark_btn_modify").hide();jQuery("#mail_bookmark_btn_normal").show();jQuery("#mail_bookmark_list").sortable("disable");if(isBookmark&&(currentMenu=="list"||currentMenu=="read")){var a=false;jQuery("#mail_bookmark_list li").each(function(){var e=jQuery(this).attr("type");var f=jQuery(this).attr("query");if(e==bookmarkType&&f==bookmarkValue){a=true}});if(!a){folderControl.changeBookmarkFlag(false)}}}function bookmarkExecute(a,b,c){checkEscapeWriteMode(function(){var e={};if(b=="tag"){e.listType=b;e.tagId=c}else{e.folder="all";e.extFolder="on";if(b=="unseen"){e.flag="U"}else{if(b=="today"){e.adv="on";e.sdate="TODAYS";e.edate="TODAYE"}else{if(b=="yesterday"){e.adv="on";e.sdate="YESTERDAYS";e.edate="YESTERDAYE"}else{if(b=="flaged"){e.flag="F"}else{if(b=="seen"){e.flag="S"}else{if(b=="attach"){e.flag="T"}else{if(b=="reply"){e.flag="A"}else{if(b=="myself"){e.flag="L"}else{e.folder=c;e.extFolder="off"}}}}}}}}e.extType=b;if(c!="Drafts"){var d=layoutControl.getContentSplitterMode();d=(d)?d:"n";layoutControl.contentSplitterChange(d)}else{layoutControl.contentNormalSplitter()}}e.bookmarkSeq=a;mailControl.loadMessageList(e)})}function folderExecute(a){checkEscapeWriteMode(function(){var c=getFolderExecuteParam(a);var b=layoutControl.getContentSplitterMode();b=(b)?b:"n";layoutControl.contentSplitterChange(b);mailControl.loadMessageList(c)})}function getFolderExecuteParam(a){var b={};if(a=="unseen"){b.flag="U"}else{if(a=="today"){b.adv="on";b.sdate="TODAYS";b.edate="TODAYE"}else{if(a=="yesterday"){b.adv="on";b.sdate="YESTERDAYS";b.edate="YESTERDAYE"}else{if(a=="flaged"){b.flag="F"}else{if(a=="seen"){b.flag="S"}else{if(a=="attach"){b.flag="T"}else{if(a=="reply"){b.flag="A"}else{if(a=="myself"){b.flag="L"}}}}}}}}b.folder="all";b.extFolder="on";b.extType=a;return b}function addMailTag(a,d){var b=folderControl.getTagData();if((!a||a.type!="modify")&&(b&&b.length>=300)){jQuery.goMessage(mailMsg.mail_tag_insert_limit);return}var c=null;if(d){if(d.sideTop=="sideTop_mail"){c={top:d.top-300,left:d.left+120}}else{c={top:d.top,left:d.left+120}}}jQuery.goPopup({id:"mail_tag_popup",pclass:"layer_normal layer_add_tag",header:mailMsg.mail_tag_add,contents:getHandlebarsTemplate("mail_tag_add_tmpl",a),offset:c,openCallback:function(){jQuery("#mail_tag_popup div.layer_pallete").on("click","a",function(f){jQuery("#mail_tag_popup div.layer_pallete a").removeClass("active");jQuery(this).addClass("active")})},closeCallback:function(){jQuery("#mail_tag_popup div.layer_pallete").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:saveMailTag},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function saveMailTag(){if(!validateInputValue(jQuery("#tag_name_input"),2,32,"folderName")){return}var c=jQuery.trim(jQuery("#tag_id_hidden").val());var a=jQuery.trim(jQuery("#tag_name_input").val());var b=jQuery("#mail_tag_popup div.layer_pallete a.active").attr("color");var d={tagName:a,tagColor:b};if(c!=""){d.oldId=c;if(isExistTagName(a,c)){jQuery.goMessage(mailMsg.alert_tag_samename);return}folderControl.modifyTag(d)}else{if(isExistTagName(a)){jQuery.goMessage(mailMsg.alert_tag_samename);return}folderControl.addTag(d)}jQuery.goPopup.close()}function deleteMailTag(a){jQuery.goConfirm(mailMsg.mail_tag_delete,mailMsg.mail_tag_delete_confirm,function(){folderControl.delTag(a);if(isFolderManageMenu()){mailSettingControl.loadViewFolderManage()}})}function checkEscapeWriteMode(a,b){if(currentMenu=="write"){if(isWriteModify()){jQuery.goConfirm("",mailMsg.confirm_escapewrite,function(){clearTimeout(writeAutoSave);clearTimeout(autoSaveTimeTerm);deleteAllHugeFile();destroyBasicUploadControl();destroyMassUploadControl();destoryEditorControl();hideAutoComplate();jQuery.goPopup.close();if(a){a()}},function(){if(b){b()}})}else{clearTimeout(writeAutoSave);clearTimeout(autoSaveTimeTerm);destroyBasicUploadControl();destroyMassUploadControl();destoryEditorControl();hideAutoComplate();jQuery.goPopup.close();if(a){a()}}}else{if(currentMenu=="read"){closeSummaryLayerOnNavigation();if(a){a()}}else{if(a){a()}}}}function writePreview(){var b=mailControl.getSendData();var e=makeRcptForm();e.writeMode=jQuery("#editorMode").data("mode");e.subject=jQuery("#subject").val();e.content=getMessageContent("preview");e.letterSeq=(b.letterSeq)?b.letterSeq:"";var c=jQuery("#senderMode");if(c.length>0&&c.val()=="on"){var d=jQuery("#senderUserEmail :selected").val();e.senderName=get_name(d);e.senderEmail=get_email(d)}else{e.senderName=b.senderName;e.senderEmail=b.senderEmail}e.attachList=getPreviewAttachString();var a=jQuery("#signSelect").val();if(a&&a>0){e.attachSign=true;e.signSeq=a}else{e.attachSign=false;e.signSeq=""}e.bannerDisplay=b.bannerDisplay;e.bannerContent=b.mailBanner?b.mailBanner.content:null;e.action="writePreview";POPUPDATA=e;window.open("/app/mail/popup","previewPopup","resizable=yes,scrollbars=yes,width=850,height=700")}function isWriteModify(){var d=jQuery("#editorMode").data("mode");var b="";try{var a=false;if(editorControl==null){return false}if(d=="html"){if(!editorControl.oEditor.validate()){jQuery.goError(mailMsg.mail_mime_size_exceed);return false}try{b=getHtmlMessage("ascheck")}catch(c){console.log(c)}}else{b=jQuery.trim(getTextMessage())}if(jQuery.trim(b)!=""){a=true;return a}if(getHugeFileUidList().length>0){a=true;return a}if(!uploadAttachFilesComplete){return true}if(getRcptFormCount()>0){a=true}}finally{b=null}return a}function getMessageContent(b){var j=mailControl.getSendData();var a=false;var e=j.signLocation;var h=jQuery("#editorMode").data("mode");var d;var g,c,f;if(h=="html"){if(!editorControl.oEditor.validate()){jQuery.goError(mailMsg.mail_mime_size_exceed);return false}d=getHtmlMessage(b)}else{d=getTextMessage()}if(b!="secure"&&b!="draft"){if(e=="inside"){if(h=="html"){g="<signpos></signpos>";c=d.indexOf(g);if(c>-1){f=d.substring(0,c);d=f+d.substring(c,d.length);a=true}}else{g="--- Original Message ---";c=d.indexOf(g);if(c>-1){f=d.substring(0,c);d=f+d.substring(c,d.length);a=true}}}if(!a){if(h=="html"){}else{}}}return d}function goWriteSecureMail(){goWrite("expressE")}function goWrite(){SearchByNameInfo.searchAddrValueList=[];secureWriteMode="normal";isOcxUpload=getCookie("OcxUpload")=="on"?true:false;if(isPopupWrite){goWriteWork()}else{checkEscapeWriteMode(function(){goWriteWork()})}}function goWriteWork(){var b=function(){var c={wtype:"normal"};if(isPopupWrite){popupWriteLoad(c)}else{layoutControl.contentNormalSplitter();mailControl.writeMessage(c);hideSearchCancelBtn()}};var a=jQuery("#folder_link_Drafts span.num").text();if(isWriteNoti&&Number(a)>0){jQuery.goConfirm(mailMsg.conf_profile_74,mailMsg.confirm_draftswrite,function(){goFolder("Drafts")},function(){b()})}else{b()}}function goWrieLoad(a){a=mailControl.getSharedFolderParam(a);if(isPopupWrite){popupWriteLoad(a)}else{checkEscapeWriteMode(function(){var b=false;try{b=isPopupView()}catch(c){b=false}if(b){popupWriteLoad(a)}else{layoutControl.contentNormalSplitter();mailControl.writeMessage(a);hideSearchCancelBtn()}})}}function switchFlagFlaged(c,d,a){var b=getListProcessParams(c);mailControl.switchMessagesFlags(b.uids,b.fnames,d,a)}function changeFlagView(e,a,j){var h,d;for(var c=0;c<j.length;c++){h=j[c];if(a=="F"){d=jQuery("#"+getFolderNameId(h)).find('span[flag="F"]');if(e){d.removeClass("ic_important_off");d.addClass("ic_important_on");d.attr("flaged","on")}else{d.removeClass("ic_important_on");d.addClass("ic_important_off");d.attr("flaged","off")}}else{if(a=="S"){var b=jQuery("#"+getFolderNameId(h));if(e){b.removeClass("read_no");var g=b.find("span.flagClass");if(g.hasClass("ic_noread_reply")){g.removeClass("ic_noread_reply").addClass("ic_read_reply")}else{if(g.hasClass("ic_read_no")){g.removeClass("ic_read_no").addClass("ic_read_yes")}else{if(g.hasClass("ic_noread_fw")){g.removeClass("ic_noread_fw").addClass("ic_read_fw")}}}}else{if(!b.hasClass("read_no")){b.addClass("read_no");var g=b.find("span.flagClass");if(g.hasClass("ic_read_reply")){g.removeClass("ic_read_reply").addClass("ic_noread_reply")}else{if(g.hasClass("ic_read_yes")){g.removeClass("ic_read_yes").addClass("ic_read_no")}else{if(g.hasClass("ic_read_fw")){g.removeClass("ic_read_fw").addClass("ic_noread_fw")}}}}}}}}var f=mailControl.getListMode();if(a=="S"&&f=="mail"){folderControl.updateFolderCountInfo()}}function changeFlagReadView(a,c){if(c=="F"){var b=jQuery("#readFlagedFlagIcon");if(a){b.removeClass("ic_important_off");b.addClass("ic_important_on");b.attr("flaged","on")}else{b.removeClass("ic_important_on");b.addClass("ic_important_off");b.attr("flaged","off")}}}function searchMessage(d){var b=mailControl.getListMode();var c="";if(d){c=d}else{var a=jQuery("#mailSearchKeyWord");c=jQuery.trim(a.val());if(c==""){jQuery.goSlideMessage(mailMsg.alert_search_nostr,"caution");a.focus();return}if(!validateInputValue(a,2,64,"searchMail")){return}}checkEscapeWriteMode(function(){if(b=="mdnlist"){var g={pattern:c};mailControl.loadMdnList(g)}else{if(b=="mdnread"){var e=jQuery("#mdnMessageId").val();var g={pattern:c,messageId:e};mailControl.loadMdnRead(g)}else{closeDetailSearchLayer();var f=mailControl.getCurrentFolder();var g={folder:f,keyWord:c};mailControl.searchMessage(g)}}showSearchCancelBtn()})}function makeDetailSearchLayer(){mailControl.getSearchQueryList();jQuery("#detailSearchLayerWrap").on("click","input,span,a",function(d){var b=jQuery(this).attr("evt-rol");if(!b){return}if(b=="select-saved-search"){var c=jQuery(this).closest("li").attr("query");checkEscapeWriteMode(function(){var e=unserialize(Base64TMS.decode(c));mailControl.loadMessageList(e);closeDetailSearchLayer()})}else{if(b=="delete-saved-search"){var a=jQuery(this).closest("li").attr("uid");var f={searchQueryIds:[a]};mailControl.deleteSearchQuery(f)}else{if(b=="save-search-folder"){if(jQuery("#detail_search_cond_area li").length>=15){jQuery.goAlert(mailMsg.mail_sfolder_save,mailMsg.mail_sfolder_insert_limit);return}openAdSearchMessageNamePopup()}else{if(b=="close-search-folder"){closeDetailSearchLayer()}else{if(b=="detail-mail-search"){adSearchMessage()}}}}}});jQuery("#detailSearchLayerWrap").on("change","select",function(c){var a=jQuery(this).attr("evt-rol");if(a=="select-search-folder"){var b=jQuery(this).val();if(b=="all"){jQuery("#searchIncludeExtFolderWrap").show()}else{jQuery("#searchIncludeExtFolderWrap").hide();jQuery("#searchIncludeExtFolder").attr("checked",false)}}});jQuery("#detailSearchLayerWrap").on("keypress","input",function(a){if(a.which==13){adSearchMessage()}});makeProcessLoader("mask")}function makeDetailUnifiedSearchLayer(){mailControl.getUnifiedSearchFolderList();var a=mailControl.isMailAttachSearch();if(a){jQuery("#searchAttachContentsWrap").parents("div.vertical_wrap").show()}jQuery("#detailSearchLayerWrap").on("click","input,span,a",function(k){var j=jQuery(this).attr("evt-rol");if(!j){return}var h=jQuery("input:radio[name='searchPeriod']:checked").val();var b=moment(new Date()).format("YYYY-MM-DDTHH:mm:ss.SSSZ");var g=moment("1970/01/01").format("YYYY-MM-DDTHH:mm:ss.SSSZ");var f=moment(new Date()).format("YYYY-MM-DDTHH:mm:ss.SSSZ");var d="all";if(h=="-1"){g=moment(moment(b).clone().add("weeks",h)).format("YYYY-MM-DDTHH:mm:ss.SSSZ");d="1w"}if(h=="-2"){g=moment(moment(b).clone().add("weeks",h)).format("YYYY-MM-DDTHH:mm:ss.SSSZ");d="2w"}else{if(h=="month"){g=moment(moment(b).clone().add("months",-1)).format("YYYY-MM-DDTHH:mm:ss.SSSZ");d="1m"}else{if(h=="directly"){g=moment(jQuery("#fromDate").val()).format("YYYY-MM-DDTHH:mm:ss.SSSZ");f=moment(moment(jQuery("#toDate").val()).clone().add("days",1).subtract("seconds",1)).format("YYYY-MM-DDTHH:mm:ss.SSSZ");d=""}}}if(j=="search-period"){jQuery("#fromDate").attr("disabled",true);jQuery("#toDate").attr("disabled",true)}else{if(j=="search-directly"){jQuery("#fromDate").attr("disabled",false);jQuery("#toDate").attr("disabled",false)}else{if(j=="close-unified-search-folder"){closeDetailSearchLayer()}else{if(j=="detail-unified-search"){var c=jQuery.trim(jQuery("#keyword").val());if(c==""){jQuery.goSlideMessage(mailMsg.alert_search_nostr,"caution");return false}if(!validateInputValue(jQuery("#keyword"),2,64,"searchMail")){return false}if(jQuery("#fromDate").val()!=""||jQuery("#toDate").val()!==""){if(!checkDatePeriod(jQuery("#fromDate").val(),jQuery("#toDate").val())){return false}}if(isMsie8){window.top.window.location="/app/#unified/search?offset=5&page=0&stype=detail&keyword="+encodeURIComponent(jQuery("#keyword").val())+"&searchAttachContents="+jQuery("#searchAttachContents").is(":checked")+"&fromDate="+g+"&toDate="+f+"&searchTerm="+d}else{window.top.window.location="/app/unified/search?offset=5&page=0&stype=detail&keyword="+encodeURIComponent(jQuery("#keyword").val())+"&searchAttachContents="+jQuery("#searchAttachContents").is(":checked")+"&fromDate="+g+"&toDate="+f+"&searchTerm="+d}jQuery("#searchType").val("appSearch");jQuery("#keyword").val("")}}}}});jQuery("#detailSearchLayerWrap").on("change","select",function(d){var b=jQuery(this).attr("evt-rol");if(b=="select-search-folder"){var c=jQuery(this).val();if(c=="all"){jQuery("#searchIncludeExtFolderWrap").show()}else{jQuery("#searchIncludeExtFolderWrap").hide();jQuery("#searchIncludeExtFolder").attr("checked",false)}}});jQuery("#detailSearchLayerWrap").on("keypress","input",function(b){if(b.which==13){adSearchMessage()}});makeProcessLoader("mask")}function adSearchMessage(){if(!validateAdSearchMessage()){return}checkEscapeWriteMode(function(){var a=getAdSearchMessageQuery();mailControl.loadMessageList(a);closeDetailSearchLayer();showSearchCancelBtn()})}function validateAdSearchMessage(){var d=jQuery.trim(jQuery("#adFrom").val());if(d!=""){if(!validateInputValue(jQuery("#adFrom"),2,64,"searchMail")){return false}}var c=jQuery.trim(jQuery("#adTo").val());if(c!=""){if(!validateInputValue(jQuery("#adTo"),2,64,"searchMail")){return false}}var e=jQuery("#adStartDate").val();var a=jQuery("#adEndDate").val();if(e!=""||a!==""){if(!checkDatePeriod(e,a)){return false}}var b=jQuery.trim(jQuery("#adSearchKeyWord").val());if(d==""&&c==""&&e==""&&a==""&&b==""){jQuery.goMessage(mailMsg.alert_search_nostr);jQuery("#adSearchKeyWord").focus();return false}if(b!=""){if(!validateInputValue(jQuery("#adSearchKeyWord"),2,64,"searchMail")){return}}return true}function getAdSearchMessageQuery(){var d=jQuery.trim(jQuery("#adFolderName").val());var a=(jQuery("#searchIncludeExtFolder").attr("checked"))?"on":"off";var e=jQuery.trim(jQuery("#adFrom").val());var f=jQuery.trim(jQuery("#adTo").val());var h="";jQuery("#adSearchCondWrap input:checked").each(function(){h+=jQuery(this).val()});var g=jQuery.trim(jQuery("#adSearchKeyWord").val());var k=jQuery("#adStartDate").val();var b=jQuery("#adEndDate").val();if(k!=""&&b!=""){k+="-00-00-00";b+="-23-59-59";k=moment(k,"YYYY-MM-DD-HH-mm-ss").utc().format();b=moment(b,"YYYY-MM-DD-HH-mm-ss").utc().format()}var j="";jQuery("#addSearchFlagWrap input:checked").each(function(){j+=jQuery(this).val()});var c={};c.adv="on";c.listType="mail";c.keyWord=g;c.folder=d;c.fromaddr=e;c.toaddr=f;c.category=h;c.sdate=k;c.edate=b;c.flag=j;c.searchExtFolder=a;return c}function closeDetailSearchLayer(){ocxUploadVisible(true);jQuery("#detailSearchLayerWrap").hide();jQuery("#detailSearchLayerWrap").off();jQuery(document).trigger("hideLayer.goLayer");removeProcessLoader()}function toggleDetailSearchLayer(){if(jQuery("#detailSearchLayerWrap").css("display")=="none"){var a=jQuery("#searchType").val();if(a=="appSearch"){makeDetailSearchLayer()}else{makeDetailUnifiedSearchLayer()}}else{closeDetailSearchLayer()}}function openAdSearchMessageNamePopup(){if(!validateAdSearchMessage()){return}jQuery.goPopup({id:"ad_search_name_popup",pclass:"layer_normal",header:mailMsg.mail_sfolder_save,contents:getHandlebarsTemplate("mail_detail_search_save_cond_name_tmpl"),buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:saveAdSearchMessageCond},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function saveAdSearchMessageCond(){if(!validateInputValue(jQuery("#adSearchMessageCondName"),2,32,"folderName")){return}var a=jQuery.trim(jQuery("#adSearchMessageCondName").val());var b=Base64TMS.encode(jQuery.param(getAdSearchMessageQuery()));var c={searchName:a,searchQuery:b};mailControl.saveSearchQuery(c);jQuery.goPopup.close()}function getMessageText(){return jQuery("#messageText").val()}var contentFrameWidth;function resizeTextFrame(a,b){jQuery("#messageContentFrame").css({height:a+25+"px","overflow-x":"hidden","overflow-y":"hidden"});contentFrameWidth=jQuery("#messageContentFrame").contents().find("#contentT").width();contentFrameWidth=(b<1000)?contentFrameWidth:b;var c;if(CURRENT_PAGE_NAME=="popup"){c=function(){var g=jQuery("#readContentMessageWrap");var f=jQuery("#mailViewContentWrap");var d=jQuery("#mailReadSenderListWrap");var e=jQuery("#mailReadArea");if(f.width()<contentFrameWidth){g.css("width",f.width());f.css("width",contentFrameWidth)}else{if(e.width()>f.width()+57){f.css("width","")}g.css("width",(isMsie)?"":"100%")}f.height("100%")};jQuery(window).unbind("resize.mailread");jQuery(window).bind("resize.mailread",c)}else{c=function(){var g=jQuery("#readContentMessageWrap");var f=jQuery("#mailViewContentWrap");var e=jQuery("#mailReadArea");var d=jQuery("#mailReadSenderListWrap");if(f.width()<contentFrameWidth){f.css("width",contentFrameWidth);g.css("width",f.width())}else{if(e.width()>f.width()+57){f.css("width","")}g.css("width",(isMsie)?"":"100%")}getReadResizeHeight();if(layoutMode==="h"){f.css("height",(e.height()-60)+"px")}};jQuery(window).unbind("resize.mailread");jQuery(window).bind("resize.mailread",c)}c()}function viewSource(b,a){var c={};c.folder=b;c.uid=a;c=mailControl.getSharedFolderParam(c);c.action="source";POPUPDATA=c;window.open("/app/mail/popup","sourcePopup","scrollbars=yes,width=1280,height=640,resizable=yes")}function viewNdrGuide(){window.open("/app/mail/ndrguide","ndrGuidePopup","scrollbars=yes,width=920,height=640,resizable=yes")}function viewRegistrationSchedule(b){var a=BASECONFIG.data;if(!a.contextRoot){a.contextRoot="/"}if(!a.locale){a.locale=LOCALE}var d=jQuery("#resistration").offset();session={};session.id=SESSION_ID;session.serverTZOffset=SERVER_TIMEZONE;GO.Calendar.addSimpleEvent({contextRoot:a.contextRoot,modal:false,summary:b,session:session,onCreateError:function(e){jQuery.goMessage(getSimpleEventErrorMessage(e))},afterAddEvent:function(f){var j=f.calendarId;var g=f.id;var m=mailMsg.event_added;var l=mailMsg.event_confirm_to_move;var h=mailMsg.event_move;jQuery.goConfirm(m,l,e,k,h);function e(){var n=a.contextRoot+"app/calendar/"+j+"/event/"+g;if(window.opener){window.location.href=n}else{window.top.window.location.href=n}}function k(){return}},lang:{"내 캘린더":mailMsg.mail_registe_my_calendar,"일정 등록":mailMsg.mail_registe_schedule,"일정명":mailMsg.mail_registe_name,"일시":mailMsg.mail_registe_date,"시간":mailMsg.mail_registe_time,"종일":mailMsg.mail_registe_allday,"확인":mailMsg.comn_confirm,"취소":mailMsg.comn_cancel,"일정상세 입력":mailMsg.mail_registe_detail,"기본 캘린더 이름":mailMsg.mail_registe_basic_calendar,"기본 캘린더 표시":mailMsg.mail_registe_basic,"분":mailMsg.autosave_option_min,"장소":mailMsg.mail_calendar_location,"전사일정":mailMsg.mail_calendar_company},offset:{left:d.left,top:d.top+jQuery("#resistration").height()}});function c(f,e){window.location.href="/app/calendar/"+f+"/event/"+e}}function getSimpleEventErrorMessage(c){var a=500;var b={"required:summary":mailMsg.mail_registe_error_01,"max:summary":msgArgsReplace(mailMsg.mail_registe_error_02,[a])};return b[c]||mailMsg.mail_registe_error}function addWriteToolbarClass(){if(!jQuery("#mainContentWrap").hasClass("mail_write")){jQuery("#mainContentWrap").addClass("mail_write")}jQuery("#toolbar_wrap").hide();jQuery("div[data-tag=write_toolbar_wrap]").show()}function deleteWriteToolbarClass(){if(jQuery("#mainContentWrap").hasClass("mail_write")){jQuery("#mainContentWrap").removeClass("mail_write")}jQuery("div[data-tag=write_toolbar_wrap]").hide();jQuery("#toolbar_wrap").show()}function saveLayoutOption(){var a="n";jQuery("#mailOptionBoxWrap span.ic_con").each(function(){if(jQuery(this).hasClass("on")){a=jQuery(this).attr("val");return false}});var b={readMode:a};mailControl.updateReadModeOption(b)}function savePageBase(){var a=jQuery("#toolbar_list_pagebase").val();var b={pageBase:a};mailControl.updatePageBaseOption(b)}function contentSplitterChange(a){layoutMode=a;layoutControl.contentSplitterChange(a);mailControl.reloadMessageList()}function editorBoxScript(a){if(editorControl){return}makeEditorProcess(a)}function makeEditorProcess(b){var a={};destoryEditorControl();var c=jQuery("#writeChangeEditorWrap");a.id="smartEditor";a.locale=LOCALE;a.content=b.htmlContent;a.letterUse=b.letterUse;editorControl=new EditorControl(a);if(EDITOR_TYPE!="SmartEditor"){c.parent().css("top","0px");c.show()}editorControl.makeEditor(function(){if(b.docTemplateApply){editorControl.showWriteTemplateSelectLink()}editorControl.setEditorText(b.htmlContent);setFocus(b)})}function setFocus(a){if(!a.sendFlag||a.sendFlag.indexOf("forward")>-1){if(!isRcptModeNormal){jQuery("#writeRcptValue").focus()}else{jQuery("#to").focus()}}else{editorControl.setFocus()}}function destoryEditorControl(){if(editorControl){editorControl.destroy();editorControl=null}}function makeAddressUnitFormat(a,c,b){if(jQuery.trim(c)==""){return}var d=jQuery("#"+a);makeFormatUnit(d,c,b);d.focus();d.width("80px")}function makeFormatEmail(d){var h=new Array();var a=0;var f=false;var g=false;for(var e=0;e<d.length;e++){if(d[e]==""){continue}if(d[e].indexOf('"')>-1){f=true;for(var c=e+1;c<d.length;c++){if(d[c].indexOf('"')>-1){g=true;for(var b=e;b<=c;b++){if(b==e){h[a]=d[b]+","}else{if(b==c){h[a]=h[a]+d[b]}else{h[a]=h[a]+d[b]+","}}}a++;break}}if(!g){h[a]=d[e]}e=c}else{h[a]=d[e];a++}}return h}function makeFormatUnit(e,l,u){if(jQuery.trim(l)==""){return}addressArray=new Array();l=l.replace(/[\r|\n|\t]/g,"");addressSplit=l.split(">,");for(var r=0;r<addressSplit.length;r++){tempAddressArray=addressSplit[r].split(",");for(var p=0;p<tempAddressArray.length;p++){tempAddressArray[p]=jQuery.trim(tempAddressArray[p])}addressArray=addressArray.concat(makeFormatEmail(tempAddressArray))}for(var r=0;r<addressArray.length;r++){l=addressArray[r];var o=checkEmailFormat(l);var q=isDiffDomain(l,USEREMAIL);var a=get_email(l);var b=(o)?((a.indexOf("$")==0||a.indexOf("#")==0||a.indexOf("!")==0)?true:false):false;var c=(o)?getFormatName(l):l;var h=(o)?getEmailFormatName(l):l;var v=jQuery('<span class="name" evt-rol="select-field" onselectstart="return false"></span>').attr("title",c).data("email",h).text(c);if(u!=null){v.data("info",true).data("name",u[0].name).data("companyName",u[0].companyName).data("deptName",u[0].deptName).data("position",u[0].title)}var d=jQuery('<span class="ic_con ic_edit_m" evt-rol="mod-field"></span>');d.attr("title",mailMsg.comn_modfy).click(function(){jQuery(this).closest("li").find("span.btn_wrap").hide();var z=jQuery(this).closest("li").hasClass("invalid");var j=jQuery(this).closest("li").addClass((z&&!isRcptModeNoneAC)?"invalid_on":"on").find("span.name");var y=j.data("email");var x=jQuery('<input type="text" evt-rol="mod-field-inside" class="edit" style="display:none;">').val(y);if(!isRcptModeNoneAC){var w={autoResizeWidth:true,makeFormat:true,multiple:false,width:"400px",matchCase:true,editMode:true,editModeFunc:makeEditFormatUnit};jQuery(x).autocomplete(mailControl.searchAddressAction,w)}j.before(x).remove();x.blur(function(D){D.preventDefault();isModFieldInside=false;if(jQuery("div.layer_auto_complete:hover").length){jQuery(this).val("")}else{var C=x.parent().next().children().children().attr("id");var B=x.val();makeEditFormatUnit(x,x.val());if(isRcptModeNoneAC&&isRcptModeNormal){searchRcptAddrOneName(C,B)}}}).keydown(function(D){if(isRcptModeNoneAC){var E=jQuery.trim(jQuery(this).val());if(D.which==13||D.which==9){var C=x.parent().next().children().children().attr("id");var B=x.val();makeEditFormatUnit(x,x.val());searchRcptAddrOneName(C,B)}var F=jQuery("#writeStrWidth");F.text(E);if(F.outerWidth()+50>jQuery(this).width()){jQuery(this).width(F.outerWidth()+50)}}if(D.which==13){isModFieldInside=false}});var A=jQuery.Event("keydown");A.which=40;x.trigger(A).show().focus()});var f="";if(!b){f=jQuery('<span class="btn_wrap"></span>').append(d)}var s=jQuery('<span class="ic_con ic_info_m"></span>');s.attr("title",mailMsg.mail_search_name_title).click(function(){var y=jQuery(this).closest("li");var C=jQuery(this).closest("li").find("span.name").data("email");var x=jQuery(this).closest("li").find("span.name").data("name");var B=jQuery(this).closest("li").find("span.name").data("deptName");var A=jQuery(this).closest("li").find("span.name").data("companyName");var j=jQuery(this).closest("li").find("span.name").data("position");var w=get_email(C);var z={};z.emailValue=C;if(x==null){x=get_name(C)}z.name=x;z.email=w;z.position=j;z.company=A;z.department=B;rcptSelectInfoPopup(z)});var t=jQuery('<span class="btn_wrap"></span>').append(s);var g=jQuery('<span class="ic_classic ic_del"></span>');g.attr("title",mailMsg.comn_del).click(function(){var j=jQuery(this).closest("li");j.find("input.edit").unautocomplete();j.remove();e.focus()});var n=jQuery('<span class="btn_wrap"></span>').append(g);var m=jQuery("<li></li>");m.addClass((!o&&!isRcptModeNoneAC)?"invalid":(q)?"out":"");if(isRcptModeNoneAC){m.append(v).append(t).append(f).append(n)}else{m.append(v).append(f).append(n)}e.closest("li").before(m);e.val("");if(isRcptModeNormal){var k=e.attr("id")}}}function makeEditFormatUnit(e,f){if(jQuery.trim(f)==""){return}var g=checkEmailFormat(f);var d=isDiffDomain(f,USEREMAIL);var c=(g)?getFormatName(f):f;var a=(g)?getEmailFormatName(f):f;var b=jQuery('<span class="name" evt-rol="select-field" onselectstart="return false"></span>').attr("title",c).data("email",a).text(c);e.before(b);e.closest("li").removeClass("out invalid invalid_on on").addClass((!g&&!isRcptModeNoneAC)?"invalid":(d)?"out":"");e.closest("li").find("span.btn_wrap").show();e.unautocomplete();e.remove()}function makeSearchAddressUnitFormat(j,e){if(jQuery.trim(j)==""){return}var m=checkEmailFormat(j);var l=isDiffDomain(j,USEREMAIL);var f=(m)?getFormatName(j,MAIL_EXPOSURE==false,LOCAL_DOMAIN):j;var b=(m)?getEmailFormatName(j):j;e=(!e)?jQuery("#writeRcptType").val():e;var k="";if(e=="to"){k=mailMsg.mail_to}else{if(e=="cc"){k=mailMsg.mail_cc}else{if(e=="bcc"){k=mailMsg.mail_bcc}}}$input=jQuery("#writeRcptValue");var h=jQuery('<p class="title"></p>').text(k+":");var g=jQuery('<span class="name"></span>').attr("title",f).data("email",b).data("type",e).text(f);var d=jQuery('<span class="ic_classic ic_del"></span>');d.click(function(){jQuery(this).closest("ul.name_tag").closest("li").remove();$input.focus()});var c=jQuery('<span class="btn_wrap"></span>').append(d);var a=jQuery('<ul class="name_tag"></ul>');a.append(jQuery("<li></li>").addClass((!m)?"invalid":(l)?"out":"").append(g).append(c));jQuery("#writeRcptList").append(jQuery("<li></li>").append(h).append(a));$input.val("");$input.focus()}function makeInputAddresskeyEvt(a){jQuery("#"+a).keydown(function(b){var c=jQuery.trim(jQuery(this).val());if(b.which==188&&!b.shiftKey){makeInputAddressFormat(a,c);b.preventDefault()}if(isRcptModeNoneAC){if(b.which==13||b.which==9){makeInputAddressFormat(a,c);searchRcptAddrOneName(a,c);b.preventDefault()}var d=jQuery("#writeStrWidth");d.text(c);if(d.outerWidth()+50>jQuery(this).width()){jQuery(this).width(d.outerWidth()+50)}}}).blur(function(c){c.preventDefault();var d=jQuery.trim(jQuery(this).val());var b=jQuery("#"+a+"_actb");if(b.length==0||b.css("display")=="none"){if(jQuery("div.layer_auto_complete:hover").length){jQuery(this).val("")}else{makeInputAddressFormat(a,d);if(isRcptModeNoneAC&&isRcptModeNormal){searchRcptAddrOneName(a,d)}}}else{if(jQuery("div.layer_auto_complete:hover").length){var e=this;setTimeout(function(){if(b.css("display")=="none"){jQuery(e).val("")}},100)}else{makeInputAddressFormat(a,d)}}}).keydown(function(b){if(b.which==8){if(jQuery(this).val()==""){jQuery(this).closest("ul.name_tag").find("li:not(.creat):last").remove()}}})}function makeInputAddressFormat(a,d){if(!d){return}var e=jQuery.trim(d);var c=getEmailArray(e);for(var b=0;b<c.length;b++){if(isRcptModeNormal){makeAddressUnitFormat(a,c[b])}else{makeSearchAddressUnitFormat(c[b],a)}}}function deleteAddressUnitFormat(a,b){jQuery(b).remove();jQuery("#"+a).focus()}function deleteSearchAddressUnitFormat(a){jQuery(a).closest("ul.name_tag").closest("li").remove();jQuery("#writeRcptValue").focus()}function deleteAddressUnitFormatAll(a){jQuery("#"+a+"AddrWrap ul.name_tag li:not(.creat)").remove()}function deleteSearchAddressUnitFormatAll(){jQuery("#writeRcptList li").remove()}function selectRcptEmail(b,a){if(jQuery.trim(a)!=""){if(isRcptModeNormal){makeAddressUnitFormat(b,a)}else{makeSearchAddressUnitFormat(a)}}}function insertRcptEmail(b,a){if(jQuery.trim(a)!=""){if(isRcptModeNormal){makeAddressUnitFormat(b,a)}else{makeSearchAddressUnitFormat(a,b)}}}function makeWriteMyself(d){var f=false;var c=(isRcptModeNormal)?"toAddrWrap":"writeRcptList";jQuery("#"+c+" ul.name_tag li:not(.creat)").each(function(){var h=jQuery(this).find("span.name").data("email");var g=get_email(h);if(USEREMAIL==g){if(d){f=true;return false}else{if(isRcptModeNormal){deleteAddressUnitFormat("to",jQuery(this))}else{deleteSearchAddressUnitFormat(jQuery(this))}}}});if(d&&!f){if(isRcptModeNormal){if(isRcptModeNoneAC){var e={};jQuery.ajax({type:"GET",url:"/api/user/profile/"+SESSION_ID,async:false,success:function(g){var k=g.data.deptMembers;var j="";for(var h=0;h<k.length;h++){if(h==0){j=k[h].deptName}else{j=j+"/"+k[h].deptName}}e.companyName=g.data.companyName;e.deptName=j;e.email=USEREMAIL;e.name=USERNAME;e.title=USERPOSITION},dataType:"json"});var a=new Array(1);a[0]=e;var b='"'+USERNAME+'" <'+USEREMAIL+">";makeAddressUnitFormat("to",b,a)}else{var b='"'+USERNAME+'" <'+USEREMAIL+">";makeAddressUnitFormat("to",b)}}else{var b='"'+USERNAME+'" <'+USEREMAIL+">";makeSearchAddressUnitFormat(b)}}}function contentDataCheck(){var b=jQuery("#contentTemp").val();var a=mailControl.getSendData();if(b!=""){setTimeout("initTextContentData()",500)}}function initTextContentData(){var a=jQuery("#contentTemp").val();if(isMsie){window.textContentFrame.setContent(a)}else{document.getElementById("textContentFrame").contentWindow.setContent(a)}}function getWriteType(){return jQuery("#editorMode").data("mode")}function openWriteBccWrap(){jQuery("#writeToggleBccWrap").removeClass("ic_arrow_down_type4").addClass("ic_arrow_up_type4").attr("title",mailMsg.comn_close);jQuery("#writeBccWrap").show()}function getWriteMode(){var b=mailControl.getSendData();var a="normal";if(b.sendFlag=="forwardAttached"||b.sendFlag=="forward"){a="forward"}return a}function chgEditorMod(f,a){var h=jQuery("#modeHtmlWrapper");var e=jQuery("#modeTextWrapper");var d;if(isOcxUpload){d=document.uploadForm.powerupload;d.SetChangeUpMode("true")}var b=jQuery("#editorMode").data("mode");if(!a&&b==f){return}var c=function(){if(f=="text"){var j=mailControl.getSendData();if(j.letterMode=="on"){clearLetterPaper()}h.hide();e.show();closeLetterListLayer();closeDocTmplListLayer();jQuery("#editorMode").data("mode",f).text("TEXT");if(!a){if(isMsie){window.textContentFrame.setFrameFocus()}else{document.getElementById("textContentFrame").contentWindow.setFrameFocus()}}if(notiMode=="link"){jQuery("#receivenoti").attr("disabled",true)}jQuery("#writeChangeEditorWrap").show();jQuery("#signSelect").attr("disabled",true)}else{e.hide();h.show();jQuery("#editorMode").data("mode",f).text("HTML");var k=mailControl.getWriteData();editorBoxScript(k);if(notiMode=="link"){jQuery("#receivenoti").attr("disabled",false)}if(EDITOR_TYPE=="SmartEditor"){jQuery("#writeChangeEditorWrap").hide()}jQuery("#signSelect").removeAttr("disabled")}b=f};var g=mailMsg.write_alert002;if(b=="html"&&notiMode=="link"){g=mailMsg.write_alert003}if(!a){jQuery.goConfirm(mailMsg.mail_write_editor_mode,g,function(){c()})}else{c()}}function viewBigAttachManager(){mailControl.listBigAttachFile(function(a){jQuery.goPopup({id:"mail_bigattach_manager_popup",pclass:"layer_normal layer_big_data",header:mailMsg.mail_attach_manager_simple,width:750,contents:getHandlebarsTemplate("mail_layer_bigattach_manager_tmpl",a),openCallback:function(){jQuery("#mail_bigattach_manager_popup").on("click","span",function(d){var c=jQuery(this).attr("evt-rol");if(!c){return}if(c=="bigattach-delete"){var b=jQuery(this).data("messageuid");deleteBigAttach(b)}})},closeCallback:function(){jQuery("#mail_bigattach_manager_popup").off()},buttons:[{btype:"cancel",btext:mailMsg.comn_close}]})})}function deleteBigAttach(a){jQuery.goCaution(mailMsg.mail_bigattach_delete,mailMsg.bigattach_list_010,function(){var b={messageUids:[a]};mailControl.deleteBigAttach(b,function(c){jQuery("#bigattach_item_"+a).remove();updateHugeQuota(Number(c));deleteUpoladBarList(a)},function(c){jQuery.goAlert(mailMsg.mail_bigattach_delete_fail,mailMsg.bigattach_list_009)})},function(){viewBigAttachManager()})}function viewExtMailPopup(){mailControl.loadExtMail(function(a){jQuery.goPopup({id:"mail_extmail_popup",pclass:"layer_normal out_mail",header:mailMsg.conf_pop_44,width:700,contents:getHandlebarsTemplate("mail_layer_extmail_tmpl",a),openCallback:function(){jQuery("#mail_extmail_popup").on("click","a",function(d){var b=jQuery(this).attr("evt-rol");if(!b){return}if(b=="extmail-download-start"){if(!jQuery(this).find("span.state").hasClass("finish")){return}var c=jQuery(this).attr("host");var g=jQuery(this).attr("userid");var f={pop3Host:c,pop3Id:g};mailControl.downloadOrderExtMail(f);jQuery(this).find("span.state").text(mailMsg.comn_waiting).removeClass("finish").addClass("wait")}else{if(b=="extmail-download-reset"){var c=jQuery(this).attr("host");var g=jQuery(this).attr("userid");var f={pop3Host:c,pop3Id:g};mailControl.resetExtMail(f)}}});checkPop3Status()},closeCallback:function(){jQuery("#mail_extmail_popup").off();clearTimeout(pop3StatusTimeout)},buttons:[{btype:"cancel",btext:mailMsg.comn_close},{btype:"confirm",btext:mailMsg.mail_pop3_insert,callback:function(){selectSettingMenu("extmail")}}]})})}var pop3StatusTimeout;function checkPop3Status(){clearTimeout(pop3StatusTimeout);jQuery("#mail_extmail_popup tr.item").each(function(){var a=jQuery(this).attr("status");if(a=="INPROGRESS"||a=="WAIT"){pop3StatusTimeout=setTimeout("runCheckPop3Status()",5000);return false}})}function runCheckPop3Status(){mailControl.loadExtMail(function(a){jQuery("#mail_extmail_popup div.content").html(getHandlebarsTemplate("mail_layer_extmail_tmpl",a));checkPop3Status()})}function receiveMessage(c){var a=c.status;var b=c.index;var d=jQuery("#extMailBtn"+b);if(a=="finish"||a=="fail"){d.text(mailMsg.comn_complate).removeClass("btn_fn8").addClass("btn_fn4");d.attr("evt-rol","extmail-download-complate");if(a=="fail"){jQuery("#extMailProcess"+b).hide();jQuery("#extMailProcessMsg"+b).text(c.msg).show()}}else{if(a=="total"){jQuery("#extMailProcessTotalCount"+b).text(c.count)}else{if(a=="success"){jQuery("#extMailProcessSuccessCount"+b).text(c.count)}else{if(a=="failCount"){jQuery("#extMailProcessFailCount"+b).text(c.count)}else{if(a=="graph"){jQuery("#extMailProcessTotalGraph"+b).css("width",c.graphTotal+"%");jQuery("#extMailProcessSuccessGraph"+b).css("width",c.graphSuccess+"%")}else{if(a=="complate"){}}}}}}}var writeModeTimeout;function getWriteModeLayer(){var b=jQuery("#writeModeSelect");var a=(b.css("display")=="none");if(!a){closeWriteModeLayer();return}jQuery("#writeModeSelect ul > *").bind("mouseout",function(){writeModeTimeout=setTimeout(function(){closeWriteModeLayer()},1000)});jQuery("#writeModeSelect ul > *").bind("mouseover",function(){if(writeModeTimeout){clearTimeout(writeModeTimeout)}});jQuery("#writeModeSelect ul > *").bind("click",function(){closeWriteModeLayer()});closeDocTmplListLayer();closeLetterListLayer();b.show()}function closeWriteModeLayer(){jQuery("#writeModeSelect ul > *").unbind();jQuery("#writeModeSelect").hide()}function getLetterListLayer(b){closeWriteModeLayer();closeDocTmplListLayer();if(!b){b=1}var c={page:b};var a=mailControl.getSendData();mailControl.getLetterList(c,function(d){d.letterMode=a.letterMode;d.type="letter";jQuery("#writeOptionLayer").handlebars("mail_letter_layer_tmpl",d);jQuery("#mailLetterLayerWrap").on("click","li",function(f){jQuery("#mailLetterLayerWrap li").removeClass("on");jQuery(this).addClass("on")});jQuery("#mailLetterLayerWrap").on("click","span,a",function(l){var j=jQuery(this).attr("evt-rol");if(!j){return}if(j=="apply-letter"){var m=jQuery("#mailLetterLayerWrap li.on");if(m.length==0){return}var g=m.data("letterseq");var n=m.data("header");var h=m.data("body");var k=m.data("tail");var f={};f.letterSeq=g;f.header=n;f.body=h;f.tail=k;setLetterPaper(f)}else{if(j=="letter-layer-close"){closeLetterListLayer()}else{if(j=="cancel-letter"){clearLetterPaper()}}}})})}function setLetterPaper(f){if(!editorControl.oEditor.validate()){jQuery.goError(mailMsg.mail_mime_size_exceed);return false}var d=getHtmlMessage("ascheck");if(jQuery.trim(d)==""){isDocTemplate=false}if(isDocTemplate){jQuery.goAlert(mailMsg.doctemplate_text_alert3);return}var h=f.header;var a=f.body;var c=f.tail;var e=jQuery("<img></img>");e.attr("id","letter_top_img");e.attr("src",h);e.css("width","600px");var g=jQuery("<img></img>");g.attr("id","letter_bot_img");g.attr("src",c);g.css("width","600px");editorControl.makeLetterLayout(e,a,g);var b=mailControl.getSendData();b.letterMode="on";b.letterSeq=f.letterSeq;b.letterData=f;mailControl.setSendData(b);isLetter=true;closeLetterListLayer()}function clearLetterPaper(){editorControl.cancelLetterLayout();var a=mailControl.getSendData();a.letterMode="off";mailControl.setSendData(a);isLetter=false;closeLetterListLayer()}function closeLetterListLayer(){jQuery("#mailLetterLayerWrap").off();jQuery("#writeOptionLayer").empty()}function getDocTemplateList(a){closeWriteModeLayer();closeLetterListLayer();if(!a){a=1}var b={page:a};mailControl.getDocTemplateList(b,function(c){c.type="docTmpl";jQuery("#writeOptionLayer").handlebars("mail_doctemplate_layer_tmpl",c);jQuery("#mailDocTmplLayerWrap").on("click","li",function(d){jQuery("#mailDocTmplLayerWrap li").removeClass("on");jQuery(this).addClass("on")});jQuery("#mailDocTmplLayerWrap").on("click","span,a",function(g){var f=jQuery(this).attr("evt-rol");if(!f){return}if(f=="apply-doctmpl"){var h=jQuery("#mailDocTmplLayerWrap li.on");if(h.length==0){return}var d=h.data("seq");setDocTemplate(d)}else{if(f=="doctmpl-layer-close"){closeDocTmplListLayer()}}})})}function setDocTemplate(a){if(isLetter){jQuery.goAlert(mailMsg.doctemplate_text_alert3);return}if(!editorControl.oEditor.validate()){jQuery.goError(mailMsg.mail_mime_size_exceed);return false}var c=getHtmlMessage("ascheck");var b=function(){var d={templateSeq:a};mailControl.getTemplateContent(d,function(e){editorControl.setEditorText(e.template);isDocTemplate=true});closeDocTmplListLayer()};if(jQuery.trim(c)!=""){jQuery.goConfirm(mailMsg.mail_doctemplate_title,mailMsg.doctemplate_text_alert2,function(){b()})}else{b()}}function closeDocTmplListLayer(){jQuery("#mailDocTmplLayerWrap").off();jQuery("#writeOptionLayer").empty()}function chgAutoSaveTerm(a){clearTimeout(autoSaveTimeTerm);isAutoSaveStart=false;mailControl.updateAutoSaveInfo(a,function(b){runAutoSaveProcess();processAutoSaveMessage("saveTerm")})}function runAutoSaveProcess(){clearTimeout(autoSaveTimeTerm);var b=folderControl.getQuotaInfo();var c=jQuery("#autoSaveSelect").val();var a=c*1000;if(a>0){if(Number(b.percent)>=100){processAutoSaveMessage("quotaover")}else{if(isAutoSaveStart){doAutoSave()}isAutoSaveStart=true}autoSaveTimeTerm=setTimeout("runAutoSaveProcess()",a)}else{isAutoSaveStart=false;clearTimeout(autoSaveTimeTerm)}}function runAutoReflashProcess(){clearTimeout(autoReflashTimeTerm);var a=getCookie("reflash_time");var b=a*1000*60;if(b>0&&isUseReflashTime){if(isAutoReflash&&currentMenu=="list"){mailControl.reloadMessageList()}isAutoReflash=true;autoReflashTimeTerm=setTimeout("runAutoReflashProcess()",b)}else{isAutoReflash=false;clearTimeout(autoReflashTimeTerm)}}function processAutoSaveMessage(d,e){clearTimeout(checkSaveTimeTerm);var b="";if(d=="saveMessage"){var a=mailControl.getSendData();a.draftMessageId=e.messageId;b=mailMsg.autosave_message_savesuccess+" ( "+moment(e.updateTimeUtc).format("HH:mm:ss")+" )"}else{if(d=="saveTerm"){var c=jQuery("#autoSaveSelect").val();b=mailMsg.autosave_message_termchange;if(c>0){if(c<60){b+=" ("+c+mailMsg.autosave_option_sec+")"}else{b+=" ("+(c/60)+mailMsg.autosave_option_min+")"}}else{b+=" ("+mailMsg.autosave_option_nosave+")"}}else{if(d=="saveErrorTerm"){b=mailMsg.autosave_term_error}else{if(d=="saveErrMessage"){b=mailMsg.autosave_message_error}else{if(d=="quotaover"){b=mailMsg.mail_send_quotaover_draft}}}}}processMessageViewer(b);isAutoSave=false}function contentValidation(){var a=jQuery("#editorMode").data("mode");if(a=="html"&&!editorControl.oEditor.validate()){jQuery.goError(mailMsg.mail_mime_size_exceed);return false}return true}function doAutoSave(){if(isSendWork){return}if(c=="html"&&!editorControl.oEditor.isAccessible()){return}var d={};d=makeRcptForm(d);var c=jQuery("#editorMode").data("mode");var b;if(c=="html"){if(!editorControl.oEditor.validate()){jQuery.goError(mailMsg.mail_mime_size_exceed);return false}b=getHtmlMessage("draft")}else{b=getTextMessage()}d.subject=jQuery("#subject").val();d.sendType="autosave";var a=mailControl.getSendData();d.draftMessageId=a.draftMessageId;d.sendFlag=a.sendFlag;d.writeMode=c;d.uids=a.uids;d.folderName=a.folderName;d.charset=a.charset;d.massMode=false;d.content=b;d.attachList=getAttachString();if(d.to==""&&d.bcc==""&&d.cc==""&&d.subject==""&&d.content==""&&d.attachList==""){return}isAutoSave=true;processMessageViewer(mailMsg.autosave_message_start);checkSaveTimeTerm=setTimeout(function(){if(isAutoSave){processAutoSaveMessage("saveErrMessage")}},10000);mailControl.autoSaveMessage(d)}function doDraftSave(){if(isSendWork){return}var c={};c=makeRcptForm(c);var h=jQuery("#editorMode").data("mode");var f;if(h=="html"){if(!editorControl.oEditor.validate()){jQuery.goError(mailMsg.mail_mime_size_exceed);return false}f=getHtmlMessage("draft")}else{f=getTextMessage()}var e=jQuery("#subject").val();if(e==""){jQuery.goSlideMessage(mailMsg.alert_nosubject,"caution");return}c.subject=e;c.sendType="draft";var j=mailControl.getSendData();c.draftMessageId=j.draftMessageId;c.sendFlag=j.sendFlag;c.writeMode=h;c.uids=j.uids;c.folderName=j.folderName;c.charset=j.charset;c.massMode=false;c.content=f;isAutoSave=true;if(isOcxUpload){var d=document.uploadForm.powerupload;var b=d.GetAttachedFileCount();if(b>0){var a=d.GetAttachedSize("HUGE");if(a>0){jQuery.goConfirm(mailMsg.menu_draft,mailMsg.confirm_draftbigattach,function(){for(var k=0;k<b;k++){type=d.GetAttachedFileAttr(k,"attachtype");if(type=="huge"){d.RemoveAttachFile(d.GetAttachedFileAttr(k,"attachid"))}}ocxUploadAndSendMessage(c)})}else{ocxUploadAndSendMessage(c)}}else{mailControl.sendMessage(c)}}else{c.attachList=getAttachString();var g=makeBigAttachContent();if(g.mode=="on"){jQuery.goConfirm(mailMsg.menu_draft,mailMsg.confirm_draftbigattach,function(){mailControl.sendMessage(c)})}else{mailControl.sendMessage(c)}}}function ocxUploadAndSendMessage(a){if(!uploadOcxFile()){isAutoSave=false;return}a.attachList=getAttachString();mailControl.sendMessage(a)}function processMessageViewer(a){clearTimeout(autoSaveMessageTerm);jQuery("#processMessageContent").text(a);jQuery("#processMessageWrap").fadeIn(500,function(){autoSaveMessageTerm=setTimeout(function(){jQuery("#processMessageWrap").fadeOut(500)},3000)})}function makeRcptForm(a){if(!a){a={}}if(isRcptModeNormal){var e=["to","cc","bcc"];var f=[];for(var c=0;c<e.length;c++){jQuery("#"+e[c]+"AddrWrap li span.name").each(function(){f.push(jQuery(this).data("email"))});if(e[c]=="to"){a.to=f.join(",")}else{if(e[c]=="cc"){a.cc=f.join(",")}else{if(e[c]=="bcc"){a.bcc=f.join(",")}}}f=[]}}else{var b=[];var d=[];var h=[];var g;var j;jQuery("#writeRcptList li span.name").each(function(){g=jQuery(this).data("type");j=jQuery(this).data("email");if(g=="to"){b.push(j)}else{if(g=="cc"){d.push(j)}else{if(g=="bcc"){h.push(j)}}}});a.to=b.join(",");a.cc=d.join(",");a.bcc=h.join(",")}return a}function getRcptFormCount(){var b=0;if(isRcptModeNormal){var c=["to","cc","bcc"];for(var a=0;a<c.length;a++){jQuery("#"+c[a]+"AddrWrap li span.name").each(function(){b++})}}else{}return b}function resultAutoSave(a){if(a.success){processAutoSaveMessage("saveMessage",a)}else{processAutoSaveMessage("saveErrMessage")}}function openReservedLayerPopup(){var f={};var c=[];var h=[];var g=mailControl.getWriteData();var b=mailControl.getSendData();for(var d=0;d<24;d++){c.push(d)}for(var d=0;d<6;d++){h.push(d*10)}f.hourArray=c;f.minArray=h;f.reservedDateInfo=g.reservedDateInfo;var e=f.reservedDateInfo.reservedDateUtc;var a=moment(e);if(b.reservation=="on"){a=moment(b.reservedDateUtc)}f.reservedDateInfo.todayDate=a.format("YYYY")+"-"+a.format("MM")+"-"+a.format("DD");f.reservedDateInfo.thour=a.format("HH");f.reservedDateInfo.tmin=a.format("mm");jQuery("#secureReservedLayerWrap").html(getHandlebarsTemplate("mail_layer_reserved_tmpl",f));jQuery("#reservedDate").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearSuffix:""});jQuery("#mailReservedLayerWrap").on("click","span,a",function(k){var j=jQuery(this).attr("evt-rol");if(!j){return}if(j=="apply-reserved"){applyReservedMail()}else{if(j=="reserved-layer-close"){closeReservedLayerPopup()}}})}function applyReservedMail(){var k=jQuery.trim(jQuery("#reservedDate").val());if(k==""){jQuery.goMessage(mailMsg.alert_emptyreserved);return}var d=jQuery("#reservedDate").data("maxreservedday");var e=k.split("-");if(!checkReserveTime(e[0],e[1],e[2],jQuery("#reservedHour").val(),jQuery("#reservedMin").val(),d)){return}var b=mailControl.getSendData();b.reserveMail=true;var l=moment(k+" "+jQuery("#reservedHour").val()+":"+jQuery("#reservedMin").val(),"YYYY-MM-DD HH:mm");var g=l.format("HH");var j=l.format("mm");b.reservedDateUtc=l.utc().format();b.sendType="reserved";mailControl.setSendData(b);var a=jQuery("#reservation_setting_info");a.empty();var f=jQuery('<span class="data"></span>');f.text(k+" "+g+mailMsg.comn_hour+" "+j+mailMsg.comn_min);var c=jQuery('<span title="'+mailMsg.comn_disabled+'" class="btn_wrap"></span>');var h=jQuery('<span class="ic_classic ic_del"></span>');h.click(function(){clearReservedData()});c.append(h);a.append(f).append(c);a.closest("dl").addClass("option_on");closeReservedLayerPopup()}function closeReservedLayerPopup(){jQuery("#mailReservedLayerWrap").off();jQuery("#secureReservedLayerWrap").empty();jQuery(document).trigger("hideLayer.goLayer")}function clearReservedData(){var a=mailControl.getSendData();a.reserveMail=false;a.reservedDateUtc="";a.sendType="normal";mailControl.setSendData(a);jQuery("#reservation_setting_info").empty();jQuery("#reservation_setting_info").closest("dl").removeClass("option_on")}function openSecureMailLayerPopup(b){var a={};jQuery("#secureReservedLayerWrap").html(getHandlebarsTemplate("mail_layer_securemail_tmpl",a));jQuery("#mailSecureLayerWrap").on("click","span,a",function(d){var c=jQuery(this).attr("evt-rol");if(!c){return}if(c=="apply-secure"){applySecureMail()}else{if(c=="secure-layer-close"){closeSecureLayerPopup()}}})}function applySecureMail(){if(!validateInputValue(jQuery("#securemailPass"),2,32,"searchMail")){return}if(!validateInputValue(jQuery("#securemailHint"),2,32,"searchMail")){return}var b=jQuery.trim(jQuery("#securemailPass").val());var d=jQuery.trim(jQuery("#securemailHint").val());var g=mailControl.getSendData();g.secureMail=true;g.securePass=b;g.secureHint=d;mailControl.setSendData(g);var f=jQuery("#secure_setting_info");f.empty();var e=jQuery('<span class="data"></span>');e.text(mailMsg.comn_use);var c=jQuery('<span title="'+mailMsg.comn_disabled+'" class="btn_wrap"></span>');var a=jQuery('<span class="ic_classic ic_del"></span>');a.click(function(){clearSecureMailData()});c.append(a);f.append(e).append(c);f.closest("dl").addClass("option_on");closeSecureLayerPopup()}function closeSecureLayerPopup(){jQuery("#mailSecureLayerWrap").off();jQuery("#secureReservedLayerWrap").empty();jQuery(document).trigger("hideLayer.goLayer")}function clearSecureMailData(){var a=mailControl.getSendData();a.secureMail=false;a.securePass="";a.secureHint="";mailControl.setSendData(a);jQuery("#secure_setting_info").empty();jQuery("#secure_setting_info").closest("dl").removeClass("option_on")}function makeSignListItem(a){a=(!a)?{}:a;var b=jQuery("#signListWrap").data("attach");a.useAttach=(b)?true:false;jQuery("#signListWrap").html(getHandlebarsTemplate("mail_layer_sign_tmpl",a));jQuery("#signSelect").on("change",function(){callSignData(jQuery("#signSelect option:selected").val())})}function callSignData(a){if(a==0){editorControl.setSignData("");return}var b={signSeq:a};mailControl.signContent(b,function(c){editorControl.setSignData(c)})}function sendMessage(a){if(!uploadAttachFilesComplete){jQuery.goAlert(mailMsg.alert_upload_progress);return}if(sendAllowUsed&&a!="draft"&&!isSendAllowed()){jQuery.goAlert("",mailMsg.sendallow_msg3);return}isSendWork=true;if(isRcptModeNoneAC){sendMailType=a;searchRcptAddrName();newSendMessage(sendMailType)}else{newSendMessage(a)}}var writeType=false;var writeParam=false;function isSendAllowed(){var b=false;var c=makeRcptForm();var a=getRcptFilePath();if(a!=""){c.massRcpt=a}mailControl.checkSendAllow(c,function(d){b=d});return b}function newSendMessage(e){if(!uploadAttachFilesComplete){jQuery.goAlert(mailMsg.alert_upload_progress);return}var j=mailControl.getSendData();j=makeRcptForm(j);var b=false;var c=j.to;var m=j.cc;var v=j.bcc;if(e!="draft"){var w=getRcptFilePath();if(w==""){j.massMode=false;if(jQuery.trim(c)==""){jQuery.goAlert(mailMsg.error_norecipient);jQuery("#to").focus();return}if(!checkEmailInvalidAddress(c)){return}if(!checkEmailInvalidAddress(m)){return}if(!checkEmailInvalidAddress(v)){return}if(isSendInfoCheckUse||isSendEmailCheckUse||isSendAttachCheckUse||isSendKeywordCheckUse){b=true}}else{j.massRcpt=w;j.massMode=true;jQuery("#onesend").attr("checked",true)}var u=jQuery("#signSelect").val();if(u&&u>0){j.attachSign=true;j.signSeq=u}else{j.attachSign=false;j.signSeq=""}j.senderMode=jQuery("#senderMode").val()=="on"?true:false;j.senderUserEmail=jQuery("#senderUserEmail").val();j.useAliasEmail=jQuery("#senderUserEmail option:selected").attr("alias")=="true";if(j.reserveMail){e="reserved"}else{e="normal"}}j.sendType=e;var h=jQuery.trim(jQuery("#subject").val());if(h==""){jQuery.goAlert(mailMsg.alert_nosubject);jQuery("#subject").focus();return}j.subject=h;j.writeMode=jQuery("#editorMode").data("mode");var k=jQuery("#editorMode").data("mode");var q="";if(k=="html"){if(!editorControl.oEditor.validate()){jQuery.goError(mailMsg.mail_mime_size_exceed);return false}q=getHtmlMessage("ascheck")}else{q=jQuery.trim(getTextMessage())}if(!checkSendMailCount(j)){return}if(b){j.sendEmailCheckResult=false;j.sendAttachCheckResult=false;j.sendKeywordCheckResult=false;j.sendInfoCheck=false;if(isSendEmailCheckUse){var c=getEmailArray(j.to);var m=(!j.cc||jQuery.trim(j.cc)=="")?"":getEmailArray(j.cc);var v=(!j.bcc||jQuery.trim(j.bcc)=="")?"":getEmailArray(j.bcc);if(m!=""){c=c.concat(m)}if(v!=""){c=c.concat(v)}var s=new Array();var f=new Array();var d=0;var n=0;var a;for(var t=0;t<c.length;t++){a=get_email(c[t]);if((a.indexOf("$")==0||a.indexOf("#")==0||a.indexOf("!")==0)?true:false){f[d]=a;d++}else{s[n]=a;n++}}var p={};p.emailArray=s;if(s.length!=0){ActionLoader.postSyncGoLoadAction("/api/mail/address/search/external",p,function(y){j.sendEmailCheckResult=(y)?true:false},"json")}else{j.sendEmailCheckResult=false}}if(isSendAttachCheckUse){var r;if(isOcxUpload){var l=document.uploadForm.powerupload;r=l.GetAttachedFileCount()}else{var g=basicAttachUploadControl.getFileList("huge");var o=basicAttachUploadControl.getFileList("normal");jQuery.merge(g,o);r=g.length}var x=sendAttachData;if(searchContentKeyword(q,x,/,/g)){if(r>0){j.sendAttachCheckResult=false}else{j.sendAttachCheckResult=true}}}if(isSendKeywordCheckUse){var x=sendKeywordData;if(searchContentKeyword(q,x,/\\\\/g)){j.sendKeywordCheckResult=true}else{j.sendKeywordCheckResult=false}}if(isSendInfoCheckUse){j.sendInfoCheck=true}if(j.sendEmailCheckResult||j.sendAttachCheckResult||j.sendKeywordCheckResult||j.sendInfoCheck){mailControl.setSendData(j);checkSendInfoValue(j)}else{sendMessageParamProcess(j)}}else{sendMessageParamProcess(j)}}function searchContentKeyword(e,d,c){var f=jQuery("#editorMode").data("mode");if(f=="html"){e=unescape_tag_title(e)}var b=new RegExp("[.*+?|()\\[\\]\\^\\${}\\\\]","g");d=d.replace(b,"\\$&");var a=d.replace(c,"|");return e.match(new RegExp("("+a+")","gi"))}function getEmailAddrNoPersonal(d){var c=jQuery("#"+d);var b=c.children().length;var a="";if(b>0){c.children().each(function(e){var f=jQuery(this).css("display");if(f=="block"){if(e===b-1){a+=get_email(unescape_tag(jQuery(this).attr("data-addr")))}else{a+=get_email(unescape_tag(jQuery(this).attr("data-addr")))+","}}})}return a}function checkSendInfoValue(c){var j=[];if(isOcxUpload){var f=document.uploadForm.powerupload;var b=f.GetAttachedFileCount();for(var e=0;e<b;e++){j.push({name:Base64TMS.decode(f.GetAttachedFileAttr(e,"FILENAME2")),id:f.GetAttachedFileAttr(e,"attachid"),size:f.GetAttachedFileAttr(e,"SIZE")})}}else{var a=basicAttachUploadControl.getFileList("huge");var g=basicAttachUploadControl.getFileList("normal");jQuery.merge(a,g);for(var e=0;e<a.length;e++){j.push({name:a[e].name,id:a[e].id,size:a[e].size})}}var d={};d.subject=c.subject;d.toList=getEmailArray(c.to);d.ccList=(!c.cc||jQuery.trim(c.cc)=="")?null:getEmailArray(c.cc);d.bccList=(!c.bcc||jQuery.trim(c.bcc)=="")?null:getEmailArray(c.bcc);d.attachList=j;d.sendEmailCheckResult=c.sendEmailCheckResult;d.sendAttachCheckResult=c.sendAttachCheckResult;d.sendKeywordCheckResult=c.sendKeywordCheckResult;d.sendInfoCheck=c.sendInfoCheck;var h;if(isSendInfoCheckUse){h=[{btype:"confirm",btext:mailMsg.menu_send,callback:checkSendMessage,autoclose:false},{btype:"cancel",btext:mailMsg.comn_setting,callback:settingWriteInfo},{btype:"cancel",btext:mailMsg.comn_cancel,callback:cancelSend,autoclose:true}]}else{h=[{btype:"confirm",btext:mailMsg.menu_send,callback:checkSendMessage,autoclose:false},{btype:"cancel",btext:mailMsg.comn_cancel,callback:cancelSend,autoclose:true}]}jQuery.goPopup({id:"mail_send_allow_check_popup",pclass:"layer_normal layer_prevent_receiveError",header:mailMsg.mail_rcptcheck,width:600,contents:getHandlebarsTemplate("mail_send_allow_check_tmpl",d),buttons:h})}function cancelSend(){isSendWork=false;SearchByNameInfo.searchAddrValueList=[];var a=mailControl.getSendData();var b=mailControl.getInitSendData();if(a.letterMode=="on"){b.letterMode="on";b.letterSeq=a.letterSeq;b.letterData=a.letterData}if(a.reserveMail){b.reserveMail=true;b.reservedDateUtc=a.reservedDateUtc;b.sendType="reserved"}if(a.secure=="on"){b.secure="on";b.securePass=a.securePass;b.secureHint=a.secureHint}b.draftMessageId=a.draftMessageId;mailControl.setSendData(b)}function checkSendMessage(){var b=mailControl.getSendData();if(isSendInfoCheckUse){var a=getCheckSendInfoValue("to");if(!a||a.length==0){jQuery.goMessage(mailMsg.mail_rcpt_to_noselect);return}settingWriteInfo();jQuery.goPopup.close();b=makeRcptForm(b)}else{jQuery.goPopup.close()}sendMessageParamProcess(b)}function settingWriteInfo(){var c=getCheckSendInfoValue("to");var b=getCheckSendInfoValue("cc");var d=getCheckSendInfoValue("bcc");if(isRcptModeNormal){deleteAddressUnitFormatAll("to");deleteAddressUnitFormatAll("cc");deleteAddressUnitFormatAll("bcc")}else{deleteSearchAddressUnitFormatAll()}if(c&&c.length>0){for(var a=0;a<c.length;a++){insertRcptEmail("to",c[a])}}if(b&&b.length>0){for(var a=0;a<b.length;a++){insertRcptEmail("cc",b[a])}}if(d&&d.length>0){for(var a=0;a<d.length;a++){insertRcptEmail("bcc",d[a])}}settingWriteInfoAttach()}function settingWriteInfoAttach(){jQuery("#basicAttachList input[name='basicAttachFileEl']").attr("checked",false);jQuery("#mail_send_allow_check_popup input[name=attachFile]").each(function(){if(!jQuery(this).attr("checked")){var a=jQuery(this).val();if(isOcxUpload){ocx.RemoveAttachFile(a)}else{jQuery("#"+a).attr("checked",true)}}if(!isOcxUpload){deletefile()}})}function sendMessageParamProcess(c){var a=c.sendType;if(directedApproverFilter(c)){return}if(isAutoSave){jQuery.goAlert(mailMsg.write_alert008);return}c.content=getMessageContent(a);var b=folderControl.getQuotaInfo();if(Number(b.percent)>=100){if(a=="draft"){jQuery.goAlert(mailMsg.mail_send_quotaover_draft);return}else{jQuery.goConfirm(mailMsg.mail_quota_over,mailMsg.mail_send_quotaover_confirm,function(){jQuery("#savesent").attr("checked",false);jQuery("#receivenoti").attr("checked",false);mailControl.setSendData(c);clearReservedData();clearSecureMailData();c=mailControl.getSendData();if(jQuery("#onesend").attr("checked")){c.oneSend=true}if(jQuery("#priority").attr("checked")){c.priority="HIGH"}if(jQuery("#vcardAttach").attr("checked")){c.attachVcard=true}if(isOcxUpload){if(!uploadOcxFile()){return}}requestSendAction(c)})}}else{sendNormalMessage(c)}}function sendNormalMessage(c){var b=c.sendType;var a=mailMsg.mail_send_confirm;if(b!="draft"){if(jQuery("#onesend").attr("checked")){c.oneSend=true}if(jQuery("#priority").attr("checked")){c.priority="HIGH"}if(jQuery("#vcardAttach").attr("checked")){c.attachVcard=true}if(jQuery("#receivenoti").attr("checked")){if((c.writeMode=="html"&&notiMode=="link")||(notiMode=="mail")){c.receiveNoti=true}}if(jQuery("#savesent").attr("checked")){c.saveSent=true}if(c.secureMail){a=mailMsg.mail_secure_confirm}}else{c.letterMode="off";if(c.secureMail){jQuery.goAlert(mailMsg.error_secure_draft);return}if(!processDraftHuseFile()){return}a=mailMsg.mail_send_drafts_confirm}var d=(c.sendType=="draft")?mailMsg.menu_draft:mailMsg.mail_send_title;makeProcessLoader();if(!sendConfirm){if(isOcxUpload){if(!uploadOcxFile()){return}}requestSendAction(c)}else{jQuery.goConfirm(d,a,function(){jQuery("#gpopupLayer").hide();jQuery(this)[0].autoclose=false;makeProcessLoader();if(isOcxUpload){if(!uploadOcxFile()){return}}requestSendAction(c)},function(){cancelSend()})}}function requestSendAction(c){var o=false;var k={};var a=[];var h=[];var f=[];var e=[];c.attachList=getAttachString();if(isOcxUpload){var g=document.uploadForm.powerupload;var b=g.GetAttachedFileCount();var l,j;for(var d=0;d<b;d++){l=g.GetAttachedFileAttr(d,"TYPE");j=g.GetAttachedFileAttr(d,"UID");if(l=="huge"&&(!j||j=="")){o=true;a.push(d);h.push(g.GetAttachedFileAttr(d,"FILENAME"));f.push(g.GetAttachedFileAttr(d,"FILEPATH"));e.push(g.GetAttachedFileAttr(d,"SIZE"))}}}else{var m=basicAttachUploadControl.getFileList("huge");var j;if(m){for(var d=0;d<m.length;d++){j=m[d].uid;if((!j||j==""||j=="0")){o=true;a.push(m[d].id);h.push(m[d].name);f.push(m[d].path);e.push(m[d].size)}}}}if(!o){var n=makeBigAttachContent();c.bigAttachContent=n.html;c.bigAttachMode=n.mode;c.bigAttachLinks=n.links;mailControl.sendMessage(c)}else{k.hidx=a;k.hfileName=h;k.hfilePath=f;k.hfileSize=e;k.regdate=today.getTime();mailControl.bigAttachUpdate(k,c)}makeProcessLoader()}function sendForBigAttach(e,g){var f;if(isOcxUpload){var d=document.uploadForm.powerupload;for(var b=0;b<e.length;b++){f=d.GetAttachedFileAttr(parseInt(e[b].fileIndex),"attachid");d.SetAttachedFileAttr2(f,"UID",e[b].messageUid)}}else{var c;for(var b=0;b<e.length;b++){c=basicAttachUploadControl.getAttachFileInfo("huge",e[b].fileIndex);c.uid=e[b].messageUid;basicAttachUploadControl.setAttachFileInfo("huge",e[b].fileIndex,c)}}var a=makeBigAttachContent();g.bigAttachContent=a.html;g.bigAttachMode=a.mode;g.bigAttachLinks=a.links;mailControl.sendMessage(g);destroyBasicUploadControl();destroyMassUploadControl()}function processDraftHuseFile(){var d;if(isOcxUpload){var e=document.uploadForm.powerupload;var c=e.GetAttachedFileCount();d=e.GetAttachedSize("HUGE");if(d>0){if(!confirm(mailMsg.confirm_draftbigattach)){return false}}for(var b=c-1;b>=0;b--){fileType=e.GetAttachedFileAttr(b,"attachtype");if(fileType=="huge"){id=e.GetAttachedFileAttr(b,"attachid");e.RemoveAttachFile(id)}}}else{d=basicAttachUploadControl.getAttachSize("hugeUse");if(d>0){if(!confirm(mailMsg.confirm_draftbigattach)){return false}}var a=basicAttachUploadControl.getFileList("huge");for(var b=0;b<a.length;b++){basicAttachUploadControl.deleteAttachList(a[b].id)}}return true}function viewQuickList(a){checkEscapeWriteMode(function(){var b={};b=mailControl.getSharedFolderParam(b);b.folder=currentFolderName;b.page=1;if(a=="TODAY"){b.adv="on";b.sdate="TODAYS";b.edate="TODAYE"}else{if(a=="YESTERDAY"){b.adv="on";b.sdate="YESTERDAYS";b.edate="YESTERDAYE"}else{b.flag=a}}mailControl.loadMessageList(b)})}function makeTagToolbar(){var f=folderControl.getTagData();if(!f||f.length==0){jQuery.goAlert(mailMsg.mail_tag_empty);return}var d=getMailListCheckedIdArray();var a=0;var e="tag";if(currentMenu=="read"&&layoutMode=="n"){e="read_"+e}for(var c=0;c<f.length;c++){for(var b=0;b<d.length;b++){var g=jQuery("#"+e+"_"+getFolderNameId(d[b])+"_"+f[c].id).length;if(g>0){a++;f[c].containsTag=true;break}else{f[c].containsTag=false}}}jQuery("#mailListTagBox").width((a>0)?((LOCALE=="en")?"265px":"250px"):"205px");mailControl.makeToolbarTagList(f)}function makeCopyMoveToolbar(){var a=folderControl.getUserFolderList();a.isInbox=true;jQuery("#toolbarInboxMoveMessageList").handlebars("mail_toolbar_user_folder_tmpl",a);if(jQuery("#toolbarInboxMoveMessageList li").length>0){jQuery("#inboxToggleFolder").show()}a.isInbox=false;jQuery("#toolbarMoveMessageList").handlebars("mail_toolbar_user_folder_tmpl",a);jQuery("#checkMessageCopy").attr("checked",false)}function messageTaggingManager(d,b){var c=getMailListCheckedIdArray();var e=getListProcessParams(c);var a={addFlag:b,tagId:d,folderNames:e.fnames,uids:e.uids};mailControl.taggingMessage(a)}function selfRemoveMessageTagging(d,b,c){var a={addFlag:"false",tagId:c,folderNames:[d],uids:[b]};mailControl.taggingMessage(a)}function deleteMessage(){var a=isContainedTrashMail();if(!a&&currentFolderType!="trash"&&currentFolderType!="reserved"){deleteMessageAction()}else{var b="";if(a||currentFolderType=="trash"){b=mailMsg.confirm_trashdelete}else{if(currentFolderType=="reserved"){b=mailMsg.confirm_reserveddelete}}jQuery.goConfirm(mailMsg.mail_message_delete,b,function(){deleteMessageAction()})}}function deleteMessageAction(){var b=("on"==jQuery("#mailListAllCheck").val());if(b){allSelectAction("delete","")}else{var c=getMailListCheckedIdArray();var d=getListProcessParams(c);var a={folderNames:d.fnames,uids:d.uids};mailControl.deleteMessages(a)}}function deleteMdn(){var a=new Array();getMailListCheckedObj().each(function(){a.push(jQuery(this).val())});mailControl.deleteMdn({messageIds:a})}function cleanMessage(){var c=("on"==jQuery("#mailListAllCheck").val());var b=getMailListCheckedCount();var a=jQuery("#pageNaviWrap").data("total");b=(c)?a:b;jQuery.goConfirm(mailMsg.menu_deleteforever,msgArgsReplace(mailMsg.confirm_clean,[b]),function(){jQuery("#gpopupLayer").hide();jQuery(this)[0].autoclose=false;if(c){allSelectAction("clean","")}else{var e=getMailListCheckedIdArray();var f=getListProcessParams(e);var d={folderNames:f.fnames,uids:f.uids};mailControl.cleanMessages(d)}})}function downloadMessage(){var b=getMailListCheckedIdArray();var c=getListProcessParams(b);var a={folder:c.fnames,uids:c.uids};a=mailControl.getSharedFolderParam(a);if(b.length>1){jQuery.goAlert(mailMsg.mail_attach_all_save_title,mailMsg.mail_attach_all_save_message)}mailControl.downloadMessages(a)}function copyMoveMessage(e){var b="move";if(jQuery("#checkMessageCopy").attr("checked")||jQuery("#onlyMessageCopy").attr("checked")){b="copy"}var c=("on"==jQuery("#mailListAllCheck").val());if(c){allSelectAction(b,e)}else{var d=getMailListCheckedIdArray();var f=getListProcessParams(d);var a={fromFolders:f.fnames,uids:f.uids,toFolder:e};if(b=="copy"){mailControl.copyMessage(a)}else{if(b=="move"){mailControl.moveMessage(a)}}}}function allSelectAction(a,b){var c=mailControl.getListParam();c.actionType=a;c.targetFolder=b;mailControl.allSelectMessageProcess(c)}function changeSeenFlag(a){var e=getMailListCheckedIdArray();var c=getListProcessParams(e);var d="seen";var b=("on"==jQuery("#mailListAllCheck").val());if(b){var f=mailControl.getListParam();f.actionType=d;f.targetFolder="";f.flagType="S";f.used=a;mailControl.allSelectMessageProcess(f)}else{mailControl.switchMessagesFlags(c.uids,c.fnames,"S",a)}}function replyWrite(c){if(getMailListCheckedCount()>1){jQuery.goAlert(mailMsg.error_replyone);return}var b=getMailListCheckedIdArray();var a=getListProcessParams(b);var d={};d.folderName=a.fnames[0];d.uids=a.uids;d.wtype=c;mailControl.getSharedFolderParam(d);goWrieLoad(d)}function forwardMessage(a){var c=getMailListCheckedIdArray();var b=getListProcessParams(c);var d={};d.folderName=b.fnames[0];d.uids=b.uids;d.fwmode=a;d.wtype="forward";mailControl.getSharedFolderParam(d);goWrieLoad(d)}function printMessage(){if(getMailListCheckedCount()>1){jQuery.goAlert(mailMsg.error_printone);return}var b=getMailListCheckedIdArray();var a=getListProcessParams(b);var c={};c.folder=a.fnames[0];c.uid=a.uids[0];c=mailControl.getSharedFolderParam(c);c.viewImg=true;c.action="print";POPUPDATA=c;window.open("/app/mail/popup","printPopup","scrollbars=yes,width=1280,height=640,resizable=yes")}function addMessageFilter(){if(getMailListCheckedCount()>1){jQuery.goAlert(mailMsg.mail_filter_select_one);return}var a=folderControl.getUserFolderList();var e=folderControl.getTagData();var c=getMailListCheckedObj();var g;var f;if(!MAIL_EXPOSURE){g=getEmailNotInCompanyDomain(companyDomainList,c.data("femail"));f=getEmailNotInCompanyDomain(companyDomainList,c.data("temail"))}else{g=jQuery.trim(get_email(c.data("femail")));f=jQuery.trim(get_email(c.data("temail")))}var b="";if(currentMenu=="read"&&layoutMode=="n"){b=c.attr("subject")}else{b=jQuery.trim(c.closest("tr").find("span.subject").text())}var d={from:g,to:f,subject:b,folderList:a,tagList:e};jQuery.goPopup({id:"mail_message_filter_popup",pclass:"layer_normal layer_auto",header:mailMsg.menu_rule,width:500,contents:getHandlebarsTemplate("mail_layer_filter_tmpl",d),openCallback:function(){jQuery("#mail_message_filter_popup input[name='filterCondOption']").click(function(){if(jQuery("#mail_message_filter_popup input[name='filterCondOption']:checked").length>1){jQuery("#filterCondOperationWrap").show()}else{jQuery("#filterCondOperationWrap").hide()}});jQuery("#mail_message_filter_popup  input[placeholder]").placeholder();jQuery("#mail_message_filter_popup div.layer_pallete").on("click","a",function(h){jQuery("#mail_message_filter_popup div.layer_pallete a").removeClass("active");jQuery(this).addClass("active");setTimeout(function(){jQuery("#mail_message_filter_popup input[placeholder]").placeholder()},3000)})},closeCallback:function(){jQuery("#mail_message_filter_popup div.layer_pallete").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,callback:saveMessageFilter,autoclose:false},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function saveMessageFilter(){var a=jQuery("#mail_message_filter_popup input[name=filterCondOption]:checked");if(a.length==0){jQuery.goSlideMessage(mailMsg.comn_error_001,"caution");return}var j={};var c=[];var r=true;a.each(function(){var v=jQuery(this).val();if(v=="from"){var w=jQuery.trim(jQuery("#filterFrom").val().toLowerCase());if(w==""){jQuery.goSlideMessage(mailMsg.conf_filter_1,"caution");jQuery("#filterFrom").focus();r=false;return false}c.push({field:"FROM",pattern:w})}else{if(v=="to"){var w=jQuery.trim(jQuery("#filterTo").val().toLowerCase());if(w==""){jQuery.goSlideMessage(mailMsg.conf_filter_1,"caution");jQuery("#filterTo").focus();r=false;return false}c.push({field:"TO",pattern:w})}else{if(v=="subject"){var w=jQuery.trim(jQuery("#filterSubject").val());if(w==""){jQuery.goSlideMessage(mailMsg.conf_filter_1,"caution");jQuery("#filterSubject").focus();r=false;return false}if(!validateInputValue(jQuery("#filterSubject"),0,255,"onlyBack")){jQuery("#filterSubject").focus();r=false;return false}c.push({field:"SUBJECT",pattern:w})}}}});if(!r){return}j.subcondList=c;var k=jQuery("#mail_message_filter_popup input[name=filterOperation]:checked").val();j.operation=k;var s=jQuery("#mail_message_filter_popup input[name=filterOption]:checked").val();var l=false;var o="";var n=false;var f="";var b="";if(s=="extBox"){j.policy="move "+jQuery("#filterFolder").val()}else{if(s=="newBox"){var e=jQuery("#filterNewMailBox");var h=jQuery.trim(e.val());if(h==""||e.hasClass("placeholder")){jQuery.goMessage(mailMsg.conf_filter_37);e.focus();return}if(!validateInputValue(e,2,32,"folderName")){return}var m=jQuery("#filterParentFolder").val();if(m==""){o=h}else{o=m+"."+h}l=true}else{if(s=="extTag"){var p=jQuery("#filterTagList").val();if(p==""){jQuery.goMessage(mailMsg.mail_tag_select_msg);return}j.policy="tag "+p}else{if(s=="newTag"){var u=jQuery("#filterNewTagName");var d=jQuery.trim(u.val());if(d==""||u.hasClass("placeholder")){jQuery.goMessage(mailMsg.mail_tag_add_msg);u.focus();return}if(!checkInputLength("jQuery",u,mailMsg.conf_filter_1,2,32)){return}if(isExistTagName(d)){jQuery.goSlideMessage(mailMsg.alert_tag_samename,"caution");return}var t=folderControl.getTagData();if(t&&t.length>=300){jQuery.goMessage(mailMsg.mail_tag_insert_limit);return}n=true;f=d;var g=jQuery("#filterNewTagList a.active").attr("color");b=g}else{jQuery.goMessage(mailMsg.conf_filter_1);return}}}}if(l){folderControl.addFolderAfterFunc(o,function(){j.policy="move "+o;mailControl.saveMailFilter(j)})}else{if(n){var q={tagName:f,tagColor:b};folderControl.addTagAfterFunc(q,function(){folderControl.getTagListAfterFunc(function(x){folderControl.makeTagList(x);var w="";for(var v=0;v<x.length;v++){if(x[v].name==d){w=x[v].id;break}}j.policy="tag "+w;mailControl.saveMailFilter(j)})})}else{mailControl.saveMailFilter(j)}}}function saveMessageFilterResult(b,a){jQuery.goConfirm(mailMsg.menu_rule,mailMsg.list_filter01,function(){jQuery("#gpopupLayer").hide();jQuery(this)[0].autoclose=false;makeProcessLoader();sortFilterList(b)})}function sortFilterList(d){var f={};var e=d.policy;var b=e.split(" ")[0];if(b=="tag"){f.storeTag=true;f.tagId=jQuery.trim(replaceAll(e,"tag",""))}else{f.toFolder=jQuery.trim(replaceAll(e,"move",""))}f.fromFolder=mailControl.getCurrentFolder();var c=d.subcondList;if(c&&c.length>0){for(var a=0;a<c.length;a++){if(c[a].field=="FROM"){f.from=c[a].pattern}else{if(c[a].field=="TO"){f.to=c[a].pattern}else{if(c[a].field=="SUBJECT"){f.subject=c[a].pattern}}}}}mailControl.sortFilterMessage(f)}function addSpamWhiteRule(b){var c=(b=="black")?mailMsg.reportspam_title:mailMsg.reportham_title;var a=(b=="black")?"mail_layer_spam_tmpl":"mail_layer_white_tmpl";jQuery.goPopup({id:"mail_add_spam_white_popup",pclass:"layer_normal",header:c,width:300,openCallback:function(){jQuery("#mail_add_spam_white_popup").data("type",b)},contents:getHandlebarsTemplate(a),buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,callback:saveSpamWhiteRule,autoclose:false},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function saveSpamWhiteRule(){var h=jQuery("#mail_add_spam_white_popup").data("type");var m=getMailListCheckedIdArray();var o=getListProcessParams(m);var j=o.uids;var e=o.fnames[0];var n=[];var f=false;var b=jQuery("#mail_add_spam_white_popup input:checkbox");var l=(b.eq(0).attr("checked"))?true:false;var a=(b.eq(1).attr("checked"))?true:false;var k;if(l){var c=getMailListCheckedData("femail");if(c&&c.length>0){for(var g=0;g<c.length;g++){k=get_email(c[g]).toLowerCase();if(k==USEREMAIL){f=true;break}else{n[n.length]=k}}}if(f){jQuery.goSlideMessage(mailMsg.conf_forward_14,"caution");return}}var d={};d.ruleType=h;d.folderName=e;d.uids=j;d.fromEmails=n;d.addRule=l;d.moveBox=a;d.adminReport=true;mailControl.addResistRule(d,saveSpamWhiteRuleResult)}function saveSpamWhiteRuleResult(a){if(a=="black"){jQuery.goMessage(mailMsg.bayesian_reportspam)}else{jQuery.goMessage(mailMsg.bayesian_reportwhite)}if(isPopupView()){if(isReloadReady()){opener.reloadMessageList()}window.close()}else{reloadMessageList()}jQuery.goPopup.close()}function registRejectAllow(a){var c="";var b="";if(a=="black"){c=mailMsg.mail_receivreject;b=mailMsg.confirm_denymsg}else{c=mailMsg.mail_receivallow;b=mailMsg.confirm_allowmsg}jQuery.goConfirm(c,b,function(){var h=getMailListCheckedData("femail");var g=[];var e;var d=false;if(h&&h.length>0){for(var f=0;f<h.length;f++){e=get_email(h[f]).toLowerCase();if(e==USEREMAIL){d=true;break}else{g[g.length]=e}}}if(d){jQuery.goMessage(mailMsg.conf_forward_14);return}var j={};j.ruleType=a;j.addRule=true;j.fromEmails=g;mailControl.addResistRule(j,registRejectAllowResult)})}function registRejectAllowResult(a){var c="";var b="";if(a=="black"){c=mailMsg.mail_receivreject;b=mailMsg.confirm_denyok}else{c=mailMsg.mail_receivallow;b=mailMsg.confirm_allowok}jQuery.goConfirm(c,b,function(){moveRejectMsg(a)})}function moveRejectMsg(c){var b=getMailListCheckedIdArray();var a=getListProcessParams(b);var d=a.uids;var f=a.fnames[0];var e={};e.ruleType=c;e.moveBox=true;e.uids=d;e.folderName=f;mailControl.addResistRule(e,function(){if(isPopupView()){if(isReloadReady()){opener.reloadMessageList()}window.close()}else{mailControl.reloadMessageList()}})}function addDiskRequestAgainPopup(e){var d=folderControl.getQuotaInfo();var a=Math.floor(folderControl.quotaRequest.quotaRequestAgainTime/60);var b=folderControl.quotaRequest.quotaRequestAgainTime-(a*60);var c;if(e==true){c=["<p class='add'>",mailMsg.volume_already_requested_001+"<strong id='quotaRequestAgainTime'></strong> "+mailMsg.volume_already_requested_002+"<span class='desc'>"+mailMsg.volume_already_requested_003+"</span>","</p>","<div class='storage_create'><div class='box'><div class='txt' id='requestComment'></div><span class='date' id='quotaRequestTime'></span></div></div>"].join("")}else{c=["<p class='add'>",mailMsg.volume_already_requested_001+"<span class='desc'>"+mailMsg.volume_already_requested_003+"</span>","</p>","<div class='storage_create'><div class='box'><div class='txt' id='requestComment'></div><span class='date' id='quotaRequestTime'></span></div></div>"].join("")}var f=mailMsg.volume_quota_diskadd;jQuery.goInputText(f,c,mailMsg.button_request_cancel,mailMsg.comn_again_add_disk,e,true,function(){var g={volumeId:folderControl.quotaRequest.volumeId,usage:d.usage,limit:d.limit};ActionLoader.putGoLoadAction("/api/volume/request/again",g,function(h){jQuery.goSlideMessage(mailMsg.mail_again_request,"caution");folderControl.getFolderAllInfo()},"json",function(h){if(h.name=="admin.not.support.quota.warning"){jQuery.goAlert(h.message,"",function(){jQuery("#mail-volume-request").remove();resizeLeftMenu()})}})},function(){var g={volumeId:folderControl.quotaRequest.volumeId};ActionLoader.postGoLoadAction("/api/volume/request/cancel",g,function(h){jQuery.goSlideMessage(mailMsg.mail_request_cancel,"caution");folderControl.getFolderAllInfo()},"json")});jQuery("#quotaRequestAgainTime").html(a+mailMsg.mail_registe_time+b+mailMsg.comn_min);jQuery("#requestComment").html(mailMsg.request_body+" : "+folderControl.quotaRequest.requestComment);jQuery("#quotaRequestTime").html(mailMsg.request_date+" : "+folderControl.quotaRequest.quotaRequestTime)}function addDiskRequestPopup(){var b=folderControl.getQuotaInfo();var a=["<p>",mailMsg.volume_result_desc,"</p>","<div class='storage_create'><textarea id='checkUserAgree' class='w_max' type='text' maxlength='100' placeholder='",mailMsg.volume_additional_request,"'></textarea></div>"].join("");var c=mailMsg.volume_quota_diskadd;jQuery.goInputText(c,a,mailMsg.button_cancel,mailMsg.comn_add_disk,true,true,function(){var d=jQuery("#checkUserAgree").val();var e={requestComment:d,type:"mail",usage:b.usage,limit:b.limit};ActionLoader.postGoLoadAction("/api/volume/request",e,function(f){jQuery.goSlideMessage(mailMsg.mail_request_success,"caution");folderControl.getFolderAllInfo()},"json",function(f){if(f.name=="admin.not.support.quota.warning"){jQuery.goAlert(f.message,"",function(){jQuery("#mail-volume-request").remove();resizeLeftMenu()})}})})}function emptyFolder(b){var a="";if(b=="Trash"){a=mailMsg.confirm_emptytrash}else{if(b=="Spam"){a=mailMsg.confirm_emptyspam}else{a=mailMsg.mail_folder_delete_alert}}jQuery.goConfirm(mailMsg.mail_folder_empty,a,function(){var c={folderName:b};folderControl.emptyMailFolder(c,function(){if(b==currentFolderName){mailControl.reloadMessageList()}else{executeFolderInfo();if(isFolderManageMenu()){mailSettingControl.loadViewFolderManage()}}})});jQuery("#gpopupLayer").width("410")}function reWrite(){if(getMailListCheckedCount()>1){jQuery.goAlert(mailMsg.error_rewrite);return}var b=getMailListCheckedIdArray();var a=getListProcessParams(b);var c={};c.folderName=a.fnames[0];c.uids=a.uids;c.wtype="rewrite";goWrieLoad(c)}function recallMsg(){var b=getMailListCheckedValue();var d=jQuery("#mdnReadUid").val();var a=jQuery("#mdnMessageId").val();var c=jQuery("#mdnMessageSubject").val();jQuery.goConfirm(mailMsg.mail_mdn_recall,mailMsg.mail_mdn_confirm,function(){var e={};e.messageId=a;e.uid=d;e.subject=c;e.recallEmails=b;mailControl.recallMessage(e)})}function recallSelectMsg(){if(getMailListCheckedCount()>1){jQuery.goAlert(mailMsg.error_recall);return}jQuery.goConfirm(mailMsg.mail_mdn_recall,mailMsg.mail_mdn_confirm,function(){var a=jQuery("input[name='msgId']:checked");var b=a.val();var c=a.attr("subject");var d={messageId:b,subject:c,recallAll:true};mailControl.recallMessage(d)})}function searchRcptAddress(){var a=jQuery("#writeRcptValue");var g=jQuery.trim(a.val());var j=[];var h=[];var f=[];if(g==""){jQuery.goMessage(mailMsg.alert_addr_search_nostr);a.focus();return}var d=(g.indexOf(",")>-1);var c=(g.indexOf(";")>-1);if(d||c){if(d){j=g.split(",")}else{if(c){j=g.split(";")}}}else{j.push(g)}for(var e=0;e<j.length;e++){var g=jQuery.trim(j[e]);if(!checkInputSearchAddr(g,2,255,true)){break;return}if(isEmail(g)){h.push(g)}else{f.push(g)}}if(f.length>0){var b={keywords:f,equalSearch:false};mailControl.searchAddressByKeyowrd(b,function(k){searchRcptResult(k)})}if(h.length>0){for(var e=0;e<h.length;e++){makeSearchAddressUnitFormat(h[e])}}a.val("");a.focus()}function searchRcptResult(d){if(d.singleAddressList.length==0&&d.multiAddressList.length==0){jQuery.goMessage(mailMsg.alert_addr_search_noresult);return}var c=d.singleAddressList;var a=d.multiAddressList;for(var b=0;b<c.length;b++){makeSearchAddressUnitFormat(c[b].address)}if(a.length>0){makeRcptSelectPopup(a,applyRcptSearchAddress)}}function applyRcptSearchAddress(){jQuery("#mail_write_multi_search_result_popup input[name=emailCheck]:checked").each(function(){makeSearchAddressUnitFormat(jQuery(this).val())});jQuery.goPopup.close()}function applyRcptAddress(e){var c=jQuery("#mail_write_multi_search_result_popup input[name=emailCheck]:checked");if(c.length==0){jQuery.goMessage(mailMsg.comn_error_001);return}var d=jQuery("#"+e+"AddrWrap li span.name");c.each(function(){var f=this;makeAddressUnitFormat(e,jQuery(this).val());d.each(function(){if(jQuery(f).data("name")==jQuery(this).data("email")){jQuery(this).closest("li").remove()}})});jQuery.goPopup.close();if(SearchByNameInfo.emptyKeywordList&&SearchByNameInfo.emptyKeywordList.length>0){var d=jQuery("#"+e+"AddrWrap li span.name");for(var b=0;b<SearchByNameInfo.emptyKeywordList.length;b++){var a=SearchByNameInfo.emptyKeywordList[b];d.each(function(){if(a==jQuery(this).data("email")){jQuery(this).closest("li").addClass("invalid")}})}}else{queryByRcptName()}}function makeRcptSelectPopup(b,a){b.mailExposure=MAIL_EXPOSURE;jQuery.goPopup({id:"mail_write_multi_search_result_popup",pclass:"layer_normal",header:mailMsg.mail_rcptadd,width:600,contents:getHandlebarsTemplate("mail_write_multi_search_result_tmpl",b),openCallback:function(){jQuery("#mail_write_multi_search_result_popup").on("click","#writeMultiSearchCheckAll",function(){var c=jQuery("#mail_write_multi_search_result_popup input[name=emailCheck]:checkbox");if(jQuery(this).attr("checked")){c.attr("checked",true)}else{c.attr("checked",false)}})},closeCallback:function(){jQuery("#mail_write_multi_search_result_popup").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,callback:a,autoclose:false},{btype:"cancel",btext:mailMsg.comn_cancel}]})}var SearchByNameInfo={searchAddrValueList:[],emptyListFlag:false,emptyKeywordList:[],rcptMultiResultType:"normal",rcptType:""};function searchRcptAddrName(){var a=makeRcptForm();SearchByNameInfo.searchAddrValueList=[];SearchByNameInfo.searchAddrValueList.push({type:"to",list:a.to});SearchByNameInfo.searchAddrValueList.push({type:"cc",list:a.cc});SearchByNameInfo.searchAddrValueList.push({type:"bcc",list:a.bcc})}function searchRcptAddrOneName(a,b){if(jQuery.trim(b)==""){return}var c={};if(a=="to"){c.to=b;SearchByNameInfo.searchAddrValueList.push({type:"to",list:c.to})}else{if(a=="cc"){c.cc=b;SearchByNameInfo.searchAddrValueList.push({type:"cc",list:c.cc})}else{if(a=="bcc"){c.bcc=b;SearchByNameInfo.searchAddrValueList.push({type:"bcc",list:c.bcc})}else{if(a=="edit"){c.edit=b;SearchByNameInfo.searchAddrValueList.push({type:"edit",list:c.edit})}}}}queryByRcptName()}function queryByRcptName(){SearchByNameInfo.emptyListFlag=false;SearchByNameInfo.emptyKeywordList=[];SearchByNameInfo.rcptType="";var e=SearchByNameInfo.searchAddrValueList.pop();if(e){var m=e.list;var h=e.type;SearchByNameInfo.rcptType=h;if(!m||jQuery.trim(m)==""){queryByRcptName();return}var n=[];var l=[];var j=[];var a=2;var d=(m.indexOf(",")>-1);var c=(m.indexOf(";")>-1);if(d||c){if(d){n=m.split(",")}else{if(c){n=m.split(";")}}}else{n.push(m)}for(var g=0;g<n.length;g++){var k=jQuery.trim(n[g]);if(k==""||k.length==0){continue}if(!checkInputSearchAddr(k,a,255,true)){break;return}if(checkEmailFormat(k)){l.push(k)}else{j.push(k)}}if(l.length>0){for(var g=0;g<l.length;g++){var f=jQuery("#"+h+"AddrWrap li span.name");f.each(function(){if(l[g]==jQuery(this).data("email")){jQuery(this).closest("li").remove()}});makeAddressUnitFormat(h,l[g])}}if(j.length>0){var b={keywords:j};mailControl.searchAddressByKeyowrd(b,function(o){resultQueryByRcptName(h,o)})}else{queryByRcptName();return}}}function resultQueryByRcptName(h,e){if(!e.singleAddressList&&!e.multiAddressList){SearchByNameInfo.rcptMultiResultType="empty";var g=jQuery("#"+h+"AddrWrap li span.name");for(var d=0;d<e.emptyAddressList.length;d++){var b=e.emptyAddressList[d];g.each(function(){if(b==jQuery(this).data("email")){jQuery(this).closest("li").addClass("invalid")}})}return}else{var c=e.singleAddressList;var a=e.multiAddressList;var f=e.emptyAddressList;if(c.length>0){var g=jQuery("#"+h+"AddrWrap li span.name");for(var d=0;d<c.length;d++){makeAddressUnitFormat(h,c[d].address,c);g.each(function(){if(c[d].personal==jQuery(this).data("email")){jQuery(this).closest("li").remove()}})}}if(f.length>0){SearchByNameInfo.emptyListFlag=true;SearchByNameInfo.emptyKeywordList=f}if(a.length>0){SearchByNameInfo.rcptMultiResultType="normal";makeRcptSelectPopup(a,function(){applyRcptAddress(h)})}else{if(SearchByNameInfo.emptyListFlag){SearchByNameInfo.rcptMultiResultType="empty";var g=jQuery("#"+h+"AddrWrap li span.name");for(var d=0;d<f.length;d++){var b=f[d];g.each(function(){if(b==jQuery(this).data("email")){jQuery(this).closest("li").addClass("invalid")}})}}else{queryByRcptName()}}}}function deleteFolder(a){jQuery.goConfirm(mailMsg.mail_folder_delete,mailMsg.confirm_delete_folder,function(){folderControl.deleteFolder(a,function(){if(a==currentFolderName){goFolder("Inbox")}if(isFolderManageMenu()){mailSettingControl.loadViewFolderManage()}childrenFnameForModify=null})})}function popupWriteLoad(c){POPUPDATA=c;c.action="write";var a="writePopup"+makeRandom();var b="scrollbars=yes, resizable=yes, width=1280";if(window.screen&&window.screen.height&&window.screen.availTop&&window.screen.height+window.screen.availTop<790){b+=", height="+(window.screen.height+window.screen.availTop)}else{b+=", height=790"}popWriteWin=window.open("/app/mail/popup",a,b)}function addBookmark(){if(bookmarkType=="tag"){var b=getTagInfo(bookmarkValue);bookmarkName=b.name}else{if(bookmarkType=="unseen"){bookmarkName="unseen";bookmarkValue="unseen"}else{if(bookmarkType=="flaged"){bookmarkName="flaged";bookmarkValue="flaged"}else{if(bookmarkType=="today"){bookmarkName="today";bookmarkValue="today"}}}}var a={bookmarkType:bookmarkType,bookmarkName:bookmarkName,bookmarkValue:bookmarkValue};folderControl.saveBookmark(a)}function deleteBookmark(){if(bookmarkType=="unseen"){bookmarkValue="unseen"}else{if(bookmarkType=="flaged"){bookmarkValue="flaged"}else{if(bookmarkType=="today"){bookmarkValue="today"}}}var a={bookmarkType:bookmarkType,bookmarkValue:bookmarkValue};folderControl.deleteBookmark(a)}function toggleAllCheckMessage(a){var d=jQuery("#pageNaviWrap");var c=d.data("total");var b=d.data("pagebase");if(c<=b){return}if(a){selectAllMessageOff();jQuery("#allSelectTr").show()}else{jQuery("#allSelectTr").hide();jQuery("#mailListAllCheck").val("off")}}function selectAllMessageOn(){jQuery("#allSelectMsg1").empty();jQuery("#allSelectMsg2").empty();jQuery("#allSelectMsg3").empty();jQuery("#allSelectMsg1").text(mailMsg.allselect_007);jQuery("#allSelectMsg2").text(mailMsg.allselect_005);var a=jQuery("<a evt-rol='select-all-message-off'></a>").append(mailMsg.allselect_009);jQuery("#allSelectMsg3").append(a);jQuery("#mailListAllCheck").val("on");displayToolbarBySelectAll()}function selectAllMessageOff(){jQuery("#allSelectMsg1").empty();jQuery("#allSelectMsg2").empty();jQuery("#allSelectMsg3").empty();var b=jQuery("#pageNaviWrap").data("total");jQuery("#allSelectMsg1").text(mailMsg.allselect_001);jQuery("#allSelectMsg2").text(msgArgsReplace(mailMsg.allselect_002,[b]));var a=jQuery("<a evt-rol='select-all-message-on'></a>").append(mailMsg.allselect_008);jQuery("#allSelectMsg3").append(a);jQuery("#mailListAllCheck").val("off");displayToolbarBySelectAll()}function displayToolbarBySelectAll(){jQuery.each(jQuery("#toolbar_wrap .critical").children().not("[evt-rol=list-select-all]"),function(b,a){if(jQuery(a).find('a[evt-act="toolbar-message-delete"]').length>0){if(jQuery("#mailListAllCheck").val()=="on"){jQuery(a).find('[evt-rol="toolbar-attach-delete"]').css({opacity:"0.3",cursor:"default"});jQuery(a).find('[evt-rol="toolbar-attach-delete"]').attr("evt-rol","")}else{jQuery(a).find('[evt-rol=""]').css({opacity:"",cursor:"pointer"});jQuery(a).find('[evt-rol=""]').attr("evt-rol","toolbar-attach-delete")}}else{if(jQuery(a).find('a[evt-act="change-flag-seen"]').length>0){return true}else{if(jQuery(a).find('a[menu="move"]').length>0){return true}else{if(jQuery("#mailListAllCheck").val()=="on"){jQuery(a).css("opacity","0.3");jQuery(a).find('[evt-rol="toolbar"]').andSelf().attr("evt-rol","");jQuery(a).children().andSelf().css("cursor","default")}else{jQuery("#toolbar_wrap .critical").children().css("opacity","");jQuery(a).find('[evt-rol=""]').andSelf().attr("evt-rol","toolbar");jQuery(a).children().andSelf().css("cursor","pointer")}}}}})}function addAddrBookEmail(c){var b=get_name(c);var a=get_email(c);jQuery.get("/api/contact/personal/group",function(d){var e={name:b,email:a,groupList:d.data};jQuery.goPopup({id:"mail_add_addrbook_email_popup",pclass:"layer_normal layer_add_address",header:mailMsg.menu_addaddr,width:300,contents:getHandlebarsTemplate("mail_add_addr_email_tmpl",e),buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:saveAddrBookEmail},{btype:"cancel",btext:mailMsg.comn_cancel}]})})}function saveAddrBookEmail(){var b=jQuery.trim(jQuery("#addrMemberName").val());if(!validateInputValue(jQuery("#addrMemberName"),2,64,"userName")){return}var a=jQuery.trim(jQuery("#addrMemberEmail").val());var c=jQuery.trim(jQuery("#addrMemberGroup").val());var d={name:b,email:a};if(c){d.groupIds=[c]}mailControl.saveMemberAddress(d);jQuery.goPopup.close()}function openAddrLayerPopup(d){var a=jQuery(d).data("email");var c={email:a,useContact:USE_CONTACT&&MAIL_EXPOSURE};var e=jQuery(d).parent().find("div.layerPop");e.html(getHandlebarsTemplate("mail_email_layer_menu_tmpl",c));var b={clickObj:jQuery(d)};jQuery(e).dropDownMenu(b)}function closeAddrLayerPopup(a){jQuery(a).closest("div.layerPop").empty()}function readViewImg(b,a){var c={};c.folder=b;c.uid=a;c.viewImg=true;c=mailControl.getSharedFolderParam(c);mailControl.readMessage(c)}function registBayesianRuleMessage(d,c,a){var b={};b.ruleType=d;b.folderName=c;b.uid=a;mailControl.registBayesianRule(b)}function confirmIntegrity(c,a){jQuery("#integrityMsg").text(mailMsg.mail_integrity_check);jQuery("#integrityBtn").hide();var b={};b.folderName=c;b.uid=a;mailControl.messageIntegrity(b,function(d){updateIntegrity(d)})}function updateIntegrity(a){var b=jQuery("#integrityMsg");if(a=="match"){b.text(mailMsg.mail_integrity_match)}else{if(a=="no-match"){b.text(mailMsg.mail_integrity_nomatch)}else{if(a=="no"){b.text(mailMsg.mail_integrity_no)}else{if(a=="error"){b.text(mailMsg.mail_integrity_error)}}}}jQuery("#integrityBtn").show()}function getCheckSendInfoValue(b){var a=new Array();jQuery("#mail_send_allow_check_popup input[name="+b+"Addr]:checked").each(function(){a.push(jQuery(this).val())});return a}function loadBasicSetting(){mailSettingControl.loadBasicSetting()}function loadMdnList(){checkEscapeWriteMode(function(){layoutControl.contentNormalSplitter();mailControl.loadMdnList();hideSearchCancelBtn()})}function clearMassRcpt(){var a=document.massRcptUploadForm;a.reset();a.massFilePath.value="";jQuery("#massRcptFile").show();jQuery("#massRcptFileInfo").hide();jQuery("#massFileName").empty();jQuery("#massFileSize").empty()}function openWriteAddrRcptPopup(a){jQuery.goPopup({id:"mail_write_address_add_popup",pclass:"layer_normal layer_address",header:mailMsg.mail_searchaddr,width:980,modal:true,contents:"<iframe id='writeAddrRcptFrame' name='writeAddrRcptFrame' scrolling='no' src='/app/contact/connector/all' frameborder='0' style='border:0;width:100%;height:470px;overflow: hidden;'></iframe><div id='popOverlay' data-overlay style='position:absolute !important;' class='overlay'><div class='processing'></div></div>",openCallback:function(b){b.draggable("option","containment","document");jQuery("body").css("overflow","hidden")},closeCallback:function(){jQuery("body").css("overflow","auto")},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:applyWriteAddrRcpt},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function applyWriteAddrRcpt(){var f;if(isMsie){f=window.writeAddrRcptFrame.getAddrRcptList()}else{f=document.getElementById("writeAddrRcptFrame").contentWindow.getAddrRcptList()}var d=f.toList;var c=f.ccList;var e=f.bccList;var b=false;if(d&&d.length>0){for(var a=0;a<d.length;a++){insertRcptEmail("to",d[a])}b=true}if(c&&c.length>0){for(var a=0;a<c.length;a++){insertRcptEmail("cc",c[a])}b=true}if(e&&e.length>0){for(var a=0;a<e.length;a++){insertRcptEmail("bcc",e[a])}b=true}if(!b){jQuery.goSlideMessage(mailMsg.mail_addr_popup_alert,"caution");return}else{jQuery.goPopup.close(function(){jQuery("body").css("overflow","auto")})}}function closeMailWritePopup(){checkEscapeWriteMode(function(){try{if(isReloadReady()){opener.reloadMessageList()}}catch(a){console.log(a)}window.close()})}function previewAttach(b,c,a){var d={folderName:c,uid:b,part:a,type:"normal"};d=mailControl.getSharedFolderParam(d);d.action="previewAttach";POPUPDATA=d;window.open("/app/mail/popup","","resizable=yes,scrollbars=yes,status=yes,width=800,height=640")}function listCheckboxControl(d,a){if(a){d.attr("checked",true).closest("tr").addClass("choice");var b=jQuery("#mail_list_content :checkbox").length;var c=jQuery("#mail_list_content :checkbox:checked").length;if(b==c){jQuery("#mailListAllCheck").attr("checked",true);toggleAllCheckMessage(true)}if(layoutMode!="n"){if(!ReadSubMessageChecker.hasCurrentItem()){jQuery("#mailReadArea").handlebars("mail_read_checked_list_tmpl");jQuery("#checkedListMessage").text(msgArgsReplace(mailMsg.mail_message_checked_list,[c]))}}}else{d.attr("checked",false).closest("tr").removeClass("choice");if(jQuery("#mailListAllCheck").attr("checked")){jQuery("#mailListAllCheck").attr("checked",false);toggleAllCheckMessage(false)}var c=jQuery("#mail_list_content :checkbox:checked").length;if(layoutMode!="n"){if(!ReadSubMessageChecker.hasCurrentItem()){jQuery("#mailReadArea").handlebars("mail_read_checked_list_tmpl");if(c!=0){jQuery("#checkedListMessage").text(msgArgsReplace(mailMsg.mail_message_checked_list,[c]))}else{jQuery("#mailReadArea").handlebars("mail_read_default_tmpl")}}}}}function showSearchCancelBtn(){var c=mailControl.getListMode();var a="107px";var b="55px";if(c=="mdnlist"||c=="mdnread"){a="126px";b="37px"}jQuery("#mailSearchKeyWord").width(a);jQuery("#mailSearchCancelBtn").css("right",b).show()}function hideSearchCancelBtn(){jQuery("#mailSearchCancelBtn").hide().css("right","55px");jQuery("#mailSearchKeyWord").width("126px");jQuery("#mailSearchKeyWord").val("");jQuery("#mailSearchKeyWord").placeholder()}function cancelSearch(){var d=mailControl.getListMode();if(d=="mdnlist"){mailControl.loadMdnList()}else{if(d=="mdnread"){var a=jQuery("#mdnReadUid").val();var c={uid:a};mailControl.loadMdnRead(c)}else{var b=mailControl.getCurrentFolder();b=(b=="all")?"Inbox":b;var c={folder:b};mailControl.loadMessageList(c)}}hideSearchCancelBtn()}function makeMailBadgeCount(){}function openWebfolderPopup(a){jQuery.goPopup({id:"mail_read_attach_webfolder_popup",pclass:"layer_normal",header:mailMsg.mail_attach_webfolder_select,width:400,contents:"<iframe id='mailReadAttachWebfolderSelectFrame' name='mailReadAttachWebfolderSelectFrame' scrolling='no' src='/app/webfolder/popup/process' frameborder='0' style='border:0;width:100%;height:200px;overflow: hidden;'></iframe>",openCallback:function(b){b.draggable("option","containment","document");b.data("attachInfo",a)},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:saveMailReadAttachWebfolder},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function saveMailReadAttachWebfolder(){var b;if(isMsie){b=window.mailReadAttachWebfolderSelectFrame.selectFileList()}else{b=document.getElementById("mailReadAttachWebfolderSelectFrame").contentWindow.selectFileList()}if(!b){return}var a=jQuery("#mail_read_attach_webfolder_popup").data("attachInfo");var c={};c.attachInfo=a;c.webfolderInfo=b;mailControl.webfolderAttachSave(c)}var webfolderAttachProcess=false;function openWriteWebfolder(){jQuery.goPopup({id:"mail_write_attach_webfolder_popup",pclass:"layer_normal",header:mailMsg.mail_attach_webfolder_write_attach,width:900,offset:(isPopupWrite)?{top:0,left:0}:null,contents:"<iframe id='mailWriteAttachWebfolderSelectFrame' name='mailWriteAttachWebfolderSelectFrame' scrolling='no' src='/app/webfolder/popup/process?path=selectFile' frameborder='0' style='border:0;width:100%;height:350px;overflow: hidden;vertical-align: top;'></iframe>",modal:true,openCallback:function(a){webfolderAttachProcess=false;jQuery("#mail_write_attach_webfolder_popup").addClass("layer_import_file");a.draggable("option","containment","document")},closeCallback:function(a){webfolderAttachProcess=false},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:applyWriteWebfolderFile},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function applyWriteWebfolderFile(){if(webfolderAttachProcess){jQuery.goMessage(mailMsg.mail_attach_webfolder_write_attach_process);return}var a;if(isMsie){a=window.mailWriteAttachWebfolderSelectFrame.writeAttachFile()}else{a=document.getElementById("mailWriteAttachWebfolderSelectFrame").contentWindow.writeAttachFile()}if(!a||!a.uids||a.uids.length==0){return}webfolderAttachProcess=true;mailControl.webfolderWriteAttach(a,function(b){checkUploadfile(b);jQuery.goPopup.close()})}function getMailUserSender(){var c=jQuery("#senderUserEmail");var b=c.attr("sname");var a='"'+b+'" <'+USERLOGINEMAIL+">";c.empty();c.append(jQuery("<option selected></option>").text(a).attr("value",a).attr("alias",false));mailControl.readMailUserSender(function(d){c.append(getHandlebarsTemplate("mail_write_sender_tmpl",d));previousSenderEmail=c.val()})}function viewSendAllow(a){jQuery.goPopup({pclass:"layer_normal layer_mail_allowlist",header:mailMsg.sendallow_list,contents:getHandlebarsTemplate("mail_send_allow_list_tmpl",a),buttons:[{btype:"cancel",btext:mailMsg.comn_close}]})}function makeInputDropEvents(a){jQuery(a).droppable({accept:"ul.name_tag li:not(.creat)",tolerance:"pointer",over:function(b,c){jQuery("#dragHelperIcon").removeClass("ic_disallow").addClass("ic_allow")},out:function(b,c){jQuery("#dragHelperIcon").removeClass("ic_allow").addClass("ic_disallow")},drop:function(c,e){e.helper.remove();var b=jQuery(this).attr("sort");if(b&&"true"==b){return}var f=this;var d=e.draggable.parent().find("li.on");if(d.length==0){d=e.draggable}d.each(function(){var h=jQuery(this).find("span.name");var g=null;if(h.data("info")){g=[];g.push({name:h.data("name"),companyName:h.data("companyName"),deptName:h.data("deptName"),title:h.data("position")})}makeAddressUnitFormat(jQuery(f).attr("area"),h.data("email"),g)});d.remove()}})}function bindAddrAreaEvents(a){jQuery(a).sortable({items:"li:not(:last-child)",containment:"#mailWriteAreaTable",appendTo:"body",cursorAt:{top:10,left:-5},scroll:false,change:function(b,c){c.placeholder.css({background:"gray",opacity:"0.3",width:"100px",visibility:"visible",border:"1px solid"}).removeClass("out")},over:function(b,c){jQuery(this).attr("sort",true)},out:function(b,c){jQuery(this).attr("sort",false)},helper:function(d,e){var f="";var b=e.length||0;if(b>0){f=e.context.textContent}else{f=jQuery(this).find("span.name").text()}var c={message:f};return getHandlebarsTemplate("mail_dnd_tmpl",c)}}).disableSelection()}function selectAddressFieldkeyEvt(D){var q=16;var b=17;var j=37;var m=39;var u=65;var a=67;var o=8;var A=46;var k=D.closest("ul.name_tag");var d=k.find("li:not(.creat)");var p=d.size();var t=d.first();var h=new Array();var c=null;var x=jQuery("#toAddrWrap").find("li:not(.creat)");var f=jQuery("#ccAddrWrap").find("li:not(.creat)");var C=jQuery("#bccAddrWrap").find("li:not(.creat)");var l=x.first();var B=f.first();var y=C.first();var n=x.size();var w=f.size();var s=C.size();var z=k.closest("div.div_ipt").attr("id");if(z!="toAddrWrap"){jQuery(document).unbind("keydown");initSelectField(l,n)}if(z!="ccAddrWrap"){jQuery(document).unbind("keydown");initSelectField(B,w)}if(z!="bccAddrWrap"){jQuery(document).unbind("keydown");initSelectField(y,s)}for(var v=0;v<p;v++){if(v==0){t.removeClass("on");c=t.next()}else{c.removeClass("on");c=c.next()}}D.addClass("on");var r=d.index(D);var g=d.index(t);var e=g+p-1;if(r==-1){p=d.size();t=d.first()}ctrlDown=false;shiftDown=false;ctrlPlusA=false;ctrlPlusClick=false;jQuery(document).keydown(function(H){if(H.keyCode==b){ctrlDown=true;for(var G=0;G<p;G++){if(G==0){t.find("span.name").attr("evt-rol","multi-select-field");c=t.next()}else{c.find("span.name").attr("evt-rol","multi-select-field");c=c.next()}}H.preventDefault()}if((r!=-1)&&((H.keyCode==o)||(H.keyCode==A))){if(window.event){window.event.returnValue=false}else{H.returnValue=false}k.find("li.on").remove()}if(H.keyCode==q){if(window.event){window.event.returnValue=false}else{H.returnValue=false}shiftDown=true;for(var G=0;G<p;G++){if(G==0){t.find("span.name").attr("evt-rol","multi-select-fields");c=t.next()}else{c.find("span.name").attr("evt-rol","multi-select-fields");c=c.next()}}H.preventDefault()}if(ctrlDown&&H.keyCode==a){ctrlDown=false;for(var G=0;G<p;G++){if(G==0){if(t.hasClass("on")){h.push(t.find("span.name").data("email"))}t.find("span.name").attr("evt-rol","select-field");c=t.next()}else{if(c.hasClass("on")){h.push(c.find("span.name").data("email"))}c.find("span.name").attr("evt-rol","select-field");c=c.next()}}if(window.clipboardData){var E="";for(var G=0;G<h.length;G++){if(G!=(h.length-1)){E+=h[G]+","}else{E+=h[G]}}window.clipboardData.setData("text",E);H.preventDefault();jQuery(document).unbind("keydown")}else{var E="";for(var G=0;G<h.length;G++){if(G!=(h.length-1)){E+=h[G]+","}else{E+=h[G]}}var F=jQuery("#hiddenCopyTextEl");if(!F||F.length==0){F=jQuery("<textarea></textarea>").css({position:"absolute",left:"-9999px",top:"0",id:"hiddenCopyTextEl"});jQuery("body").append(F)}F.val(E);F.focus();F[0].setSelectionRange(0,F.val().length);try{document.execCommand("copy")}catch(I){console.log(I)}F.val("");H.preventDefault();jQuery(document).unbind("keydown")}}if(ctrlDown&&H.keyCode==u){if(window.event){window.event.returnValue=false}else{H.returnValue=false}ctrlPlusA=true;d.addClass("on")}if(H.keyCode==m){if(r!=e){if(shiftDown){if(D.next().hasClass("on")){D.removeClass("on")}else{D.next().addClass("on")}D=D.next();r=d.index(D)}else{D.removeClass("on");D.next().addClass("on");D=D.next();jQuery(document).unbind("keydown");selectAddressFieldkeyEvt(D)}}}if(H.keyCode==j){if(r!=g){if(shiftDown){if(D.prev().hasClass("on")){D.removeClass("on")}else{D.prev().addClass("on")}D=D.prev();r=d.index(D)}else{D.removeClass("on");D.prev().addClass("on");D=D.prev();jQuery(document).unbind("keydown");selectAddressFieldkeyEvt(D)}}}}).keyup(function(F){if(F.keyCode==b||F.keyCode==q){ctrlDown=false;shiftDown=false;for(var E=0;E<p;E++){if(E==0){t.find("span.name").attr("evt-rol","select-field");c=t.next()}else{c.find("span.name").attr("evt-rol","select-field");c=c.next()}}F.preventDefault()}})}function initSelectField(d,c){var a=null;for(var b=0;b<c;b++){if(b==0){d.find("span.name").attr("evt-rol","select-field");d.removeClass("on");a=d.next()}else{a.find("span.name").attr("evt-rol","select-field");a.removeClass("on");a=a.next()}}}function inlineImgUploadLayer(a){var c={useFlash:hasFlashPlayer()};var d=this;var b=jQuery.goPopup({id:"mail_inline_img_upload",header:mailMsg.common_upload_picture,width:"250px",pclass:"layer_normal layer_date_set",contents:"<div style='text-align:center'>"+getHandlebarsTemplate("mail_inline_img_upload_tmpl",c)+"</div>",modal:true,closeCallback:function(){if(hasFlashPlayer()){jQuery("#swfupload-control").swfupload("destroy")}},openCallback:function(e){var f={locale:LOCALE,param:{maxImageSize:"1024000",uploadType:"flash",email:USER_EMAIL},popupContents:e};if(hasFlashPlayer()){inlineImgUploadControl=new MailInlineImgControl(f)}else{inlineImgUploadControl=new MailSimpleInlineImgControl(f);jQuery("#mailSimpleInlineImgUpload").fileupload({url:"/api/mail/image/upload",formData:{uploadType:"flash",maxImageSize:jQuery("#maxImageSize").val()},dataType:"json",pasteZone:null,done:function(k,j){var g=j.result;if(g.errorMessage==""){var h='<img src="'+g.fileURL+'" title="'+g.fileName+'"/>';editorControl.addEditorText(h);e.close()}else{jQuery.goSlideMessage(g.errorMessage,"caution")}}})}inlineImgUploadControl.makeBtnControl()}});return this}function moreFolder(c){var b=null;var a={};if(c){b={top:c.top,left:c.left+90}}ActionLoader.getGoLoadAction(folderControl.folderAllInfoAction,a,function(h){var f=h.userFolders;f.isInbox=true;jQuery.goPopup({id:"mail_more_folder_popup",pclass:"layer_normal layer_select layer_mailbox_detail ",header:mailMsg.mail_folder_more,width:400,modal:false,contents:getHandlebarsTemplate("mail_more_folder_popup_tmpl"),openCallback:function(){jQuery("#selectMoreMailFolderPopup").on("click","a,span,ins,li,p",function(p){var y=jQuery(this).attr("evt-rol");if(!y){return}if(p.stopPropagation){p.stopPropagation()}else{p.cancelBubble=true}p.preventDefault();if(y=="toggle-mail-folder"){var u=jQuery(this).attr("status");var t=jQuery(this).attr("fid");var x=jQuery(this).closest("li").attr("depth");x=parseInt(x,10);var z=jQuery(this).closest("li").find("ul[depth='"+(x+1)+"']");var D="O";if(u=="open"){z.hide();jQuery(this).removeClass("close").addClass("open").attr({status:"close",title:mailMsg.comn_open});D="C"}else{z.show();jQuery(this).removeClass("open").addClass("close").attr({status:"open",title:mailMsg.comn_close})}}else{if(y=="folder"){var q=jQuery(this).attr("fname");goFolder(q);closeMailMoreFolderPopupLayer();closeMailFolderOptionLayer()}else{if(y=="unseen-folder"){var q=jQuery(this).attr("fname");goFolder(q,"U");closeMailMoreFolderPopupLayer();closeMailFolderOptionLayer()}else{if(y=="receive-noti-list"){loadMdnList();closeMailMoreFolderPopupLayer();closeMailFolderOptionLayer()}else{if(y=="empty-spam-folder"){emptyFolder("Spam");closeMailMoreFolderPopupLayer();closeMailFolderOptionLayer()}else{if(y=="empty-trash-folder"){emptyFolder("Trash");closeMailMoreFolderPopupLayer();closeMailFolderOptionLayer()}else{if(y=="mail-folder-option"){closeMailFolderOptionLayer();var w=jQuery(this).data("depth");var s=jQuery(this).attr("fname");var C=jQuery(this).parent().parent().find("p a");childrenFnameForModify=new Array(C.length);jQuery(this).parent().parent().find("p a").each(function(E){childrenFnameForModify[E]=jQuery(this).attr("fname")});var A=jQuery(this).data("share");var r=jQuery(this).data("shareseq");var v={folderName:s,depth:w,share:A,shareseq:r};var B=jQuery(this).offset();v.useSharedfolder=useSharedfolder;jQuery.goPopup({id:"mailFolderOptionLayer",pclass:"layer_normal layer_context",width:115,modal:false,isClose:true,openCallback:function(){jQuery("#mailFolderOptionLayer header,#mailFolderOptionLayer footer").hide();jQuery("#mailFolderOptionLayer div.content").css("padding","0");jQuery("#mailFolderOptionLayer div.content").on("click","li",function(H){var E=jQuery(this).attr("evt-rol");var J=jQuery(this).parent().attr("folder");if(E=="empty-user-folder"){emptyFolder(J)}else{if(E=="modify-folder"){modifyFolder(J)}else{if(E=="delete-folder"){deleteFolder(J)}else{if(E=="add-sub-folder"){addSubFolder(J)}else{if(E=="share-folder"){openShareFolderSettingLayer(J);var G=("on"==jQuery(this).parent().data("share"));if(G){var F=jQuery(this).parent().data("shareseq");jQuery("#orgShareFlag").attr("checked",true);jQuery("#orgShareFlag").data("shareSeq",F);var I={folderUid:F};folderControl.getSharringReaderList(I)}}else{if(E=="upload-message"){upfolderName=J;openUploadMessageLayer()}else{if(E=="move-folder"){moveFolder(J)}}}}}}}})},offset:{top:B.top,left:B.left+15},contents:getHandlebarsTemplate("mail_folder_option_tmpl",v),buttons:[]})}else{if(y=="tmw-folder"){window.open("tmwPopup.jsp")}}}}}}}}})},closeCallback:function(){},buttons:[{btype:"cancel",btext:mailMsg.comn_close}]});var l=h.defaultFolders;var o=false;if(l&&l.length>0){for(var j=0;j<l.length;j++){var d=l[j];if(d.fullName=="Quotaviolate"){o=true}var m=jQuery("#"+d.id+"_more_num");m.empty();if(d.unseenCnt>0){var g=jQuery("<a></a>");var n=jQuery("<span class='num'></span>");n.text(d.unseenCnt);g.attr({"evt-rol":"unseen-folder",fname:d.fullName});g.html(n);m.html(g);m.data("unseen",d.unseenCnt)}if(isMailBadgeUse&&d.fullName=="Inbox"){mailBadgeCount=d.unseenCnt}}}if(o){jQuery("#more_df_quotaviolate").show()}else{jQuery("#more_df_quotaviolate").hide()}f.isInbox=true;var e=jQuery("#inbox_folder_popup_area");e.handlebars("mail_more_user_folder_tmpl",f);var k=jQuery("#inbox_toggle_more_btn");if(e.find("li.folder").length>0){if(status=="C"){k.addClass("open").removeClass("close").attr({status:"close",title:mailMsg.comn_open});e.hide()}else{k.addClass("close").removeClass("open").attr({status:"open",title:mailMsg.comn_close});e.show()}k.show()}else{k.hide()}f.isInbox=false;jQuery("#uf_more_folder_popup_area").handlebars("mail_more_user_folder_tmpl",f);jQuery("#selectMoreMailFolderPopup span").each(function(p){if(jQuery(this).attr("status")!=null){var q=jQuery(this).closest("li").attr("depth");q=parseInt(q,10);var r=jQuery(this).closest("li").find("ul[depth='"+(q+1)+"']");r.show();jQuery(this).removeClass("open").addClass("close").attr({status:"open",title:mailMsg.comn_close})}})},"json")}function contactGoSlideMessage(b,a){jQuery.goSlideMessage(b,a||"caution")}function rcptSelectInfoPopup(b,a){jQuery.goPopup({id:"mail_write_multi_search_result_popup",pclass:"layer_normal",header:mailMsg.mail_search_name_title,width:600,contents:getHandlebarsTemplate("mail_write_rcpt_info_tmpl",b),openCallback:function(){jQuery("#mail_write_multi_search_result_popup").on("click","#writeMultiSearchCheckAll",function(){var c=jQuery("#mail_write_multi_search_result_popup input[name=emailCheck]:checkbox");if(jQuery(this).attr("checked")){c.attr("checked",true)}else{c.attr("checked",false)}})},closeCallback:function(){jQuery("#mail_write_multi_search_result_popup").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,callback:a,autoclose:false},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function bigAttachBtnCheck(){if(jQuery("#bigAttachFlagCheck").is(":checked")){jQuery("#bigattachBtn").removeClass("action_off").addClass("action_on")}else{jQuery("#bigattachBtn").removeClass("action_on").addClass("action_off")}}function directedApproverFilter(e){if(!isDirectedApprover()){return false}var b={};b.to=e.to;b.cc=e.cc;b.bcc=e.bcc;b.massRcpt=e.massRcpt;var a=true;ActionLoader.postSyncGoLoadAction("/api/mail/address/search/external/domain",b,function(f){a=f},"json");var c=jQuery("#approverAddrWrap");var d=jQuery("#approverAddrWrap ul li");if(d.length>0&&a){a=false;e.approver=jQuery("#approverAddrWrap li").attr("approver")}else{if(a){openDirectedApproverPopup();c.show()}else{d.remove();c.hide()}}return a}function isDirectedApprover(){return jQuery("#approverAddrWrap").attr("data")}function checkMassRcptToggleBtn(b){if(b){var a=(getCookie("DO_MASSRCPT_CLOSE")=="on");if(!a){jQuery("#massRcptToggleBtn").removeClass("ic_arrow_down_type4").addClass("ic_arrow_up_type4").attr("title",mailMsg.comn_close);jQuery("#massRcptwrap").show()}}}function attachChecklayer(){jQuery.goPopup({id:"attachChecklayer",header:mailMsg.mail_attach_check_layer_header,pclass:"layer_normal layer_prevent_receiveError",width:600,contents:getHandlebarsTemplate("mail_attch_check_layer"),openCallback:function(){jQuery("#attachChekLayerSubject").text(jQuery("#subjectTitle").text());jQuery("#attachChekLayerListWrap").html(jQuery("#attachListWrap").html());jQuery("#attachChekLayerFileCount").text(jQuery("#attachFileCount").text());jQuery("#attachChecklayer").on("click","a,span,ins,li,p",function(e){var d=jQuery(this).attr("evt-rol");if(!d){return}if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}e.preventDefault();var h=jQuery("#folderName").val();var c=jQuery("#msgUid").val();var b=jQuery(this).closest("li").attr("part");if(d=="download-attach"){downloadAttach(h,c,b)}else{if(d=="download-tnef-attach"){var a=jQuery(this).attr("attkey");downLoadTnefAttach(h,c,b,a)}else{if(d=="delete-attach"){deleteAttachFile(h,c,b)}else{if(d=="delete-attach-all"){var f="";jQuery("#attachListWrap li").each(function(){if(!jQuery(this).hasClass("deleted")){f+=(f=="")?f:"_";f+=jQuery(this).attr("part")}});deleteAllAttach(h,c,f)}else{if(d=="preview-attach"){previewAttach(c,h,b)}else{if(d=="save-webfolder"){var g={folderName:h,uid:c,part:b};if(jQuery("#shared_folder_wrap").find("p.title.on").length>0){g.sharedUserSeq=jQuery("#shared_folder_wrap").find("p.title.on").children().attr("seq");g.sharedFolderName=h;g.sharedFlag="shared"}openWebfolderPopup(g)}}}}}}})},buttons:[{btype:"close",autoclose:true,btext:mailMsg.comn_close}]})}function checkSendMailCount(e){if(!isMaxSendMailCountUse||e.sendType=="draft"){return true}makeProcessLoader();var a=0;var c=true;jQuery.ajax({type:"POST",url:"/api/mail/recipientcount",data:{to:e.to,cc:e.cc,bcc:e.bcc},async:false,success:function(f){a=f.data;removeProcessLoader()},error:function(){c=false;removeProcessLoader()},dataType:"json"});if(!c){return false}var d="";if(e.sendType=="reserved"){d=e.reservedDateUtc}var b=0;jQuery.ajax({type:"POST",url:"/api/mail/sendmailcount",data:{sendType:e.sendType,reservedDateUtc:d},async:false,success:function(f){b=f.data},dataType:"json"});if((a+b)>maxSendMailCount){jQuery.goAlert(mailMsg.mail_max_send_message_001);return false}return true}function isFolderManageMenu(){return(currentMenu=="setting"&&currentMenuType=="folder")}function getRcptFilePath(){var a=jQuery("#massFileItem span.item_file");return(a.length>0)?a.attr("file-path"):""}function closeSummaryLayerOnNavigation(){if(jQuery("#ai_summary_popup").length>=1){jQuery(".btn_layer_x").click()}}var draftParam={emailAddress:"",subject:"",content:"",userInstruction:"",isRetry:false,isTemplate:false,language:"KOR",style:{current:{length:"",tone:""},target:{length:"",tone:""}}};var draftResult={title:"",subject:"",content:"",requestSeq:"",emailComplementSentence:"",emailComplementKeywords:null};var myCalendarList=[];var companyCalendarList=[];var checkedCompanyCalendarId="";var checkedMyCalendarId="";var calendarAiModel={attendees:[],calendarId:"",startTime:"",endTime:"",location:"",summary:"",timeType:"",timeZoneOffset:"",type:"",visibility:""};var calendarAiDataExist=false;var dateInfo={startDate:"",startDateTime:"",endDate:"",endDateTime:""};function resetCalendarAiModel(){calendarAiModel.attendees=[];calendarAiModel.calendarId="";calendarAiModel.startTime="";calendarAiModel.endTime="";calendarAiModel.location="";calendarAiModel.summary="";calendarAiModel.timeType="timed";calendarAiModel.timeZoneOffset="";calendarAiModel.type="";calendarAiModel.visibility="";calendarAiDataExist=false}function resetDraftParam(){draftParam.content="";draftParam.userInstruction="";draftParam.isRetry=false;draftParam.isTemplate=false;draftParam.language="KOR";draftParam.style.current.tone="";draftParam.style.current.length="";draftParam.style.target.tone="";draftParam.style.target.length=""}var purpose="";var softCancel={draft:0,summary:0,translate:0};var summaryInitial={captured:false,html:"",className:""};function captureSummaryInitialIfNeeded(){if(summaryInitial.captured){return}var a=jQuery("#ai_summary_wrap");summaryInitial.html=a.html();summaryInitial.className=a.attr("class")||"ai_summary_wrap";summaryInitial.captured=true}function restoreSummaryInitialView(){var a=jQuery("#ai_summary_wrap");if(summaryInitial.captured){a.attr("class",summaryInitial.className);a.html(summaryInitial.html)}else{a.attr("class","ai_summary_wrap");a.html('<div class="ai_empty">  <p class="desc">메일 내용을 요약해보세요.</p>  <a id="start_summary_btn" class="btn_major_s"><span class="txt">요약 생성</span></a></div>')}jQuery("#start_summary_btn").off("click").on("click",function(){var b=getAiSummaryParams();startAiSummaryProcess(b.emailId,b.subject,b.sender,b.subject)})}function submitAiDraft(){resetDraftParam();var b=++softCancel.draft;var c=jQuery('ul[evt-rol="write-address-to"] li:first-child span').text();var d=null;if(c!=null){d=extractEmail(c)}if(d!=null){draftParam.emailAddress=d}draftParam.subject=getSubject();draftParam.content=getEditorContext();var a=jQuery("#ai_draft_prompt").val();if(a==null||a.length==0){jQuery.goMessage("내용을 입력해주세요.");return}draftParam.userInstruction=a;draftResult.title=draftParam.userInstruction;jQuery("#ai_draft_prompt").val("");jQuery("#ai_draft_input").removeClass("ai_input_msg").addClass("ai_summary_loading");jQuery("#ai_draft_input").html('<div class="loading_msg_wrap">\n        <div class="spinner"></div>\n        <span class="msg">요청하신 내용을 생성 중입니다.</span>\n    </div>\n    <a id="stop_draft_btn" class="btn_major_s">\n        <span class="txt_blind">중지</span>\n    </a>\n');jQuery("#stop_draft_btn").off("click").on("click",function(){softCancel.draft++;jQuery("#ai_draft_input").removeClass("ai_summary_loading").addClass("ai_input_msg").html('<textarea id="ai_draft_prompt" class="input w_max" placeholder="본문 내용 중 다듬고 싶은 내용이 있으신가요? AI가 도와드릴게요."></textarea><a id="ai_draft_btn" class="btn_major_s"><span class="txt_blind">AI 작성</span></a>');jQuery("#ai_draft_btn").off("click").on("click",function(){submitAiDraft()})});ActionLoader.postGoJsonLoadAction("/api/ai/draft",draftParam,function(f){if(b!==softCancel.draft){return}jQuery("#ai_draft_input").removeClass("ai_summary_loading").removeClass("on").addClass("ai_input_msg").addClass("feedback");jQuery("#ai_draft_input").html('<textarea id="ai_draft_prompt" class="input w_max" placeholder="본문 내용 중 다듬고 싶은 내용이 있으신가요? AI가 도와드릴게요."></textarea>\n            <a id="ai_draft_btn" class="btn_major_s">\n                <span class="txt_blind">AI 작성</span>\n            </a>');if(f==null){jQuery("#ai_draft_prompt").val("요청하신 내용을 생성할 수 없습니다. 다시 시도해주세요.");jQuery("#ai_draft_btn").off("click").on("click",function(){submitAiDraft()});return}if(f.subject!=null&&f.subject.length>0){draftResult.subject=f.subject}if(draftResult.subject.length>0&&jQuery("#subject").val().length==0){jQuery("#subject").val(draftResult.subject)}draftResult.content=f.content;draftResult.requestSeq=f.requestSeq;draftResult.emailComplementSentence=f.emailComplementSentence;draftResult.emailComplementKeywords=f.emailComplementKeywords;var e=jQuery(jQuery(jQuery("#ai_draft_input").parents("body").find("iframe#dext_frame_smartEditor")[0]).contents().context.contentDocument);var g=e.find("iframe").contents().find("#dext_body");var h=g.html();g.html(draftResult.content+"<br>"+h);aiAdoptionApiRequest(draftResult.requestSeq);jQuery("#ai_draft_prompt").off("focus input blur").on("focus input blur",function(){checkAiTextarea()});jQuery("#ai_draft_prompt").on("keyup",function(j){if(j.key==="Enter"&&!j.shiftKey){submitAiDraft()}});jQuery("#ai_draft_btn").off("click").on("click",function(){submitAiDraft()})},"json")}function checkAiTextarea(){var c=jQuery("#ai_draft_prompt");var b=(c.val()||"").trim()!=="";var a=c.is(":focus");if(b||a){jQuery("#ai_draft_input").addClass("on")}else{jQuery("#ai_draft_input").removeClass("on")}}function getEditorContext(){var a=jQuery(jQuery("#dext_frame_smartEditor")[0].contentWindow.document).find("#dext5_design_smartEditor")[0].contentWindow.document.getElementById("dext_body").innerText;return a||""}function getSubject(){return jQuery("#subject").val()||""}function extractEmail(a){var c=/([a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,})/;var b=a.match(c);return b?b[0]:null}function copyToClipboard(b){var a=document.createElement("textarea");a.value=b;document.body.appendChild(a);a.select();document.execCommand("copy");document.body.removeChild(a)}var summaryParam={isRetry:false,emailInfo:{emailId:"",emailSubject:"",emailContent:"",sender:""}};var summaryResult={tag:"요약",oneLineSummary:"",mainSummary:"",requestUuid:""};function resetSummaryResult(){summaryResult.tag="요약";summaryResult.oneLineSummary="";summaryResult.mainSummary="";summaryResult.requestUuid=""}function startAiSummaryProcess(c,b,a,d){resetSummaryResult();summaryParam.isRetry=false;summaryParam.emailInfo.emailId=c;summaryParam.emailInfo.emailSubject=b;summaryParam.emailInfo.emailContent=d;summaryParam.emailInfo.sender=a;showSummaryRetry=true;summaryApiRequest()}function replaceWrapMessage(b){var a=jQuery("#message_wrap");if(a.length>0){a.html(b)}}function createWaitingContents(){var a=jQuery("#ai_summary_wrap");a.removeClass("ai_summary_wrap").addClass("ai_summary_loading");a.html('<div class="loading_msg_wrap" id="message_wrap">\n        <div class="spinner"></div>\n            <span class="msg">요청하신 내용을 생성 중입니다.</span>\n        </div>\n        <a class="btn_major_s" id="stop_summary_btn" href="javascript:void(0);" data-bypass>\n            <span class="txt_blind">중지</span>\n        </a>')}function summaryApiRequest(){captureSummaryInitialIfNeeded();createWaitingContents();var a=++softCancel.summary;jQuery("#stop_summary_btn").off("click").on("click",function(){softCancel.summary++;restoreSummaryInitialView()});ActionLoader.postGoJsonLoadAction("/api/ai/summary",summaryParam,function(b){if(a!==softCancel.summary){return}resetCalendarAiModel();summaryParam.isRetry=false;if(b==null){replaceWrapMessage(createErrorContents());return}calendarAiDataExist=false;if(b.calendarSchedule!=null){calendarAiDataExist=true;var d=b.calendarSchedule.startTime.split("T");dateInfo.startDate=d[0];dateInfo.startDateTime=d[1];var c=b.calendarSchedule.endTime.split("T");dateInfo.endDate=c[0];dateInfo.endDateTime=c[1];calendarAiModel.summary=b.calendarSchedule.summary;calendarAiModel.location=b.calendarSchedule.location;if(b.calendarSchedule.isAllDay){calendarAiModel.timeType="allday"}else{calendarAiModel.timeType="timed"}}var f=b.oneLineSummary.length>0?b.oneLineSummary:summaryResult.oneLineSummary;var e=b.mainSummary.length>0?b.mainSummary:summaryResult.mainSummary;summaryResult.requestUuid=b.requestUuid;setSummaryResult(f,e);setAiSummaryResult()},"json")}function setAiSummaryResult(){var a=jQuery("#ai_summary_wrap");a.removeClass("ai_summary_loading").addClass("ai_summary_result");var d='<div class="header"><span class="tit">AI메일 요약 결과</span>';if(calendarAiDataExist){d+='<ul class="ai_recommend">\n                <li>\n                    <span class="recommend_txt">📅 일정이 포함된 요약이예요.</span>\n                    <span id="calendar_regist_btn" class="recommend_link">일정 등록하기</span>\n                </li>\n            </ul>'}d+='<div class="functions">\n                <ul class="left">\n                    <li>\n                        <a id="retry_summary_btn" class="icon_btn">\n                            <i class="sp_img ic_refresh ic_medium"></i>\n                            <div class="tooltips">\n                                <span class="tooltip_text">다시 요약</span>\n                            </div>\n                        </a>\n                    </li>\n                    <li id="language_menu_list">\n                        <a class="icon_btn">\n                            <i class="sp_img ic_language ic_medium"></i>\n                            <i class="sp_img ic_arr_open ic_xsmall"></i>\n                            <div class="tooltips">\n                                <span class="tooltip_text">생성언어</span>\n                            </div>\n                        </a>\n                        <ul class="menu_layer">\n                            <li class="language_menu" data-id="KOR"><a class="">한국어</a></li>\n                            <li class="language_menu" data-id="ENG"><a class="">영어</a></li>\n                            <li class="language_menu" data-id="JPN"><a class="">일본어</a></li>\n                            <li class="language_menu" data-id="CHS"><a class="">중국어(간체)</a></li>\n                            <li class="language_menu" data-id="CHT"><a class="">중국어(번체)</a></li>\n                            <li class="language_menu" data-id="VIE"><a class="">베트남어</a></li>\n                        </ul>\n                    </li>\n                    <li>\n                        <a id="copy_summary_btn" class="icon_btn">\n                            <i class="sp_img ic_copy ic_medium"></i>\n                            <div class="tooltips">\n                                <span class="tooltip_text">복사하기</span>\n                            </div>\n                        </a>\n                    </li>\n                </ul>\n            </div>\n        </div>\n        <div class="contents">\n            <div id="ai_summary_contents" class="txt_wrap">\n            </div>\n            <a id="contents_toggle_btn" class="btn_minor_s toogle_up">\n                <i class="sp_img ic_arr_close ic_medium"></i>\n                <span class="txt">접기</span>\n            </a>\n        </div>';a.html(d);jQuery("#language_menu_list").on("click",function(f){f.stopPropagation();jQuery("#language_menu_list").addClass("active")});jQuery(document).on("click",function(){jQuery("#language_menu_list").removeClass("active")});jQuery(".language_menu").on("click",function(j){j.stopPropagation();jQuery("#language_menu_list").removeClass("active");var k=jQuery(this).attr("data-id");var f=summaryResult.mainSummary;var h=summaryResult.tag;var g={language:k,content:summaryResult.mainSummary};submitSummaryTranslateApi(g,h,f)});var b=summaryResult.mainSummary.replace(/\n/g,"<br>");jQuery("#ai_summary_contents").html(b);jQuery("#contents_toggle_btn").on("click",function(){if(jQuery("#contents_toggle_btn").hasClass("toogle_up")){jQuery("#contents_toggle_btn").removeClass("toogle_up").addClass("toogle_down");jQuery("#contents_toggle_btn").html('<i class="sp_img ic_arr_open ic_medium"></i>\n                    <span class="txt">펼치기</span>');jQuery("#ai_summary_contents").hide()}else{jQuery("#contents_toggle_btn").removeClass("toogle_down").addClass("toogle_up");jQuery("#contents_toggle_btn").html('<i class="sp_img ic_arr_close ic_medium"></i>\n                    <span class="txt">접기</span>');jQuery("#ai_summary_contents").show()}});jQuery("#copy_summary_btn").click(function(){var f=jQuery("#ai_summary_contents").html();var e=f.replace(/<br\s*\/?>/gi,"\n").replace(/<\/p\s*>/gi,"\n").replace(/<[^>]+>/g,"").trim();copyToClipboard(e);aiAdoptionApiRequest(summaryResult.requestUuid);jQuery.goMessage("내용을 복사하였습니다.")});jQuery("#retry_summary_btn").click(function(){summaryParam.isRetry=true;showSummaryRetry=false;summaryApiRequest()});var c=this;jQuery("#calendar_regist_btn").click(function(){checkScheduleApiRequest(summaryResult.requestUuid);ActionLoader.getGoLoadAction("/api/user/session",null,function(e){calendarAiModel.timeZoneOffset=e.serverTZOffset;ActionLoader.getGoLoadAction("/api/calendar/user/"+e.id+"/calendar",null,function(g){myCalendarList=[];companyCalendarList=[];for(var f=0;f<g.length;f++){if(g[f].type==="normal"){myCalendarList.push(g[f])}else{if(g[f].permission){companyCalendarList.push(g[f])}}}checkedMyCalendarId=myCalendarList[0].id;calendarAiModel.calendarId=checkedMyCalendarId;c.popupEl=jQuery.goPopup({wrapTpl:['<div class="go_popup {pclass}" id="{pid}" data-close="false" style="height: calc(100% - 300px) !important" data-layer><div class="wrap_scroll"><header><h1>{header}</h1>{headerHtml}<a class="btn_layer_x" data-bypass><span class="ic"></span><span class="txt">'+mailMsg.comn_close+'</span></a></header><div class="wrap_contents">{pTitle}{message}{contents}</div></div><div class="wrap_footer"></div></div>'],id:"ai_summary_popup",pclass:"layer_normal ai_guider ai_calendar_add",header:"AI 일정등록",offset:{},modal:false,contents:createCalendarContentsHtml()});addCalendarRegistEvent(e.id);addDatepicker();if(calendarAiModel.timeType=="allday"){jQuery("#checkbox-allday").prop("checked",true);jQuery("#startTimeInputArea").hide();jQuery("#endTimeInputArea").hide()}},"json")},"json")})}function validateAndAdjustDateAndTime(){var e=jQuery("#startTime").val();var c=jQuery("#endTime").val();var a=jQuery("#startDatePicker").val();var f=jQuery("#endDatePicker").val();var b=new Date(a+"T"+e);var d=new Date(f+"T"+c);if(b>d){if(a==f){jQuery("#endTime").val(e)}}}function formatToHHMMUsingRegex(a){a=a.replace(/[^0-9]/g,"");return a.replace(/^(\d{2})(\d)/,"$1:$2").replace(/^(\d{2}:\d{2}).*/,"$1")}function addCalendarRegistEvent(a){jQuery("#startTime").on("input",function(){jQuery("#startTimeList").hide();jQuery("#startTime").val(formatToHHMMUsingRegex(jQuery("#startTime").val()));validateAndAdjustDateAndTime()});jQuery("#endTime").on("input",function(){jQuery("#endTimeList").hide();jQuery("#endTime").val(formatToHHMMUsingRegex(jQuery("#endTime").val()));validateAndAdjustDateAndTime()});jQuery("#startTime").click(function(){if(jQuery("#startTimeList").css("display")==="none"){jQuery("#startTimeList").show()}else{jQuery("#startTimeList").hide()}});jQuery("#endTime").click(function(){if(jQuery("#endTimeList").css("display")==="none"){jQuery("#endTimeList").show()}else{jQuery("#endTimeList").hide()}});jQuery(".startLi").click(function(){jQuery("#startTime").val(jQuery(this).data("value"));jQuery("#startTimeList").hide();validateAndAdjustDateAndTime()});jQuery(".endLi").click(function(){jQuery("#endTime").val(jQuery(this).data("value"));jQuery("#endTimeList").hide();validateAndAdjustDateAndTime()});jQuery("#calendarDetailBtn").click(function(){var d={summary:jQuery("#calendarAiSummary").val(),calendar:calendarAiModel.calendarId,tt:jQuery("#checkbox-allday").is(":checked")==true?"allday":"timed",ct:"public",sd:jQuery("#startDatePicker").val(),ed:jQuery("#endDatePicker").val(),location:jQuery("#calendarAiLocation").val(),st:jQuery("#startTime").val(),et:jQuery("#endTime").val()};var c="/app/calendar/regist?summary="+encodeURIComponent(d.summary)+"&calendar="+encodeURIComponent(d.calendar)+"&tt="+encodeURIComponent(d.tt)+"&ct="+encodeURIComponent(d.ct)+"&sd="+encodeURIComponent(d.sd)+"&ed="+encodeURIComponent(d.ed)+"&location="+encodeURIComponent(d.location)+"&st="+encodeURIComponent(d.st)+"&et="+encodeURIComponent(d.et);window.top.window.location=c});var b=this;jQuery(".goBackHomeBtn").click(function(){b.popupEl.remove()});jQuery("#registAiCalendar").click(function(){calendarAiModel.summary=jQuery("#calendarAiSummary").val();if(calendarAiModel.summary.length==0){jQuery.goMessage("일정명을 입력해주세요.");return}if(jQuery("#checkbox-allday").is(":checked")){calendarAiModel.timeType="allday";calendarAiModel.startTime=jQuery("#startDatePicker").val()+"T00:00:00.000"+calendarAiModel.timeZoneOffset;calendarAiModel.endTime=jQuery("#endDatePicker").val()+"T23:59:59.999"+calendarAiModel.timeZoneOffset}else{calendarAiModel.timeType="timed";calendarAiModel.startTime=jQuery("#startDatePicker").val()+"T"+jQuery("#startTime").val()+":00.000"+calendarAiModel.timeZoneOffset;calendarAiModel.endTime=jQuery("#endDatePicker").val()+"T"+jQuery("#endTime").val()+":59.999"+calendarAiModel.timeZoneOffset}var c=new Date(calendarAiModel.startTime);var d=new Date(calendarAiModel.endTime);if(c>d){jQuery.goMessage("날짜와 시간을 확인해주세요.");return}calendarAiModel.location=jQuery("#calendarAiLocation").val();if(jQuery("#useCompanyCalendar").is(":checked")){calendarAiModel.type="company"}else{calendarAiModel.type="normal";calendarAiModel.attendees=[a]}calendarAiModel.visibility="public";ActionLoader.postGoJsonLoadAction("/api/calendar/"+calendarAiModel.calendarId+"/event",calendarAiModel,function(e){jQuery(".wrap_contents").html(createCalendarRegistCompleteHtml());jQuery("#btnMoveToEvent").click(function(){window.top.window.location="/app/calendar/"+calendarAiModel.calendarId+"/event/"+e.id});jQuery("#btnClose").click(function(){jQuery(".btn_layer_x").click()})})});jQuery("#checkbox-allday").on("change",function(){var c=jQuery(this).is(":checked");if(c){jQuery("#startTimeInputArea").hide();jQuery("#endTimeInputArea").hide()}else{jQuery("#startTimeInputArea").show();jQuery("#endTimeInputArea").show()}});jQuery("#myCalendarSelector").click(function(){var c=this;jQuery("#companyCalendarSelector").removeClass("active");if(jQuery(c).hasClass("active")){jQuery(c).removeClass("active")}else{jQuery(c).addClass("active")}});jQuery("#companyCalendarSelector").click(function(){var c=this;jQuery("#myCalendarSelector").removeClass("active");if(jQuery(c).hasClass("active")){jQuery(c).removeClass("active")}else{jQuery(c).addClass("active")}});jQuery(".myCalendarList").click(function(){jQuery("#myCalendarName").text(jQuery(this).text());calendarAiModel.calendarId=jQuery(this).data("calendarid")});jQuery(".companyCalendarList").click(function(){jQuery("#companyCalendarName").text(jQuery(this).text());calendarAiModel.calendarId=jQuery(this).data("calendarid")});jQuery("#useCompanyCalendar").on("change",function(){var c=jQuery(this).is(":checked");if(c){if(!checkedCompanyCalendarId){checkedCompanyCalendarId=companyCalendarList[0].id;calendarAiModel.calendarId=companyCalendarList[0].id}jQuery("#myCalendarTemplate").hide();jQuery("#companyCalendarSelector").show()}else{jQuery("#myCalendarTemplate").show();jQuery("#companyCalendarSelector").hide()}})}function addDatepicker(){jQuery("#startDatePicker").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearSuffix:"",onSelect:function(a){jQuery("#startDatePicker").val(a);jQuery("#endDatePicker").datepicker("option","minDate",a);validateAndAdjustDateAndTime()}});jQuery("#endDatePicker").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearSuffix:"",onSelect:function(a){jQuery("#endDatePicker").val(a);validateAndAdjustDateAndTime()},minDate:jQuery("#startDatePicker").val()})}function createCalendarRegistCompleteHtml(){var a='<div class="wrap_info"><p class="text heading">일정이 등록되었습니다.</p><p class="text body">등록한 일정으로 이동하시겠습니까?</p><i class="img_dada_bubble"></i><div class="group_btn"><a id="btnClose" class="btn_minor"><span class="txt">닫기</span></a><a id="btnMoveToEvent" class="btn_major static"><span class="txt">일정 확인 하기</span></a></div></div>';return a}function createCalendarContentsHtml(){var b='<div class="wrap_templates"><ul class="group_template"><li class="template_list"><div class="template_item"><p class="item_name">일정명<i>*</i></p></div><div class="template_value"><input id="calendarAiSummary" class="hidden_input" type="text" placeholder="내용을 입력해 주세요." value="'+calendarAiModel.summary+'"></div></li><li class="template_list"><div class="template_item"><p class="item_name">일시</p></div><div class="template_value"><form class="wrap_calendar_add"><span class="tit">시작</span><span class="wrap_date"><input id="startDatePicker" class="start-date txt wfix_small" type="text" name="start_date" value="'+dateInfo.startDate+'" readonly="readonly"><span class="ic ic_calendar"></span></span><span id="startTimeInputArea" class="wrap_multiselect wrap-selecttime"><span class="wrap_select"><span class="wrap_select_list"><input id="startTime" name="start_time" type="text" class="txt wfix_small" data-outside="start" value="'+dateInfo.startDateTime+'"><ul id="startTimeList" data-type="start" class="select_list" style="display:none" data-outside="start"><li class="startLi" data-value="00:30">00:30</li><li class="startLi" data-value="01:00">01:00</li><li class="startLi" data-value="01:30">01:30</li><li class="startLi" data-value="02:00">02:00</li><li class="startLi" data-value="02:30">02:30</li><li class="startLi" data-value="03:00">03:00</li><li class="startLi" data-value="03:30">03:30</li><li class="startLi" data-value="04:00">04:00</li><li class="startLi" data-value="04:30">04:30</li><li class="startLi" data-value="05:00">05:00</li><li class="startLi" data-value="05:30">05:30</li><li class="startLi" data-value="06:00">06:00</li><li class="startLi" data-value="06:30">06:30</li><li class="startLi" data-value="07:00">07:00</li><li class="startLi" data-value="07:30">07:30</li><li class="startLi" data-value="08:00">08:00</li><li class="startLi" data-value="08:30">08:30</li><li class="startLi" data-value="09:00">09:00</li><li class="startLi" data-value="09:30">09:30</li><li class="startLi" data-value="10:00">10:00</li><li class="startLi" data-value="10:30">10:30</li><li class="startLi" data-value="11:00">11:00</li><li class="startLi" data-value="11:30">11:30</li><li class="startLi" data-value="12:00">12:00</li><li class="startLi" data-value="12:30">12:30</li><li class="startLi" data-value="13:00">13:00</li><li class="startLi" data-value="13:30">13:30</li><li class="startLi" data-value="14:00">14:00</li><li class="startLi" data-value="14:30">14:30</li><li class="startLi" data-value="15:00">15:00</li><li class="startLi" data-value="15:30">15:30</li><li class="startLi" data-value="16:00">16:00</li><li class="startLi" data-value="16:30">16:30</li><li class="startLi" data-value="17:00">17:00</li><li class="startLi" data-value="17:30">17:30</li><li class="startLi" data-value="18:00">18:00</li><li class="startLi" data-value="18:30">18:30</li><li class="startLi" data-value="19:00">19:00</li><li class="startLi" data-value="19:30">19:30</li><li class="startLi" data-value="20:00">20:00</li><li class="startLi" data-value="20:30">20:30</li><li class="startLi" data-value="21:00">21:00</li><li class="startLi" data-value="21:30">21:30</li><li class="startLi" data-value="22:00">22:00</li><li class="startLi" data-value="22:30">22:30</li><li class="startLi" data-value="23:00">23:00</li><li class="startLi" data-value="23:30">23:30</li></ul></span></span></span><br><span class="tit">종료</span><span class="wrap_date"><input id="endDatePicker" class="end-date txt wfix_small" type="text" name="end_date" value="'+dateInfo.endDate+'" readonly="readonly"><span class="ic ic_calendar"></span></span><span id="endTimeInputArea" class="wrap_multiselect wrap-selecttime"><span class="wrap_select"><span class="wrap_select_list"><input id="endTime" name="end_time" type="text" class="txt wfix_normal" data-outside="end" value="'+dateInfo.endDateTime+'"><ul id="endTimeList" data-type="end" class="select_list" style="display:none" data-outside="end"><li class="endLi" data-value="00:00">00:00</li><li class="endLi" data-value="00:30">00:30</li><li class="endLi" data-value="01:00">01:00</li><li class="endLi" data-value="01:30">01:30</li><li class="endLi" data-value="02:00">02:00</li><li class="endLi" data-value="02:30">02:30</li><li class="endLi" data-value="03:00">03:00</li><li class="endLi" data-value="03:30">03:30</li><li class="endLi" data-value="04:00">04:00</li><li class="endLi" data-value="04:30">04:30</li><li class="endLi" data-value="05:00">05:00</li><li class="endLi" data-value="05:30">05:30</li><li class="endLi" data-value="06:00">06:00</li><li class="endLi" data-value="06:30">06:30</li><li class="endLi" data-value="07:00">07:00</li><li class="endLi" data-value="07:30">07:30</li><li class="endLi" data-value="08:00">08:00</li><li class="endLi" data-value="08:30">08:30</li><li class="endLi" data-value="09:00">09:00</li><li class="endLi" data-value="09:30">09:30</li><li class="endLi" data-value="10:00">10:00</li><li class="endLi" data-value="10:30">10:30</li><li class="endLi" data-value="11:00">11:00</li><li class="endLi" data-value="11:30">11:30</li><li class="endLi" data-value="12:00">12:00</li><li class="endLi" data-value="12:30">12:30</li><li class="endLi" data-value="13:00">13:00</li><li class="endLi" data-value="13:30">13:30</li><li class="endLi" data-value="14:00">14:00</li><li class="endLi" data-value="14:30">14:30</li><li class="endLi" data-value="15:00">15:00</li><li class="endLi" data-value="15:30">15:30</li><li class="endLi" data-value="16:00">16:00</li><li class="endLi" data-value="16:30">16:30</li><li class="endLi" data-value="17:00">17:00</li><li class="endLi" data-value="17:30">17:30</li><li class="endLi" data-value="18:00">18:00</li><li class="endLi" data-value="18:30">18:30</li><li class="endLi" data-value="19:00">19:00</li><li class="endLi" data-value="19:30">19:30</li><li class="endLi" data-value="20:00">20:00</li><li class="endLi" data-value="20:30">20:30</li><li class="endLi" data-value="21:00">21:00</li><li class="endLi" data-value="21:30">21:30</li><li class="endLi" data-value="22:00">22:00</li><li class="endLi" data-value="22:30">22:30</li><li class="endLi" data-value="23:00">23:00</li><li class="endLi" data-value="23:30">23:30</li></ul></span></span></span><br><span class="wrap_option"><input id="checkbox-allday" type="checkbox" name="timeType" value="allday"><label for="checkbox-allday">종일</label></span></form></div></li><li class="template_list"><div class="template_item"><p class="item_name">장소</p></div><div class="template_value"><div class="wrap_place_add"><input id="calendarAiLocation" class="hidden_input" type="text" placeholder="내용을 입력해 주세요." value="'+calendarAiModel.location+'"></div></div></li>';if(companyCalendarList.length>0){b+='<li class="template_list"><div class="template_item"><p class="item_name">전사 일정</p></div><div class="template_value"><div class="wrap_value"><div class="wrap_switch"><label class="switch"><input id="useCompanyCalendar" type="checkbox"><span class="slider round"></span></label></div><div id="companyCalendarSelector" class="item_selector" style="display: none"><a class="selector" target="" title="선택"><p id="companyCalendarName" class="selected_item" data-calendarid="'+companyCalendarList[0].id+'">'+companyCalendarList[0].name+'</p><i class="sp_img ic_arr_open ic_xsmall"></i></a><ul class="menu_layer">';for(var a=0;a<companyCalendarList.length;a++){b+='<li><a class="companyCalendarList" data-calendarid="'+companyCalendarList[a].id+'">'+companyCalendarList[a].name+"</a></li>"}b+="</ul></div></div></div></li>"}b+='<li id="myCalendarTemplate" class="template_list"><div class="template_item"><p class="item_name">내 캘린더</p></div><div class="template_value"><div class="template_item"><div id="myCalendarSelector" class="item_selector"><a class="selector" target="" title="선택"><p id="myCalendarName" class="selected_item" data-calendarid="'+myCalendarList[0].id+'">'+myCalendarList[0].name+'</p><i class="sp_img ic_arr_open ic_xsmall"></i></a><ul class="menu_layer">';for(var a=0;a<myCalendarList.length;a++){b+='<li><a class="myCalendarList" data-calendarid="'+myCalendarList[a].id+'">'+myCalendarList[a].name+"</a></li>"}b+='</ul></div></div></div></li></ul><div class="group_btn"><a id="calendarDetailBtn" class="btn_major static"><span class="txt">일정 상세 입력</span></a><a id="registAiCalendar" class="btn_major"><span class="txt">저장</span></a><a class="btn_minor goBackHomeBtn"><span class="txt">취소</span></a></div></div>';return b}function checkScheduleApiRequest(a){ActionLoader.postGoJsonLoadAction("/api/ai/email/check/schedule",a,function(b){},"json")}function aiAdoptionApiRequest(a){ActionLoader.postGoJsonLoadAction("/api/ai/adoption",a,function(){},"json")}function setSummaryResult(b,a){summaryResult.oneLineSummary=b;summaryResult.mainSummary=a}var showSummaryRetry=true;function submitSummaryTranslateApi(d,c,a){captureSummaryInitialIfNeeded();createWaitingContents();var b=++softCancel.translate;jQuery("#stop_summary_btn").off("click").on("click",function(){softCancel.translate++;restoreSummaryInitialView()});ActionLoader.postGoJsonLoadAction("/api/ai/contents/translate",d,function(e){if(b!==softCancel.translate){return}if(e==null){restoreSummaryInitialView();return}calendarAiDataExist=false;summaryResult.requestUuid=e.requestSeq;setSummaryResult(summaryResult.oneLineSummary,e.content);setAiSummaryResult();summaryResult.mainSummary=a;summaryResult.tag=c},"json")}function createErrorContents(){return"일시적인 오류가 발생하였습니다.<br>잠시 후 다시 시도해 주세요."}function extractNameFromEmail(b){var c=/^"([^"]+)"<[^@]+@[^>]+>$/;var a=b.match(c);if(a){return a[1]}else{return""}}function getAiSummaryParams(){var c=jQuery("#messageListId").attr("subject");var b=extractNameFromEmail(jQuery("#messageListId").data("femail"));var a=jQuery("#msgUid").val();var d={subject:c,sender:b,emailId:a};return d}function openAiConsentCheckLayer(a){jQuery.goPopup({wrapTpl:['<div class="go_popup {pclass}" id="{pid}" data-close="false" style="display:none" data-layer>','<header><h1>{header}</h1>{headerHtml}<a class="btn_layer_x" data-bypass><span class="ic"></span><span class="txt">'+mailMsg.comn_close+"</span></a></header>",'<div class="content">{contents}</div><footer class="btn_layer_wrap"><span id="agreeAiBtn" class="btn_major btn_disabled" data-role="button"><span class="icon"></span><span class="txt">동의하기</span></span><span class="btn_minor btn_layer_x" data-role="button"><span class="icon"></span><span class="txt">취소</span></span></footer></div>'],id:"ai_consent_popup",pclass:"layer_normal ai_consent_form",header:"다우오피스 AI 기능 이용 동의",contents:makeAiConsentContents()});jQuery("#ai_consent_popup").ready(function(){addEventForAiConsentLayer(a)})}function makeAiConsentContents(){return'<div class="list_wrap scroll_wrap" style="line-height: 1.5; font-size: 13px;">&nbsp; 본 AI 기능을 이용하려는 자는 최초 1회 본 AI 기능 이용에 관하여 동의가 필요합니다. 동의를 하지 않는 경우 본 AI 기능을 이용할 수 없으며, 이용자가 본 AI 기능 이용 동의 후 더 이상 이용을 원하지 않는 경우 비활성화 방식 또는 당해 기능을 이용하지 않는 방식으로 기능 이용을 중단할 수 있습니다. <br />&nbsp; 회사는 AI 기능을 제공하려는 목적으로만 이용자의 개인정보 등 다음의 데이터를 직접 또는 제3자(예: AI 플랫폼사의 AI 서비스를 API 등의 호출 방식으로 회사의 서비스에 결합하는 경우 등)에게 재위탁하는 방식으로 처리(취득, 보관 및 활용)할 수 있으며, 당해 이용자의 데이터에는 제3자를 위한 학습데이터에 활용 또는 제공되지 않습니다. <br /><table style="width: 100%; margin-top: 24px;"><thead><tr><th style="width: 72px; background-color: #ededed; border: 1px solid #ddd; text-align: left; font-weight: bold; padding: 4px 8px;">AI 기능</th><td colspan="2" style="border: 1px solid #ddd; text-align: left; padding: 4px 8px;">콘텐츠 생성 및 요약</td></tr></thead><tbody><tr><th style="width: 72px; background-color: #ededed; border: 1px solid #ddd; text-align: left; font-weight: bold; padding: 4px 8px;">데이터 <br />처리 목적</th><td colspan="2" style="border: 1px solid #ddd; text-align: left; padding: 4px 8px;">다우오피스 AI 기능 제공</td></tr><tr><th style="width: 72px; background-color: #ededed; border: 1px solid #ddd; text-align: left; font-weight: bold; padding: 4px 8px;">데이터 <br />처리 항목</th><td colspan="2" style="border: 1px solid #ddd; text-align: left; padding: 4px 8px;">다우오피스 내 이용자가 입력하는 콘텐츠에 포함된 데이터</td></tr><tr><th style="width: 72px; background-color: #ededed; border: 1px solid #ddd; text-align: left; font-weight: bold; padding: 4px 8px;">재위탁자</th><td colspan="2" style="border: 1px solid #ddd; text-align: left; padding: 4px 8px;">OpenAI</td></tr><tr><th style="width: 72px; background-color: #ededed; border: 1px solid #ddd; text-align: left; font-weight: bold; padding: 4px 8px;">재위탁 사항</th><td colspan="2" style="border: 1px solid #ddd; text-align: left; padding: 4px 8px;">AI 기능 제공을 위한 데이터</td></tr><tr><th style="width: 72px; background-color: #ededed; border: 1px solid #ddd; text-align: left; font-weight: bold; padding: 4px 8px;">처리기간</th><td colspan="2" style="border: 1px solid #ddd; text-align: left; padding: 4px 8px;">다우오피스 계정 삭제 시 또는 이용자의 이용계약 해지 후 6개월</td></tr></tbody></table><br />&nbsp; 본 AI 기능은 AI 기술의 특성상 AI플랫폼사의 학습데이터 및 이를 통해 산출되는 데이터에 부적절하거나 부정확한 내용 또는 저작권 등 타인의 권리를 침해하는 사항이 포함될 수 있으며 이는 회사의 입장과는 무관하므로 이용자는 본 AI 기능을 통해 산출된 데이터를 이용하기 전 해당 내용의 진위 또는 법령위반 여부 등을 확인할 주의의무가 있습니다. 또한 회사는 본 AI 기능을 통해 제공되는 산출 데이터의 적절성, 정확성, 적법성, 신뢰성을 보장하지 않습니다.<br />&nbsp; 본 AI 기능은 이용자가 입력한 데이터에 기반하여 결과물을 산출하므로 이용자는 자신이 입력하는 데이터에 저작권자의 저작물 등 타인의 권리를 침해하거나 그러한 우려가 있는 내용 또는 타인의 비밀에 관한 사항, 기타 관련 법령을 위반하는 사항을 포함시켜서는 안됩니다. <br />&nbsp; 이용자는 본 AI 기능을 이용함에 있어 사전 서비스 이용약관, 이용자의 회사 내부 정책을 확인 및 준수하고, 관계 법령을 위반하는 방법으로 AI 기능을 이용하여서는 안됩니다. <br /></div><div class="vertical_wrap_s"><input id="aiCheckBox" type="checkbox" /><label for="aiCheckBox"> 다우오피스 AI 서비스 이용에 동의합니다. (필수)</label></div><p class="desc">동의하지 않을 경우 다우오피스 AI 서비스를 사용할 수 없습니다. <br /></p>'}function addEventForAiConsentLayer(a){jQuery("#aiCheckBox").on("click",function(){if(this.checked){jQuery("#agreeAiBtn").removeClass("btn_disabled")}else{jQuery("#agreeAiBtn").addClass("btn_disabled")}});jQuery("#agreeAiBtn").on("click",function(){if(jQuery(this).hasClass("btn_disabled")){return}else{agreeAiMail(a)}})}function agreeAiMail(b){var a={agreement:true};ActionLoader.postGoJsonLoadAction("/api/agreement/ai",a,function(){agreeForAiMail=true;jQuery(".btn_layer_x").click();b()},"json")}var POPUPDATA={};function getPopupData(){return POPUPDATA}var progressBarOpt={boxImage:"/resources/images/progressbar.gif",barImage:"/resources/images/progressbg_green_50.gif",width:100};function ocx_file(){var a=document.uploadForm.powerupload;a.AttachFile()}function ocx_init(){var a=document.uploadForm.powerupload;a.SetAttachDuedate(Math.floor(BIGATTACH_EXPIRE_DATE.getTime()/1000));a.SetAttachMaxSize("HUGE",MAX_BIG_ATTACH_SIZE);a.SetAttachMaxSize("NORMAL",1024*1024*MAX_ATTACH_SIZE);a.SetUrlData("UPLOAD",goHostInfo+"/api/mail/file/upload");a.SetUrlData("UPFIELD","theFile");jQuery("#ocx_normal_size").html(printSize(0));jQuery("#ocx_huge_size").html(printSize(0));jQuery("#ocx_huge_quota").html(printSize(BIG_ATTACH_QUOTA))}function deleteOcxFileAll(){var c=document.uploadForm.powerupload;var b=c.GetAttachedFileCount();for(var a=0;a<b;a++){c.DetachFile(0)}}function updateHugeQuota(b){BIG_ATTACH_QUOTA=MAX_BIG_ATTACH_QUOTA-b;BIG_ATTACH_QUOTA=(BIG_ATTACH_QUOTA<0)?0:BIG_ATTACH_QUOTA;if(isOcxUpload){var a=document.uploadForm.powerupload;jQuery("#ocx_huge_quota").html(printSize(BIG_ATTACH_QUOTA));a.SetAttachMaxSize("HUGE",MAX_BIG_ATTACH_SIZE)}else{jQuery("#basic_huge_quota").html(printSize(BIG_ATTACH_QUOTA));basicAttachUploadControl.setAttachSize("hugeMax",BIG_ATTACH_QUOTA)}}function ocx_upload(){var a=document.uploadForm.powerupload;a.SetUploadParam("type","ocx");a.SetUploadParam("writeFile","true");a.SetUploadParam("upldtype","upld");a.SetUploadParam("attfile","true");a.SetUploadParam("userId","mailadm");a.SetUploadParam("queryValue","Successful");a.SetUploadParam("text","text");a.SetUploadParam("uploadType","power");a.SetUploadParam("regdate",today.getTime());return a.UploadFiles()}function makeBigAttachContent(){var c={};var l;var k=null;var t=0;var a=[];var d,n,p,f,h,g;var c;if(isOcxUpload){var m=document.uploadForm.powerupload;var q=m.GetAttachedFileCount();for(var r=0;r<q;r++){d=m.GetAttachedFileAttr(r,"TYPE");upkey=m.GetAttachedFileAttr(r,"UPKEY");n=m.GetAttachedFileAttr(r,"SIZE");p=m.GetAttachedFileAttr(r,"FILENAME2");f=m.GetAttachedFileAttr(r,"FILEPATH");h=m.GetAttachedFileAttr(r,"UID");p=Base64TMS.decode(p);if(d=="huge"){a.push({size:n,fileName:p,uid:h})}}}else{var b=basicAttachUploadControl.getFileList("huge");for(var r=0;r<b.length;r++){n=b[r].size;p=b[r].name;h=b[r].uid;a.push({size:n,fileName:p,uid:h})}}var o="";var j=(window.location.port)?":"+window.location.port:"",o=window.location.protocol+"//"+window.location.hostname+j;var e='<table class="tb_attachFile" width="100%" style="table-layout:fixed; border:1px solid #e6e6e6; margin:10px 0 20px; padding:0; font-size: 12px" cellspacing="0" cellpadding="0"><thead><tr><th style="padding:8px; text-align:left; background-color:#F7F7F7; border-bottom:1px solid #e6e6e6; cursor: default"><img src="'+o+'/resources/images/ic_clip.png" style="vertical-align:middle; height:16px; margin-right:5px" /><span style="display:inline-block; vertical-align:middle;"> '+mailMsg.bigattach_06+'</span><span style="display:inline-block; vertical-align:middle; color:#2EACB3; font-weight:normal; font-size: 12px">&nbsp;&nbsp;'+a.length+'</span><span style="display:inline-block; vertical-align:middle; font-weight:normal; font-size: 12px">'+mailMsg.mail_unit_count+"</span></th></tr></thead><tbody>";var s='<table class="tb_attachFile" width="100%" style="table-layout:fixed; border:1px solid #e6e6e6; margin:10px 0 20px; padding:0; font-size: 12px" cellspacing="0" cellpadding="0"><thead><tr><th style="padding:8px; text-align:left; background-color:#F7F7F7; border-bottom:1px solid #e6e6e6; cursor: default"><img src="'+o+'/resources/images/ic_clip.png" style="vertical-align:middle; height:16px; margin-right:5px" /><span style="display:inline-block; vertical-align:middle;"> '+mailMsg.bigattach_06+'</span><span style="display:inline-block; vertical-align:middle; color:#2EACB3; font-weight:normal; font-size: 12px">&nbsp;&nbsp;'+a.length+'</span><span style="display:inline-block; vertical-align:middle; font-weight:normal; font-size: 12px">'+mailMsg.mail_unit_count+'</span><span style="display:inline-block; vertical-align:middle;font-family:AppleGothic,arial,Helvetica,sans-serif">&nbsp;&nbsp;(Large Attachment <span style="display:inline-block; vertical-align:middle; color:#2EACB3; font-weight:normal; font-size: 12px">&nbsp;&nbsp;'+a.length+"</span> ) </span></th></tr></thead><tbody>";if(a.length>0){k=[];for(var r=0;r<a.length;r++){c=a[r];n=c.size;p=c.fileName;k.push("email="+USEREMAIL+"&uid="+c.uid);e+='<tr><td style="padding: 8px; box-sizing: border-box; border-bottom: 1px solid #e6e6e6; background-color: #f7f7f7;"><a href="{tims_bigattach_link_'+r+'}" style="vertical-align: middle; line-height: 22px; text-decoration: none; color: #333; margin-right: 3px;font-family:AppleGothic,arial,Helvetica,sans-serif">'+p+'</a><span style="font-family: tahoma, dotum; color: #999; font-size: 11px; margin-right: 5px;font-family:AppleGothic,arial,Helvetica,sans-serif">('+printSize(n)+')</span><a target="_self" href="{tims_bigattach_link_'+r+'}" ><img src="'+o+'/resources/images/ic_mail_download.gif" style="vertical-align: middle; margin-top: -2px; padding: 4px; border-style: none" title="download"></a></td></tr>';s+='<tr><td style="padding: 8px; box-sizing: border-box; border-bottom: 1px solid #e6e6e6; background-color: #f7f7f7;"><a href="{tims_bigattach_link_'+r+'}" style="vertical-align: middle; line-height: 22px; text-decoration: none; color: #333; margin-right: 3px;font-family:AppleGothic,arial,Helvetica,sans-serif">'+p+'</a><span style="font-family: tahoma, dotum; color: #999; font-size: 11px; margin-right: 5px;font-family:AppleGothic,arial,Helvetica,sans-serif">('+printSize(n)+')</span><a target="_self" href="{tims_bigattach_link_'+r+'}" ><img src="'+o+'/resources/images/ic_mail_download.gif" style="vertical-align: middle; margin-top: -2px; padding: 4px; border-style: none" title="download"></a></td></tr>';t++}}e+='<tr><td style="background-color:#F7F7F7; padding:9px 8px; font-family:AppleGothic,arial,Helvetica,sans-serif; line-height: 16px"><span style="color:#3b3b3b">'+mailMsg.bigattach_17+" </span>"+msgArgsReplace(mailMsg.bigattach_16,[BIGATTACH_EXPIRE,BIGATTACH_DOWNCNT])+' : <span style="color:red"> ~ '+BIGATTACH_EXPIRE_DATE.getFullYear()+"-"+(BIGATTACH_EXPIRE_DATE.getMonth()+1)+"-"+BIGATTACH_EXPIRE_DATE.getDate()+'</span><span style="padding-left:5px">'+BIGATTACH_TIMEZONE+"</span></td></tr></tbody></table>";s+='<tr><td style="background-color:#F7F7F7; padding:9px 8px; font-family:AppleGothic,arial,Helvetica,sans-serif; line-height: 16px"><span style="color:#3b3b3b">'+mailMsg.bigattach_17+" - </span>"+msgArgsReplace(mailMsg.bigattach_16,[BIGATTACH_EXPIRE,BIGATTACH_DOWNCNT])+'<span style="color:#3b3b3b;"> (Download available for '+BIGATTACH_EXPIRE+'days) : <span style="color:red"> ~ '+BIGATTACH_EXPIRE_DATE.getFullYear()+"-"+(BIGATTACH_EXPIRE_DATE.getMonth()+1)+"-"+BIGATTACH_EXPIRE_DATE.getDate()+'</span></span><span style="padding-left:5px">'+BIGATTACH_TIMEZONE+"</span></td></tr></tbody></table>";if(t>0){c.mode=true;if(LOCALE=="en"){c.html=e}else{c.html=s}c.links=k}else{c.mode=false;c.html="";c.links=k}return c}function hugeMailCheck(){var c;if(isOcxUpload){var d=document.uploadForm.powerupload;c=d.GetAttachedSize("HUGE")}else{c=basicAttachUploadControl.getAttachSize("hugeUse")}var b=jQuery("#reservation").attr("checked");var a=jQuery("#reservation");var e=jQuery("#securemail");if(c>0&&b){if(e&&e.attr("disabled")){chkSecureMail(true)}jQuery.goAlert("",mailMsg.write_alert006);chkReservedMail(false)}else{if(c>0&&e&&e.attr("checked")){if(a.attr("disabled")){chkReservedMail(true)}jQuery.goAlert("",mailMsg.write_alert005);chkSecureMail(false)}else{if(c==0){if(a.attr("disabled")){chkReservedMail(true)}else{if(e&&e.attr("disabled")){chkSecureMail(true)}}}}}}function basic_init(){basicAttachUploadControl.setAttachSize("hugeMax",BIG_ATTACH_QUOTA);basicAttachUploadControl.setAttachSize("hugeUse",0);basicAttachUploadControl.setAttachSize("normalMax",1024*1024*MAX_ATTACH_SIZE);basicAttachUploadControl.setAttachSize("normalUse",0);jQuery("#basic_normal_size").html(printSize(0));jQuery("#basic_huge_size").html(printSize(0));jQuery("#basic_huge_quota").html(printSize(BIG_ATTACH_QUOTA))}function updateAttachQuota(b,a){if(b=="hugeUse"){jQuery("#basic_huge_size").html(printSize(a));basicAttachUploadControl.setAttachSize("hugeUse",a)}else{if(b=="normalUse"){jQuery("#basic_normal_size").html(printSize(a));basicAttachUploadControl.setAttachSize("normalUse",a)}}}var uploadAttachFilesError=false;var uploadAttachFilesComplete=true;var basicUploadListeners={swfuploadLoaded:function(a){setTitleBar(TITLENAME)},fileQueued:function(e,c){var b=c.size;var d=basicAttachUploadControl.getAttachQuotaInfo();var f=((b+d.normalUse)>d.normalMax)?true:false;var a=jQuery("#bigAttachFlagCheck").attr("checked");if((a||(b>d.normalMax)||f)&&basicAttachUploadControl.getHugeUploadUse()){c.type="huge";if((b+d.hugeUse)>d.hugeMax){if(f){jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.ocx_upalert_size)}else{jQuery.goAlert(mailMsg.comn_upload_title,printSize(d.hugeMax)+" "+mailMsg.ocx_upalert_size)}jQuery("#basicUploadControl").swfupload("cancelUpload",c.id);return}if(b>MAX_BIG_ATTACH_SIZE){jQuery.goAlert(mailMsg.comn_upload_title,msgArgsReplace(mailMsg.bigattach_18,[printSize(MAX_BIG_ATTACH_SIZE)]));jQuery("#basicUploadControl").swfupload("cancelUpload",c.id);return}jQuery("#basicUploadControl").swfupload("addFileParam",c.id,"attachtype","huge");jQuery("#basicUploadControl").swfupload("addFileParam",c.id,"regdate",today.getTime());updateAttachQuota("hugeUse",b+d.hugeUse);hugeMailCheck()}else{c.type="normal";if((b+d.normalUse)>d.normalMax){jQuery.goAlert(mailMsg.comn_upload_title,printSize(d.normalMax)+" "+mailMsg.ocx_upalert_size);jQuery("#basicUploadControl").swfupload("cancelUpload",c.id);return}jQuery("#basicUploadControl").swfupload("addFileParam",c.id,"attachtype","normal");updateAttachQuota("normalUse",b+d.normalUse)}c.directUpload=true;basicAttachUploadControl.addAttachList(c);basicAttachUploadControl.addUploadQueueFile(c);showAttachBoxDisplay(true)},fileQueueError:function(c,a,d,b){if(d==SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE){jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.ocx_virtxt_failquest)}else{if(d==SWFUpload.QUEUE_ERROR.FILE_EXCEEDS_SIZE_LIMIT){jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.ocx_upalert_size)}else{jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.error_fileupload+"["+d+"]")}}},fileDialogStart:function(a){},fileDialogComplete:function(b,a,c){startUploadAttach()},uploadStart:function(b,a){jQuery("#progress_"+a.id).progressBar(0,progressBarOpt)},uploadProgress:function(d,b,c){var a=b.size;var e=Math.ceil(c/a*100);e=(e>=100)?100:e;jQuery("#progress_"+b.id).hide();jQuery("#progress_"+b.id).progressBar(e,progressBarOpt);jQuery("#progress_"+b.id).show();if(e==100){jQuery("#progress_"+b.id).html("<img src='/resources/images/img_loader_s.gif' align='absmiddle'>")}},uploadSuccess:function(d,c,b){var e=jQuery.parseJSON(b);if(e.uploadResult=="success"&&parseInt(e.uid,10)>-1){basicAttachUploadControl.setUploadCompleteFile(c.id,e);jQuery("#progress_"+c.id).html('<span style="color:red">['+mailMsg.comn_upload_complete+"]</span>");var a=jQuery("#basicAttachItemList tr").length;var f=basicAttachUploadControl.getUploadQueueSize();jQuery("#basicAttachItemList").animate({scrollTop:((a-f+1)*24)},"slow")}else{if(!uploadAttachFilesError){jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.error_fileupload)}jQuery("#"+c.id).attr("checked",true);deletefile()}},uploadComplete:function(b,a){if(!basicAttachUploadControl.isNextUploadQueue(a.id)){uploadAttachFilesComplete=true}},uploadError:function(c,a,d,b){if(d!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED){if(!uploadAttachFilesError){jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.error_fileupload);basic_init();uploadAttachFilesError=true}}}};var basicAttachUploadControl;function chgAttachMod(b,d){var a=b;var c=function(){var u=jQuery("#att_btn_ocx");var g=jQuery("#crtBtnSimple");var l=jQuery("#att_ocx_area");var r=jQuery("#att_ocx_quota_info");var q=jQuery("#att_btn_simple");var t=jQuery("#crtBtnPower");var m=jQuery("#att_simple_area");var h=jQuery("#att_simple_quota_info");var s=jQuery("#simpleFileInit");var o=jQuery("#simpleFileInitSub");if(USE_WEBFOLDER==true){jQuery("#writeWebfolderBtn").show()}else{jQuery("#writeWebfolderBtn").hide()}try{if(a=="ocx"){isOcxUploadDownModule=false;if(!isOcxUploadDownModule){if(USE_BIGATTACH_MODE){makePoweruploadOcx("ocxCompL",LOCALE)}else{makeNormalUploadOcx("ocxCompL",LOCALE)}try{if(isMsie){var k=document.uploadForm.powerupload;k.SetUrlData("UPFIELD","theFile");isOcxUploadDownModule=true}}catch(p){console.log(p);isOcxUploadDownModule=false;if(isMsie9){setTimeout(function(){chgAttachMod("ocx",true);jQuery("#crtBtnSimple").hide()},1000)}}}if(isOcxUploadDownModule){ocx_init();var k=document.uploadForm.powerupload;q.hide();t.hide();m.hide();h.hide();s.hide();o.hide();k.SetChangeUpMode("true");u.show();g.show();l.show();r.show();showAttachBoxDisplay(true);setCookie("OcxUpload","on",365);isOcxUpload=true;if(jQuery("span[evt-rol='attach-area-toggle']").hasClass("ic_arrow_down_type4")){jQuery("span[evt-rol='attach-area-toggle']").trigger("click")}basicAttachUploadControl.emptyFileList();if(USE_BIGATTACH_MODE){jQuery("#basic_bigattach_size").show();jQuery("#bigAttachMgn").show();jQuery("#bigattachMessageSpanBtn").show()}}}else{u.hide();g.hide();l.hide();r.hide();s.show();o.show();jQuery("#basicUploadControl").hide();if(USE_BIGATTACH_MODE){jQuery("#basic_bigattach_size").show();jQuery("#bigattachMngBtn").show();jQuery("#bigattachMessageSpanBtn").show()}else{jQuery("#basic_bigattach_size").hide();jQuery("#bigattachMngBtn").hide();jQuery("#bigattachMessageSpanBtn").hide()}q.show();t.show();m.show();h.show();showAttachBoxDisplay(false);if(activeXMake&&isMsie&&isOcxUpload){var k=document.uploadForm.powerupload;var n=k.GetAttachedFileCount();var f;for(var j=n-1;j>=0;j--){f=k.GetAttachedFileAttr(j,"attachid");k.RemoveAttachFile(f)}k.Reset()}setCookie("OcxUpload","off",365);isOcxUpload=false;basicAttachUploadControl.init();basicAttachUploadControl.makeBtnControl();basicAttachUploadControl.makeListControl();basic_init();if(!isMsie||!activeXMake){g.hide();t.hide()}}}catch(p){throw p}};if(!d&&getAttachTotalCount()>0){jQuery.goConfirm(mailMsg.mail_write,mailMsg.mail_attach_change_mode_is_exsit_title,function(){c()})}else{c()}}function checkUploadfile(c){var a,j,e,g,h,b;if(c&&c.length>0){for(var d=0;d<c.length;d++){e=c[d].upkey;a=c[d].name;j=c[d].size;h=c[d].hostId;g=(c[d].uid)?c[d].uid:"";b="normal";var f=getAttachNormalSize();if((parseInt(f,10)+parseInt(j,10))>(MAX_ATTACH_SIZE*1024*1024)){b="huge"}addlist(a,j,e,h,g,b)}fileCheck=true;jQuery("#att_simple_area").show().closest("tr").find("[evt-rol=attach-area-toggle]").toggleClass("ic_arrow_down_type4").toggleClass("ic_arrow_up_type4")}else{fileCheck=true}}function deleteAllHugeFile(){var a=getHugeFileUidList();if(a.length>0){deleteBigAttachFile(a)}}function getHugeFileUidList(){var f=[];if(isOcxUpload){var g=document.uploadForm.powerupload;var d=g.GetAttachedFileCount();var e,c;for(var b=0;b<d;b++){e=g.GetAttachedFileAttr(b,"TYPE");c=g.GetAttachedFileAttr(b,"UID");if(e=="huge"&&(c&&c!="")){f.push(c)}}}else{var a=basicAttachUploadControl.getFileList("huge");var c;if(a){for(var b=0;b<a.length;b++){c=a[b].uid;if((c&&c!=""&&c!="0")){f.push(c)}}}}return f}function deleteUpoladBarList(c){if(!isOcxUpload){var a=basicAttachUploadControl.getFileList("huge");for(var b=0;b<a.length;b++){if(c==a[b].uid){jQuery("#"+a[b].id).attr("checked",true);break}}deletefile()}}function deletefile(c){c=c||false;if(!isOcxUpload){var e=[];var b=[];if(c){jQuery("input[name=basicAttachFileEl]").each(function(){b.push(jQuery(this).attr("id"))})}else{b=basicAttachUploadControl.getCheckAttachFileIds()}if(b.length>0){var a=basicAttachUploadControl.getFileList("huge");for(var f=0;f<b.length;f++){if(a){for(var d=0;d<a.length;d++){if(b[f]==a[d].id){e.push(a[d].uid);break}}}basicAttachUploadControl.deleteAttachList(b[f])}if(e.length>0){deleteBigAttachFile(e)}var g=basicAttachUploadControl.getAttachQuotaInfo();updateAttachQuota("hugeUse",g.hugeUse);updateAttachQuota("normalUse",g.normalUse);jQuery("#basicAttachChkAll").attr("checked",false);if(getAttachTotalCount()==0){showAttachBoxDisplay(false)}}}else{var h=document.uploadForm.powerupload;h.DetachFile(-1)}}function deletefileById(f){if(!isOcxUpload){var c=[];var a=basicAttachUploadControl.getFileList("huge");if(a){for(var b=0;b<a.length;b++){if(f==a[b].id){c.push(a[b].uid);break}}}basicAttachUploadControl.deleteAttachList(f);if(c.length>0){deleteBigAttachFile(c)}var d=basicAttachUploadControl.getAttachQuotaInfo();updateAttachQuota("hugeUse",d.hugeUse);updateAttachQuota("normalUse",d.normalUse);jQuery("#basicAttachChkAll").attr("checked",false);if(getAttachTotalCount()==0){showAttachBoxDisplay(false)}}else{var e=document.uploadForm.powerupload;e.DetachFile(-1)}}function previewTempFile(c){var a=basicAttachUploadControl.getAttachFileInfo("normal",c);var b={fileName:a.name,filePath:a.path,hostId:a.hostId};b.action="previewAttachTempFile";POPUPDATA=b;window.open("/app/mail/popup","","resizable=yes,scrollbars=yes,status=yes,width=800,height=640")}function downloadTempFile(d){var a=basicAttachUploadControl.getAttachFileInfo("normal",d);var c={fileName:a.name,filePath:a.path,fileSize:a.size,hostId:a.hostId};if(TABLET||MOBILE){var b=location.protocol+"//"+window.location.host;url="/api/mail/file/temp/download?"+jQuery.param(c);window.location=b+url}else{document.getElementById("reqFrame").src="/api/mail/file/temp/download?"+jQuery.param(c)}}function getAttachTotalCount(){var d=0;if(!isOcxUpload){var e=basicAttachUploadControl.getFileList("normal");var b=basicAttachUploadControl.getFileList("huge");var a=(!e||!e.length||e.length<1)?0:e.length;var f=(!b||!b.length||b.length<1)?0:b.length;d=a+f}else{var c=document.uploadForm.powerupload;d=c.GetAttachedFileCount()}return d}function addWebfolderAttach(b){var a,j,e,g,f,c;var h=false;for(var d=0;d<b.length;d++){e=b[d][0];a=b[d][1];j=b[d][2];g=b[d][3];c=((j>MAX_ATTACH_SIZE*1024*1024))?"huge":"normal";if(!addlist(a,j,e,g,"",c)){h=true;break}}if(!h){jQuery.goPopup.close()}webfolderAttachProcess=false}function addlistForJQuery(b,n,m,j,f,h,c){var l=b+" ("+n+" bytes)";var e="normal";if(USE_BIGATTACH_MODE){e=(h)?h:"normal"}var g;var a;var k=m.substring((m.length-1),m.length);if(k=="r"){document.massmail.rcptsfile.value=m;jQuery("#filename").html(l)}else{showAttachBoxDisplay(true);var d={path:m,size:n,name:b,hostId:j,uid:f,type:e,notChage:true};if(c){d.id=c;basicAttachUploadControl.updateAttachFile(d)}else{d.id="SWFUpload_0_a"+makeRandom();basicAttachUploadControl.addAttachList(d)}}return true}function addlist(r,k,m,f,h,d,v){var j=r+" ("+k+" bytes)";var a="normal";if(USE_BIGATTACH_MODE){a=(d)?d:"normal"}var b;var q;var g=m.substring((m.length-1),m.length);if(g=="r"){document.massmail.rcptsfile.value=m;jQuery("#filename").html(j)}else{var c=parseInt(k);if(a=="normal"){if(isOcxUpload){var l=document.uploadForm.powerupload;b=l.GetAttachedSize("NORMAL")}else{b=basicAttachUploadControl.getAttachSize("normalUse")}c=b+parseInt(k);if(c>(MAX_ATTACH_SIZE*1024*1024)){jQuery.goAlert(mailMsg.comn_upload_title,MAX_ATTACH_SIZE+"MB "+mailMsg.ocx_upalert_size);return false}}else{if(a=="huge"){if(isOcxUpload){var l=document.uploadForm.powerupload;q=l.GetAttachedSize("HUGE")}else{q=basicAttachUploadControl.getAttachSize("hugeUse")}if((q+c)>BIG_ATTACH_QUOTA){jQuery.goAlert(mailMsg.comn_upload_title,printSize(BIG_ATTACH_QUOTA)+" "+mailMsg.ocx_upalert_size);return false}}}showAttachBoxDisplay(true);if(isMsie&&isOcxUpload){try{var l=document.uploadForm.powerupload;var o=l.AddAttachedFile(r,k,a);l.SetAttachedFileAttr2(o,"FILEPATH",m);l.SetAttachedFileAttr2(o,"UPKEY",m);l.SetAttachedFileAttr2(o,"FILENAME2",Base64TMS.encode(r));l.SetAttachedFileAttr2(o,"SIZE",k);l.SetAttachedFileAttr2(o,"HOSTID",f);l.SetAttachedFileAttr2(o,"TYPE",a);l.SetAttachedFileAttr2(o,"RESULT","OK");if(a=="huge"){jQuery("#ocx_huge_size").html(printSize(l.GetAttachedSize("HUGE")))}else{jQuery("#ocx_normal_size").html(printSize(c))}}catch(t){console.log(t)}}else{var w=basicAttachUploadControl.generatorFileIndex();var u={path:m,size:k,name:r,hostId:f,uid:h,type:a,notChage:true,index:w};if(v){u.id=v;basicAttachUploadControl.updateAttachFile(u)}else{u.id="SWFUpload_0_a"+makeRandom();basicAttachUploadControl.addAttachList(u)}if(a=="huge"){updateAttachQuota("hugeUse",q+c)}else{updateAttachQuota("normalUse",c)}}}return true}function getAttachNormalSize(){var b=0;if(isOcxUpload){var a=document.uploadForm.powerupload;b=a.GetAttachedSize("NORMAL")}else{b=basicAttachUploadControl.getAttachSize("normalUse")}return b}function getPreviewAttachString(){var a="";if(isOcxUpload){var e=document.uploadForm.powerupload;var c=e.GetAttachedFileCount();for(var b=0;b<c;b++){var d=e.GetAttachedFileAttr(b,"TYPE");if(d!="normal"){a+="temp\t"+Base64TMS.decode(e.GetAttachedFileAttr(b,"FILENAME2"))+"\t0\tunknown\t0\n"}else{a+=e.GetAttachedFileAttr(b,"UPKEY")+"\t"+Base64TMS.decode(e.GetAttachedFileAttr(b,"FILENAME2"))+"\t"+e.GetAttachedFileAttr(b,"SIZE")+"\t"+e.GetAttachedFileAttr(b,"HOSTID")+"\t"+e.GetAttachedFileAttr(b,"UID")+"\n"}}}else{var f=basicAttachUploadControl.getFileList("normal");for(var b=0;b<f.length;b++){a+=f[b].path+"\t"+f[b].name+"\t"+f[b].size+"\t"+f[b].hostId+"\t"+f[b].uid+"\n"}}return a}function getAttachString(){var a="";if(isOcxUpload){var e=document.uploadForm.powerupload;var c=e.GetAttachedFileCount();for(var b=0;b<c;b++){var d=e.GetAttachedFileAttr(b,"TYPE");if(d!="normal"){continue}a+=e.GetAttachedFileAttr(b,"UPKEY")+"\t"+Base64TMS.decode(e.GetAttachedFileAttr(b,"FILENAME2"))+"\t"+e.GetAttachedFileAttr(b,"SIZE")+"\t"+e.GetAttachedFileAttr(b,"HOSTID")+"\t"+e.GetAttachedFileAttr(b,"UID")+"\n"}}else{var f=basicAttachUploadControl.getFileList("normal");for(var b=0;b<f.length;b++){a+=f[b].path+"\t"+f[b].name+"\t"+f[b].size+"\t"+f[b].hostId+"\t"+f[b].uid+"\n"}}return a}function chgAttachFileType(e){var a=jQuery("#"+e);var c=a.attr("atttype");var b=Number(a.attr("attsize"));var g,f;var d=basicAttachUploadControl.getAttachQuotaInfo();if(c=="huge"){if((b>d.normalMax)||(b+d.normalUse>d.normalMax)){jQuery.goAlert(mailMsg.comn_upload_title,printSize(d.normalMax)+" "+mailMsg.ocx_upalert_size);return}updateAttachQuota("hugeUse",d.hugeUse-b);updateAttachQuota("normalUse",b+d.normalUse)}else{if((b>d.hugeMax)||(b+d.hugeUse>d.hugeMax)){jQuery.goAlert(mailMsg.comn_upload_title,printSize(d.hugeMax)+" "+mailMsg.ocx_upalert_size);return}updateAttachQuota("normalUse",d.normalUse-b);updateAttachQuota("hugeUse",b+d.hugeUse)}basicAttachUploadControl.chageAttachType(e);hugeMailCheck()}function startUploadAttach(d){var c;var b=basicAttachUploadControl.getUploadQueueFile();uploadAttachFilesError=false;if(b.length>0){uploadAttachFilesComplete=false;for(var a=0;a<b.length;a++){c=b[a];jQuery("#progress_"+c.id).progressBar(progressBarOpt)}basicAttachUploadControl.startUpload()}}function showAttachBoxDisplay(a){if(a){jQuery("#attach_area").show()}else{jQuery("#attach_area").hide()}}function deleteBigAttachFile(a){var b={messageUids:a};mailControl.deleteBigAttach(b)}function destroyBasicUploadControl(){if(isOcxUpload){jQuery("#att_ocx_area").hide()}if(basicAttachUploadControl){var b=jQuery("#att_btn_simple object").length==0?false:true;if(b){if(isOcxUpload){jQuery("#att_btn_simple").height("0px").show().css("visibility","hidden")}try{basicAttachUploadControl.stopUpload();basicAttachUploadControl.cancelUpload();basicAttachUploadControl.destroy()}catch(a){console.log(a)}}}}function destroyMassUploadControl(){if(massAttachUploadControl){var a=jQuery("#massUploadControl object").length==0?false:true;if(a){try{massAttachUploadControl.stopUpload();massAttachUploadControl.cancelUpload();massAttachUploadControl.destroy()}catch(b){console.log(b)}}}}function uploadOcxFile(){var b=true;var a=ocx_upload();if(!a||uploadAttachFilesError){if(!a){jQuery.goAlert(mailMsg.error_fileupload);deleteOcxFileAll();ocx_init()}uploadAttachFilesError=false;b=false}return b}var UploadSimpleBasicControl=function(a){var b=this;this.opt=a;this.init=function(){var d=this.opt;this.btnId="#"+d.btnId;this.listId="#"+d.listId;this.controlType=d.controlType;this.quota={hugeMax:0,normalMax:0,hugeUse:0,normalUse:0};this.normalFileList=new HashMap();this.hugeFileList=new HashMap();this.queueFileList=new HashMap();this.uploadCompleteFile=[];this.hugeMode=d.controlType=="power";this.defaultImgPath="/resources/images/upload.gif";var c=getCookie("isAttachAreaFolded")=="true"&&jQuery('[evt-rol="attach-area-toggle"]').length;if(c){jQuery('[evt-rol="attach-area-toggle"]').removeClass("ic_arrow_up_type4").addClass("ic_arrow_down_type4");jQuery("#att_simple_area").hide()}};this.makeBtnControl=function(){function c(g){var f=g.files[0];if(jQuery("#"+f.id).length){return false}if(f.relativePath){return false}return true}if(this.btnId=="#basicUploadControl"){var d=jQuery("#dropZone");var e=null;jQuery("#simpleFileInitSub").off("click");jQuery("#simpleFileInitSub").on("click",function(){jQuery("#mailSimpleUpload").click()});jQuery("#mailSimpleUpload").unbind();d.unbind();jQuery("#mailSimpleUpload").fileupload({url:"/api/mail/file/upload",sequentialUploads:true,formData:{uploadType:"flash",maxAttachFileSize:MAX_ATTACH_SIZE},dataType:"json",done:function(g,f){},dropZone:d,pasteZone:null});d.bind("dragleave",function(f){clearTimeout(e);e=setTimeout(function(){d.removeClass("drag_file")},100)});d.bind("dragover",function(f){f.preventDefault();f.stopPropagation();f.originalEvent.dataTransfer.dropEffect="move";jQuery(this).addClass("drag_file");clearTimeout(e)});d.bind("drop",function(f){f.preventDefault();f.stopPropagation();jQuery(this).removeClass("drag_file")});jQuery("#mailSimpleUpload").bind("fileuploadadd",function(l,k){uploadAttachFilesComplete=false;var f=basicAttachUploadControl.generatorFileIndex();var h="file_index_"+f;k.files[0].id=h;k.files[0].index=f;var j=k.files[0];var g=basicAttachUploadControl.getAttachQuotaInfo();var p=(j.size+g.normalUse)>g.normalMax;var m=jQuery("#bigAttachFlagCheck").attr("checked");var n="normal";if((m||(j.size>g.normalMax)||p)&&basicAttachUploadControl.getHugeUploadUse()){n="huge";if((j.size+g.hugeUse)>g.hugeMax){if(p){jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.ocx_upalert_size)}else{jQuery.goAlert(mailMsg.comn_upload_title,printSize(g.hugeMax)+" "+mailMsg.ocx_upalert_size)}return false}if(j.size>MAX_BIG_ATTACH_SIZE){jQuery.goAlert(mailMsg.comn_upload_title,msgArgsReplace(mailMsg.bigattach_18,[printSize(MAX_BIG_ATTACH_SIZE)]));return false}k.formData={uploadType:"flash",maxAttachFileSize:MAX_ATTACH_SIZE,attachtype:"huge",regdate:today.getTime()};updateAttachQuota("hugeUse",j.size+g.hugeUse)}else{n="normal";if((j.size+g.normalUse)>g.normalMax){jQuery.goAlert(mailMsg.comn_upload_title,printSize(g.normalMax)+" "+mailMsg.ocx_upalert_size);return false}if(j.size>(MAX_ATTACH_SIZE*1024*1024)){jQuery.goAlert(mailMsg.comn_upload_title,MAX_ATTACH_SIZE+"MB "+mailMsg.ocx_upalert_size);return false}updateAttachQuota("normalUse",j.size+g.normalUse)}var j={id:h,index:f,name:j.name,size:j.size,type:n};b.addAttachFile(j);var o=k.submit();jQuery('[data-id="'+h+'delBtn"]').on("click",function(q){o.abort()})}).bind("fileuploadprogress",function(k,f){var h=f.files[0];var m=h.id;var l=Math.ceil(f.loaded/f.total*100);if(l>99){l=100}l=(l>=100)?100:l;var j=jQuery("#progress_"+m);j.hide();j.find(".gage").css("width",l);j.show();jQuery("#"+m+"delBtn").show();var g=jQuery("#status_"+m);if(l==100){g.html("<img src='/resources/images/img_loader_s.gif'>")}else{g.html('<span class="rate">'+l+"%</span>")}}).bind("fileuploadsubmit",function(j,h){var f=jQuery("#bigAttachFlagCheck").attr("checked");var g=h.formData?h.formData.attachtype=="huge":false;if(f||g){h.formData={uploadType:"flash",maxAttachFileSize:MAX_ATTACH_SIZE,attachtype:"huge",regdate:today.getTime()}}}).bind("fileuploadsend",function(g,f){}).bind("fileuploaddone",function(n,l){var q=l.result;var f=q.uploadResult;var g=mailMsg.comn_upload_complete;var p=q.fileSize;var j=l.files[0];var h=j.id;if(f==="success"){var m=jQuery("#bigAttachFlagCheck").attr("checked");var o=l.formData?l.formData.attachtype=="huge":false;var k=(m||o)?"huge":"normal";addlistForJQuery(q.fileName,q.fileSize,q.filePath,q.hostId,q.uid,k,h)}else{g=mailMsg.conf_pop_54;if(p==0){jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.file_size_zero);jQuery("#"+h).closest("li").remove();uploadAttachFilesComplete=true;return false}}uploadAttachFilesComplete=b.isUploadComplete(j,l.originalFiles);b.updateAttachFileProgress(h,g);jQuery("#att_simple_area").toggle(true);jQuery('[evt-rol="attach-area-toggle"]').removeClass("ic_arrow_down_type4").addClass("ic_arrow_up_type4");setCookie("isAttachAreaFolded",false,365)}).bind("fileuploadfail",function(h,g){uploadAttachFilesComplete=b.isUploadComplete(g.files[0],g.originalFiles);if(g.errorThrown!="abort"){var f=g.files[0].id;b.updateAttachFileProgress(f,mailMsg.conf_pop_54);jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.error_fileupload)}}).bind("fileuploadchunkalways",function(g,f){})}else{jQuery("#massSimpleUpload").unbind();jQuery("#massSimpleUpload").fileupload({url:"/api/mail/file/upload",formData:{uploadType:"flash",maxAttachFileSize:MAX_ATTACH_SIZE},dataType:"json",done:function(l,h){var k=h.result,g=k.fileName,j=(parseInt(k.fileSize)/1024).toFixed(2),f=["<span class='item_file' file-path='"+k.filePath+"'>","<span class='ic_file ic_txt'></span>","<span class=''>"+g+"</span>","<span class='size'>"+j+"KB</span>","<span class='btn_bdr'>","<span class='ic_classic ic_del' title='"+mailMsg.comn_del+"'></span>","</span>","</span>"].join("");if(!isConfirmFile(g,"txt")){jQuery.goAlert(msgArgsReplace(mailMsg.error_nofileext,["txt"]));return}$fileItemTmp=jQuery(f);jQuery("#massFileItem").html($fileItemTmp);jQuery("#uploadActor").hide();$fileItemTmp.find("span.ic_del").on("click",function(m){jQuery(this).parents("span.item_file:first").remove();jQuery("#uploadActor").show()})}})}};this.generatorFileIndex=function(){var d=0;var c=jQuery("#basicAttachList > li").size();if(c>0){var e=jQuery("#basicAttachList li:last").attr("data-index");if(e){d=parseInt(e)+1}}return d};this.isUploadComplete=function(d,c){return d==c[c.length-1]};this.btnControldestory=function(){};this.getControlFile=function(){};this.startUpload=function(){};this.stopUpload=function(){};this.cancelUpload=function(){};this.resetUpload=function(){this.init();this.makeListControl()};this.makeListControl=function(){var e=jQuery('<ul id="basicAttachList" class="attach_list" style="display: none;">');var c=jQuery('<ul id="bigAttachList" class="file_wrap big_file" style="display: none;">');var d=this.listId;setTimeout(function(){jQuery(d).empty();jQuery(d).append(e);jQuery(d).append(c)},100)};this.makeListWebFolderControl=function(){var e=jQuery('<table class="form_type"></table>');var k=jQuery("<tr></tr>");var c=jQuery('<td style="padding:0"></td>');var f=jQuery('<table id="basicAttachTitle" class="in_table form_mail004"></table>');var d=jQuery("<thead></thead>");var h=jQuery("<tr></tr>");h.append('<th class="checkbox"><input type="checkbox" id="basicAttachChkAll" onclick="checkAll(this,document.uploadForm.basicAttachFileEl)"/></th>');h.append('<th class="align_l filename">'+mailMsg.bigattach_list_001+"</th>");h.append('<th class="align_l attachtype">'+mailMsg.webfolder_ext+"</th>");h.append('<th class="align_r filesize">'+mailMsg.bigattach_list_002+"</th>");h.append('<th class="align_c" style="width:46px">'+mailMsg.comn_upload_status+"</th>");d.append(h);f.append(d);c.append(f);k.append(c);e.append(k);var g=jQuery('<div class="div_scroll" style="height:200px"><table id="basicAttachList" class="in_table form_mail004">');var j=this.listId;setTimeout(function(){jQuery(j).empty();jQuery(j).append(e);jQuery(j).append(g)},100)};this.addAttachList=function(c){b.addAttachFile(c);b.updateAttachFile(c);b.updateAttachFileProgress(c.id)};this.addAttachFile=function(g){var d=g.type=="huge";var f='<li id="'+g.id+'Low" data-index="'+g.index+'" class="wrap_file"><input type="checkbox" id="'+g.id+'" name="basicAttachFileEl" style="display: none;" attsize="'+g.size+'" atttype="'+(d?"huge":"normal")+'" /><span class="file"><span class="btn_wrap" onclick="deletefileById(\''+g.id+'\')"><span id="'+g.id+'delBtn" data-id="'+g.id+'delBtn" class="ic_attach ic_del"></span></span><span class="ic_file ic_'+getFileTypeImage(g.name)+'"></span><span class="name">'+escape_tag(g.name)+"</span>"+e.call(this,g)+'</span><span class="info"><span class="etc"><span class="gage_wrap" id="progress_'+g.id+'" style="display: none;"><span class="gage" style="width: 0%;"></span></span></span><span id="status_'+g.id+'" class="status"><span class="ic state_stay"></span></span><span class="kind"><span class="'+(d?"state nude":"txt")+'">'+(d?mailMsg.bigattach_11:mailMsg.bigattach_10)+'</span></span><span class="size">'+printSize(g.size)+"</span></span></li>";jQuery("#basicAttachList").show().append(f);showAttachBoxDisplay(true);function e(k){var j=[];j.push('<span class="attach_opt">');if(c(getFileTypeImage(k.name))){var h=['<span class="btn_fn7" onclick="previewTempFile(\''+k.id+'\')"><span class="txt">'+mailMsg.mail_preview+"</span></span>&nbsp;"];j.push(h)}var l=['<span class="btn_fn7" onclick="downloadTempFile(\''+k.id+'\')"><span class="txt">'+mailMsg.bigattach_09+"</span></span>"];j.push(l);j.push("</span>");return j.join("")}function c(j){j=j.toLowerCase();var h="doc|docx|hwp|ppt|pptx|xls|xlsx|pdf|txt|jpg|jpeg|gif|tif|tiff|png|hwpx|j2k|jpc|j2c|jp2|webp";var k=new RegExp("("+h+")$","i");if(k.test(j)){return true}else{return false}}};this.updateAttachFileProgress=function(d,c){jQuery('[data-id="fileNameWrapper_'+d+'"]').show();jQuery("#progress_"+d).hide();jQuery("#status_"+d).html('<span class="ic state_complete"></span>')};this.updateAttachFile=function(d){var c=d.type=="huge";if(c){this.hugeFileList.put(d.id,d)}else{this.normalFileList.put(d.id,d)}};this.addAttachWebfolderList=function(e){var c=e.type=="huge";var d='<tr id="'+e.id+'Low" >';d+='<td class="checkbox"><input type="checkbox" id="'+e.id+'" name="basicAttachFileEl" value="" attsize="'+e.size+'" atttype="'+((c)?"huge":"normal")+'"><span class="btn_bdr" onclick="deletefileById(\''+e.id+'\')"><span title="'+mailMsg.comn_del+'" class="ic_attach ic_del"></span></span></td>';d+='<td class="align_l filename" title="'+escape_tag(e.name)+'"><span class="item_file file_wrap"><span class="ic_file ic_'+getFileTypeImage(e.name)+'"></span><span class="name">'+escape_tag(e.name)+"</span></span></td>";d+='<td class="align_c attachtype"><span class="name">'+getFileTypeImage(e.name)+"</span></td>";d+='<td class="align_r filesize"><span class="size">'+printSize(e.size)+"</span></td>";d+='<td id="'+e.id+'TypeInfo" class="align_c" style="width:30px"><span id="progress_'+e.id+'" class="progressBar"><span class="ic state_complete"></span></span></td>';d+="</tr>";if(c){this.hugeFileList.put(e.id,e)}else{this.normalFileList.put(e.id,e)}jQuery("#basicAttachList").append(d)};this.getCheckAttachFileIds=function(){var c=[];jQuery("/*#basicAttachList */input[name=basicAttachFileEl]:checked").each(function(){c.push(jQuery(this).attr("id"))});return c};this.deleteAttachList=function(g,f){var d=jQuery("#"+g).attr("atttype");var c=jQuery("#"+g).attr("attsize");if(d=="huge"){this.hugeFileList.remove(g);updateAttachQuota("hugeUse",this.quota.hugeUse-parseInt(c,0))}else{this.normalFileList.remove(g);updateAttachQuota("normalUse",this.quota.normalUse-parseInt(c,0))}if(f){jQuery(f.currentTarget).parents("#"+g+"Low").remove()}else{jQuery("#"+g+"Low").remove()}};this.setAttachSize=function(d,c){if(d=="hugeMax"){this.quota.hugeMax=c}else{if(d=="hugeUse"){this.quota.hugeUse=c}else{if(d=="normalMax"){this.quota.normalMax=c}else{if(d=="normalUse"){this.quota.normalUse=c}}}}};this.getAttachSize=function(d){var c=0;if(d=="hugeMax"){c=this.quota.hugeMax}else{if(d=="hugeUse"){c=this.quota.hugeUse}else{if(d=="normalMax"){c=this.quota.normalMax}else{if(d=="normalUse"){c=this.quota.normalUse}}}}return c};this.getAttachQuotaInfo=function(){return this.quota};this.getFileList=function(c){if(c=="huge"){return this.hugeFileList.getValues()}else{if(c=="normal"){return this.normalFileList.getValues()}else{return[]}}};this.setFileList=function(f,c){var e=new HashMap();for(var d=0;d<c.length;d++){e.put(c[d].id,c[d])}if(f=="huge"){this.hugeFileList=e}else{this.normalFileList=e}};this.getAttachFileInfo=function(c,d){return(c=="huge")?this.hugeFileList.get(d):this.normalFileList.get(d)};this.setAttachFileInfo=function(c,e,d){if(c=="huge"){this.hugeFileList.put(e,d)}else{this.normalFileList.put(e,d)}};this.setUploadCompleteFile=function(e,c){var d=this.hugeFileList.get(e);if(d){d.uid=c.uid;d.path=c.filePath;this.hugeFileList.remove(e);this.hugeFileList.put(e,d)}else{d=this.normalFileList.get(e);if(d){d.uid=c.uid;d.path=c.filePath;this.normalFileList.remove(e);this.normalFileList.put(e,d)}}};this.setHugeUploadUse=function(c){this.hugeMode=c};this.getHugeUploadUse=function(){return this.hugeMode};this.isHugeTypeFile=function(d){var c=this.hugeFileList.get(d);return(c)?true:false};this.chageAttachType=function(c){};this.destroy=function(){if(this.listId){jQuery(this.listId).empty()}this.quota={hugeMax:0,normalMax:0,hugeUse:0,normalUse:0};if(this.normalFileList){this.normalFileList.destroy()}if(this.hugeFileList){this.hugeFileList.destroy()}if(this.queueFileList){this.queueFileList.destroy()}this.uploadCompleteFile=[]};this.emptyFileList=function(){if(this.listId){jQuery(this.listId).empty()}}};var SignSimpleSettingControl=function(a){this.opt=a;this.makeBtnControl=function(){};this.destroy=function(){}};var MailSimpleInlineImgControl=function(a){this.opt=a;this.makeBtnControl=function(){};this.destroy=function(){}};var msgProgressBarOpt={boxImage:"/resources/images/progressbar.gif",barImage:"/resources/images/progressbg_green_50.gif",width:60,showText:false};var basicMsgUploadListeners={swfuploadLoaded:function(a){},fileQueued:function(d,b){var a=b.size;var c=basicMsgUploadControl.getAttachQuotaInfo();if((a>c.normalMax)||(a+c.normalUse>c.normalMax)){jQuery.goMessage(mailMsg.error_upload_quota);setTimeout(function(){closeUploadModal()},1000);return}basicMsgUploadControl.addUploadQueueFile(b)},fileQueueError:function(c,a,d,b){if(d=="-120"){jQuery.goMessage(mailMsg.ocx_virtxt_failquest)}else{jQuery.goMessage(mailMsg.error_fileupload+"["+d+"]")}},fileDialogStart:function(a){},fileDialogComplete:function(b,a,c){if(a==0){return}uploadMailMessage()},uploadStart:function(b,a){jQuery("#msg_progress_"+a.id).progressBar(0,msgProgressBarOpt)},uploadProgress:function(d,b,c){var a=b.size;var e=Math.ceil(c/a*100);e=(e>=100)?100:e;jQuery("#msg_progress_"+b.id).hide();jQuery("#msg_progress_"+b.id).progressBar(e,msgProgressBarOpt);jQuery("#msg_progress_"+b.id).show();if(e==100){jQuery("#msg_progress_"+b.id).html("<img src='/resources/images/img_loader_s.gif' align='absmiddle'>")}},uploadSuccess:function(d,b,a){var e=JSON.parse(a);var c=false;switch(e.resultMessage){case"success":jQuery("#msg_progress_"+b.id).html('<span style="color:red">['+mailMsg.comn_upload_complete+"]</span>");break;case"overQuota":jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.error_upload_quota);setTimeout(function(){closeUploadModal()},1000);break;case"sizeZero":jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.file_size_zero);break;default:jQuery.goMessage(mailMsg.comn_upload_title,mailMsg.error_fileupload);jQuery("#msg_progress_"+b.id).addClass("failUpload").html('<span style="color:red">['+mailMsg.comn_cancel+"]</span>")}},uploadComplete:function(b,a){if(!basicMsgUploadControl.isNextUploadQueue(a.id)){jQuery.goMessage(mailMsg.alert_messageupload);setTimeout(function(){var c=[];jQuery("#messageUploadListWrap span.failUpload").each(function(d){c.push({name:jQuery(this).closest("tr").find("span.name").text()})});if(c.length==0){closeUploadModal(function(){if(mailMenuStatus=="setting"){reloadViewFolderManage()}else{reloadMessageList()}})}else{jQuery("#mail_message_upload_popup a.btn_minor_s span.txt").text(mailMsg.comn_close);jQuery("#messageUploadFailListWrap").html(getHandlebarsTemplate("mail_message_upload_fail_tmpl",c)).show();if(mailMenuStatus=="setting"){reloadViewFolderManage()}else{reloadMessageList()}}},1000)}},uploadError:function(c,a,d,b){if(d!=SWFUpload.UPLOAD_ERROR.FILE_CANCELLED){jQuery.goMessage(mailMsg.error_fileupload);setTimeout(function(){closeUploadModal()},1000);return}}};var basicMsgUploadOpt={controlType:"normal",btnId:"basicMsgUploadControl",btnCid:"basicMsgUploadBtn",formName:"theFile",param:{uploadType:"flash",email:USEREMAIL},url:"/api/mail/message/upload",maxFileSize:1024*1024*100,fileType:"*.eml",btnText:mailMsg.comn_file_select,width:(LOCALE=="jp")?90:73,debug:false,handler:basicMsgUploadListeners};var basicMsgUploadControl=null;var upfolderName="";if(hasFlashPlayer()){basicMsgUploadControl=new UploadBasicControl(basicMsgUploadOpt)}else{basicMsgUploadControl=new UploadSimpleBasicControl(basicMsgUploadOpt)}function uploadMailMessage(){if(upfolderName==""||upfolderName.length==0){upfolderName=mailControl.getCurrentFolder()}startUploadMsg(upfolderName);upfolderName=""}function startUploadMsg(b){var a=basicMsgUploadControl.getUploadQueueFile();jQuery("#basicMsgUploadControl").swfupload("addPostParam","folderName",b);jQuery("#messageUploadListTable").append(getHandlebarsTemplate("mail_message_upload_items_tmpl",a));jQuery("#messageUploadListWrap").show();basicMsgUploadControl.startUpload()}function closeUploadModal(a){basicMsgUploadControl.cancelUpload();basicMsgUploadControl.destroy();jQuery.goPopup.close();if(a){a()}}function generatorFileIndex(){var b=0;var a=jQuery("#basicAttachList > li").size();if(a>0){var c=jQuery("#basicAttachList li:last").attr("data-index");if(c){b=parseInt(c)+1}}return b}function openUploadMessageLayer(){var a=0;var b={useFlash:hasFlashPlayer()};jQuery.goPopup({id:"mail_message_upload_popup",pclass:"layer_normal",header:mailMsg.menu_uploadmsg,width:500,contents:getHandlebarsTemplate("mail_message_upload_tmpl",b),openCallback:function(){if(!hasFlashPlayer()){if(upfolderName==""||upfolderName.length==0){upfolderName=mailControl.getCurrentFolder()}jQuery("#mailSimpleMessageUpload").fileupload({url:"/api/mail/message/upload",sequentialUploads:true,formData:{uploadType:"flash",folderName:upfolderName},dataType:"json",pasteZone:null});jQuery("#mailSimpleMessageUpload").bind("fileuploadadd",function(k,j){var g=j.files[0].size;var d=j.files[0].name;var h=a++;var c="file_index_"+h;j.files[0].id=c;j.files[0].index=h;if(!isFileExt(d,"eml")){jQuery.goMessage(msgArgsReplace(mailMsg.error_nofileext,["eml"])+" ["+j.files[0].name+"]");return false}if(g>1024*1024*100){jQuery.goMessage(mailMsg.ocx_upalert_size+" ["+j.files[0].name+"]");return false}var f={id:c,index:h,name:d};jQuery("#messageUploadListTable").append(getHandlebarsTemplate("mail_message_upload_item_tmpl",f));jQuery("#messageUploadListWrap").show()}).bind("fileuploadprogress",function(f,c){var d=c.files[0];var h=d.id;var g=Math.ceil(c.loaded/c.total*100);g=(g>=100)?100:g;jQuery("#msg_progress_"+h).hide();jQuery("#msg_progress_"+h).progressBar(g,msgProgressBarOpt);jQuery("#msg_progress_"+h).show();if(g==100){jQuery("#msg_progress_"+h).html("<img src='/resources/images/img_loader_s.gif' align='absmiddle'>")}}).bind("fileuploadsubmit",function(d,c){}).bind("fileuploadsend",function(d,c){}).bind("fileuploaddone",function(h,g){var c=g.result;var f=g.files[0];var d=f.id;switch(c.resultMessage){case"success":jQuery("#msg_progress_"+d).html('<span style="color:red">['+mailMsg.comn_upload_complete+"]</span>");break;case"overQuota":jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.error_upload_quota);setTimeout(function(){closeUploadModal()},1000);break;case"sizeZero":jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.file_size_zero);break;default:jQuery.goMessage(mailMsg.comn_upload_title,mailMsg.error_fileupload);jQuery("#msg_progress_"+d).addClass("failUpload").html('<span style="color:red">['+mailMsg.comn_cancel+"]</span>")}}).bind("fileuploadstop",function(c){jQuery.goPopup.close();if(isFolderManageMenu()){mailSettingControl.loadViewFolderManage()}else{mailControl.reloadMessageList()}}).bind("fileuploadfail",function(d,c){jQuery.goAlert(mailMsg.comn_upload_title,mailMsg.error_fileupload)}).bind("fileuploadchunkalways",function(d,c){})}else{msgUploadInit()}},closeCallback:function(){},buttons:[{btype:"cancel",btext:mailMsg.comn_cancel,callback:function(){closeUploadModal()}}]})}function msgUploadInit(){basicMsgUploadControl.init();basicMsgUploadControl.makeBtnControl();basicMsgUploadControl.setAttachSize("normalMax",1024*1024*100);basicMsgUploadControl.setAttachSize("normalUse",0);isOcxMsgUploadMode=false}var isBackup=false;var isBackupComplete=false;var backupWork=false;var backupStatusId="";var backupInterval;var backupFolderName="";var backupFolderEncName="";var maxForwaringCount=0;var installLocale="";var MailSettingControl=function(){var a=this;this.basicSettingAction="/api/mail/setting/basic";this.vcardAction="/api/mail/setting/vcard";this.spamRuleAction="/api/mail/setting/spam";this.signAction="/api/mail/setting/sign";this.signDataAction="/api/mail/setting/sign/data";this.defaultSignAction="/api/mail/setting/sign/default";this.deleteSignDataAction="/api/mail/setting/sign/data/delete";this.deleteAllSignDataAction="/api/mail/setting/sign/data/delete/all";this.filterAction="/api/mail/setting/filter";this.saveFilterApplyAction="/api/mail/setting/filter/apply";this.deleteFilterAction="/api/mail/setting/filter/delete";this.selectFilterAction="/api/mail/setting/filter/cond";this.forwardAction="/api/mail/setting/forward";this.saveDefineForwardAction="/api/mail/setting/forward/ext";this.autoReplyAction="/api/mail/setting/autoreply";this.extMailAction="/api/mail/setting/extmail";this.extMailsAction="/api/mail/setting/extmails";this.deleteExtMailAction="/api/mail/setting/extmail/delete";this.deleteAllExtMailAction="/api/mail/setting/extmail/delete/all";this.folderManageAction="/api/mail/setting/folder";this.changeUserFolderAgingAction="/api/mail/setting/folder/aging";this.startBackupFolderAction="/api/mail/setting/folder/backup/start";this.statusBackupFolderAction="/api/mail/setting/folder/backup/status";this.downloadBackupFolderAction="/api/mail/setting/folder/backup/download";this.deleteBackupFolderAction="/api/mail/setting/folder/backup/delete";this.lastRcptAction="/api/mail/setting/lastrcpt";this.makeMailEvent=function(){var c=new EventControl("#mailSettingContent","click","a, span, ins, input, select");c.add("save-basic-setting",function(e){saveBasicInfo()});c.add("basic-setting-cancel",function(e){a.loadBasicSetting()});c.add("default-basic-setting",function(e){defaultUserSetting()});c.add("save-spam-setting",function(e){saveSpamInfo()});c.add("spam-setting-cancel",function(e){a.loadViewSapmRule()});c.add("save-auto-filter",function(e){saveFilterInfo()});c.add("save-auto-forward",function(e){saveAllForwardInfo()});c.add("auto-forward-cancel",function(e){a.loadViewForward()});c.add("auto-filter-cancel",function(e){a.loadViewFilter()});c.add("view-vcard",function(e){a.loadManageVcard()});c.add("mail-white-add",function(e){addWhiteMailList()});c.add("mail-black-add",function(e){addBlackMailList()});c.add("mail-white-delete",function(e){jQuery(e).parent().parent().remove();deleteMailList("w")});c.add("mail-black-delete",function(e){jQuery(e).parent().parent().remove();deleteMailList("b")});c.add("all-white-delete",function(e){deleteAllMailList("w")});c.add("all-black-delete",function(e){deleteAllMailList("b")});c.add("modify-signData",function(f){var e=jQuery(f).parent().data("sign_seq");a.loadModifySignData(e)});c.add("write-signData",function(e){a.addSignData()});c.add("delete-signData",function(f){var e=jQuery(f).parent().data("sign_seq");deleteGetSignData(e)});c.add("delete-AllsignData",function(e){deleteGetAllSignData()});c.add("setting-defaultSign",function(f){var e=jQuery(f).parent().data("sign_seq");setDefaultSign(e)});c.add("save-sign-setting",function(e){saveSignSetting()});c.add("cancel-sign-setting",function(e){a.loadViewSign()});c.add("auto-filter-add",function(e){a.loadFilterManager()});c.add("delete-filter",function(f){var e=jQuery(f).attr("condSeq");deleteFilter(e)});c.add("all-filter-delete",function(e){deleteAllFilters()});c.add("modify-filter",function(f){var e=jQuery(f).attr("condseq");var g={};g.condSeq=e;a.modifyFilterManager(g)});c.add("forward-mail-add",function(e){addForwardMailList()});c.add("forward-mail-delete",function(e){jQuery(e).parent().parent().remove();deleteForwardMailList("f")});c.add("forward-all-delete",function(e){deleteAllForwardMailList("f")});c.add("exception-forward-add",function(e){var f={};var h=jQuery("#defineForwardList").attr("data-forward_list_num");var g=new Array();jQuery("#defineForwardList .defineRuleValue").each(function(){g.push({didSaveDefineValue:jQuery(e).text()})});f.forward_list_num=h++;f.defineList=g;a.forwardExcept(f)});c.add("delete-ext-rule",function(f){jQuery(f).parent().parent().remove();var e=jQuery(f).data("index");jQuery("#removeDefineForwardList").append("<option value="+e+">"+e+"</option>")});c.add("exception-forward-delete-all",function(e){jQuery("#removeAllDefineForward").val("true");deleteAllForwardMailList("d")});c.add("modify-ext-rule",function(j){var k={};var f=jQuery(j).data("index");var e=jQuery(j).data("address");var h=jQuery(j).data("domain");if(e==""){k.defineType="domain";k.defineValue=h}else{k.defineType="mail";k.defineValue=e}var g=new Array();jQuery("#seq"+f+" label").each(function(){g.push({forwarding_address_list:jQuery(this).text()})});k.forwarding_address_list=g;k.defineForwardingSeq=f;a.forwardModifyExcept(k)});c.add("mail-add",function(e){addMailList()});c.add("mail-delete",function(e){deleteMailList()});c.add("start-time",function(e){setStartTime()});c.add("end-time",function(e){setEndTime()});c.add("reply-mail-add",function(e){a.addReplyMail()});c.add("reply-mail-delete",function(e){jQuery(e).parent().parent().remove();deleteReplyMail()});c.add("reply-mail-delete-all",function(e){deleteReplyMailAll()});c.add("ext-mail-add",function(e){a.popupExtMailManager()});c.add("ext-mail-delete",function(f){var g=jQuery(f).attr("pop3host");var e=jQuery(f).attr("pop3id");deleteExtList(g,e)});c.add("ext-mail-modify",function(f){var h=jQuery(f).attr("pop3host");var e=jQuery(f).attr("pop3id");var g={};g.pop3Host=h;g.pop3Id=e;a.modifyExtMailManager(g)});c.add("ext-mail-delete-all",function(e){deleteAllExtList()});c.add("add-folder",function(e){addFolder()});c.add("folder",function(f){var e=jQuery(f).attr("fname");goFolder(e)});c.add("modify-folderName",function(f){closeModifyFolderArea();var e=jQuery(f).closest("tr");if(e.hasClass("edit")){e.removeClass("edit")}else{e.addClass("edit")}jQuery(f).parent().parent().hide();jQuery(f).parent().parent().next().show()});c.add("modify-folder",function(l){var h=jQuery(l).parent().attr("fid");var j=jQuery("#modify_folder_"+h);if(!validateInputValue(j,2,32,"folderName")){return}var n=j.attr("previous_name");var g=jQuery.trim(j.val());var e=jQuery("#modify_folder_"+h).data("folder-name");if(g==e){var h=jQuery(l).parent().attr("fid");var k=jQuery("#modify_folder_"+h).attr("previous_name");jQuery("#modify_folder_"+h).val(e);closeModifyFolderArea();return}var m="";if(n.indexOf(".")>0){m=n.substring(0,n.lastIndexOf(".")+1)}g=m+""+g;if(isDefaultBoxCheck(g)){jQuery.goMessage(mailMsg.alert_systemfolder);return}var f={previousName:n,newName:g};folderControl.modifyFolder(f,function(){a.loadViewFolderManage()})});c.add("modify-folder-cancel",function(f){var h=jQuery(f).parent().attr("fid");var e=jQuery("#modify_folder_"+h).data("folder-name");var g=jQuery("#modify_folder_"+h).attr("previous_name");jQuery("#modify_folder_"+h).val(e);closeModifyFolderArea()});c.add("add-tag",function(e){addMailTag()});c.add("delete-folder",function(e){var f=jQuery(e).parent().attr("fname");deleteFolder(f)});c.add("move-folder",function(e){var f=jQuery(e).parent().attr("fname");moveFolder(f,true)});c.add("empty-folder",function(e){var f=jQuery(e).parent().attr("fname");emptyFolder(f)});c.add("modify-tagName",function(j){var e=jQuery(j).attr("tagname");var g=jQuery(j).attr("tagcolor");var f=jQuery(j).attr("tagid");var h={id:f,name:e,color:g,type:"modify"};addMailTag(h)});c.add("modify-tag-cancel",function(e){var f=jQuery(e).parent().attr("fid");jQuery("#mailTagPallete").remove();jQuery("#tag_row_"+f).show();jQuery("#tag_modify_area_"+f).hide().empty()});c.add("delete-tag",function(f){var e=jQuery(f).attr("tagid");deleteMailTag(e)});c.add("backup-folder",function(e){var g=jQuery(e).parent().attr("fname");var f=jQuery(e).parent().attr("fid");startBackupFolderExcute(g,f)});c.add("download-backup",function(e){a.downloadBackupFolder()});c.add("delete-backup",function(e){a.deleteBackupFolder();jQuery("#empty_org").hide()});c.add("lastrcpts-delete",function(f){jQuery(f).closest("tr").remove();var e=jQuery(f).data("seq");deleteLastRcptExcute(e)});c.add("lastrcpts-delete-all",function(e){deleteAllLastRcptExcute()});c.add("share-folder",function(g){var j=jQuery(g).parent().attr("fname");openShareFolderSettingLayer(j,function(){a.loadViewFolderManage()});var f=("on"==jQuery(g).parent().data("share"));if(f){var e=jQuery(g).parent().data("shareseq");jQuery("#orgShareFlag").attr("checked",true);jQuery("#orgShareFlag").data("shareSeq",e);var h={folderUid:e};folderControl.getSharringReaderList(h)}});c.add("save-auto-reply",function(e){saveAutoReply()});c.add("auto-reply-cancel",function(e){a.loadViewAutoReply()});c.add("rcpt-setting-cancel",function(e){a.loadViewLastRcpt()});c.add("save-rcpt",function(e){saveLastRcptExcute()});c.add("upload-folder",function(e){upfolderName=jQuery(e).parent().attr("fname");openUploadMessageLayer()});c.add("add-sender-email",function(e){validateAddSenderEmail();if(jQuery("#mailSenderListTbody tr").length>1){jQuery("#myEmailDefault").show()}});c.add("delete-sender-item",function(e){if(jQuery(e).closest("tr").find("#defaultEmail").length>0){jQuery(".senderItem").first().after('<span id="defaultEmail">('+mailMsg.conf_userinfo_sender_email_default+")</span>")}jQuery(e).closest("tr").remove();if(jQuery("#mailSenderListTbody tr").length==0){jQuery("#mailSenderListWrap").hide()}else{if(jQuery("#mailSenderListTbody tr").length==1){jQuery("#myEmailDefault").hide()}}});c.add("default-sender-email",function(e){jQuery("#defaultEmail").remove();jQuery(e).closest("tr").find(".senderItem").after('<span id="defaultEmail">('+mailMsg.conf_userinfo_sender_email_default+")</span>")});var b=new EventControl("#mailSettingWrap","click","a, span, ins, li");b.add("basic-setting",function(e){selectSettingMenu("basic")});b.add("sign-setting",function(e){selectSettingMenu("sign")});b.add("folder-setting",function(e){selectSettingMenu("folder")});b.add("spam-setting",function(e){selectSettingMenu("spam")});b.add("auto-filter",function(e){selectSettingMenu("filter")});b.add("auto-forward",function(e){selectSettingMenu("forward")});b.add("auto-reply",function(e){selectSettingMenu("autoreply")});b.add("extMail-setting",function(e){selectSettingMenu("extmail")});b.add("last-rcpt",function(e){selectSettingMenu("lastrcpt")});var d=new EventControl("#mailSettingWrap","change","select");d.add("spam-policy",function(e){checkSpamMode()});d.add("spam-level",function(e){});d.add("spam-handle",function(e){});d.add("pop3-server-select",function(e){setPOP3Server()});d.add("change-UserFolderAging",function(h){var k=jQuery(h).data("name");var g=jQuery(h).data("preaging");var e=jQuery(h).val();var f=jQuery(h).data("index");var j={folderName:k,preAgingDay:g,agingDay:e,selectIdx:f};changeUserFolderAgingDayExcute(j,jQuery(h))});d.add("reply-mode",function(e){changeReplyMode()})};this.loadBasicSetting=function(){changeMailContainer("setting");ActionLoader.getGoLoadAction(this.basicSettingAction,null,a.printBasicSetting,"json");google.sendPageView(this.basicSettingAction)};this.printBasicSetting=function(d){setSchedulerTab("0");var b=USERLOGINEMAIL;d.myEmail='"'+d.senderName+'" <'+b+">";d.mailExposure=MAIL_EXPOSURE;if(d.useMailSender){var f=true;var e=d.senderList;if(e){for(var c=0;c<e.length;c++){if(e[c].defaultMail){f=false}}}d.myEmailDefault=f}jQuery("#mailSettingContent").handlebars("mail_setting_basic_tmpl",d);jQuery.ajax({type:"GET",url:"/api/user/available/emails",data:null,async:false,success:function(g,j){var h=jQuery("#availableEmails");jQuery(g.data).each(function(k,l){h.append("<option value="+l.email+" data-type="+l.userType+">"+l.email+"</option>")})},dataType:"json"});a.initTabScroll()};this.saveBasicInfo=function(b){ActionLoader.postGoJsonLoadAction(this.basicSettingAction,b,function(c){if(jQuery("#searchallfolder").attr("checked")){searchAllFolder="on"}else{searchAllFolder="off"}isPopupWrite=("popup"==jQuery("#composeModeSelect").val());isWriteNoti=(jQuery("#writeNoti").attr("checked"));isMailBadgeUse=(jQuery("#mailBadgeUse").attr("checked"));makeMailBadgeCount();jQuery.goSlideMessage(mailMsg.save_ok)},"json")};this.saveBasciPopupInfo=function(b){ActionLoader.postGoJsonLoadAction(this.vcardAction,b,a.messageAlert,"json")};this.savePopupVcardInfo=function(b){ActionLoader.postGoJsonLoadAction(this.vcardAction,b,a.vcardMessagevAlert,"json")};this.saveSpamInfo=function(b){ActionLoader.postGoJsonLoadAction(this.spamRuleAction,b,function(c){jQuery.goSlideMessage(mailMsg.save_ok)},"json")};this.resultDialog=function(b){if(b.isSuccess){jQuery.goSlideMessage(b.isSuccess)}else{jQuery.goSlideMessage(b.isFail,"caution")}};this.filterMessageAlert=function(b){if(b.result){if(b.msg){jQuery.goSlideMessage(b.msg)}else{jQuery.goSlideMessage(mailMsg.common_job_success)}}else{if(b.msg){jQuery.goSlideMessage(b.msg,"caution")}}a.loadViewFilter()};this.messageAlert=function(b){if(b.result){if(b.msg){jQuery.goAlert(b.msg)}else{jQuery.goAlert(mailMsg.common_job_success)}}else{if(b.msg){jQuery.goAlert(b.msg)}}};this.extMessageAlert=function(b){if(b.isSuccess){if(b.msg){jQuery.goAlert(b.msg)}else{jQuery.goAlert(mailMsg.common_job_success)}jQuery.goPopup.close()}else{if(b.msg){jQuery.goAlert(b.msg);return false}}};this.vcardMessagevAlert=function(b){jQuery.goAlert(mailMsg.save_ok)};this.saveForwardMessageAlert=function(b){if(b.result){jQuery.goSlideMessage(b.msg)}else{if(b.msg){jQuery.goSlideMessage(b.msg,"caution")}}a.loadViewForward()};this.settingDefaultSign=function(b){ActionLoader.postGoLoadAction(this.defaultSignAction,b,function(c){jQuery.goSlideMessage(mailMsg.save_ok);a.loadViewSign()},"json")};this.modifySign=function(b){ActionLoader.postGoLoadAction(this.signAction,b,function(c){a.loadViewSign();jQuery.goSlideMessage(mailMsg.save_ok)},"json")};this.deleteSignData=function(b){ActionLoader.postGoLoadAction(this.deleteSignDataAction,b,function(c){a.loadViewSign();jQuery.goSlideMessage(mailMsg.del_ok)},"json")};this.deleteAllSignData=function(){ActionLoader.postGoLoadAction(this.deleteAllSignDataAction,null,function(b){a.loadViewSign();jQuery.goSlideMessage(mailMsg.del_ok)},"json")};this.addSignData=function(){var c={useFlash:hasFlashPlayer()};var b=jQuery("#mail_setting_modify_sign_modal").length;if(!b){jQuery.goPopup({id:"mail_setting_modify_sign_modal",width:700,isLock:true,offset:{top:"10px",left:"25%"},pclass:"layer_normal layer_sign",header:mailMsg.conf_profile_66,contents:getHandlebarsTemplate("mail_setting_modify_sign_modal_tmpl",c),openCallback:function(){settingEditorBoxScript();jQuery("#signSelectMode").show();jQuery("#registSignImage").show();jQuery("#signText").hide();jQuery("#signHtml").show();jQuery("#signImgSizeText").show();jQuery("#onlySignImgSize").hide();jQuery("#signWriteType").val("write");var e=jQuery(window).height()-200;jQuery("#mail_setting_modify_sign_modal .content").css({height:e+"px","overflow-y":"scroll"});jQuery("#mail_setting_modify_sign_modal table.form_type").on("change","select, input, span",function(g){var f=jQuery(this).attr("evt-rol");if(!f){return}if(f=="change-SignMode"){changeSignMode()}else{if(f=="change-onlyImageSignMode"){changeOnlyImageSignMode()}else{if(f=="changeImgSize"){changeImgSize()}}}});jQuery("#mail_setting_modify_sign_modal table.form_type").on("click","span",function(g){var f=jQuery(this).attr("evt-rol");if(!f){return}if(f=="upload-SignImage"){selectSignImage()}});jQuery("#sign_img_delete").on("click",function(){deleteThumbnailImage();jQuery("#sign_img_delete").hide()});var d={locale:LOCALE};if(hasFlashPlayer()){signSettingControl=new SignSettingControl(d)}else{signSettingControl=new SignSimpleSettingControl(d);jQuery("#mailSimpleSignImageUpload").fileupload({url:"/api/mail/image/upload",formData:{uploadType:"flash",maxImageSize:jQuery("#maxImageSize").val()},dataType:"json",pasteZone:null,done:function(h,g){var f=g.result;if(f.errorMessage==""){jQuery("#thumbnail_image").attr("src",f.fileURL).attr("img-data",f.filePath).attr("img-name",f.fileName);jQuery("#sign_img_delete").show()}else{jQuery.goSlideMessage(f.errorMessage,"caution")}}})}signSettingControl.makeBtnControl()},closeCallback:function(){settingEditorBoxDestroy();a.destroySignAttach();jQuery("#mail_setting_modify_sign_modal div.content").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:saveSign},{btype:"cancel",btext:mailMsg.comn_cancel}],toggleTrigger:false})}};this.destroySignAttach=function(){if(signSettingControl){var c=jQuery("#registSignImage object").length==0?false:true;if(c){try{signSettingControl.destroy()}catch(b){console.log(b)}}}};this.saveSignData=function(b){ActionLoader.postGoJsonLoadAction(this.signDataAction,b,function(c){a.loadViewSign();jQuery.goSlideMessage(mailMsg.save_ok)},"json")};this.loadViewSign=function(){changeMailContainer("setting");ActionLoader.getGoLoadAction(this.signAction,null,a.printViewSign,"json");google.sendPageView(this.signAction)};this.printViewSign=function(b){setSchedulerTab("1");jQuery("#mailSettingContent").handlebars("mail_setting_sign_tmpl",b);a.initTabScroll()};this.printViewSignData=function(b){setSchedulerTab("1");jQuery("#mailSettingContent").handlebars("mail_setting_sign_data_tmpl",b)};this.loadWriteSignData=function(){ActionLoader.postLoadAction(this.writeSignDataAction,null,a.printSignDataAction,"json")};this.loadModifySignData=function(b){ActionLoader.getGoLoadAction(this.signDataAction,{signSeq:b},a.modifySignData,"json")};this.modifySignData=function(c){c.useFlash=hasFlashPlayer();var b=jQuery("#mail_setting_modify_sign_modal").length;if(!b){jQuery.goPopup({id:"mail_setting_modify_sign_modal",width:700,isLock:true,offset:{top:"10px",left:"25%"},pclass:"layer_normal layer_sign",header:mailMsg.conf_sign_edit,contents:getHandlebarsTemplate("mail_setting_modify_sign_modal_tmpl",c),openCallback:function(){var f=c.signType;if(f=="image"||f=="image_full"){jQuery("#signText").hide();jQuery("#signHtml").hide();jQuery("#signSelectMode").hide();jQuery("#signImgSizeText").hide();jQuery("#onlySignImgSize").show();jQuery("#thumbnail_image").removeAttr("width");jQuery("#thumbnail_image").removeAttr("height");jQuery("#thumbnailImageWrap").height("170px");if(f=="image"){jQuery("#thumbnail_image").css({width:"350px",height:"170px"});jQuery("#signImageSizeDesc").text("350 x 170")}jQuery("#sign_only_image").attr("checked","checked")}else{jQuery("#signSelectMode").show();jQuery("#registSignImage").show();var e=jQuery("#sign_mode").val();if(e=="html"){jQuery("#signText").hide();jQuery("#signHtml").show();settingEditorBoxScript(null,c.signText)}else{jQuery("#signText").show();jQuery("#signHtml").hide()}jQuery("#onlySignImgSize").hide();jQuery("#thumbnailImageWrap").height("120px");jQuery("#thumbnail_image").css({width:"100px",height:"120px"});jQuery("#signImageSizeDesc").text("100 x 120")}jQuery("#signWriteType").val("modify");var g=jQuery(window).height()-200;jQuery("#mail_setting_modify_sign_modal .content").css({height:g+"px","overflow-y":"scroll"});jQuery("#mail_setting_modify_sign_modal table.form_type").on("change","select, input, span",function(j){var h=jQuery(this).attr("evt-rol");if(!h){return}if(h=="change-SignMode"){changeSignMode()}else{if(h=="change-onlyImageSignMode"){changeOnlyImageSignMode(c.signText)}else{if(h=="changeImgSize"){changeImgSize()}}}});jQuery("#mail_setting_modify_sign_modal table.form_type").on("click","span",function(j){var h=jQuery(this).attr("evt-rol");if(!h){return}if(h=="upload-SignImage"){selectSignImage()}});jQuery("#sign_img_delete").on("click",function(){deleteThumbnailImage();jQuery("#sign_img_delete").hide()});var d={width:(LOCALE=="jp")?90:73};if(hasFlashPlayer()){signSettingControl=new SignSettingControl(d)}else{signSettingControl=new SignSimpleSettingControl(d);jQuery("#mailSimpleSignImageUpload").fileupload({url:"/api/mail/image/upload",formData:{uploadType:"flash",maxImageSize:jQuery("#maxImageSize").val()},dataType:"json",pasteZone:null,done:function(k,j){var h=j.result;if(h.errorMessage==""){jQuery("#thumbnail_image").attr("src",h.fileURL).attr("img-data",h.filePath).attr("img-name",h.fileName);jQuery("#sign_img_delete").show()}else{jQuery.goSlideMessage(h.errorMessage,"caution")}}})}signSettingControl.makeBtnControl()},closeCallback:function(){settingEditorBoxDestroy();signSettingControl.destroy();jQuery("#mail_setting_modify_sign_modal div.content").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:saveSign},{btype:"cancel",btext:mailMsg.comn_cancel}],toggleTrigger:false})}};this.printSavaSignDataResult=function(b){if(b.isSuccess=="success"){jQuery.goAlert("success")}};this.loadViewFolderManage=function(){changeMailContainer("setting");ActionLoader.getGoLoadAction(a.folderManageAction,null,a.viewFolderSetting,"json");google.sendPageView(this.folderManageAction)};this.viewFolderSetting=function(b){setSchedulerTab("2");jQuery("#mailSettingContent").handlebars("mail_setting_folder_tmpl",b.folderListModel);if(!useSharedfolder){jQuery("#folderManageWrap .shareFolder").hide()}if(b.backupModel&&b.backupModel.folderName){backupStatusId=b.backupModel.folderName}a.checkBackup(b.backupModel);a.printBackupFolderInfo(b.backupModel);a.processBackupFolder();a.initTabScroll()};this.initTabScroll=function(){jQuery("#mailSettingContent").css({"overflow-y":"auto",height:(jQuery(window).height()-175)+"px"})};this.messageResult=function(b){if(b.msg=="success"){jQuery.goAlert("success")}else{jQuery.goAlert(b.msg)}};this.changeUserFolderAgingDay=function(b){ActionLoader.postLoadAction(this.changeUserFolderAgingAction,b,function(c){jQuery.goMessage(mailMsg.common_job_change)},function(){jQuery.goMessage(mailMsg.conf_pop_56)},"json")};this.startBackupFolder=function(b){b.type="start";a.printBackupFolderInfo(b);ActionLoader.postGoLoadAction(this.startBackupFolderAction,b,a.resultStartBackupProcess,"json")};this.resultStartBackupProcess=function(b){isBackup=false;if(!b.error){isBackup=true;backupFolderName=b.folderName;backupFolderEncName=b.folderEncName;a.processBackupFolder()}a.printBackupFolderInfo(b);backupWork=false};this.processBackupFolder=function(){if(isBackup){backupInterval=setTimeout(function(){a.statusBackupFolder()},3000)}};this.checkBackup=function(b){if(b.processing){isBackup=true}else{isBackup=false}if(b.complate){isBackupComplete=true}else{isBackupComplete=false}if(b.folderName){backupFolderName=b.folderName;backupFolderEncName=b.folderEncName}};this.statusBackupFolder=function(){ActionLoader.getGoLoadAction(this.statusBackupFolderAction,null,function(b){if(b.error){isBackup=false;b.folderEncName=backupFolderEncName}else{if(b.complate){isBackup=false;isBackupComplete=true}a.processBackupFolder()}a.printBackupFolderInfo(b)},"json")};this.printBackupFolderInfo=function(d){var b=getFolderNameId(d.folderEncName);if(!d.error&&d.type=="start"){jQuery("#startBackup_graph_"+b).parent().show();jQuery("#startBackup_graph_"+b).css("width","0%");jQuery("#startBackup_"+b+" span.desc").text(mailMsg.mail_backup_process);jQuery("#startBackup_"+b).show()}else{if(d.type=="start"){jQuery("#startBackup_graph_"+b).parent().hide();jQuery("#startBackup_"+b+" span.desc").text(mailMsg.mail_backup_start);jQuery("#startBackup_"+b).show()}else{if(d.error){jQuery("#startBackup_graph_"+b).parent().hide();jQuery("#startBackup_"+b+" span.desc").text(mailMsg.mail_backup_error)}else{if(d.complate){var c=d.folderName.split(".");var e=c[c.length-1];var f='"'+e+'" '+mailMsg.mail_backup_complete+" ("+d.fileSizeFormat+")";if(jQuery("#startBackup_graph_"+b).length==0){jQuery("#empty_org").show();jQuery("#empty_msg").append(f)}else{jQuery("#startBackup_graph_"+b).css("width","100%");jQuery("#startBackup_"+b).hide();jQuery("#completeBackup_"+b+" span.desc").text(f);jQuery("#completeBackup_"+b).show()}}else{if(d.processing){jQuery("#startBackup_"+b).show();jQuery("#startBackup_graph_"+b).css("width",d.percent+"%")}else{jQuery("#startBackup_"+b).hide();jQuery("#completeBackup_"+b).hide()}}}}}};this.downloadBackupFolder=function(){isBackup=false;isBackupComplete=false;a.printBackupFolderInfo({folderName:backupFolderName,folderEncName:backupFolderEncName});jQuery("#reqFrame").attr("src",this.downloadBackupFolderAction)};this.deleteBackupFolder=function(){isBackup=false;isBackupComplete=false;a.printBackupFolderInfo({folderName:backupFolderName,folderEncName:backupFolderEncName});ActionLoader.postGoLoadAction(this.deleteBackupFolderAction,null,function(b){if(!b.error){jQuery.goAlert(mailMsg.alert_backup_delete_success)}else{jQuery.goAlert(mailMsg.alert_backup_delete_error)}isBackup=false;isBackupComplete=false;a.processBackupFolder();backupWork=false},"json")};this.loadViewSapmRule=function(){changeMailContainer("setting");ActionLoader.getGoLoadAction(this.spamRuleAction,null,a.viewSpamRuleSetting,"json");google.sendPageView(this.spamRuleAction)};this.viewSpamRuleSetting=function(c){setSchedulerTab("3");var b=getSpamPolicy(c);c.spamPolicyValue=b;jQuery("#mailSettingContent").handlebars("mail_setting_spam_tmpl",c);checkSpamMode();a.initTabScroll()};this.saveSpamInfo=function(b){ActionLoader.postGoJsonLoadAction(this.spamRuleAction,b,function(c){jQuery.goSlideMessage(mailMsg.save_ok)},"json")};this.loadViewFilter=function(){changeMailContainer("setting");ActionLoader.getGoLoadAction(this.filterAction,null,a.viewFilterSetting,"json");google.sendPageView(this.filterAction)};this.viewFilterSetting=function(b){setSchedulerTab("4");b.smartFilter=smartFilter;jQuery("#mailSettingContent").handlebars("mail_setting_filter_tmpl",b);a.initTabScroll()};this.saveFilterInfo=function(b){ActionLoader.postGoJsonLoadAction(this.saveFilterApplyAction,b,function(){jQuery.goSlideMessage(mailMsg.save_ok)},"json")};this.loadViewForward=function(){changeMailContainer("setting");ActionLoader.getGoLoadAction(this.forwardAction,null,a.viewForwardSetting,"json")};this.saveForwardInfo=function(b){ActionLoader.postGoJsonLoadAction(this.forwardAction,b,function(c){jQuery.goSlideMessage(mailMsg.save_ok);a.loadViewForward()},"json")};this.saveDefineForwardInfo=function(b){ActionLoader.postGoJsonLoadAction(this.saveDefineForwardAction,b,function(c){jQuery.goSlideMessage(mailMsg.save_ok);a.loadViewForward()},"json")};this.viewForwardSetting=function(b){setSchedulerTab("5");maxForwaringCount=b.maxForwaringCount;jQuery("#mailSettingContent").handlebars("mail_setting_forward_tmpl",b);a.initTabScroll()};this.deleteFilterRule=function(b){ActionLoader.postGoLoadAction(this.deleteFilterAction,b,function(){jQuery.goSlideMessage(mailMsg.del_ok);a.loadViewFilter()},"json")};this.loadViewAutoReply=function(){changeMailContainer("setting");ActionLoader.getGoLoadAction(this.autoReplyAction,null,a.viewAutoReplySetting,"json");google.sendPageView(this.autoReplyAction)};this.addReplyMail=function(){var b=jQuery("#mail_setting_mailadd").length;if(!b){jQuery.goPopup({id:"mail_setting_mailadd",pclass:"layer_normal layer_add_mailbox",header:mailMsg.conf_spamrule_47,contents:getHandlebarsTemplate("mail_setting_mailadd_tmpl"),openCallback:function(){},closeCallback:function(){jQuery("#mail_setting_mailadd div.content").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:saveMailAdd},{btype:"cancel",btext:mailMsg.comn_cancel}]})}};this.viewAutoReplySetting=function(b){setSchedulerTab("6");jQuery("#mailSettingContent").handlebars("mail_setting_reply_tmpl",b);jQuery("#startTime").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearSuffix:""});jQuery("#endTime").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearSuffix:""});a.initTabScroll()};this.saveAutoReply=function(b){ActionLoader.postGoJsonLoadAction(this.autoReplyAction,b,function(){jQuery.goSlideMessage(mailMsg.save_ok)},"json")};this.loadViewExtMail=function(){changeMailContainer("setting");ActionLoader.getGoLoadAction(this.extMailsAction,null,a.viewExtMailSetting,"json");google.sendPageView(this.extMailsAction)};this.viewExtMailSetting=function(b){setSchedulerTab("7");installLocale=b.installLocale;jQuery("#mailSettingContent").handlebars("mail_setting_ext_tmpl",b);a.initTabScroll()};this.deleteExtRule=function(b){ActionLoader.postGoJsonLoadAction(this.deleteExtMailAction,b,function(c){jQuery.goSlideMessage(mailMsg.del_ok);a.loadViewExtMail()},"json")};this.deleteAllExtRule=function(){ActionLoader.postGoJsonLoadAction(this.deleteAllExtMailAction,null,function(b){jQuery.goSlideMessage(mailMsg.del_ok);a.loadViewExtMail()},"json")};this.loadViewLastRcpt=function(){changeMailContainer("setting");ActionLoader.getGoLoadAction(this.lastRcptAction,null,a.viewLastRcptSetting,"json");google.sendPageView(this.lastRcptAction)};this.viewLastRcptSetting=function(b){setSchedulerTab("8");b.mailExposure=MAIL_EXPOSURE;b.companyDomainList=companyDomainList;jQuery("#mailSettingContent").handlebars("mail_setting_rcpt_tmpl",b);a.initTabScroll()};this.deleteLastRcpt=function(b){ActionLoader.postGoLoadAction(this.lastRcptAction,b,function(c){jQuery.goSlideMessage(mailMsg.save_ok);a.loadViewLastRcpt()},"json")};this.loadManageVcard=function(){ActionLoader.getGoLoadAction(this.vcardAction,null,a.manageVcard,"json")};this.manageVcard=function(b){b.useFlash=hasFlashPlayer();var c=jQuery.goPopup({id:"mail_setting_modal_popup",width:700,pclass:"layer_normal layer_nameCard",header:mailMsg.conf_sign_13,contents:getHandlebarsTemplate("mail_setting_modal_tmpl",b),openCallback:function(){jQuery("#mail_setting_modal_popup div.content").on("click","input, span, a",function(g){var f=jQuery(this).attr("evt-rol");if(f=="add-folder-select-parent"){if(jQuery(this).attr("checked")){jQuery("#addFolderParentSelect").attr("disabled",false)}else{jQuery("#addFolderParentSelect").attr("disabled",true)}}else{if(f=="basic-upload-photo"){selectPicture()}else{if(f=="delete-photo"){deleteThumbnailImage();jQuery("#vcard_img_delete").hide()}else{if(f=="detail-addr"){toggleAddressLayer("office")}else{if(f=="detail-home-addr"){toggleAddressLayer("home")}}}}}});jQuery("#mail_setting_modal_popup div.content").on("change","select",function(h){var g=jQuery(this).attr("evt-rol");if(g=="select-item"){var f=jQuery(this).find("option:selected");var l=f.val();if(l&&l!=""){var k=f.text();var j={itemName:k,itemId:l};var e=jQuery("#tbody #"+l).length==0?true:false;if(e){jQuery("#selectAddItem").before(getHandlebarsTemplate("addr_member_view_add_item_tmpl",j))}f.remove()}}});var d={locale:LOCALE};if(hasFlashPlayer()){simpleBasicControl=new SimpleBasicControl(d)}else{simpleBasicControl=new UploadSimpleBasicControl(d);jQuery("#mailSimpleVcardImageUpload").fileupload({url:"/api/mail/image/upload",formData:{uploadType:"flash",maxImageSize:jQuery("#maxImageSize").val()},dataType:"json",pasteZone:null,done:function(h,g){var f=g.result;if(f.errorMessage==""){jQuery("#thumbnail_image").attr("src",f.fileURL).attr("img-data",f.filePath).attr("img-name",f.fileName);jQuery("#vcard_img_delete").show()}else{jQuery.goSlideMessage(f.errorMessage,"caution")}}})}simpleBasicControl.makeBtnControl()},closeCallback:function(){jQuery("#mail_setting_modal_popup div.content").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:modifyVcardInfo},{btype:"cancel",btext:mailMsg.comn_cancel}]});c.reoffset();jQuery("#mail_setting_modal_popup").css("margin-left","-350px")};this.forwardExcept=function(b){jQuery.goPopup({id:"mail_forward_except_modal_popup",width:700,pclass:"layer_normal layer_except",header:mailMsg.conf_forward_38,contents:getHandlebarsTemplate("mail_forward_except_modal_tmpl",b),openCallback:function(){jQuery("#defineForwardingSeq").attr("value",b.forward_list_num);jQuery("#mail_forward_except_modal_popup div.content").on("click","input, span, a",function(d){var c=jQuery(this).attr("evt-rol");if(c=="forward-except-add"){addExceptForwardList()}else{if(c=="forward-except-delete"){deleteSelectList()}else{if(c=="forward-except-all-delete"){deleteAllList()}}}})},closeCallback:function(){jQuery("#mail_forward_except_modal_popup div.content").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:saveDefineForwardInfo},{btype:"cancel",btext:mailMsg.comn_cancel}]})};this.forwardModifyExcept=function(b){jQuery.goPopup({id:"mail_forward_except_modify_modal_popup",width:700,pclass:"layer_normal layer_except",header:mailMsg.conf_forward_39,contents:getHandlebarsTemplate("mail_forward_except_modal_tmpl",b),openCallback:function(){jQuery("#mail_forward_except_modify_modal_popup div.content").on("click","input, span, a",function(f){var d=jQuery(this).attr("evt-rol");if(d=="forward-except-add"){var c=jQuery("#defineForwardingAddressText").val();addExceptForwardList(c)}else{if(d=="forward-except-delete"){deleteSelectList()}else{if(d=="forward-except-all-delete"){deleteAllList()}}}})},closeCallback:function(){jQuery("#mail_forward_except_modify_modal_popup div.content").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:saveDefineForwardInfo},{btype:"cancel",btext:mailMsg.comn_cancel}]})};this.loadFilterManager=function(){var b={};a.filterManager(b)};this.filterManager=function(d){var b=folderControl.getUserFolderList();var e=folderControl.getTagData();d.folderList=b;d.tagList=e;jQuery.goPopup({id:"mail_setting_modal_filter",width:600,pclass:"layer_normal layer_autoSort",header:mailMsg.menu_conf_filter,contents:getHandlebarsTemplate("mail_setting_modal_filter_tmpl",d),openCallback:function(){jQuery("#mail_setting_modal_filter input[placeholder]").placeholder();jQuery("#mail_setting_modal_filter div.content").on("click","input, a",function(l){var k=jQuery(this).attr("evt-rol");var g=jQuery("#settingFilterSaveFolder");var f=jQuery("#settingFilterSaveNewFolder");var m=jQuery("#settingFilterInputBoxName");var j=jQuery("#settingFilterTagList");var h=jQuery("#settingFilterNewTagName");if(k=="move-folder"){g.attr("disabled",false);f.attr("disabled",true);m.attr("disabled",true);j.attr("disabled",true);h.attr("disabled",true)}else{if(k=="move-newFolder"){g.attr("disabled",true);f.attr("disabled",false);m.attr("disabled",false);j.attr("disabled",true);h.attr("disabled",true)}else{if(k=="set-tag"){g.attr("disabled",true);f.attr("disabled",true);m.attr("disabled",true);j.attr("disabled",false);h.attr("disabled",true)}else{if(k=="set-new-tag"){g.attr("disabled",true);f.attr("disabled",true);m.attr("disabled",true);j.attr("disabled",true);h.attr("disabled",false)}}}}});bindFilterInputEvent();jQuery("#mail_setting_modal_filter div.layer_pallete").on("click","a",function(f){jQuery("#mail_setting_modal_filter div.layer_pallete a").removeClass("active");jQuery(this).addClass("active")});if(d.policy){if(!d.tagPolicy){jQuery("#settingFilterTagList").attr("disabled",true);jQuery("#settingFilterSaveFolder").val(d.policy.replace("move ",""));jQuery("#settingFilterFolderSave").attr("checked","checked")}else{if(d.tagPolicy){jQuery("#settingFilterSaveFolder").attr("disabled",true);jQuery("#settingFilterTagList").attr("disabled",false).val(d.policy.replace("tag ",""));jQuery("#settingFilterSetTag").attr("checked","checked")}}}if(d.subcondList&&d.subcondList.length>1){jQuery("#settingFilterCondOperationWrap").show()}},closeCallback:function(){unbindFilterInputEvent();jQuery("#mail_setting_modal_filter div.layer_pallete").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:saveFilter},{btype:"cancel",btext:mailMsg.comn_cancel}]});var c=jQuery("#mail_setting_modal_filter").css("margin-top");c=Number(c.substring(0,c.indexOf("px")));jQuery("#mail_setting_modal_filter").css("margin-top",(c+55)+"px")};this.modifyFilterManager=function(b){ActionLoader.getGoLoadAction(this.selectFilterAction,b,a.filterManager,"json")};this.saveAutoFilter=function(b){ActionLoader.postGoJsonLoadAction(a.filterAction,b,function(c){jQuery.goPopup.close();jQuery.goMessage(mailMsg.save_ok);a.loadViewFilter();folderControl.getFolderInfo();folderControl.getTagList()},"json",function(c){if(c.name=="DuplicatedException"){jQuery.goMessage(mailMsg.conf_filter_exist)}else{jQuery.goMessage(mailMsg.save_fail)}})};this.saveExtMailSetting=function(b){ActionLoader.postGoJsonLoadAction(this.extMailAction,b,function(c){jQuery.goPopup.close();jQuery.goSlideMessage(mailMsg.save_ok);a.loadViewExtMail();folderControl.getFolderInfo()},"json")};this.popupExtMailManager=function(){var b={pop3Port:""};a.extMailManager(b)};this.extMailManager=function(b){b.folderList=folderControl.getUserFolderList();b.locale=installLocale;jQuery.goPopup({id:"mail_ext_setting_modal",width:650,pclass:"layer_normal layer_outMail",header:mailMsg.conf_pop_9,contents:getHandlebarsTemplate("mail_ext_setting_modal_tmpl",b),openCallback:function(){if(b.pop3Boxname){jQuery("#saveFolder").val(b.pop3Boxname.replace("move ",""))}if(installLocale=="jp"){jQuery("#pop3Id").attr("disabled",false);jQuery("#pop3Port").attr("disabled",false);jQuery("#pop3Host").attr("disabled",false);jQuery("#sslCheck").attr("disabled",false);jQuery("#pop3Pw").attr("disabled",false);jQuery("pop3Del1").attr("disabled",false);jQuery("pop3Del2").attr("disabled",false);setPOP3Server()}jQuery("#mail_ext_setting_modal div.content").on("change","select, input",function(f){var d=jQuery(this).attr("evt-rol");if(!d){return}if(d=="pop3-server-select"){var c=jQuery("#pop3List option:selected").val();if(c!="none"){jQuery("#pop3Id").attr("disabled",false);jQuery("#pop3Port").attr("disabled",false);jQuery("#pop3Host").attr("disabled",false);jQuery("#sslCheck").attr("disabled",false);jQuery("#pop3Pw").attr("disabled",false);jQuery("pop3Del1").attr("disabled",false);jQuery("pop3Del2").attr("disabled",false);setPOP3Server()}else{jQuery("#pop3Id").attr("disabled",true);jQuery("#pop3Id").val("");jQuery("#pop3Port").attr("disabled",true);jQuery("#pop3Port").val("");jQuery("#pop3Host").attr("disabled",true);jQuery("#pop3Host").val("");jQuery("#sslCheck").attr("disabled",true);jQuery("#sslCheck").attr("checked",false);jQuery("#pop3Pw").attr("disabled",true);jQuery("#pop3Pw").val("")}}else{if(d=="ssl-check"){changeSslSelect()}}});jQuery("#mail_ext_setting_modal div.content").on("click","input",function(d){var c=jQuery(this).attr("evt-rol");if(!c){return}if(c=="create-new-folder"){checkBox()}})},closeCallback:function(){jQuery("#mail_filter_modal_popup div.content").off()},buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:saveExtMailManager},{btype:"cancel",btext:mailMsg.comn_cancel}]})};this.modifyExtMailManager=function(b){ActionLoader.getGoLoadAction(this.extMailAction,b,a.extMailManager,"json")}};function selectSettingMenu(a){checkEscapeWriteMode(function(){changeMailContainer("setting");currentMenu="setting";currentMenuType=a;selectCurrentFolderName("");var b={type:"setting",name:mailMsg.location_conf};makeMailHeaderMessege(b);switch(a){case"basic":mailSettingControl.loadBasicSetting();break;case"sign":mailSettingControl.loadViewSign();break;case"folder":mailSettingControl.loadViewFolderManage();break;case"spam":mailSettingControl.loadViewSapmRule();break;case"filter":mailSettingControl.loadViewFilter();break;case"forward":mailSettingControl.loadViewForward();break;case"autoreply":mailSettingControl.loadViewAutoReply();break;case"extmail":mailSettingControl.loadViewExtMail();break;case"lastrcpt":mailSettingControl.loadViewLastRcpt();break}})}function toggleAddressLayer(a){if(jQuery("#detail"+a+"AddressLayerWrap").css("display")=="none"){makeAddressLayer(a)}else{closeAddressLayer(a)}}function makeAddressLayer(a){jQuery("#detail"+a+"AddressLayerWrap").show();jQuery("#detail"+a+"AddressLayerWrap").handlebars("addr_address_layer_view_tmpl",{type:a});jQuery("#detail"+a+"AddressLayerWrap").on("click","a,span",function(c){c.preventDefault();var b=jQuery(this).attr("evt-rol");if(b=="closeDetailAddress"){closeAddressLayer(a)}else{if(b=="inputDetailAddress"){if(!setAddressData(a)){return}closeAddressLayer(a)}}})}function closeAddressLayer(a){jQuery("#detail"+a+"AddressLayerWrap").hide();jQuery("#detail"+a+"AddressLayerWrap").off()}function addExtForwardInfo(){saveForwardInfo()}function saveDefineForwardInfo(){saveDefineForwardInfo()}function filterTagToolbar(){var a=mailSettingControl.getTagData();mailSettingControl.makeToolbarTagList(a)}function initSettingFunction(){initSettingMenuDispaly();mailSettingControl=new MailSettingControl();initSettingService()}function initSettingMenuDispaly(){if(!useGroupForwarding){jQuery("#auto-forward-menu").hide()}if(!useExternal){jQuery("#auto-extMail-setting").hide();jQuery("#extmail-download-menu").hide()}if(!useAutoreply){jQuery("#auto-reply-menu").hide()}}function initSettingService(){mailSettingControl.makeMailEvent()}function setSchedulerTab(a){jQuery(".tab_menu_wrap li").removeClass();jQuery(".tab_menu_wrap li:eq("+a+")").addClass("active")}function defaultUserSetting(){jQuery("#hiddenimg").attr("checked",true);jQuery("#hiddentag").attr("checked",true);jQuery("#searchallfolder").attr("checked",false);jQuery("#saveSendBox").attr("checked",true);jQuery("#notSaveSendBox").attr("checked",false);jQuery("#receiveNoti").attr("checked",true);jQuery("#notUseReceiveNoti").attr("checked",false);jQuery("#wmodeSelect").val("HTML");jQuery("#composeModeSelect").val("normal");jQuery("#encodingSelect").val("UTF-8");jQuery("#writeNoti").attr("checked",false);jQuery("#notUseWriteNoti").attr("checked",true);var a=jQuery("#senderName").val();jQuery("#senderNameInfo").val(a);var a=jQuery("#senderEmail").val();jQuery("#senderEmailInfo").val(a);jQuery("#vcardAttach").attr("checked",true);jQuery("#mailBadgeUse").attr("checked",false);jQuery("#listViewCc").attr("checked",false);if(jQuery("#replyToSameMail").is(":visible")){jQuery("#replyToSameMail").attr("checked",true);jQuery("#senderEmailInfo").attr("disabled",true)}jQuery("#defaultEmail").remove();jQuery("#myEmailDefault").closest("tr").find(".senderItem").after('<span id="defaultEmail">('+mailMsg.conf_userinfo_sender_email_default+")</span>")}function modifyUserInfo(){var a=getUserInfo();mailSettingControl.saveBasciPopupInfo(a)}function modifyVcardInfo(){var a=getUserInfo();if(!isValidAddressInfo(a)){return}mailSettingControl.savePopupVcardInfo(a)}function modifyUserAddrInfo(){var a=getUserAddrInfo();mailSettingControl.saveBasciPopupInfo(a)}function setAddressData(d){var g=jQuery("#"+d+"Country").val();var e=jQuery("#"+d+"State").val();var f=jQuery("#"+d+"City").val();var c=jQuery("#"+d+"PostalCode").val();var a=jQuery("#"+d+"Street").val();if(!checkInputLength("jQuery",jQuery("#"+d+"Country"),"",0,128,true)){jQuery("#"+d+"Country").focus();return false}if(!checkInputValidate("jQuery",jQuery("#"+d+"Country"),"onlyBack")){jQuery("#"+d+"Country").focus();return false}if(!checkInputLength("jQuery",jQuery("#"+d+"State"),"",0,128,true)){jQuery("#"+d+"State").focus();return false}if(!checkInputValidate("jQuery",jQuery("#"+d+"State"),"onlyBack")){jQuery("#"+d+"State").focus();return false}if(!checkInputLength("jQuery",jQuery("#"+d+"City"),"",0,128,true)){jQuery("#"+d+"City").focus();return false}if(!checkInputValidate("jQuery",jQuery("#"+d+"City"),"onlyBack")){jQuery("#"+d+"City").focus();return false}if(!checkInputLength("jQuery",jQuery("#"+d+"Street"),"",0,128,true)){jQuery("#"+d+"Street").focus();return false}if(!checkInputValidate("jQuery",jQuery("#"+d+"Street"),"onlyBack")){jQuery("#"+d+"Street").focus();return false}if(jQuery("#"+d+"PostalCode").val()!=""){if(!checkInputValidate("jQuery",jQuery("#"+d+"PostalCode"),"number")){return false}}var b="";if(g){jQuery("#"+d+"Country").val(g);b+=g+" "}if(e){jQuery("#"+d+"State").val(e);b+=e+" "}if(f){jQuery("#"+d+"City").val(f);b+=f+" "}if(c){jQuery("#"+d+"PostalCode").val(c);b+=c+" "}if(a){jQuery("#"+d+"Street").val(a);b+=a}if(d=="office"){jQuery("#officeBasicAddress").val(b)}else{if(d=="home"){jQuery("#homeAddress").val(b)}}jQuery("#"+d+"AddressTemp").val(b);return true}function getUserInfo(){var p={};var c=jQuery("#firstName").val();var v=jQuery("#lastName").val();var g=jQuery("#memberName").val();var t=jQuery("#memberEmail").val();var D=jQuery("#titleName").val();var C=jQuery("#companyName").val();var h=jQuery("#departmentName").val();var t=jQuery("#memberEmail").val();var w=jQuery("#mobileNo").val();var o=jQuery("#officeTel").val();var y=jQuery("#description").val();var d=jQuery("#homeCountry").val();var q=jQuery("#homePostalCode").val();var n=jQuery("#homeState").val();var r=jQuery("#homeCity").val();var z=jQuery("#homeStreet").val();var x=jQuery("#officeCountry").val();var b=jQuery("#officePostalCode").val();var B=jQuery("#officeState").val();var a=jQuery("#officeCity").val();var m=jQuery("#officeStreet").val();var l=jQuery("#homeTel").val();var A=jQuery("#officeHomepage").val();var f=jQuery("#messenger").val();var k=jQuery("#thumbnail_image").attr("img-data");if(c){p.firstName=c}if(v){p.lastName=v}if(g){p.memberName=g}if(t){p.memberEmail=t}if(D){p.titleName=D}if(C){p.companyName=C}if(h){p.departmentName=h}if(t){p.memberEmail=t}if(w){p.mobileNo=w}if(o){p.officeTel=o}if(l){p.homeTel=l}if(f){p.messenger=f}if(A){p.officeHomepage=A}var s=jQuery("#homeAddressTemp").val();var u=jQuery("#homeAddress").val();if(s==""){if(u){p.homeExtAddress=u}p.homeCountry="";p.homePostalCode="";p.homeCity="";p.homeState=""}if(s==u){if(d){p.homeCountry=d}if(q){p.homePostalCode=q}if(n){p.homeState=n}if(r){p.homeCity=r}}var j=jQuery("#officeAddressTemp").val();var e=jQuery("#officeBasicAddress").val();if(j==""){if(e){p.officeExtAddress=e}}if(j!=""&&j!=e){if(e){p.officeExtAddress=e}}if(j==e){if(x){p.officeCountry=x}if(b){p.officePostalCode=b}if(B){p.officeState=B}if(a){p.officeCity=a}if(m){p.officeStreet=m}}if(y){p.description=y}if(k){p.photoPath=k}return p}function isValidAddressInfo(){if(!validateInput(jQuery("#lastName"),1,128,"userName")){return false}if(!validateInput(jQuery("#firstName"),1,128,"userName")){return false}if(!validateInput(jQuery("#memberName"),2,512,"userName")){return false}if(!checkInputLength("jQuery",jQuery("#memberName"),"",0,128)){jQuery("#memberName").focus();return false}if(!validateInput(jQuery("#titleName"),2,256,"userName")){return false}if(!checkInputLength("jQuery",jQuery("#titleName"),"",0,128)){jQuery("#titleName").focus();return false}if(!validateInput(jQuery("#companyName"),2,256,"userName")){return false}if(!checkInputLength("jQuery",jQuery("#companyName"),"",0,128)){jQuery("#companyName").focus();return false}if(!validateInput(jQuery("#departmentName"),2,256,"userName")){return false}if(!checkInputLength("jQuery",jQuery("#departmentName"),"",0,128)){jQuery("#departmentName").focus();return false}if(!checkInputLength("jQuery",jQuery("#memberEmail"),"",0,256,true)){jQuery("#memberEmail").focus();return false}if(jQuery("#memberEmail").val()!=""){if(!isEmail(jQuery("#memberEmail").val())){jQuery.goAlert(mailMsg.error_email);jQuery("#memberEmail").focus();return false}}if(!checkInputLength("jQuery",jQuery("#mobileNo"),"",0,32)){jQuery("#mobileNo").focus();return false}if(!checkInputValidate("jQuery",jQuery("#mobileNo"),"onlyBack")){jQuery("#mobileNo").focus();return false}if(!checkInputLength("jQuery",jQuery("#officeTel"),"",0,32)){jQuery("#officeTel").focus();return false}if(!checkInputValidate("jQuery",jQuery("#officeTel"),"onlyBack")){jQuery("#officeTel").focus();return false}if(!validateInput(jQuery("#officeAddress"),0,1024,"onlyBack")){return false}if(!checkInputLength("jQuery",jQuery("#homeTel"),"",0,64)){jQuery("#homeTel").focus();return false}if(!checkInputValidate("jQuery",jQuery("#homeTel"),"onlyBack")){jQuery("#homeTel").focus();return false}if(!validateInputValue(jQuery("#officeHomepage"),0,512,"onlyBack")){return false}if(!checkInputLength("jQuery",jQuery("#homeCountry"),"",0,64)){jQuery("#homeCountry").focus();return false}if(!checkInputValidate("jQuery",jQuery("#homeCountry"),"onlyBack")){jQuery("#homeCountry").focus();return false}if(!checkInputLength("jQuery",jQuery("#homeState"),"",0,64)){jQuery("#homeState").focus();return false}if(!checkInputValidate("jQuery",jQuery("#homeState"),"onlyBack")){jQuery("#homeState").focus();return false}if(!checkInputLength("jQuery",jQuery("#homeCity"),"",0,64)){jQuery("#homeCity").focus();return false}if(!checkInputValidate("",jQuery("#homeCity"),"onlyBack")){jQuery("#homeCity").focus();return false}if(!checkInputLength("jQuery",jQuery("#homeStreet"),"",0,64)){jQuery("#homeStreet").focus();return false}if(!checkInputValidate("jQuery",jQuery("#homeStreet"),"onlyBack")){jQuery("#homeStreet").focus();return false}if(!validateInput(jQuery("#homeAddress"),0,1024,"onlyBack")){return false}if(!checkInputLength("jQuery",jQuery("#homePostalCode"),"",0,64)){jQuery("#homePostalCode").focus();return false}if(!checkInputValidate("jQuery",jQuery("#homePostalCode"),"onlyBack")){jQuery("#homePostalCode").focus();return false}if(!checkInputLength("jQuery",jQuery("#officeCountry"),"",0,64)){jQuery("#officeCountry").focus();return false}if(!checkInputValidate("jQuery",jQuery("#officeCountry"),"onlyBack")){jQuery("#officeCountry").focus();return false}if(!checkInputLength("jQuery",jQuery("#officeState"),"",0,64)){jQuery("#officeState").focus();return false}if(!checkInputValidate("jQuery",jQuery("#officeState"),"onlyBack")){jQuery("#officeState").focus();return false}if(!checkInputLength("jQuery",jQuery("#officeCity"),"",0,64)){jQuery("#officeCity").focus();return false}if(!checkInputValidate("jQuery",jQuery("#officeCity"),"onlyBack")){jQuery("#officeCity").focus();return false}if(!checkInputLength("jQuery",jQuery("#officeStreet"),"",0,64)){jQuery("#officeStreet").focus();return false}if(!checkInputValidate("jQuery",jQuery("#officeStreet"),"onlyBack")){jQuery("#officeStreet").focus();return false}if(!validateInput(jQuery("#officAddress"),0,1024,"onlyBack")){return false}if(!checkInputLength("jQuery",jQuery("#officPostalCode"),"",0,64)){jQuery("#homePostalCode").focus();return false}if(!checkInputValidate("jQuery",jQuery("#officPostalCode"),"onlyBack")){jQuery("#homePostalCode").focus();return false}return true}var viewTime=null;function menuLayerOut(a){viewTime=setTimeout("menuLayerClose('"+a+"')",300)}function menuLayerClose(a){if(viweStatus!="out"){return}document.getElementById(a).style.display="none"}function menuLayerOpen(b){if(viweStatus=="out"||viweStatus!=b){return}if(viweStatus=="ly_etc_dn1"){if(isMsie){var a=findPosY(document.getElementById("etc_dn_sp"));document.getElementById(b).style.pixelTop=a+20}else{var a=findPosY(document.getElementById("etc_dn_sp"));document.getElementById(b).style.top=a+13+"px"}}document.getElementById(b).style.display="inline"}function selPFolder(d,c,a,e){if(c.indexOf(".")!=-1){d=c.replace(/\./g,"/")}if(e=="new"){jQuery("#parentFolder_new").text(d);jQuery("#parentFolder").val(c);if(a){viweStatus="out";menuLayerOut("newPfBox");jQuery("#newPfBox").hide()}}else{jQuery("#parentFolder_default").text(d);if(c!=""){jQuery("#policy").val("move "+c)}else{jQuery("#policy").val("")}if(a){viweStatus="out";menuLayerOut("pfBox");jQuery("#pfBox").hide()}}}function getUserAddrInfo(){var f={};var b=jQuery("#officeCountry").val();var d=jQuery("#officePostalCode").val();var e=jQuery("#officeState").val();var a=jQuery("#officeCity").val();var c=jQuery("#officeStreet").val();if(b){f.officeCountry=b}if(d){f.officePostalCode=d}if(e){f.officeState=e}if(a){f.officeCity=a}if(c){f.officeStreet=c}return f}function closeViewSignLayer(){jQuery("#viewSignWrap").hide();jQuery("#viewSignWrap").off()}function saveBasicInfo(){var a=getUserBasicInfoData();if(a){mailSettingControl.saveBasicInfo(a)}}function getUserBasicInfoData(){var a="on";var j="off";var d=jQuery("#senderEmailInfo");var k=d.val();var e=jQuery("#senderNameInfo");if(!checkInputLength("jQuery",e,mailMsg.conf_userinfo_msg_01,0,128)){return}if(!checkInputValidate("jQuery",e,"userName")){return}if(trim(k)!=""){if(!isEmail(k)){jQuery.goAlert(mailMsg.common_2);d.focus();return}}var g=jQuery("input[name='saveSendBoxFalg']:checked").val();var h=jQuery("input[name='receiveNotiFalg']:checked").val();var b=jQuery("#wmodeSelect").val();if(b=="text"&&h==a&&notiMode=="link"){jQuery.goAlert(mailMsg.conf_alert_userinfo_receivenoti_wmode);return}if(g==j&&h==a&&b=="html"){if(confirm(mailMsg.conf_alert_userinfo_receivenoti)){jQuery("#receiveNoti").attr("checked","checked");jQuery("#saveSendBox").attr("checked","checked")}else{return}}var c={};c.addressVisible=getOnOffIfChecked(jQuery("input[name='addressVisible']:checked").val()==a);c.hiddenImg=getOnOffIfChecked(jQuery("#hiddenimg").is(":checked"));c.hiddenTag=getOnOffIfChecked(jQuery("#hiddentag").is(":checked"));c.searchAllFolder=getOnOffIfChecked(jQuery("#searchallfolder").is(":checked"));c.saveSendBox=getOnOffIfChecked(jQuery("input[name='saveSendBoxFalg']:checked").val()==a);c.receiveNoti=getOnOffIfChecked(jQuery("input[name='receiveNotiFalg']:checked").val()==a);c.writeNoti=getOnOffIfChecked(jQuery("input[name='writeNotiFalg']:checked").val()==a);c.vcardAttach=getOnOffIfChecked(jQuery("#vcardattach").is(":checked"));c.writeMode=jQuery("#wmodeSelect").val();c.composeMode=jQuery("#composeModeSelect").val();c.charSet=jQuery("#encodingSelect").val();c.senderName=e.val();c.senderEmail=k;c.pageLineCnt=jQuery("#pageLineCntVal").val();c.mailBadgeUse=getOnOffIfChecked(jQuery("#mailBadgeUse").is(":checked"));c.listViewCc=getOnOffIfChecked(jQuery("#listViewCc").is(":checked"));c.nationView=getOnOffIfChecked(jQuery("#nationView").is(":checked"));c.useMailSender=jQuery("#mailSenderUse").val()===a;var f=[];if(!!c.useMailSender){jQuery("#mailSenderListTbody .senderItem").each(function(){var l=USERLOGINEMAIL;if(jQuery(this).data("email").indexOf(l)<=0){var m={};m.email=jQuery(this).data("email");m.aliasUser=!!jQuery(this).data("alias");m.defaultMail=jQuery(this).closest("tr").find("#defaultEmail").length>0;f.push(m)}})}c.senderList=f;if(jQuery("#replyToSameMail").is(":visible")){c.replyToSameMail=getOnOffIfChecked(jQuery("#replyToSameMail").is(":checked"))}c.rcptMode=jQuery("input[name='rcptMode']:checked").val();c.sendConfirm=jQuery("input[name='sendConfirm']:checked").val();return c}function getOnOffIfChecked(a){if(!_.isBoolean(a)){return}return a?"on":"off"}function init(){jQuery("#signApplySelect").selectbox({selectId:"signApply",selectFunc:""},"${fn:escapeXml(signVo.signApply)}",[{index:signMsg.conf_sign_3,value:"T"},{index:signMsg.conf_sign_4,value:"F"}])}function checkSpamMode(){var a=jQuery("#spamPolicy").val();if(a==1){jQuery("#spamLevel").show();jQuery("#blackAndWhiteTr").show();jQuery("#spamHandleTr").show();jQuery("#blackListTr").show()}else{if(a==2){jQuery("#spamLevel").hide();jQuery("#blackAndWhiteTr").show();jQuery("#spamHandleTr").show();jQuery("#blackListTr").show()}else{if(a==3){jQuery("#spamLevel").hide();jQuery("#blackAndWhiteTr").hide();jQuery("#spamHandleTr").hide();jQuery("#blackListTr").hide()}else{if(a==4){jQuery("#spamLevel").hide();jQuery("#blackAndWhiteTr").show();jQuery("#spamHandleTr").show();jQuery("#blackListTr").hide()}}}}}function getSpamPolicy(e){var d=e.applyAllowedlistOnly;var a=e.applyRuleLevel;var b=e.applyBlacklist;var c=e.applyWhitelist;if(d=="off"&&a=="on"&&b=="on"&&c=="on"){return 1}else{if(d=="off"&&a=="off"&&b=="on"&&c=="on"){return 2}else{if(d=="off"&&a=="off"&&b=="off"&&c=="on"){return 3}else{if(d=="on"&&a=="off"&&b=="off"&&c=="on"){return 4}}}}}function addWhiteMailList(){jQuery.goPopup({id:"spam_mail_add_popup",pclass:"layer_normal layer_add_mailbox",header:mailMsg.conf_spamrule_47,contents:getHandlebarsTemplate("mail_setting_spam_modal_white_tmpl"),buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:addWhiteRuleList},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function addBlackMailList(){jQuery.goPopup({id:"spam_mail_add_popup",pclass:"layer_normal layer_add_mailbox",header:mailMsg.conf_spamrule_47,contents:getHandlebarsTemplate("mail_setting_spam_modal_black_tmpl"),buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:addBlackRuleList},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function addForwardMailList(){jQuery.goPopup({id:"forward_mail_add_popup",pclass:"layer_normal layer_add_mailbox",header:mailMsg.conf_spamrule_47,contents:getHandlebarsTemplate("mail_setting_spam_modal_white_tmpl"),buttons:[{btype:"confirm",btext:mailMsg.comn_confirm,autoclose:false,callback:addForwardList},{btype:"cancel",btext:mailMsg.comn_cancel}]})}function addWhiteRuleList(){var c,f,e;var b=false;var a=USEREMAIL;c=jQuery("#addWhiteMail").val().toLowerCase();f=jQuery("#whiteList td.txt").map(function(){return jQuery(this).text()}).get();e=jQuery("#blackList td.txt").map(function(){return jQuery(this).text()}).get();if(f&&f.length>0){for(var d=0;d<f.length;d++){if(f[d]==c){jQuery.goAlert(mailMsg.conf_spam_14);b=true;return}}}if(e&&e.length>0){for(var d=0;d<e.length;d++){if(c==e[d]){jQuery.goAlert(mailMsg.conf_spam_15);b=true;return}}}if(incNotAllowSpecialChar(c)){jQuery.goAlert(mailMsg.common_form_004);return}if(!b){if(!checkInputSearchAddr(c,2,255,true)){return}addMailList(jQuery("#addWhiteMail"),f,"1000",a,false,"w");jQuery("#whiteList_empty").hide()}jQuery.goPopup.close()}function addBlackRuleList(){var c,f,e;var b=false;var a=USEREMAIL;c=jQuery("#addBlackMail").val().toLowerCase();f=jQuery("#blackList td.txt").map(function(){return jQuery(this).text()}).get();e=jQuery("#whiteList td.txt").map(function(){return jQuery(this).text()}).get();if(f&&f.length>0){for(var d=0;d<f.length;d++){if(f[d]==c){jQuery.goAlert(mailMsg.conf_spam_15);b=true;return}}}if(e&&e.length>0){for(var d=0;d<e.length;d++){if(c==e[d]){jQuery.goAlert(mailMsg.conf_spam_14);b=true;return}}}if(incNotAllowSpecialChar(c)){jQuery.goAlert(mailMsg.common_form_004);return}if(!b){if(!checkInputSearchAddr(c,2,255,true)){return}addMailList(jQuery("#addBlackMail"),f,"1000",a,false,"b");jQuery("#blackList_empty").hide()}jQuery.goPopup.close()}function addForwardList(){var b,d;jQuery("#forwardMailList_empty_area").hide();var a=USEREMAIL;b=jQuery("#addWhiteMail").val().toLowerCase();d=jQuery("#forwardMailList td.forwardMailList").map(function(){return jQuery(this).text()}).get();if(d&&d.length>0){for(var c=0;c<d.length;c++){if(b==d[c]){jQuery.goMessage(mailMsg.common_form_005);return}}}if(maxForwaringCount<=d.length){jQuery.goMessage(msgArgsReplace(mailMsg.conf_forward_15,[maxForwaringCount]));return}addMailList(jQuery("#addWhiteMail"),d,"1000",a,false,"f");jQuery.goPopup.close()}function deleteMailList(c){var d=0;if(c=="w"){var b=jQuery("#whiteList_txt").length;if(b==0){jQuery("#whiteList_empty").show()}}else{if(c=="b"){var a=jQuery("#blackList_txt").length;if(a==0){jQuery("#blackList_empty").show()}}}}function deleteAllMailList(a){var b=0;if(a=="w"){jQuery("#whiteList #whiteList_txt").each(function(){jQuery(this).remove()});jQuery("#whiteList_empty").show()}else{if(a=="b"){jQuery("#blackList #blackList_txt").each(function(){jQuery(this).remove()});jQuery("#blackList_empty").show()}}jQuery.goAlert(mailMsg.del_ok)}function deleteAllFilters(){var a=jQuery("#autoFilter span[evt-rol='delete-filter']");if(a.length==0){return}jQuery.goConfirm(mailMsg.alert_remove_all,"",function(){var c={};var b=[];a.each(function(){b.push(jQuery(this).attr("condseq"))});c.condSeqs=b;mailSettingControl.deleteFilterRule(c)})}function addExceptForwardList(){var c,e,b;var a=USEREMAIL;b=false;c=jQuery("#defineForwardingAddressText").val().toLowerCase();e=jQuery("#defineForwardingList li span").map(function(){return jQuery(this).text()}).get();if(e&&e.length>0){for(var d=0;d<e.length;d++){if(c==e[d]){jQuery.goMessage(mailMsg.conf_forward_2);b=true;return}}}if(!b){addMailList(jQuery("#defineForwardingAddressText"),e,"1000",a,false,"e");jQuery("#defineForwardingAddressText").attr("value","")}}function deleteSelectList(){var a=0;jQuery("#defineForwardingList li input:checkbox").each(function(){if(jQuery(this).attr("checked")){a++}});if(a==0){jQuery.goMessage(mailMsg.common_form_007);return}jQuery("#defineForwardingList li input:checkbox").each(function(){if(jQuery(this).attr("checked")){jQuery(this).closest("li").remove()}})}function deleteAllList(){var a=0;jQuery("#defineForwardingList li input:checkbox").each(function(){a++});if(a==0){jQuery.goAlert(mailMsg.common_form_007);return}else{if(a>0){jQuery("#defineForwardingList li input:checkbox").each(function(){jQuery(this).attr("checked",true)})}}jQuery("#defineForwardingList li input:checkbox").each(function(){jQuery(this).closest("li").remove()})}function saveSpamInfo(){var a=getSpamInfo();mailSettingControl.saveSpamInfo(a)}function getSpamInfo(){var f={};var b=jQuery("#spamPolicy").val();if(b=="1"){f.applyAllowedlistOnly="off";f.applyRuleLevel="on";f.applyBlacklist="on";f.applyWhitelist="on"}else{if(b=="2"){f.applyAllowedlistOnly="off";f.applyRuleLevel="off";f.applyBlacklist="on";f.applyWhitelist="on"}else{if(b=="3"){f.applyAllowedlistOnly="off";f.applyRuleLevel="off";f.applyBlacklist="off";f.applyWhitelist="on"}else{if(b=="4"){f.applyAllowedlistOnly="on";f.applyRuleLevel="off";f.applyBlacklist="off";f.applyWhitelist="on"}}}}var d=jQuery("#spamLevel").val();if(d=="1"){f.pspamRuleLevel="3"}else{if(d=="2"){f.pspamRuleLevel="2"}else{if(d=="3"){f.pspamRuleLevel="1"}}}var e=jQuery("#spamHandle").val();if(e=="move Spam"){f.pspamPolicy="move Spam"}else{if(e=="move Trash"){f.pspamPolicy="move Trash"}else{if(e=="delete"){f.pspamPolicy="delete"}}}var c=new Array();jQuery("#whiteList #whiteList_txt .txt").each(function(){c.push(jQuery(this).text())});var a=new Array();jQuery("#blackList #blackList_txt .txt").each(function(){a.push(jQuery(this).text())});f.whiteList=c;f.blackList=a;return f}function saveFilter(){var k={};var b=[];var m=false;var q="";var p=false;var f="";var a="";var r=jQuery("#setting_filter_sender").val().trim().toLowerCase();var d=jQuery("#setting_filter_receiver").val().trim().toLowerCase();var j=jQuery("#setting_filter_subject").val().trim();if(r==""&&d==""&&j==""){jQuery.goMessage(mailMsg.conf_filter_1);jQuery("#setting_filter_sender").focus();isSuccess=false;return}if(r!=""){b.push({field:"FROM",pattern:r})}if(d!=""){b.push({field:"TO",pattern:d})}if(j!=""){if(!validateInputValue(jQuery("#setting_filter_subject"),0,255,"onlyBack")){jQuery("#setting_filter_subject").focus();isSuccess=false;return}b.push({field:"SUBJECT",pattern:j})}k.condSeq=jQuery("#filterCondSeq").val();k.subcondList=b;var l=jQuery("#mail_setting_modal_filter input[name=filterOperation]:checked").val();k.operation=l;var u=jQuery("input[name='autoFilterSelect']:checked").val();if(u=="folder"){var n=jQuery("#settingFilterSaveFolder option:selected").val();if(n==""){jQuery.goMessage(mailMsg.conf_alert_mailbox_select);return}k.policy="move "+n}else{if(u=="newFolder"){var e=jQuery("#settingFilterInputBoxName");var h=jQuery.trim(e.val());if(h==""||e.hasClass("placeholder")){jQuery.goMessage(mailMsg.conf_filter_37);e.focus();return}if(!validateInputValue(e,2,32,"folderName")){return}var o=jQuery("#settingFilterSaveNewFolder option:selected").val();if(o==""){q=h}else{q=o+"."+h}m=true}else{if(u=="tag"){var s=jQuery("#settingFilterTagList option:selected").val();if(s==""){jQuery.goMessage(mailMsg.mail_tag_select_msg);return}k.policy="tag "+s}else{if(u=="newTag"){var w=jQuery("#settingFilterNewTagName");var c=jQuery.trim(w.val());if(c==""||w.hasClass("placeholder")){jQuery.goMessage(mailMsg.mail_tag_add_msg);w.focus();return}if(!checkInputLength("jQuery",w,mailMsg.conf_filter_1,2,32)){return}if(isExistTagName(c)){jQuery.goSlideMessage(mailMsg.alert_tag_samename,"caution");return}var v=folderControl.getTagData();if(v&&v.length>=300){jQuery.goMessage(mailMsg.mail_tag_insert_limit);return}p=true;f=c;var g=jQuery("#mail_setting_modal_filter div.layer_pallete a.active").attr("color");a=g}else{jQuery.goMessage(mailMsg.conf_filter_1);return}}}}if(m){folderControl.addFolderAfterFunc(q,function(){k.policy="move "+q;mailSettingControl.saveAutoFilter(k)})}else{if(p){var t={tagName:f,tagColor:a};folderControl.addTagAfterFunc(t,function(){folderControl.getTagListAfterFunc(function(z){folderControl.makeTagList(z);var y="";for(var x=0;x<z.length;x++){if(z[x].name==c){y=z[x].id;break}}k.policy="tag "+y;mailSettingControl.saveAutoFilter(k)})})}else{mailSettingControl.saveAutoFilter(k)}}}function saveExtMailManager(k){var c={};var g=false;var n="";var l=jQuery("#pop3Host");if(!validateInputValue(l,2,255,"onlyBack")){return}var e=l.val().trim();if(!validateIP(e)&&!isDomain(e)){jQuery.goMessage(mailMsg.conf_pop_37);l.select();return false}var j=jQuery("#pop3Port").val().trim();if(j==""){jQuery.goMessage(mailMsg.conf_pop_40);jQuery("#pop3Port").select();return false}else{if(!isPort(j)){jQuery.goMessage(mailMsg.conf_pop_43);return false}}var f=jQuery("#pop3Id");if(!validateInputValue(f,2,255,"onlyBack")){return}var m=f.val().trim();if(m==""){jQuery.goMessage(mailMsg.conf_pop_2);f.select();return false}if((!isLocal(m))&&(!isEmail(m))){jQuery.goMessage(mailMsg.conf_pop_52);f.select();return false}var b=jQuery("#pop3Pw");if(!validateInputValue(b,1,64,"onlyBack")){return}if(jQuery("#mbox").attr("checked")){var d=trim(jQuery("#inputBoxName").val());if(!checkInputLength("jQuery",jQuery("#inputBoxName"),mailMsg.conf_filter_37,2,32)){return}if(!checkInputValidate("jQuery",jQuery("#inputBoxName"),"folderName")){return}if(trim(jQuery("#saveNewFolder option:selected").val())=="noChoiceParentFolder"){n=d}else{var a=jQuery("#saveNewFolder option:selected").val();a=a.split(" ").join("");a=a.replace(/>/gi,".");n=a+"."+d}g=true}else{var h=jQuery("#saveFolder option:selected").val();if(h=="noChoiceParentFolder"){jQuery.goMessage(mailMsg.conf_alert_mailbox_select);return false}if(h.indexOf(">")>0){h=h.split(" ").join("");h=h.replace(/>/gi,".")}c.policy="move "+h}c.pop3Host=e;c.pop3Port=j;c.pop3Id=m;c.pop3Pw=b.val().trim();c.sslCheck=jQuery("#sslCheck").attr("checked")?true:false;c.pop3Del=jQuery("#pop3Del1").attr("checked")?true:false;if(g){folderControl.addFolderAfterFunc(n,function(){c.policy="move "+n;mailSettingControl.saveExtMailSetting(c)})}else{mailSettingControl.saveExtMailSetting(c)}}function isEmailCheck(a){if(a.indexOf("@")>-1&&!isEmail(a)&&!isMailDomain(a)&&!isMailSubDomain(a)){return false}return true}function saveFilterInfo(){var a=getFilterInfo();mailSettingControl.saveFilterInfo(a)}function saveForwardInfo(){if(validationCheck()){var a=false;var c=getForwardInfo();var b=jQuery("#defineValue").val().toLowerCase();jQuery("#defineForwardingList input[dlist=defineList]").each(function(){if(b==jQuery.trim(jQuery(this).val())){jQuery.goAlert(mailMsg.conf_forward_31);a=true}});if(!a){mailSettingControl.saveForwardInfo(c);jQuery.goPopup.close()}}else{return}}function saveAllForwardInfo(){getForwardInfo();mailSettingControl.saveForwardInfo(param)}function saveDefineForwardInfo(){if(validationCheck()){var b=false;var d=getDefineForwardInfo();var c=jQuery("#defineValue").val().toLowerCase();var a=d.defineForwardingSeq;jQuery("#defineForwardList tr .defineRuleValue").each(function(){var e=jQuery(this).parents().attr("data-index");if(a!=e&&c==jQuery.trim(jQuery(this).text())){jQuery.goAlert(mailMsg.conf_forward_31);b=true}});if(!b){mailSettingControl.saveDefineForwardInfo(d);jQuery.goPopup.close()}}else{return}}function saveAutoReply(){var b=jQuery("#startTime").val();var j=jQuery("#endTime").val();if(jQuery("#reply_apply").attr("checked")){if(!checkInputLength("jQuery",jQuery("#autoReplySubject"),"",0,255)){return}if(jQuery.trim(jQuery("#autoReplyText").val()).length>2048){jQuery.goAlert(msgArgsReplace(mailMsg.error_inputlength_over,[2048]));return}if(trim(b)==""){jQuery.goAlert(mailMsg.conf_autoreply_29);return}if(trim(j)==""){jQuery.goAlert(mailMsg.conf_autoreply_30);return}var c=b.split("-");var f=j.split("-");var a=new Date(c[0],c[1]-1,c[2]);var e=new Date(f[0],f[1]-1,f[2]);var h=new Date();h.setHours(0,0,0,0);if(h.getTime()>a.getTime()){jQuery.goAlert(mailMsg.conf_autoreply_28);return}if(a.getTime()>e.getTime()){jQuery.goAlert(mailMsg.conf_autoreply_8);return}if(h.getTime()>e.getTime()){jQuery.goAlert(mailMsg.conf_autoreply_7);return}}var d={};d.useAutoReply=jQuery("#reply_apply").attr("checked")?true:false;var g=new Array();jQuery("#mail_add_list tr .reply_address").each(function(){g.push(jQuery(this).text())});if(trim(b)!=""){b+="-00-00-00";b=moment(b,"YYYY-MM-DD-HH-mm-ss").utc().format()}if(trim(j)!=""){j+="-23-59-59";j=moment(j,"YYYY-MM-DD-HH-mm-ss").utc().format()}d.startTime=b;d.endTime=j;d.subject=jQuery("#autoReplySubject").val();d.content=jQuery("#autoReplyText").val();d.replyMode=jQuery("#replyMode").val();d.replyAddressList=g;mailSettingControl.saveAutoReply(d)}function deleteForwardMailList(b){var c=0;if(b=="f"){var a=jQuery("#forward_mail_list").length;if(a==0){jQuery("#forwardMailList_empty_area").show()}}else{if(b=="e"){jQuery("#blackList li input:checkbox").each(function(){if(jQuery(this).attr("checked")){c++}});if(c==0){jQuery.goAlert(mailMsg.common_form_007);return}else{if(c>0){if(!confirm(mailMsg.common_form_009)){return}}}jQuery("#blackList li input:checkbox").each(function(){if(jQuery(this).attr("checked")){jQuery(this).closest("li").remove()}})}}}function deleteAllForwardMailList(a){var c=0;if(a=="f"){var d=jQuery("#forwardMailList_empty_area").prev().html();var b=jQuery("#forwardMailList_empty_area").next().html();while(d||b){jQuery("#forward_mail_list").remove();d=jQuery("#forwardMailList_empty_area").prev().html();b=jQuery("#forwardMailList_empty_area").next().html()}jQuery("#forwardMailList_empty_area").show()}else{if(a=="e"){jQuery("#blackList li input:checkbox").each(function(){c++});if(c==0){jQuery.goAlert(mailMsg.common_form_007);return}else{if(c>0){jQuery("#blackList li input:checkbox").each(function(){jQuery(this).attr("checked",true)});if(!confirm(mailMsg.common_form_009)){return}}}jQuery("#blackList li input:checkbox").each(function(){jQuery(this).closest("li").remove()})}else{if(a=="d"){jQuery(".defineForwarList_value").hide();jQuery("#defineForwarList_empty_area").show()}}}}function getFilterInfo(){param={};var b=jQuery("input[name='filterApplyFlg']:checked").val();var a=jQuery("input[name='billbox']:checked").val();var c=jQuery("input[name='advbox']:checked").val();var d=jQuery("input[name='snsbox']:checked").val();param.filter=(b=="on")?true:false;if(smartFilter){param.billbox=(a=="on")?true:false;param.advbox=(c=="on")?true:false;param.snsbox=(d=="on")?true:false}return param}function getForwardInfo(){param={};var d=jQuery("input[name='forwardApplyFlag']:checked").val();if(d=="on"){var f=jQuery("#forwardMode").val();if(f=="forwarding"){param.forwardMode="forwarding"}else{if(f=="forwardingonly"){param.forwardMode="forwardingonly"}}}else{param.forwardMode="none"}var b=new Array();jQuery("#forwardMailList tr .forwardMailList").each(function(){b.push(jQuery(this).text())});var a=new Array();var e=jQuery("#removeAllDefineForward").val();if(e!="true"){jQuery("#defineForwardList").find("tr[data-index]").each(function(){a.push(jQuery(this).data("index"))})}param.forwardingAddress=b;param.defineForwardingSeqList=a;var c=jQuery("#defineForwardingSeq").val();param.defineForwardingSeq=c;return param}function getDefineForwardInfo(){param={};var e=jQuery("input[name='forwardApplyFlag']:checked").val();if(e=="on"){var f=jQuery("#forwardMode").val();if(f=="forwarding"){param.forwardMode="forwarding"}else{if(f=="forwardingonly"){param.forwardMode="forwardingonly"}}}else{param.forwardMode="none"}var b=new Array();jQuery("#forwardMailList tr .forwardMailList").each(function(){b.push(jQuery(this).text())});param.forwardingAddress=b;var a=jQuery("#defineType").val();if(a=="mail"){param.defineType="mail"}else{if(a=="domain"){param.defineType="domain"}}var d=jQuery("#defineValue").val();if(d){d=d.toLowerCase()}param.defineValue=d;var g=new Array();jQuery("#defineForwardingList li .txt").each(function(){g.push(jQuery(this).text())});param.defineForwardingAddress=g;var c=jQuery("#defineForwardingSeq").val();param.defineForwardingSeq=c;return param}function validationCheck(){var a=jQuery("#defineType").val();var b=jQuery("#defineValue").val().toLowerCase();var c=new Array();jQuery("#defineForwardingList li .txt").each(function(){c.push(jQuery(this).text())});if(c.length>0){if(a=="mail"){if(!isMail(b)){jQuery.goMessage(mailMsg.common_2);jQuery("#defineValue").focus();return false}}else{if(a=="domain"){if(!isDomain(b)){jQuery.goMessage(mailMsg.error_domain);jQuery("#defineValue").focus();return false}}}}else{jQuery.goMessage(mailMsg.conf_forward_empty_msg);return false}return true}function deleteFilter(a){var b={};b.condSeqs=[a];mailSettingControl.deleteFilterRule(b)}function deleteExtList(a,b){param={};param.pop3Host=a;param.pop3Id=b;mailSettingControl.deleteExtRule(param)}function deleteAllExtList(){jQuery.goConfirm(mailMsg.alert_remove_all,"",function(){mailSettingControl.deleteAllExtRule()})}function setStartTime(){jQuery("#startTime").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearSuffix:""})}function setEndTime(){jQuery("#endTime").datepicker({dateFormat:"yy-mm-dd",changeMonth:true,changeYear:true,yearSuffix:""})}function changeSslSelect(){var a=jQuery("#sslCheck").attr("checked");if(a){jQuery("#pop3Port").attr("value","995")}else{jQuery("#pop3Port").attr("value","110")}}function changeReplyMode(){var a=jQuery("#replyMode").val();if(a=="REPLYWHITE"){jQuery("#reply_mode_area").show()}else{if(a=="REPLYALL"){jQuery("#reply_mode_area").hide()}}}function deleteReplyMail(){var a=jQuery("#reply_mail_list").length;if(a==0){jQuery("#mail_list_empty").show()}}function deleteReplyMailAll(){var b=jQuery("#mail_list_empty").prev().html();var a=jQuery("#mail_list_empty").next().html();while(b||a){jQuery("#reply_mail_list").remove();b=jQuery("#mail_list_empty").prev().html();a=jQuery("#mail_list_empty").next().html()}jQuery("#mail_list_empty").show()}function saveMailAdd(){var b,c;jQuery("#mail_list_empty").hide();var a=USEREMAIL;b=jQuery("#add_mail_name").val();if(!checkInputLength("jQuery",jQuery("#add_mail_name"),"",0,255)){return}c=jQuery("#mail_add_list tr .reply_address").map(function(){return jQuery(this).text()}).get();addMailList(jQuery("#add_mail_name"),c,"1000",a,false,"r");jQuery.goPopup.close()}function setPOP3Server(){var a=jQuery("#pop3List").val();jQuery("form input").attr("disabled",a=="");if(a.indexOf("|")>-1){a=a.replace("|ssl","");jQuery("#pop3Port").val("995");jQuery("#sslCheck").attr("checked",true)}else{jQuery("#pop3Port").val("110");jQuery("#sslCheck").attr("checked",false)}jQuery("#pop3Host").val(a=="userInput"?"":a)}function checkBox(){if(jQuery("#mbox").attr("checked")){jQuery("#saveNewFolder").removeAttr("disabled");jQuery("#saveFolder").attr("disabled","disabled");jQuery("#inputBoxName").show()}else{jQuery("#saveNewFolder").attr("disabled","disabled");jQuery("#saveFolder").removeAttr("disabled");jQuery("#inputBoxName").hide()}}function changeOnlyImageSignMode(c){var a=jQuery("#sign_only_image").attr("checked");if(a=="checked"){settingEditorBoxDestroy();jQuery("#signSelectMode").hide();jQuery("#registSignImage").show();jQuery("#signText").hide();jQuery("#signHtml").hide();jQuery("#signImgSizeText").hide();jQuery("#onlySignImgSize").show();jQuery("#thumbnail_image").removeAttr("width");jQuery("#thumbnail_image").removeAttr("height");jQuery("#thumbnailImageWrap").height("170px");if("image"==jQuery("input[name='imgSizeFlag']:checked").val()||jQuery("input[name='imgSizeFlag']:checked").val()==undefined){jQuery("#thumbnail_image").css({width:"350px",height:"170px"});jQuery("#signImageSizeDesc").text("350 x 170");jQuery("input[name='imgSizeFlag'][value='image']").attr("checked","checked")}else{jQuery("#thumbnail_image").css({width:"",height:""});jQuery("input[name='imgSizeFlag'][value='image_full']").attr("checked","checked")}jQuery("#thumbnailImageDivWrap").css({overflow:"auto",width:"670px",height:"180px"})}else{jQuery("#signSelectMode").show();jQuery("#registSignImage").show();var b=jQuery("#sign_mode option:selected").val();if(b=="html"){jQuery("#signText").hide();jQuery("#signHtml").show();settingEditorBoxScript(null,c)}else{jQuery("#signText").show();jQuery("#signHtml").hide();settingEditorBoxDestroy()}jQuery("#signImgSizeText").show();jQuery("#onlySignImgSize").hide();jQuery("#thumbnailImageWrap").height("120px");jQuery("#thumbnail_image").css({width:"100px",height:"120px"});jQuery("#signImageSizeDesc").text("100 x 120");jQuery("#thumbnailImageDivWrap").css({overflow:"",width:"",height:""})}}function changeSignMode(){jQuery("#mail_setting_modify_sign_modal").hide();var b=jQuery("#sign_mode option:selected").val();jQuery("#signSelectMode").show();jQuery("#registSignImage").show();if(b=="html"){if(!confirm(mailMsg.conf_sign_18)){jQuery("#sign_mode").val("text");jQuery("#mail_setting_modify_sign_modal").show();return}var a=jQuery("#signText_Textarea").val();jQuery("#signText").hide();jQuery("#signHtml").show();settingEditorBoxDestroy();settingEditorBoxScript()}else{if(!confirm(mailMsg.conf_sign_17)){jQuery("#sign_mode").val("html");jQuery("#mail_setting_modify_sign_modal").show();return}jQuery("#signText").show();jQuery("#signHtml").hide();jQuery("#signText_Textarea").empty()}jQuery("#mail_setting_modify_sign_modal").show()}function selectPicture(){jQuery("#theFile").click()}function deleteThumbnailImage(){jQuery("#thumbnail_image").attr("img-data","");jQuery("#thumbnail_image").attr("src","/resources/images/photo_profile_sample.jpg")}function saveSign(){var a=getSignData();if(a){mailSettingControl.destroySignAttach();mailSettingControl.saveSignData(a);jQuery.goPopup.close()}}function getSignData(){var d=jQuery("#signName");var q=d.val();if(!validateInputValue(d,1,20,"onlyBack")){return}var h=jQuery("#beforeSignName");var m=h.val();var b=jQuery("#signWriteType").val();var k=false;jQuery("#signListTable input[name='signNameHidden']").each(function(s){if(jQuery.trim(q)==jQuery.trim(jQuery(this).val())){if(b=="modify"){if(m!=q){k=true}}else{k=true}}});if(k){jQuery.goMessage(mailMsg.conf_sign_alert_signName_same);return}var r=jQuery("#sign_only_image").attr("checked");var e=jQuery("#sign_mode option:selected").val();var j="";var a=false;if(!r){if(e=="html"){j=settingGetHtmlMessage()}else{j=jQuery("#signText_Textarea").val()}var g=j.length;if(g<1&&g>2048){jQuery.goMessage(msgArgsReplace(mailMsg.error_inputlength,[1,2048]));return}}var o=jQuery("#signSeq").val();var f="";var n=jQuery("#defaultSign").attr("checked");if(n=="checked"){a=true}if(r){f=jQuery("input[name='imgSizeFlag']:checked").val()}else{f="normal"}var c={};c.signName=q;c.defaultSign=a;c.signMode=e;c.signText=j;c.signSeq=o;c.signType=f;var l=jQuery("#thumbnail_image").attr("img-data");if(l){c.signImagePath=l}var p=jQuery("#thumbnail_image").attr("img-name");if(p){c.signImageName=p}return c}function settingGetHtmlMessage(){return signSmartEditorControl.getEditorText()}function sleep(b){var c=new Date().getTime();var a=c;while(a-c<b){a=new Date().getTime()}}function selectSignImage(){jQuery("#theFile").click()}function deleteGetSignData(a){var b={signSeq:a};mailSettingControl.deleteSignData(b)}function deleteGetAllSignData(){var a=function(){mailSettingControl.deleteAllSignData()};jQuery.goConfirm(mailMsg.location_sign,mailMsg.mail_sign_select_all_remove_title,function(){a()})}function setDefaultSign(a){var b={};b.signSeq=a;mailSettingControl.settingDefaultSign(b)}function saveSignSetting(){var a=jQuery("#sign_apply").attr("checked")?true:false;var c=jQuery("#signLocationOption option:selected").val();var b={};b.signUse=a;b.signOutside=(c=="outside");mailSettingControl.modifySign(b)}function changeUserFolderAgingDayExcute(e,d){var b=e;var c=function(){mailSettingControl.changeUserFolderAgingDay(b)};var a=function(){var g=b.preAgingDay;var f;d.find("option").each(function(){var h=jQuery(this).val();if(g==h){f=jQuery(this)}});if(f){f.attr("selected",true)}else{d.find("option").attr("selected",false)}};jQuery.goConfirm(mailMsg.mail_folder,mailMsg.mail_change_aging_title,function(){c()},function(){a()})}function startBackupFolderExcute(c,b){if(isBackup||isBackupComplete||backupWork){jQuery.goAlert(mailMsg.mail_backup_title,mailMsg.alert_backup_process);return}backupWork=true;backupStatusId=b;var a={folderName:c,folderEncName:b};mailSettingControl.startBackupFolder(a)}function reloadViewFolderManage(){mailSettingControl.loadViewFolderManage()}function closeModifyFolderArea(){jQuery("#folderManageWrap span.txt_edit").each(function(){jQuery(this).prev().show();jQuery(this).hide()});jQuery("#folderManageWrap tr.edit").each(function(){jQuery(this).removeClass("edit")})}var signSmartEditorControl;function settingEditorBoxScript(b,c){var a={useImage:false};if(signSmartEditorControl){signSmartEditorControl.destroy();signSmartEditorControl=null}a.id="signSmartEditor";a.locale=LOCALE;a.simpleMode=true;a.blockResize=true;signSmartEditorControl=new EditorControl(a);signSmartEditorControl.makeEditor(function(){if(c){signSmartEditorControl.setEditorText(c)}})}function settingEditorBoxDestroy(){if(signSmartEditorControl){signSmartEditorControl.destroy();signSmartEditorControl=null}}function saveMailTagExcute(){var c=jQuery("#tag_name_input");var a=c.val();var b=jQuery("#mail_tag_popup div.layer_pallete a.active").attr("color");if(!validateInputValue(c,2,32,"folderName")){return}mailSettingControl.addTag(a,b);jQuery.goPopup.close()}function closeMailTagPallete(){jQuery("#mailTagPallete").remove();var a=jQuery("#tag_modify_area").length;if(a){jQuery("#tag_modify_area").parent().parent().prev().show();jQuery("#tag_modify_area").parent().parent().empty()}}function modifyTagNameExcute(g){var c=g.tagName;var a=g.color;var h=g.id;var b="tag_row_"+h;var f="modify_tag_pallete_"+h;var e="tag_modify_area_"+h;var d={name:c,color:a,id:h};jQuery("#"+b).hide();jQuery("#"+e).append(getHandlebarsTemplate("tag_modify_tmpl",d));jQuery("#"+e).show();var d={color:a};jQuery("#"+f).html(getHandlebarsTemplate("mail_pallete_modal_tmpl",d));jQuery("#"+f+" div.layer_pallete").on("click","a",function(j){jQuery("#"+f+" div.layer_pallete a").removeClass("active");jQuery(this).addClass("active")})}function deleteLastRcptExcute(c){var a=jQuery("#rcptList");var b=a.val();if(b==""){a.val(c)}else{a.val(b+","+c)}if(!jQuery("#rcptbodyEmpty ~ tr").length){jQuery("#rcptbodyEmpty").show()}}function deleteAllLastRcptExcute(){jQuery("#rcptData .deleteBtn").each(function(){deleteLastRcptExcute(jQuery(this).data("seq"))});jQuery("#rcptbodyEmpty ~ tr").remove();jQuery("#rcptbodyEmpty").show()}function saveLastRcptExcute(){var a=jQuery("#rcptList").val();if(a==""){jQuery.goSlideMessage(mailMsg.save_ok);return}var b=a.split(",");var c={rcptSeqList:b};mailSettingControl.deleteLastRcpt(c)}function isMail(a){len=get_length(a);if(len>256){return false}for(i=0;i<len;i++){ch=a.charAt(i);if((ch>="0"&&ch<="9")||(ch>="A"&&ch<="Z")||(ch>="a"&&ch<="z")||ch=="-"||ch=="."||ch=="_"||ch=="@"){continue}else{return false}}for(i=0;i<len;i++){ch=a.charAt(i);if(ch=="@"){return true}}return false}function get_length(a){real_length=0;len=a.length;for(i=0;i<len;i++){ch=a.charCodeAt(i);if(ch>=16777215){real_length+=4}else{if(ch>=65535){real_length+=3}else{if(ch>=255){real_length+=2}else{real_length++}}}}return real_length}function checkName(){var a=jQuery("#lastName").val();var b=jQuery("#firstName").val();a=a+" ";jQuery("#memberName").val(a+b)}function validateAddSenderEmail(){if(jQuery("#mailSenderListTbody .senderItem").length>=100){jQuery.goMessage(msgArgsReplace(mailMsg.common_form_002,[100]));return}if(!validateInputValue(jQuery("#inputSenderName"),0,128,"userName")){return}var d=jQuery.trim(jQuery("#inputSenderName").val());var g=jQuery("#availableEmails :selected");var f=jQuery.trim(g.val());if(f==""){jQuery.goMessage(mailMsg.common_form_003);g.focus();return}if(!isEmail(f)){jQuery.goMessage(mailMsg.common_form_004);g.focus();return}var b=false;jQuery("#mailSenderListTbody .senderItem").each(function(){var h=get_email(jQuery(this).data("email"));if(h==f){b=true;return false}});if(b){jQuery.goMessage(mailMsg.common_form_005);return}var e={};var c=getEmailFormat(d,f);e.value=c;e.isAliasUser=g.data("type")=="AliasUser";var a=getHandlebarsTemplate("mail_sender_add_tmpl",e);jQuery("#mailSenderListTbody").append(a);jQuery("#mailSenderListWrap").show();jQuery("#inputSenderName").val("")}function toggleReplyTo(a){if(jQuery(a.currentTarget).is(":checked")){jQuery("#senderEmailInfo").attr("disabled","disabled")}else{jQuery("#senderEmailInfo").removeAttr("disabled")}}function changePersonalPart(a){jQuery(".senderItem").first().text('"'+jQuery(a.currentTarget).val()+'" <'+USEREMAIL+">")}function changeImgSize(){jQuery("#signSelectMode").hide();jQuery("#registSignImage").show();jQuery("#signText").hide();jQuery("#signHtml").hide();jQuery("#signImgSizeText").hide();jQuery("#onlySignImgSize").show();jQuery("#thumbnail_image").removeAttr("width");jQuery("#thumbnail_image").removeAttr("height");jQuery("#thumbnailImageWrap").height("170px");if("image"==jQuery("input[name='imgSizeFlag']:checked").val()){jQuery("#thumbnail_image").css({width:"350px",height:"170px"});jQuery("#signImageSizeDesc").text("350 x 170")}else{jQuery("#thumbnail_image").css({width:"",height:""})}}function bindFilterInputEvent(){jQuery("#setting_filter_sender,#setting_filter_receiver,#setting_filter_subject").keyup(function(){var b=jQuery.trim(jQuery("#setting_filter_sender").val());var c=jQuery.trim(jQuery("#setting_filter_receiver").val());var a=jQuery.trim(jQuery("#setting_filter_subject").val());if((b!=""&&c!="")||(b!=""&&a!="")||(c!=""&&a!="")){jQuery("#settingFilterCondOperationWrap").show()}else{jQuery("#settingFilterCondOperationWrap").hide()}})}function unbindFilterInputEvent(){jQuery("#setting_filter_sender,#setting_filter_receiver,#setting_filter_subject").unbind("keyup")};