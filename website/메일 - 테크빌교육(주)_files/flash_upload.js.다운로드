(function(){define(["jquery","components/fileupload/views/file_item","swfupload","swfupload.plugin","jquery.progressbar","GO.util"],function(e,t){function s(){var e=document.title,t=e.indexOf("#");document.title=sessionStorage.getItem("browserTitle")||e.substring(0,t)}function o(t){var n=t.useButtonWindow?SWFUpload.WINDOW_MODE.WINDOW:SWFUpload.WINDOW_MODE.TRANSPARENT,r={upload_url:t.context_root+t.url,file_size_limit:t.file_size_limit,file_types:t.file_type,file_upload_limit:t.file_upload_limit,flash_url:t.context_root+"resources/js/vendors/swfupload/swfupload.swf",button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:n,button_text_style:".buttonText {"+t.button_style+"}",button_text:t.button_text,button_width:t.button_width,button_height:t.button_height,button_text_top_padding:t.top_padding,button_text_left_padding:t.left_padding,button_placeholder:this.$el.find(".button")[0],file_types_description:"",debug:t.debug,custom_settings:{something:"here"},file_post_name:t.file_post_name||"file",post_params:t.post_params||{}};return e(this.el).swfupload(r)}function u(e){if(e.context_root==undefined||e.el==undefined||e.url==undefined)throw new Exception("require parameter[context_root, el, url]")}var n={locale:e('meta[name="locale"]').attr("content"),context_root:"/",lang:{ko:{"\uc0ad\uc81c":"\uc0ad\uc81c"},ja:{"\uc0ad\uc81c":"\u524a\u9664"},en:{"\uc0ad\uc81c":"Delete"},zh_CN:{"\uc0ad\uc81c":"\u5220\u9664"},zh_TW:{"\uc0ad\uc81c":"\u522a\u9664"},vi:{"\uc0ad\uc81c":"X\u00f3a"}},button_text:"",button_height:20,button_width:69,button_style:"border: 1px solid #D1D1D1;background-color:#efefef;display:inline-block;cursor:pointer;color:#6f6f6f;border-radius:2px; font-size:12px;font-weight:bold; text-align: center;vertical-align: middle;font-family:\ub3cb\uc6c0,dotum,AppleGothic,arial,Helvetica,sans-serif;",progressBarUse:!0,file_size_limit:0,file_upload_limit:0,file_type:"*.*",top_padding:5,left_padding:0,debug:!1},r,i=Backbone.View.extend({initialize:function(t){u(t),this.$el=typeof t.el=="string"?e(t.el):t.el,this.$el.append("<input type='hidden' class='button'/>"),this.$el.siblings("div.progress").length||this.$el.after("<div class='progress' style='display:none;margin-top:5px'></div>");var i=e.extend({},n,t);this.lang=n.lang.hasOwnProperty[i.locale]?n.lang[i.locale]:n.lang.ko,this.flashFileUploder=o.call(this,i),this.progressBarUse=i.progressBarUse,this.isMail=t.isMail||!1;if(this.progressBarUse){var s=this;this.progressEl=i.progressEl==undefined?this.$el.parents(":first").find("div.progress"):e(i.progressEl),this.progressBarOpt={boxImage:i.context_root+"resources/images/progressbar.gif",barImage:i.context_root+"resources/images/progressbg_green_100.gif",width:180,max:100},this.progressEl.hide(),this.progressEl.progressBar(0,this.progressBarOpt),this.progressEl.find("span:first").css("vertical-align","top"),this.progressEl.append("<a><span class='ic_classic ic_del' title='"+this.lang["\uc0ad\uc81c"]+"'></span></a>"),this.progressEl.find("span.ic_del").on("click",function(){s.$el.trigger("cancel:upload")})}this.$el.on("cancel:upload",function(){e(this).swfupload("cancelUpload")}),r=document.title,this._bindEvents()},_fileQueued:function(e,t){this.queueCallback(e,{name:t.name,size:t.size,type:t.type}),this.$el.swfupload("startUpload")},_uploadStart:function(e,t){var n=this.startCallback(e,{name:t.name,size:t.size,type:t.type,id:t.id});n==0&&this.$el.swfupload("cancelUpload")},_uploadProgress:function(e,t,n){var r={name:t.name,type:t.type,loadedSize:n,totalSize:t.size};if(this.progressBarUse){this.progressEl.show();var i=Math.ceil(r.loadedSize/r.totalSize*100);i>99&&(i=100),this.progressEl.progressBar(i,this.progressBarOpt)}this.progressCallback(e,r)},_uploadSuccess:function(n,r,i){var s=e.parseJSON(i),o={};this.isMail&&(s.data=s,s.data.fileExt=r.type,o.uid=s.uid),s.data.id=r.id;var u=s.data;_.extend(o,{fileName:u.fileName,filePath:u.filePath,hostId:u.hostId,fileSize:GO.util.getHumanizedFileSize(u.fileSize),fileClass:GO.util.getFileIconStyle({extention:u.fileExt}),removeText:this.lang["\uc0ad\uc81c"],thumbnail:u.thumbnail});var a=null;GO.util.isImage(u.fileExt)?a=t.createImageFile(o):a=t.createFile(o),this.successCallback(n,s,a.$el)},_uploadComplete:function(e,t){this.progressBarUse&&(this.progressEl.hide(),this.progressEl.progressBar(0,this.progressBarOpt)),this.$el.swfupload("startUpload"),this.completeCallback(e,t)},_uploadError:function(e,t){this.errorCallback(e,t)},start:function(e){return this.startCallback=e,this},queue:function(e){return this.queueCallback=e,this},progress:function(e){return this.progressCallback=e,this},success:function(e){return this.successCallback=e,this},complete:function(e){return this.completeCallback=e,this},error:function(e){return this.errorCallback=e,this},_bindEvents:function(){this.flashFileUploder.unbind("fileQueued"),this.flashFileUploder.unbind("uploadStart"),this.flashFileUploder.unbind("uploadProgress"),this.flashFileUploder.unbind("uploadSuccess"),this.flashFileUploder.unbind("uploadComplete"),this.flashFileUploder.unbind("uploadError"),this.flashFileUploder.bind("fileQueued",e.proxy(function(e,t){this._fileQueued(e,t)},this)),this.flashFileUploder.bind("uploadStart",e.proxy(function(e,t){this._uploadStart(e,t)},this)),this.flashFileUploder.bind("uploadProgress",e.proxy(function(e,t,n){this._uploadProgress(e,t,n)},this)),this.flashFileUploder.bind("uploadSuccess",e.proxy(function(e,t,n){this._uploadSuccess(e,t,n)},this)),this.flashFileUploder.bind("uploadComplete",e.proxy(function(e,t){this._uploadComplete(e,t)},this)),this.flashFileUploder.bind("uploadError",e.proxy(function(e,t){this._uploadError(e,t)},this))}});return SWFUpload.prototype.fileDialogStart=function(){window.history.pushState||s(),this.queueEvent("file_dialog_start_handler")},SWFUpload.prototype.flashReady=function(){console.info("override after!!");var e=this.getMovieElement();if(!e){this.debug("Flash called back ready but the flash movie can't be found.");return}this.cleanUp(e),this.queueEvent("swfupload_loaded_handler"),window.history.pushState||setTimeout(function(){var e=navigator.userAgent.toLowerCase();e.indexOf("msie")!=-1&&s()},200)},i})})();