(function(){define(["backbone","app","jquery","models/dept_profile","hgn!templates/dept_profile_card","i18n!nls/commons","jquery.go-popup","jquery.fancybox"],function(e,t,n,r,i,s){var o=null,u={send_mail:s["\uba54\uc77c \ubcf4\ub0b4\uae30"],show_calendar:s["\uc77c\uc815 \ubcf4\uae30"],dept_manager:s["\ubd80\uc11c\uc7a5"],dept_member:s["\ubd80\uc11c\uc6d0"],sendmail_to_dept:s["\ubd80\uc11c\uc6d0 \uc804\uccb4\uc5d0\uac8c \uba54\uc77c \ubcf4\ub0b4\uae30"],ecoupon:s["\uc120\ubb3c\ud558\uae30"],none:s["\uc5c6\uc74c"],count:s["\uba85"]},a=e.View.extend({el:"#gpopupLayer",initialize:function(e){this.options=e||{},this.isAvailableMail=GO.isAvailableApp("mail"),this.isAvailableEcoupon=GO.isAvailableApp("ecoupon"),this.el&&this.unbindEvent()},bindEvent:function(){n(this.el).on("click","li.mail",n.proxy(this.moveToSendMail,this)),n(this.el).on("click","li.ecoupon",n.proxy(this.moveToEcoupon,this))},unbindEvent:function(){n(this.el).off("click","li.mail"),n(this.el).off("click","li.ecoupon")},moveToSendMail:function(){var e=this.model.toJSON(),t=GO.router.getSendMailUrl({name:e.name,email:e.email});return t&&window.open(t,"popupRead"+GO.util.getSecureRandomInt(1,1e6),"scrollbars=yes,resizable=yes,width=1280,height=760"),!1},moveToEcoupon:function(){GO.router.navigate("ecoupon?type=dept&id="+this.options.deptId,{trigger:!0,pushState:!0})},render:function(){this.model=r.read(this.options.deptId);var e=this.model.toJSON(),t=this.__makeAncestorsDeptsName(e);e.ancestorsName=t,e.email=(e["emailId"]!=""?e.email:!1)||!1,this.__setIsExistMaster(e);var s=i(n.extend(e,{lang:u,isAvailableMail:this.isAvailableMail,isAvailableEcoupon:this.isAvailableEcoupon,hasChildren:e.childrenCount<=0||e.memberCount<=0?!1:!0,isRootDept:e.parentCode==undefined?!0:!1})),o={pclass:"layer_card",modal:!1,width:220,contents:s};if(this.options.offset)o.offset=this.options.offset;else if(this.targetEl){var a=n(this.targetEl),f=a.offset(),l=n(window).width(),c=f.left+a.width()+o.width;o.offset={top:f.top+a.height()+5,left:f.left+a.width()+5};if(l<c){var h=32,p=c-l+h;o.offset.left-=p}}this.el=n.goPopup(o),this.el.draggable({handle:".handle",cursor:"move",start:function(e,t){n(this).css("bottom","")}}),n("div.layer_card").css("top","50%"),this.bindEvent()},__setIsExistMaster:function(e){e.masterName==""?e.isExistMaster=!1:e.isExistMaster=!0},__makeAncestorsDeptsName:function(e){var t=e.ancestors,n=t[0];for(var r=1;r<t.length;r++)n+=" > "+t[r];return n}});return{render:function(e,t,n){o==null?o=new a({deptId:e,targetEl:t,offset:n}):(o.options.deptId=e,o.options.targetEl=t,o.options.offset==n),o.render()}}})})(jQuery);