define("admin/models/layout/side_menu",function(require){var e=require("backbone"),t=require("underscore"),n=require("admin/models/layout/side_sub_menu"),r=require("i18n!admin/nls/admin"),i=e.Model.extend({initialize:function(e,s,o,u,a){this.depth=u?u:0,this.maxDepth=this.depth,this.attributes=e,this.inAccessableKey=s,this.inAccessableApps=o,this.serviceAdminMode=a,this.uid=this.get("uid"),this.adminMenuKey=this.get("adminMenuKey"),this.labelKey=r[this.get("labelKey")]?r[this.get("labelKey")]:this.get("labelKey"),this.labelKeyOrigin=this.get("labelKey"),this.href=this.get("href"),this.contentsPath=this.get("contentsPath"),this.routingName=this.get("routingName"),this.level=this.get("level"),this.order=this.get("order"),this.option=this.get("option"),this.appService=this.get("appService"),this.favorite=!1,this.view=!0,this.childs=[],this.filterMenuUid=["A-h","D-n-3"];var f=this.serviceAdminMode?"service":"site";this.isAccessibleApp=!this.appService||!t.contains(this.inAccessableApps,this.appService);var l=!this.inAccessableKey||!t.contains(this.inAccessableKey,this.uid);this.isAccessibleLevel=GO.session().systemAdmin&&!t.contains(this.filterMenuUid,this.uid)?!0:t.contains(this.level,f),this.accessible=l&&this.isAccessibleApp&&this.isAccessibleLevel;var c=this.get("childs")||[];for(var h=0,p;p=c[h];h++){var d=new i(p,s,o,this.depth+1,a);d.maxDepth>this.maxDepth&&(this.maxDepth=d.maxDepth),this.childs[h]=d,this.childs[h].parentUid=this.uid}this.childs=t.sortBy(this.childs,function(e){return e.order});var v=this.get("subMenu");this.subMenu=[];if(v&&v.length>0)for(var h=0,m;m=v[h];h++)this.subMenu[h]=new n(m),this.subMenu[h].parentUid=this.uid},initViewFlag:function(){this.view=!0,this.keyword=undefined;for(var e=0;e<this.childs.length;e++)this.childs[e].initViewFlag()},filtering:function(e,t){if(!this.accessible)return!1;this.keyword=e;if(!this.keyword||this.keyword.length<1){this.initViewFlag();return}var n=t,r=!1;if(!n&&this.labelKey){var i=this.getInitialityStr(this.labelKey).trim();n=this.labelKey.toLowerCase().indexOf(e.toLowerCase())>=0||i.indexOf(e)>=0}for(var s=0;s<this.childs.length;s++)r|=this.childs[s].filtering(e,n);return this.view=n||r,this.view},url:function(){return GO.contextRoot+"ad/api/menu/access?"+$.param({adminMenuKey:this.uid})},parse:function(e){this.favorite=e.favorite},getInitialityStr:function(e){var t="",n="\u3131\u3132\u3134\u3137\u3138\u3139\u3141\u3142\u3143\u3145\u3146\u3147\u3148\u3149\u314a\u314b\u314c\u314d\u314e";for(var r=0;r<e.length;r++){if(e[r]===" "){t+=" ";continue}var i=(e.charCodeAt(r)-44032)/588;i>0&&(t+=n.charAt(i))}return t},getMenuKey:function(){return this.uid?this.uid:this.adminMenuKey},getMenuGroup:function(){return this.parent?this.parent.id:""},getRoutingPath:function(){return"admin.main."+this.routingName},getContentsPath:function(){return this.contentsPath},getTitle:function(){return this.labelKey},getRoutingName:function(){return this.routingName},getOption:function(){return this.get("option")},getFavorite:function(){return this.favorite},updateFavorite:function(e){this.favorite=e;var t=this;$.ajax({url:GO.contextRoot+"ad/api/menu/favorite",data:JSON.stringify({adminMenuKey:t.getMenuKey(),favorite:t.favorite}),type:"PUT",async:!1,contentType:"application/json",success:function(e){t.favorite=e.favorite,$("body").trigger("favorite.menu.updated")},error:function(){t.favorite=!t.favorite}})}});return i});