(function(){define([],function(require){function s(t){console.info("call jquery-fileupload"),l(t);var n=e.extend({},i,t);this.lang=n.lang.hasOwnProperty(n.locale)?n.lang[n.locale]:n.lang.ko;var r="";n.mode=="TEXT"?r=u(n.textTmpl,{text:n.button_text,title:n.button_title,accept:n.accept}):t.mode=="IMAGE"?r=u(n.imgTmpl,{title:n.button_title}):t.mode=="COMMENT"&&(r=u(n.commentTmpl,{title:n.button_title})),this.el=e(r),n.multiple==0&&this.el.find("input[name='file']").removeAttr("multiple"),a(this.el.find("span.upload_button"),n),e(n.el).replaceWith(this.el),this.isMail=t.isMail||!1,this.progressBarUse=n.progressBarUse;if(this.progressBarUse){var s=this;this.progressEl=n.progressEl==undefined?this.el.find("div.progress"):e(n.progressEl),this.progressBarOpt={boxImage:n.context_root+"resources/images/progressbar.gif",barImage:n.context_root+"resources/images/progressbg_green_100.gif",width:200,max:100},this.progressEl.hide(),this.progressEl.progressBar(0,this.progressBarOpt),this.progressEl.find("span:first").css("vertical-align","top"),this.progressEl.append("<a><span class='ic_classic ic_del' title='"+this.lang["\uc0ad\uc81c"]+"'></span><a>"),this.progressEl.find("span.ic_del").on("click",function(){e(s.el).trigger("cancel:upload")})}var o={autoUpload:!0,pasteZone:null,url:f(n),timeout:0,dropZone:e(n.dropZone)};n.file_post_name&&(o.paramName=n.file_post_name),n.post_params&&(o.formData=n.post_params),this.fileuploadObject=this.el.fileupload(o);var s=this;e(this.el).on("cancel:upload",function(){s.XHR.abort()})}function o(t){var n={};return e.each(t.split(";"),function(){var t=this.split(":"),r=t[0],i=e.trim(t[1]);n[r]=i}),n}function u(e,t){return e.replace(/{(\w*)}/g,function(e,n){return t.hasOwnProperty(n)?t[n]:""})}function a(e,t){var n=o(t.button_style);e.css(n),e.css("height",t.button_height),e.css("width",t.button_width),e.addClass(t.button_class)}function f(t){var n="";if(e.browser.msie&&Number(e.browser.version)<10){var r=t.url.split("?");n=t.context_root+r[0]+"/submit?"+r[1]}else n=t.context_root+t.url;return n}function l(e){if(e.context_root==undefined||e.el==undefined||e.url==undefined)throw new Exception("require parameter[context_root, el, url]")}require("jquery.ui"),require("jquery.iframe-transport"),require("jquery.progressbar"),require("GO.util"),require("jquery.fileupload");var e=require("jquery"),t=require("components/fileupload/views/file_item"),n=require("i18n!nls/commons"),r=require("app"),i={locale:e('meta[name="locale"]').attr("content"),lang:{ko:{"\uc0ad\uc81c":"\uc0ad\uc81c","\ud30c\uc77c \ucca8\ubd80":"\ud30c\uc77c \ucca8\ubd80"},ja:{"\uc0ad\uc81c":"\u524a\u9664","\ud30c\uc77c \ucca8\ubd80":"\u30d5\u30a1\u30a4\u30eb\u6dfb\u4ed8"},en:{"\uc0ad\uc81c":"Delete","\ud30c\uc77c \ucca8\ubd80":"Attach"},zh_CN:{"\uc0ad\uc81c":"\u5220\u9664","\ud30c\uc77c \ucca8\ubd80":"\u6dfb\u52a0\u6587\u4ef6"},zh_TW:{"\uc0ad\uc81c":"\u522a\u9664","\ud30c\uc77c \ucca8\ubd80":"\u6dfb\u52a0\u6587\u4ef6"},vi:{"\uc0ad\uc81c":"X\u00f3a","\ud30c\uc77c \ucca8\ubd80":"T\u1eadp tin \u0111\u00ednh k\u00e8m"}},button_class:"button_text",mode:"TEXT",button_style:"border: 1px solid #D1D1D1;background-color:#efefef;display:inline-block;cursor:pointer;color:#666;border-radius:2px;width: 100%; padding: 2px 0 0;font-size:12px;font-weight:bold; text-align: center;vertical-align: middle;font-family:\ub3cb\uc6c0,dotum,AppleGothic,arial,Helvetica,sans-serif;",progressBarUse:!0,textTmpl:["<span class='wrap_btn wrap_file_upload'>","<span class='btn_file_form fileinput-button' style='text-align: center;'>","<span class='button text'>{text}</span>","<input type='file' name='file' title='{title}' multiple='' accept={accept} />","</span>","<div class='progress' style='display:none;margin-top:5px'></span>","</span>"].join(""),imgTmpl:["<span class='wrap_btn wrap_file_upload'>","<span class='fileinput-button'>","<span class='ic_con ic_file_up'></span>","<input type='file' name='file' title='{title}' style='height:inherit;' multiple=''/>","</span>","<div class='progress' style='display:none;margin-top:5px'></span>","</span>"].join(""),commentTmpl:["<span class='wrap_btn wrap_file_upload'>","<span>","<span class='ic24 ic_file_upload'></span>","<input type='file' name='file' title='{title}' style='height:inherit;' multiple=''/>","</span>","<div class='progress' style='display:none;'></div>","</span>"].join("")};return i.button_text=i.lang[i.locale]==undefined?i.lang.ko["\ud30c\uc77c \ucca8\ubd80"]:i.lang[i.locale]["\ud30c\uc77c \ucca8\ubd80"],i.button_title=i.button_text,s.prototype.queue=function(e){var t=this;return this.fileuploadObject.bind("fileuploadadd",function(n,r){t.XHR=r;var i=r.files[0],s={name:i.name,size:i.size,type:"."+i.name.split(".")[1]};e(n,s)}),this},s.prototype.start=function(t){return this.fileuploadObject.bind("fileuploadsend",function(i,s){var o=s.files[0],u=o.name,a=o.size,f="",l=r.config("allowedFileUploadSize");if(l<a){var c=r.i18n(n["\ucca8\ubd80\ud560 \uc218 \uc788\ub294 \ucd5c\ub300 \uc0ac\uc774\uc988\ub294 0MB \uc785\ub2c8\ub2e4."],"arg1",r.util.getHumanizedFileSize(l)).replace("MB","");return e.goSlideMessage(c,"caution"),!1}u.lastIndexOf(".")<0?f="none":f=u.substr(u.lastIndexOf(".")+1);var h={name:u,size:a,type:"."+f};return t(i,h)}),this},s.prototype.progress=function(e){var t=this;return this.fileuploadObject.bind("fileuploadprogress",function(n,r){var i=r.files[0],s={name:i.name,type:"."+i.name.split(".")[1],loadedSize:r.loaded,totalSize:r.total};if(t.progressBarUse){t.progressEl.show();var o=Math.ceil(s.loadedSize/s.totalSize*100);o>99&&(o=100),t.progressEl.progressBar(o,t.progressBarOpt)}e(n,s)}),this},s.prototype.success=function(n){var r=this;return this.fileuploadObject.bind("fileuploaddone",function(i,s){console.info("uploadSuccess Call");var o={},u={},a=null;if(r.isMail){var f=JSON.parse(s.result),l=f.fileName.split("."),c=l[l.length-1];o.data=f,o.data.fileExt=c,u.uid=f.uid}else e.browser.msie&&Number(e.browser.version)<10?o=e.parseJSON(e("pre",s.result).text()):o=s.result;var h=o.data;u={fileName:h.fileName,filePath:h.filePath,hostId:h.hostId,fileSize:GO.util.getHumanizedFileSize(h.fileSize),fileClass:GO.util.getFileIconStyle({extention:h.fileExt}),removeText:r.lang["\uc0ad\uc81c"],thumbnail:h.thumbnail},GO.util.isImage(h.fileExt)&&h.thumbnail?a=t.createImageFile(u):a=t.createFile(u),console.log("callback => ",n),n(i,o,a.$el)}),this},s.prototype.complete=function(e){var t=this;return this.fileuploadObject.bind("fileuploadalways",function(n,r){t.progressBarUse&&(t.progressEl.hide(),t.progressEl.progressBar(0,t.progressBarOpt)),e(n,r)}),this},s.prototype.error=function(e){return this.fileuploadObject.bind("fileuploadfail",function(t,n){console.info("jquery file upload error !!"),e(t,n)}),this},s})})();