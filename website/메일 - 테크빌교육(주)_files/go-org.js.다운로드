(function(e){var t=Array.prototype.slice,n=e.goOrg=function(){var e=t.call(arguments);return n.initialize.apply(n,e)};e.fn.imitateKeyEvent=function(){return this.each(function(){var e=function(e){this._o=e,this._value=e.value,this._bindEvents()};e.prototype._bindEvents=function(){var e=this,t=function(e,t,n){e.attachEvent?e.attachEvent("on"+t,n):e.addEventListener(t,n,!1)};t(this._o,"focus",function(){e._timer&&clearInterval(e._timer),e._timer=setInterval(function(){e._value!==e._o.value&&(e._value=e._o.value,e._fireEvent())},50)}),t(this._o,"blur",function(){e._timer&&clearInterval(e._timer),e._timer=null})},e.prototype._fireEvent=function(){var e;document.createEvent?(window.KeyEvent?(e=document.createEvent("KeyEvents"),e.initKeyEvent("keyup",!0,!0,window,!1,!1,!1,!1,65,0)):(e=document.createEvent("UIEvents"),e.initUIEvent("keyup",!0,!0,window,1),e.keyCode=65),this._o.dispatchEvent(e)):(e=document.createEventObject(),e.keyCode=65,this._o.fireEvent("onkeyup",e))},new e(this)})};var r=GO.session("theme")==="THEME_CLASSIC",i={width:300,height:430},s={width:300,height:30};r&&(i={height:430},s={height:38}),e.extend(n,{el:"#organogram",contextRoot:null,orgEl:null,treeEl:null,zindex:null,searchKeyword:null,treeLoaded:!1,version:"0.0.1",options:{},maxSize:i,minSize:s,defaultLocale:"ko",lang:{ko:{"\uc870\uc9c1\ub3c4":"\uc870\uc9c1\ub3c4","\ud06c\uac8c\ubcf4\uae30":"\ud06c\uac8c\ubcf4\uae30","\uc774\ub984":"\uc774\ub984","\ubd80\uc11c":"\ubd80\uc11c","\uc544\uc774\ub514":"\uc544\uc774\ub514","\uc804\ud654\ubc88\ud638":"\uc804\ud654","\uc9c1\uc704":"\uc9c1\uc704","\uc9c1\ucc45":"\uc9c1\ucc45","\uac80\uc0c9":"\uac80\uc0c9","\uc7a0\uc2dc\ub9cc \uae30\ub2e4\ub824\uc8fc\uc138\uc694":"\uc7a0\uc2dc\ub9cc \uae30\ub2e4\ub824\uc8fc\uc138\uc694","\uc870\uc9c1\uc21c":"\uc870\uc9c1\uc21c","\uac00\ub098\ub2e4\uc21c":"\uac00\ub098\ub2e4\uc21c","\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.","\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4":"\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4","\ub354\ubcf4\uae30":"\ub354\ubcf4\uae30","\ud504\ub85c\ud544":"\ud504\ub85c\ud544","\ubd80\uc11c \ud504\ub85c\ud544":"\ubd80\uc11c \ud504\ub85c\ud544","\uba54\uc77c \ubcf4\ub0b4\uae30":"\uba54\uc77c \ubcf4\ub0b4\uae30","\uc77c\uc815 \ubcf4\uae30":"\uc77c\uc815 \ubcf4\uae30","\uc5f4\uae30":"\uc5f4\uae30","\ub2eb\uae30":"\ub2eb\uae30","\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694.":"\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694."},ja:{"\uc870\uc9c1\ub3c4":"\u7d44\u7e54\u56f3","\ud06c\uac8c\ubcf4\uae30":"\u62e1\u5927\u8868\u793a","\uc774\ub984":"\u540d\u524d","\ubd80\uc11c":"\u90e8\u7f72","\uc544\uc774\ub514":"ID","\uc804\ud654\ubc88\ud638":"\u96fb\u8a71","\uc9c1\uc704":"\u8077\u4f4d","\uc9c1\ucc45":"\u5f79\u8077","\uac80\uc0c9":"\u691c\u7d22","\uc7a0\uc2dc\ub9cc \uae30\ub2e4\ub824\uc8fc\uc138\uc694":"\u3057\u3070\u3089\u304f\u304a\u5f85\u3061\u304f\u3060\u3055\u3044\u3002","\uc870\uc9c1\uc21c":"\u7d44\u7e54\u9806","\uac00\ub098\ub2e4\uc21c":"abc\u9806","\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"\u691c\u7d22\u7d50\u679c\u304c\u3042\u308a\u307e\u305b\u3093\u3002","\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4":"\u30e1\u30f3\u30d0\u30fc\u304c\u3042\u308a\u307e\u305b\u3093\u3002","\ub354\ubcf4\uae30":"\u3082\u3063\u3068\u898b\u308b","\ud504\ub85c\ud544":"\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb","\ubd80\uc11c \ud504\ub85c\ud544":"\u90e8\u7f72\u30d7\u30ed\u30d5\u30a3\u30fc\u30eb","\uba54\uc77c \ubcf4\ub0b4\uae30":"\u30e1\u30fc\u30eb\u9001\u4fe1","\uc77c\uc815 \ubcf4\uae30":"\u4e88\u5b9a\u78ba\u8a8d","\uc5f4\uae30":"\u958b\u304f","\ub2eb\uae30":"\u9589\u3058\u308b","\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694.":"\u7d50\u679c\u5024\u304c\u591a\u3044\u3067\u3059\u3002\u691c\u7d22\u3092\u5229\u7528\u3057\u3066\u304f\u3060\u3055\u3044\u3002"},en:{"\uc870\uc9c1\ub3c4":"Organization Tree","\ud06c\uac8c\ubcf4\uae30":"Enlarge","\uc774\ub984":"Name","\ubd80\uc11c":"Department","\uc544\uc774\ub514":"ID","\uc804\ud654\ubc88\ud638":"Phone","\uc9c1\uc704":"Position","\uc9c1\ucc45":"Title","\uac80\uc0c9":"Search","\uc7a0\uc2dc\ub9cc \uae30\ub2e4\ub824\uc8fc\uc138\uc694":"Please wait..","\uc870\uc9c1\uc21c":"By Organization","\uac00\ub098\ub2e4\uc21c":"By Alphabet","\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"No Result","\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4":"No Member","\ub354\ubcf4\uae30":"View More","\ud504\ub85c\ud544":"Profile","\ubd80\uc11c \ud504\ub85c\ud544":"Description","\uba54\uc77c \ubcf4\ub0b4\uae30":"Email","\uc77c\uc815 \ubcf4\uae30":"View Event","\uc5f4\uae30":"Open","\ub2eb\uae30":"Close","\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694.":"There are too many results. Please use the search function."},zh_CN:{"\uc870\uc9c1\ub3c4":"\u7ec4\u7ec7\u673a\u6784\u56fe","\ud06c\uac8c\ubcf4\uae30":"\u67e5\u770b\u5927\u56fe","\uc774\ub984":"\u540d\u5b57","\ubd80\uc11c":"\u90e8\u95e8","\uc544\uc774\ub514":"ID","\uc804\ud654\ubc88\ud638":"\u7535\u8bdd","\uc9c1\uc704":"\u804c\u79f0","\uc9c1\ucc45":"\u804c\u4f4d","\uac80\uc0c9":"\u641c\u7d22","\uc7a0\uc2dc\ub9cc \uae30\ub2e4\ub824\uc8fc\uc138\uc694":"\u8bf7\u7a0d\u5019\u3002","\uc870\uc9c1\uc21c":"\u7ec4\u7ec7\u987a\u5e8f","\uac00\ub098\ub2e4\uc21c":"abc\u987a\u5e8f","\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"\u6ca1\u6709\u641c\u7d22\u7ed3\u679c\u3002","\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4":"\u6ca1\u6709\u4f1a\u5458\u3002","\ub354\ubcf4\uae30":"\u67e5\u770b\u66f4\u591a","\ud504\ub85c\ud544":"\u7b80\u4ecb","\ubd80\uc11c \ud504\ub85c\ud544":"\u90e8\u95e8\u7b80\u4ecb","\uba54\uc77c \ubcf4\ub0b4\uae30":"\u53d1\u9001\u90ae\u4ef6","\uc77c\uc815 \ubcf4\uae30":"\u67e5\u770b\u65e5\u7a0b","\uc5f4\uae30":"\u6253\u5f00","\ub2eb\uae30":"\u5173\u95ed","\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694.":"\u7ed3\u679c\u592a\u591a\u3002\u8bf7\u4f7f\u7528\u641c\u7d22\u529f\u80fd\u3002"},zh_TW:{"\uc870\uc9c1\ub3c4":"\u7d44\u7e54\u6a5f\u69cb\u5716","\ud06c\uac8c\ubcf4\uae30":"\u67e5\u770b\u5927\u5716","\uc774\ub984":"\u540d\u5b57","\ubd80\uc11c":"\u90e8\u9580","\uc544\uc774\ub514":"ID","\uc804\ud654\ubc88\ud638":"\u96fb\u8a71","\uc9c1\uc704":"\u8077\u7a31","\uc9c1\ucc45":"\u8077\u4f4d","\uac80\uc0c9":"\u641c\u7d22","\uc7a0\uc2dc\ub9cc \uae30\ub2e4\ub824\uc8fc\uc138\uc694":"\u8acb\u7a0d\u5019\u3002","\uc870\uc9c1\uc21c":"\u7d44\u7e54\u9806\u5e8f","\uac00\ub098\ub2e4\uc21c":"abc\u9806\u5e8f","\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"\u6c92\u6709\u641c\u7d22\u7d50\u679c\u3002","\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4":"\u6c92\u6709\u6703\u54e1\u3002","\ub354\ubcf4\uae30":"\u67e5\u770b\u66f4\u591a","\ud504\ub85c\ud544":"\u7c21\u4ecb","\ubd80\uc11c \ud504\ub85c\ud544":"\u90e8\u9580\u7c21\u4ecb","\uba54\uc77c \ubcf4\ub0b4\uae30":"\u767c\u9001\u90f5\u4ef6","\uc77c\uc815 \ubcf4\uae30":"\u67e5\u770b\u65e5\u7a0b","\uc5f4\uae30":"\u6253\u958b","\ub2eb\uae30":"\u95dc\u9589","\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694.":"\u7d50\u679c\u592a\u591a\u3002\u8acb\u4f7f\u7528\u641c\u7d22\u529f\u80fd\u3002"},vi:{"\uc870\uc9c1\ub3c4":"S\u01a1 \u0111\u1ed3 t\u1ed5 ch\u1ee9c","\ud06c\uac8c\ubcf4\uae30":"Xem k\u00edch th\u01b0\u1edbc","\uc774\ub984":"H\u1ecd t\u00ean","\ubd80\uc11c":"Ph\u00f2ng ban","\uc544\uc774\ub514":"H\u1ecd t\u00ean","\uc804\ud654\ubc88\ud638":"tho\u1ea1i nh\u00e0","\uc9c1\uc704":"Ch\u1ee9c v\u1ee5","\uc9c1\ucc45":"Ch\u1ee9c tr\u00e1ch","\uac80\uc0c9":"T\u00ecm ki\u1ebfm","\uc7a0\uc2dc\ub9cc \uae30\ub2e4\ub824\uc8fc\uc138\uc694":"Vui l\u00f2ng ch\u1edd trong gi\u00e2y l\u00e1t","\uc870\uc9c1\uc21c":"Theo t\u1ed5 ch\u1ee9c","\uac00\ub098\ub2e4\uc21c":"Theo Alphabet","\uac80\uc0c9\uacb0\uacfc\uac00 \uc5c6\uc2b5\ub2c8\ub2e4.":"Kh\u00f4ng c\u00f3 k\u1ebft qu\u1ea3 t\u00ecm ki\u1ebfm","\uba64\ubc84\uac00 \uc5c6\uc2b5\ub2c8\ub2e4":"Kh\u00f4ng c\u00f3 th\u00e0nh vi\u00ean","\ub354\ubcf4\uae30":"Xem th\u00eam","\ud504\ub85c\ud544":"Th\u00f4ng tin c\u00e1 nh\u00e2n","\ubd80\uc11c \ud504\ub85c\ud544":"Th\u00f4ng tin c\u00e1 nh\u00e2n ph\u00f2ng ban","\uba54\uc77c \ubcf4\ub0b4\uae30":"G\u1eedi th\u01b0","\uc77c\uc815 \ubcf4\uae30":"Xem l\u1ecbch tr\u00ecnh","\uc5f4\uae30":"M\u1edf","\ub2eb\uae30":"\u0110\u00f3ng","\uacb0\uacfc\uac12\uc774 \ub9ce\uc2b5\ub2c8\ub2e4. \uac80\uc0c9\uc744 \uc774\uc6a9\ud574 \uc8fc\uc138\uc694.":"C\u00f3 nhi\u1ec1u gi\u00e1 tr\u1ecb k\u1ebft qu\u1ea3. Vui l\u00f2ng s\u1eed d\u1ee5ng t\u00ecm ki\u1ebfm."}},i18n:{},defaults:{offset:30,treeId:"orgSideTree",tpl:{defaults:["<h1>",'<ins class="ic"></ins><span class="txt">{lb_organogram}</span>','<span class="btn_wrap" id="orgToggleWrap"><span id="orgToggle" class="ic_gnb ic_hide_up2" data-slide="true" title="{lb_expend}"></span></span>',"</h1>",'<div class="search_wrap">','<form name="orgSearch" onSubmit="return false;">','<input class="search" type="text" placeholder="{lb_name}/{lb_id}/{lb_department}/{lb_position}/{lb_title}/{lb_phone}" title="{lb_name}/{lb_id}/{lb_department}/{lb_position}/{lb_title}/{lb_phone}" style="width: 100%;">','<input class="btn_search" type="submit" value="{lb_search}" title="{lb_search}">',"</form>","</div>",'<div class="tab_wrap"></div>'].join(""),contents:'<div id="tabOrgTree" class="content_tab_wrap" style="height:400px"><div id="orgSideTree"></div></div><div id="tabOrgMembers" class="content_tab_wrap" style="display:none;height:400px"></div>'}},initialize:function(t){var n=!0;this.options=e.extend(!0,{},this.defaults,t),this.options.el&&(this.el=this.options.el);if(this.options.lang&&this.lang.hasOwnProperty(this.options.lang))this.i18n=this.lang[this.options.lang];else{var r=e('meta[name="locale"]').attr("content");r&&this.lang.hasOwnProperty(r)?this.i18n=this.lang[r]:this.i18n=this.lang[this.defaultLocale]}return this.treeLoaded=!1,this.options.isOrgServiceOn!==undefined?n=this.options.isOrgServiceOn:n=GO.session("useOrgAccess"),this.options.hasOwnProperty("displayFormats")?this.displayFormats=this.options.displayFormats:this.displayFormats=null,this.isOrgServiceOn=n,this.orgEl=e(this.el),this.render(),this.setPosition(),this.bindPositionEvent(),GO.session("theme")==="THEME_ADVANCED"&&this.hide(),this},template:function(e,t){return e.replace(/{(\w*)}/g,function(e,n){return t.hasOwnProperty(n)?t[n]:""})},render:function(){var t=null,r=this.options,i=e(".go_wrap");this.contextRoot=r.contextRoot||"";if(!this.orgEl.length&&i.length){i.after('<aside class="go_organogram" id="'+this.el.substr(1)+'"></aside>'),this.orgEl=e(this.el);if(!this.orgEl.length)return!1}this.orgEl.html(this.template(n.defaults.tpl.defaults,{lb_expend:this.i18n["\uc5f4\uae30"],lb_organogram:this.i18n["\uc870\uc9c1\ub3c4"],lb_name:this.i18n["\uc774\ub984"],lb_department:this.i18n["\ubd80\uc11c"],lb_id:this.i18n["\uc544\uc774\ub514"],lb_position:this.i18n["\uc9c1\uc704"],lb_search:this.i18n["\uac80\uc0c9"],lb_phone:this.i18n["\uc804\ud654\ubc88\ud638"],lb_title:this.i18n["\uc9c1\ucc45"]})).css("height",this.minSize.height),this.orgEl.find("input[placeholder]").placeholder(),this.orgEl.find("#orgToggleWrap").on("click",function(){e("#orgToggle").hasClass("ic_show_down2")?n._orgClose():n._orgOpen()});var s=this.orgEl.find(".search_wrap input.search");return(e.browser.mozilla||e.browser.opera)&&s.imitateKeyEvent(),s.bind("keyup",function(r){if(r){if(r.keyCode===13)return e(r.currentTarget).focus(),!1;clearTimeout(t),t=setTimeout(n._search,500)}return!1}),s.on("click",function(t){e("#orgToggle").hasClass("ic_hide_up2")&&n._orgOpen()}),this.orgEl.css(this.minSize).find(".tab_wrap").show(),GO.session("theme")==="THEME_CLASSIC"&&this.orgEl.addClass("hide"),this},on:function(){return e.fn.on.apply(this.orgEl,t.call(arguments))},off:function(){return e.fn.off.apply(this.orgEl,t.call(arguments))},setPosition:function(){e('meta[name="device"]').attr("content")!=="pc"?e("#organogram").css("position","fixed"):document.location.pathname.indexOf("/app/mail")<0&&GO.session("theme")!=="THEME_ADVANCED"&&this.orgEl.css("top",e(document).scrollTop()+e(window).height()-this.orgEl.outerHeight()-26)},bindPositionEvent:function(){var t=this;e(window).on("scroll.org",function(){t.setPosition()}),e(window).resize(function(){t.setPosition()})},_renderSearchList:function(){var t=n.orgEl.find("input.search"),r=t.val()===t.attr("placeholder")?"":e.trim(n.orgEl.find("input.search").val());if(!r)return n._searchReset(),!1;n.orgEl.find("#tabOrgTree").hide();var i=e.goNodeList({selectQuery:"#tabOrgMembers",keyword:r,i18n:this.i18n,type:"org",isOrgServiceOn:this.isOrgServiceOn,contextRoot:this.contextRoot,displayFormats:this.displayFormats,callback:e.proxy(this._eventCallback,this)});i.$el.show(),i.deferred.then(e.proxy(function(e){var t=e.getData();if(t.length===1){var n=t[0],r={};n.nodeType==="department"&&(r.type="org"),r.id=n.id,r.email=n.email,r.name=n.name,this._eventCallback(r,{type:"select_node"})}},this))},_renderTreeNode:function(){this.treeLoaded=!0;var t=e.goNodeTree({el:"#orgSideTree",type:"node",i18n:this.i18n,isMyDeptOpened:!0,multiCompanyVisible:!0,contextRoot:this.contextRoot,displayFormats:this.displayFormats,url:[this.contextRoot,"api/organization/"],callback:e.proxy(function(e,t){this._eventCallback(e,t),n._removeContextMenu()},this)});this.treeEl=t.$el},_eventCallback:function(e,t){"org"===e.type||"company"===e.type?this.orgEl.trigger("show:dept_profile",{id:e.id,email:e.email,name:e.name,rel:"org"}):(t.type==="click"||t.type==="select_node"||t.type==="contextmenu")&&this.orgEl.trigger("show:profile",{id:e.id,email:e.email,name:e.name,rel:"member"})},toggleDisplayAndExtend:function(){this._isShown()?(this.hide(),this._orgClose()):(this.show(),this._orgOpen(),this.orgEl.find("input.search").focus())},_orgOpen:function(){n.orgEl.find("#orgToggle").removeClass("ic_hide_up2").addClass("ic_show_down2").attr("title",n.i18n["\ub2eb\uae30"]),n.orgEl.css(n.maxSize).find(".tab_wrap").show(),n.orgEl.find("#"+n.defaults.treeId).length||(n.orgEl.find(".tab_wrap").html(n.defaults.tpl.contents),n.isOrgServiceOn?n.treeLoaded||n._renderTreeNode():n._renderSearchList(),n.orgEl.find(".content_tab_wrap").on("scroll",function(){e("body > .org_context_menu").remove()})),e(window).on("click.go-org",function(t){var r=e(t.target);!r.parents(n.el).length&&!r.parents(".go_popup").length&&!r.attr("data-action")&&n._orgClose()}),this.setPosition(),GO.session("theme")==="THEME_CLASSIC"&&this.orgEl.removeClass("hide")},_orgClose:function(){return e(window).off(".go-org"),this.orgEl.find("#orgToggle").removeClass("ic_show_down2").addClass("ic_hide_up2").attr("title",this.i18n["\uc5f4\uae30"]),this.orgEl.css(n.minSize).find(".tab_wrap").hide(),this._removeContextMenu(),this.setPosition(),GO.session("theme")==="THEME_ADVANCED"?this.hide():this.orgEl.addClass("hide"),!1},_search:function(){n._orgOpen(),n._renderSearchList()},_searchReset:function(){n.orgEl.find("input.search").val(""),n.orgEl.find("#tabOrgMembers").hide(),n.orgEl.find("#tabOrgTree").show()},_removeContextMenu:function(){e("body > .org_context_menu").remove(),n.orgEl.unbind("click.contextRemove")},show:function(){this.orgEl.show()},hide:function(){this.orgEl.hide()},_isShown:function(){return this.orgEl.is(":visible")}})})(jQuery);