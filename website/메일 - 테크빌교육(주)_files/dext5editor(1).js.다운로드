(function(e,t){function c(e,t){t?this.oEditor.setContent(h.call(this)+e):this.oEditor.setContent(e)}function h(){return this.oEditor?this.oEditor.getContent():""}var n="100%",r=300,i=400,s=GO.contextRoot||"/",o={ko:"ko",en:"en",ja:"ja",jp:"ja",cn:"zh_CN",tw:"zh_TW","zh-cn":"zh_CN","zh-tw":"zh_TW",zh_CN:"zh_CN",zh_TW:"zh_TW",vi:"vi",zh:"zh_CN"},u={ko:"ko-kr",en:"en-us",ja:"ja-jp",jp:"ja-jp",cn:"zh-cn",tw:"zh-tw","zh-cn":"zh-cn","zh-tw":"zh-tw",zh_CN:"zh-cn",zh_TW:"zh-tw",vi:"vi"},a=GO.instanceType||"mail",f=navigator.appName=="Netscape"&&navigator.userAgent.search("Trident")!=-1||navigator.userAgent.toLowerCase().indexOf("msie")!=-1,l={app:f?"api/dextUpload/file":"api/dextUpload",admin:f?"ad/api/dextUpload/file":"ad/api/dextUpload",mail:"api/mail/image/upload"};t.getJSON(s+"resources/js/conf/editor/editor.config.json",function(e){i=e.config.height}).fail(function(){console.warn("height \uc124\uc815\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.")}),GO.Editor.registry("Dext5Editor",{type:GO.Editor.TYPE_DEXT5,contentSetter:c,contentGetter:h,defaults:function(){return{contextRoot:s,onLoad:function(){},onUnload:function(){},content:""}},oEditor:null,initialize:function(e,t){this.checkCount=0,this.__super__.initialize.call(this,e,t),this.isFormEditor=t.isFormEditor,this.basePath=[location.protocol,"//",location.hostname,location.port?":"+location.port:"",this.options.contextRoot].join("")},render:function(){if(this.$el.parents("body").length){var e=this.$el.outerHeight();this.$el.css("height","");if(this.$el.is("textarea")){var s=t("<div></div>");_.each(this.$el.prop("attributes"),function(e){s.attr(e.name,e.value)}),this.$el.attr("id",""),this.$el.after(s),this.$el.hide(),s.show()}var f=o[this.options.lang]||this.options.lang||"ko";DEXT5.config.InitXml=this.basePath+(a==="admin"?"ad/":"")+"api/dextconfig/"+f+(this.options.useImage!==!1?"":"?image=false"),DEXT5.config.EditorHolder=this.idAttr,DEXT5.config.Width=this.options.width||n,DEXT5.config.Lang=u[this.options.lang],DEXT5.config.RootPath=[this.basePath,"resources/js/vendors/dext5editor/"].join(""),DEXT5.config.HandlerUrl=this.options.contextRoot+l[a],DEXT5.config.UseRecentlyFont="1";var c=localStorage.getItem("dextRecentlyFont");c&&(DEXT5.config.DefaultFontFamily=c.split(",")[0]);var h="save";GO.util.isMobile()&&(h="save,separator,table_insert,insert_row_down,delete_column,insert_column_right,table_delete,merge_cell,split_cell,table_same_width,table_same_height,cell_bg_color,c_inline_image,c_inline_html,formatting,font_family,font_size,line_height,superscript,subscript,remove_format,remove_css",a==="mail"&&(DEXT5.config.ToolBar1=!1,DEXT5.config.ToolBar2=!1,DEXT5.config.StatusBarItem="design")),DEXT5.config.RemoveItem=h,DEXT5.config.UserCssUrl=[this.basePath,"resources/css/fonts/fonts_asset.css"].join(""),a==="mail"&&(DEXT5.config.ImageCustomPropertyDelimiter="0"),DEXT5.config.Height=this.options.height||(e<r?i+"px":e+"px"),DEXT5.config.InitFocus="0",this._bindEvents(),new Dext5editor(this.idAttr)}else var p=setTimeout(t.proxy(function(){console.log(this.$el.parents("body").length);if(this.checkCount>=20){clearTimeout(p);return}this.checkCount++,this.render()},this),200)},_fixFireFox:function(){var e=DEXT5.getDext5BodyDom(this.idAttr),n=_.filter(t(e).siblings().find("link"),function(e){return e.href.indexOf("doc_editor.css")>-1})[0];setTimeout(_.bind(function(){n&&(n.href=this.options.contextRoot+"resources/css/doc_editor.css")},this),100)},_bindEvents:function(){window.dext_editor_loaded_event||(window.dext_editor_loaded_event=t.proxy(function(e){var n=GO.Editor.getInstance(e.ID);n.oEditor=n,n.setContent(n.options.content),n.options.onLoad();if(this.isFormEditor){DEXT5.addUserCssUrl(this.basePath+"resources/css/doc_editor.css",this.idAttr);var r=DEXT5.getDext5BodyDom(e.ID);r.setAttribute("id","dext_body"),r.ondragstart=function(){return!1},r.ondrop=function(){return!1}}t(window).trigger("dext_editor_loaded"),t.browser.mozilla&&this.isFormEditor&&this._fixFireFox()},this)),!window.dext_editor_afterchangemode_event&&this.isFormEditor&&(window.dext_editor_afterchangemode_event=t.proxy(function(e,n,r){var i=GO.Editor.getInstance(r);i._bindDbClickEvent(r),n==="source"&&(t(window).trigger("dext_editor_afterchangemode_event",arguments),t.browser.mozilla&&this._fixFireFox())},this)),window.dext_editor_custom_action||(window.dext_editor_custom_action=t.proxy(function(e,n){e=="c_inline_image"&&window.inlineImgUploadLayer(n);if(e=="c_inline_html"){if(GO.util.isIE8()||GO.util.isIE9()){alert("\uc9c0\uc6d0\ud558\uc9c0 \uc54a\ub294 \ube0c\ub77c\uc6b0\uc800\uc785\ub2c8\ub2e4.");return}var r=t("#dextFileReader");r.length||(r=t('<input id="fileReader" style="display: none;" type="file">'),t("body").append(r),r.on("change",function(e){var t=e.target.files[0];if(!t)return;if(t.type!=="text/html"){alert("html \ud30c\uc77c\ub9cc \uac00\ub2a5\ud569\ub2c8\ub2e4.");return}if(t.size/1024>512){alert("512 KB \uc774\ud558 \ud30c\uc77c\ub9cc \uac00\ub2a5\ud569\ub2c8\ub2e4.");return}var r=new FileReader;r.onload=function(e){var t=e.target.result,r=GO.Editor.getInstance(n);r.setContent(t)},r.readAsText(t)})),r.trigger("click")}},this))},_bindDbClickEvent:function(e){var t=DEXT5.getDext5Dom(e);DEXT5.util.addEvent(t,"click",_.bind(function(e){this.$el.trigger("clickEditorContent",e),e.stopPropagation&&e.stopPropagation()},this)),DEXT5.util.addEvent(t,"keypress",_.bind(function(e){console.log("keypress"),this.$el.trigger("keypressEditorContent",e),e.stopPropagation&&e.stopPropagation()},this))},validate:function(){return encodeURIComponent(DEXT5.getBodyValue(this.idAttr)).length<15728640},getHTMLContent:function(){return this.getContent()},getContent:function(){return DEXT5.getBodyValue(this.idAttr)},getDocument:function(){return DEXT5.getDext5Dom(this.idAttr)},setContent:function(e,t){t?DEXT5.setInsertHTML(e,this.idAttr):(DEXT5.setBodyValue(e,this.idAttr),this.isFormEditor&&this._bindDbClickEvent(this.idAttr))},setHeight:function(e){DEXT5.config.Height=e},destroy:function(){t(this.ctx).parents("body").length&&DEXT5&&DEXT5.destroy(this.idAttr)},isAccessible:function(){return DEXT5.getEditor(this.idAttr)._currentMode!=="source"}})})(this,jQuery);