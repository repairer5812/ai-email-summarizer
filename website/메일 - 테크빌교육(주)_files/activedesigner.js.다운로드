(function(e,t){function o(e,t){t||!1?this.oEditor.BodyValue=u.call(this)+e:this.oEditor.BodyValue=e}function u(){return this.oEditor?this.oEditor.BodyValue:""}function a(){return['<iframe width="'+n+'" height="'+r,'" id="'+this.wrapperId+'" name="'+this.wrapperId,'" src="'+this.options.contextRoot+"editor/activedesigner?formId="+this.wrapperId,this.useImage===undefined?"":"&useImage="+this.useImage,'" style="border:0;" frameBorder="0"></iframe>'].join("")}function f(){return["<iframe id='"+this.idAttr+"ToggleFrame'","width='"+n+"' height='"+r+"'","style='display:none;border:1px solid gray' frameBorder='0'></iframe>"].join("")}function l(e){if(!c.call(this))return;var n=this;this.$el.siblings("#"+this.wrapperId).toggle(e);var r=document.getElementById(this.idAttr+"ToggleFrame");t(r).toggle(!e),t(r).ready(function(){r&&r.contentWindow&&r.contentWindow.document.body&&(r.contentWindow.document.body.innerHTML=n.getHTMLContent())})}function c(){return this.$el.siblings("#"+this.wrapperId).length>0}function h(){var e=this;this.hideListener=setTimeout(function(){var t=e.$el.parents("body").length>0;if(!t){e.destroy();return}h.call(e)},500)}function p(){clearTimeout(this.hideListener)}function d(){var e=(new Date).getTime(),t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var n=GO.util.getSecureRandomInt(0,15);return e=Math.floor(e/16),(t=="x"?n:n&3|8).toString(16)});return t}var n="100%",r="450px",i=GO.contextRoot||"/",s=15;t.getJSON(i+"resources/js/conf/editor/editor.config.json",function(e){r=e.config.height+"px"}).fail(function(e,t,n){console.warn("height \uc124\uc815\uc774 \uc5c6\uc2b5\ub2c8\ub2e4.")}),GO.Editor.registry("ActiveDesigner",{type:GO.Editor.TYPE_ACTIVEX,contentSetter:o,contentGetter:u,defaults:function(){return{contextRoot:i,onLoad:function(){},onUnload:function(){},content:""}},oEditor:null,initialize:function(e,n){this.__super__.initialize.call(this,e,n),this.wrapperId=this.idAttr+"Iframe",this.useImage=n.useImage,this.initDefer=t.Deferred(),this.uuid=d();var r=this;t(document).on("showLayer.goLayer."+this.uuid,function(e,n){r.initDefer.done(function(){var e=t("div[data-layer]:visible").length,i=n?e>=0:e>0;if(!i)return;r.deactivate()})}),t(document).on("hideLayer.goLayer."+this.uuid,function(e,n){r.initDefer.done(function(){var e=t("div[data-layer]:visible").length,i=n?e>1:e>0;if(i)return;r.activate()})}),t(document).trigger("showActiveX.editor")},render:function(){if(this.$el.siblings("iframe#"+this.idAttr).length)return;var e=this,n=e.$el.height()||r,i=a.call(this)+f.call(this);this.$el.attr("data-content-type","MIME"),this.$el.attr("data-editor","ActiveDesigner"),this.$el.after(i),this.$el.hide(),this.$el.siblings("#"+this.wrapperId).load(function(){var n=t(this).data("activeDesigner");e.deactivate(),n.done(function(t){e.activate(),e.oEditor=t,e.oEditor.BodyValue=e.options.content||"",e.initDefer.resolve(),e.onLoad()})}),this.$el.siblings("#"+this.idAttr+"ToggleFrame").load(function(){var e=this.contentWindow.document,t=e.head||e.getElementsByTagName("head")[0],n=e.createElement("style"),r="body, P {margin: 0px;padding: 0px;line-height: 1.5;font-size: 12px;font-family: \ub3cb\uc6c0,dotum,AppleGothic,arial,Helvetica,sans-serif;}";n.type="text/css",n.styleSheet?n.styleSheet.cssText=r:n.appendChild(e.createTextNode(r)),t.appendChild(n)}),h.call(this)},getContent:function(){return this.oEditor?this.getMIMEContent():""},getMIMEContent:function(){return this.oEditor?this.oEditor.MIMEValue:""},getHTMLContent:function(){return this.oEditor?this.oEditor.BodyValue:""},onLoad:function(){this.options.onLoad()},activate:function(){l.call(this,!0)},deactivate:function(){l.call(this,!1)},destroy:function(){this.$el.siblings("iframe").remove(),this.onUnload(),t(document).off("showLayer.goLayer."+this.uuid),t(document).off("hideLayer.goLayer."+this.uuid),t(document).trigger("hideActiveX.editor"),p.call(this)},validate:function(){var e=!0;try{this.oEditor&&!this.oEditor.MimeValue&&(e=!1),this.oEditor&&this.oEditor.MimeValue.length/1024/1024>s&&(e=!1)}catch(t){e=!1}return e},hideListener:null})})(this,jQuery);